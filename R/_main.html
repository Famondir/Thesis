<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Extraction of tabular data from annual reports with LLMs</title>
  <meta name="description" content="Extraction of tabular data from annual reports with LLMs" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="Extraction of tabular data from annual reports with LLMs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Extraction of tabular data from annual reports with LLMs" />
  
  
  

<meta name="author" content="Simon Schäfer" />


<meta name="date" content="2025-09-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/dt-ext-rowgroup-1.13.6/css/rowGroup.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-rowgroup-1.13.6/js/dataTables.rowGroup.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css">
<script src="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js"></script> -->


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="report_misc/style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Extraction of tabular data from annual reports with LLMs</h1>
<p class="author"><em>Simon Schäfer</em></p>
<p class="date"><em>September 8, 2025</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#motivation" id="toc-motivation"><span class="toc-section-number">1.1</span> Motivation</a></li>
<li><a href="#objectives" id="toc-objectives"><span class="toc-section-number">1.2</span> Objectives</a></li>
<li><a href="#introduction-methodology" id="toc-introduction-methodology"><span class="toc-section-number">1.3</span> Methodology</a></li>
<li><a href="#thesis-outline" id="toc-thesis-outline"><span class="toc-section-number">1.4</span> Thesis Outline</a></li>
<li><a href="#summary" id="toc-summary"><span class="toc-section-number">1.5</span> Summary</a></li>
<li><a href="#to-place-in-chapters-above" id="toc-to-place-in-chapters-above"><span class="toc-section-number">1.6</span> To place in chapters above</a></li>
<li><a href="#unstrukturierte-daten" id="toc-unstrukturierte-daten"><span class="toc-section-number">1.7</span> Unstrukturierte Daten</a>
<ul>
<li><a href="#portable-document-format" id="toc-portable-document-format"><span class="toc-section-number">1.7.1</span> Portable Document Format</a></li>
</ul></li>
</ul></li>
<li><a href="#literature-review" id="toc-literature-review"><span class="toc-section-number">2</span> Literature review</a>
<ul>
<li><a href="#information-retrieval" id="toc-information-retrieval"><span class="toc-section-number">2.1</span> Information extraction / retrieval</a>
<ul>
<li><a href="#term-frequency" id="toc-term-frequency"><span class="toc-section-number">2.1.1</span> Term frequency</a></li>
<li><a href="#text-processing" id="toc-text-processing"><span class="toc-section-number">2.1.2</span> Text processing</a></li>
<li><a href="#regular-expressions" id="toc-regular-expressions"><span class="toc-section-number">2.1.3</span> Regular expressions</a></li>
<li><a href="#llm-theory" id="toc-llm-theory"><span class="toc-section-number">2.1.4</span> Large Language Models</a>
<ul>
<li><a href="#transformers" id="toc-transformers"><span class="toc-section-number">2.1.4.1</span> Transformers</a></li>
<li><a href="#encoder" id="toc-encoder"><span class="toc-section-number">2.1.4.2</span> Encoder</a></li>
<li><a href="#decoder" id="toc-decoder"><span class="toc-section-number">2.1.4.3</span> Decoder</a></li>
<li><a href="#gpt-generative-pretrained-transformers" id="toc-gpt-generative-pretrained-transformers"><span class="toc-section-number">2.1.4.4</span> GPT (Generative Pretrained Transformers)</a></li>
<li><a href="#mixture-of-experts" id="toc-mixture-of-experts"><span class="toc-section-number">2.1.4.5</span> Mixture of Experts</a></li>
<li><a href="#mixed-modal" id="toc-mixed-modal"><span class="toc-section-number">2.1.4.6</span> Mixed modal</a></li>
</ul></li>
<li><a href="#llm-methods" id="toc-llm-methods"><span class="toc-section-number">2.1.5</span> Methods for LLM application</a>
<ul>
<li><a href="#few-shot-learning" id="toc-few-shot-learning"><span class="toc-section-number">2.1.5.1</span> Few-shot Learning</a></li>
<li><a href="#rag" id="toc-rag"><span class="toc-section-number">2.1.5.2</span> RAG</a></li>
<li><a href="#guided-and-restricted-decoding" id="toc-guided-and-restricted-decoding"><span class="toc-section-number">2.1.5.3</span> Guided and restricted decoding</a></li>
</ul></li>
</ul></li>
<li><a href="#other-concepts" id="toc-other-concepts"><span class="toc-section-number">2.2</span> Other concepts</a>
<ul>
<li><a href="#sample-distribution-visualization-methods" id="toc-sample-distribution-visualization-methods"><span class="toc-section-number">2.2.1</span> Sample distribution visualization methods</a></li>
<li><a href="#tree-based-machine-learning-algorithms" id="toc-tree-based-machine-learning-algorithms"><span class="toc-section-number">2.2.2</span> Tree based machine learning algorithms</a></li>
<li><a href="#shap" id="toc-shap"><span class="toc-section-number">2.2.3</span> Model agnostic explanation models</a></li>
</ul></li>
<li><a href="#summary-0.5-p" id="toc-summary-0.5-p"><span class="toc-section-number">2.3</span> Summary (0.5 p)</a></li>
<li><a href="#to-place-in-chapters-above-1" id="toc-to-place-in-chapters-above-1"><span class="toc-section-number">2.4</span> To place in chapters above</a></li>
<li><a href="#table-extraction-tasks" id="toc-table-extraction-tasks"><span class="toc-section-number">2.5</span> Table extraction tasks</a>
<ul>
<li><a href="#difficulties" id="toc-difficulties"><span class="toc-section-number">2.5.1</span> Difficulties</a></li>
</ul></li>
<li><a href="#document-extraction-process" id="toc-document-extraction-process"><span class="toc-section-number">2.6</span> Document Extraction Process</a>
<ul>
<li><a href="#document-layout-analysis" id="toc-document-layout-analysis"><span class="toc-section-number">2.6.1</span> Document Layout Analysis</a></li>
</ul></li>
<li><a href="#tools" id="toc-tools"><span class="toc-section-number">2.7</span> Tools</a>
<ul>
<li><a href="#vision-grid-transformer" id="toc-vision-grid-transformer"><span class="toc-section-number">2.7.0.1</span> Vision Grid Transformer</a></li>
<li><a href="#tableformer" id="toc-tableformer"><span class="toc-section-number">2.7.0.2</span> TableFormer</a></li>
</ul></li>
</ul></li>
<li><a href="#methodology" id="toc-methodology"><span class="toc-section-number">3</span> Methodology</a>
<ul>
<li><a href="#problem-definition" id="toc-problem-definition"><span class="toc-section-number">3.1</span> Problem Definition</a></li>
<li><a href="#research-design-philosophy" id="toc-research-design-philosophy"><span class="toc-section-number">3.2</span> Research Design &amp; Philosophy</a>
<ul>
<li><a href="#research-questions" id="toc-research-questions"><span class="toc-section-number">3.2.1</span> Research questions</a></li>
<li><a href="#evaluation-framework" id="toc-evaluation-framework"><span class="toc-section-number">3.2.2</span> Evaluation framework</a></li>
<li><a href="#evaluation-research" id="toc-evaluation-research"><span class="toc-section-number">3.2.3</span> Evaluation research</a></li>
</ul></li>
<li><a href="#evaluation-strategy" id="toc-evaluation-strategy"><span class="toc-section-number">3.3</span> Evaluation Strategy</a>
<ul>
<li><a href="#metrics" id="toc-metrics"><span class="toc-section-number">3.3.1</span> Metrics</a></li>
<li><a href="#benchmarking" id="toc-benchmarking"><span class="toc-section-number">3.3.2</span> Benchmarking</a></li>
</ul></li>
<li><a href="#data-strategy" id="toc-data-strategy"><span class="toc-section-number">3.4</span> Data Strategy</a>
<ul>
<li><a href="#sampling-methodology" id="toc-sampling-methodology"><span class="toc-section-number">3.4.1</span> Sampling methodology</a></li>
<li><a href="#ground-truth-creation-process" id="toc-ground-truth-creation-process"><span class="toc-section-number">3.4.2</span> Ground truth creation process</a></li>
<li><a href="#preprocessing" id="toc-preprocessing"><span class="toc-section-number">3.4.3</span> Preprocessing</a></li>
<li><a href="#data-splitting" id="toc-data-splitting"><span class="toc-section-number">3.4.4</span> Data splitting</a></li>
</ul></li>
<li><a href="#experimental-framework" id="toc-experimental-framework"><span class="toc-section-number">3.5</span> Experimental Framework</a>
<ul>
<li><a href="#llm-overview" id="toc-llm-overview"><span class="toc-section-number">3.5.1</span> LLM overview</a></li>
<li><a href="#gpu-benchmark" id="toc-gpu-benchmark"><span class="toc-section-number">3.5.2</span> Hardware normalization</a></li>
<li><a href="#error-analysis" id="toc-error-analysis"><span class="toc-section-number">3.5.3</span> Error analysis</a></li>
<li><a href="#baseline-selection-rationale" id="toc-baseline-selection-rationale"><span class="toc-section-number">3.5.4</span> Baseline selection rationale</a></li>
<li><a href="#prompt-building" id="toc-prompt-building"><span class="toc-section-number">3.5.5</span> Prompt building</a></li>
<li><a href="#evaluation-methods" id="toc-evaluation-methods"><span class="toc-section-number">3.5.6</span> Evaluation methods</a></li>
</ul></li>
<li><a href="#ethical-practical-considerations-eher-am-ende-oder-weg" id="toc-ethical-practical-considerations-eher-am-ende-oder-weg"><span class="toc-section-number">3.6</span> Ethical &amp; Practical Considerations (eher am Ende oder weg?)</a>
<ul>
<li><a href="#pdf-extraction-limitations" id="toc-pdf-extraction-limitations"><span class="toc-section-number">3.6.1</span> PDF extraction limitations</a></li>
<li><a href="#computational-constraints" id="toc-computational-constraints"><span class="toc-section-number">3.6.2</span> Computational constraints</a></li>
<li><a href="#generalizability-scope" id="toc-generalizability-scope"><span class="toc-section-number">3.6.3</span> Generalizability scope</a></li>
<li><a href="#ethical-considerations" id="toc-ethical-considerations"><span class="toc-section-number">3.6.4</span> Ethical considerations</a></li>
</ul></li>
</ul></li>
<li><a href="#implementation" id="toc-implementation"><span class="toc-section-number">4</span> Implementation</a>
<ul>
<li><a href="#environments" id="toc-environments"><span class="toc-section-number">4.1</span> Environments</a></li>
<li><a href="#evaluation-and-reporting" id="toc-evaluation-and-reporting"><span class="toc-section-number">4.2</span> Evaluation and Reporting</a></li>
<li><a href="#software-packages" id="toc-software-packages"><span class="toc-section-number">4.3</span> Software Packages</a></li>
<li><a href="#speedup-with-vllm-and-batching" id="toc-speedup-with-vllm-and-batching"><span class="toc-section-number">4.4</span> Speedup with vLLM and batching</a></li>
<li><a href="#text-extraction" id="toc-text-extraction"><span class="toc-section-number">4.5</span> Text extraction</a></li>
<li><a href="#data-processing" id="toc-data-processing"><span class="toc-section-number">4.6</span> Data processing</a></li>
</ul></li>
<li><a href="#results" id="toc-results"><span class="toc-section-number">5</span> Results</a>
<ul>
<li><a href="#page-identification-introduction" id="toc-page-identification-introduction"><span class="toc-section-number">5.1</span> Page identification</a>
<ul>
<li><a href="#approaches" id="toc-approaches"><span class="toc-section-number">5.1.1</span> Approaches</a></li>
<li><a href="#comparison-page-identification" id="toc-comparison-page-identification"><span class="toc-section-number">5.1.2</span> Comparison</a></li>
</ul></li>
<li><a href="#table-extraction-introduction" id="toc-table-extraction-introduction"><span class="toc-section-number">5.2</span> Information extraction</a>
<ul>
<li><a href="#approaches-1" id="toc-approaches-1"><span class="toc-section-number">5.2.1</span> Approaches</a></li>
<li><a href="#comparing-table-extraction-methods" id="toc-comparing-table-extraction-methods"><span class="toc-section-number">5.2.2</span> Comparison</a></li>
</ul></li>
<li><a href="#error-rate-guidance-results" id="toc-error-rate-guidance-results"><span class="toc-section-number">5.3</span> Error rate guidance</a>
<ul>
<li><a href="#page-identification-error-rate-results" id="toc-page-identification-error-rate-results"><span class="toc-section-number">5.3.1</span> Page identification</a></li>
<li><a href="#information-extraction-error-rate-results" id="toc-information-extraction-error-rate-results"><span class="toc-section-number">5.3.2</span> Information extraction</a></li>
</ul></li>
<li><a href="#summary-results" id="toc-summary-results"><span class="toc-section-number">5.4</span> Summary</a></li>
</ul></li>
<li><a href="#discussion" id="toc-discussion"><span class="toc-section-number">6</span> Discussion</a>
<ul>
<li><a href="#interpretations" id="toc-interpretations"><span class="toc-section-number">6.1</span> Interpretations</a>
<ul>
<li><a href="#table-extraction" id="toc-table-extraction"><span class="toc-section-number">6.1.0.1</span> Table extraction</a></li>
</ul></li>
<li><a href="#limitations" id="toc-limitations"><span class="toc-section-number">6.2</span> Limitations</a>
<ul>
<li><a href="#table-extraction-1" id="toc-table-extraction-1"><span class="toc-section-number">6.2.1</span> table extraction</a>
<ul>
<li><a href="#regex-baseline" id="toc-regex-baseline"><span class="toc-section-number">6.2.1.1</span> Regex baseline</a></li>
</ul></li>
<li><a href="#classification" id="toc-classification"><span class="toc-section-number">6.2.2</span> classification</a></li>
</ul></li>
<li><a href="#not-covered" id="toc-not-covered"><span class="toc-section-number">6.3</span> Not covered</a>
<ul>
<li><a href="#table-detection-extraction" id="toc-table-detection-extraction"><span class="toc-section-number">6.3.1</span> Table detection / extraction</a></li>
</ul></li>
<li><a href="#outlook" id="toc-outlook"><span class="toc-section-number">6.4</span> Outlook</a>
<ul>
<li><a href="#vision-model" id="toc-vision-model"><span class="toc-section-number">6.4.1</span> Vision Model</a></li>
<li><a href="#docling-and-co" id="toc-docling-and-co"><span class="toc-section-number">6.4.2</span> Docling and Co</a></li>
<li><a href="#table-extraction-2" id="toc-table-extraction-2"><span class="toc-section-number">6.4.3</span> Table extraction</a></li>
<li><a href="#sophisticated-approaches-for-text-extraction" id="toc-sophisticated-approaches-for-text-extraction"><span class="toc-section-number">6.4.4</span> Sophisticated approaches for text extraction</a></li>
</ul></li>
<li><a href="#error-analysis-1" id="toc-error-analysis-1"><span class="toc-section-number">6.5</span> Error analysis</a></li>
</ul></li>
<li><a href="#conclusion" id="toc-conclusion"><span class="toc-section-number">7</span> Conclusion</a></li>
<li><a href="#references" id="toc-references">References</a></li>
<li><a href="#glossary" id="toc-glossary">Glossary</a></li>
<li><a href="#page-identification-report" id="toc-page-identification-report"><span class="toc-section-number">8</span> Appendix A - Page identification report</a>
<ul>
<li><a href="#regex-page-identification" id="toc-regex-page-identification"><span class="toc-section-number">8.1</span> Baseline: Regex</a></li>
<li><a href="#toc-understanding" id="toc-toc-understanding"><span class="toc-section-number">8.2</span> Table of Contents understanding</a>
<ul>
<li><a href="#text-based-toc-understanding" id="toc-text-based-toc-understanding"><span class="toc-section-number">8.2.1</span> Details for the approaches</a></li>
<li><a href="#results-1" id="toc-results-1"><span class="toc-section-number">8.2.2</span> Results</a></li>
<li><a href="#machine-readable-toc-approach-specific-results" id="toc-machine-readable-toc-approach-specific-results"><span class="toc-section-number">8.2.3</span> Machine readable TOC approach specific results</a></li>
</ul></li>
<li><a href="#llm-page-identification" id="toc-llm-page-identification"><span class="toc-section-number">8.3</span> Classification with LLMs</a>
<ul>
<li><a href="#binary-classification" id="toc-binary-classification"><span class="toc-section-number">8.3.1</span> Binary classification</a></li>
<li><a href="#multi-class-classification" id="toc-multi-class-classification"><span class="toc-section-number">8.3.2</span> Multi-class classification</a></li>
</ul></li>
<li><a href="#tf-classifier" id="toc-tf-classifier"><span class="toc-section-number">8.4</span> Term frequency based classifier</a></li>
<li><a href="#summary-2" id="toc-summary-2"><span class="toc-section-number">8.5</span> Summary</a></li>
</ul></li>
<li><a href="#appendix-b---information-extraction-report" id="toc-appendix-b---information-extraction-report"><span class="toc-section-number">9</span> Appendix B - Information extraction report</a>
<ul>
<li><a href="#baseline-regex" id="toc-baseline-regex"><span class="toc-section-number">9.1</span> Baseline: Regex</a></li>
<li><a href="#extraction-with-llms-real-tables" id="toc-extraction-with-llms-real-tables"><span class="toc-section-number">9.2</span> Extraction with LLMs</a>
<ul>
<li><a href="#real-table-extraction-results" id="toc-real-table-extraction-results"><span class="toc-section-number">9.2.1</span> Real tables</a></li>
<li><a href="#synthetic-table-extraction" id="toc-synthetic-table-extraction"><span class="toc-section-number">9.2.2</span> Synthetic tables</a></li>
<li><a href="#real-table-extraction-synth-context" id="toc-real-table-extraction-synth-context"><span class="toc-section-number">9.2.3</span> Hybrid approach</a></li>
</ul></li>
<li><a href="#summary-3" id="toc-summary-3"><span class="toc-section-number">9.3</span> Summary</a></li>
</ul></li>
<li><a href="#appendix-c---error-rate-guidance-report" id="toc-appendix-c---error-rate-guidance-report"><span class="toc-section-number">10</span> Appendix C - Error rate guidance report</a>
<ul>
<li><a href="#page-identification-4" id="toc-page-identification-4"><span class="toc-section-number">10.1</span> Page identification</a>
<ul>
<li><a href="#binary-classification-1" id="toc-binary-classification-1"><span class="toc-section-number">10.1.1</span> Binary classification</a></li>
<li><a href="#multi-class-classification-1" id="toc-multi-class-classification-1"><span class="toc-section-number">10.1.2</span> Multi-class classification</a></li>
</ul></li>
<li><a href="#extraction-with-llms" id="toc-extraction-with-llms"><span class="toc-section-number">10.2</span> Extraction with LLMs</a>
<ul>
<li><a href="#real-tables-1" id="toc-real-tables-1"><span class="toc-section-number">10.2.1</span> Real tables</a></li>
<li><a href="#synthetic-tables-1" id="toc-synthetic-tables-1"><span class="toc-section-number">10.2.2</span> Synthetic tables</a></li>
<li><a href="#hybrid-aproach" id="toc-hybrid-aproach"><span class="toc-section-number">10.2.3</span> Hybrid aproach</a></li>
</ul></li>
</ul></li>
<li><a href="#appendix-d---feature-effect-analysis" id="toc-appendix-d---feature-effect-analysis"><span class="toc-section-number">11</span> Appendix D - Feature effect analysis</a>
<ul>
<li><a href="#regular-expressions-3" id="toc-regular-expressions-3"><span class="toc-section-number">11.1</span> Regular expressions</a></li>
<li><a href="#real-tables-2" id="toc-real-tables-2"><span class="toc-section-number">11.2</span> Real tables</a></li>
<li><a href="#hybrid-approach-1" id="toc-hybrid-approach-1"><span class="toc-section-number">11.3</span> Hybrid approach</a></li>
</ul></li>
<li><a href="#appendix-e---miscellaneous" id="toc-appendix-e---miscellaneous"><span class="toc-section-number">12</span> Appendix E - Miscellaneous</a>
<ul>
<li><a href="#hitl" id="toc-hitl"><span class="toc-section-number">12.1</span> Human in the loop application</a></li>
<li><a href="#local-machine" id="toc-local-machine"><span class="toc-section-number">12.2</span> Local machine</a></li>
<li><a href="#benchmarks" id="toc-benchmarks"><span class="toc-section-number">12.3</span> Benchmarks</a>
<ul>
<li><a href="#text-extraction-benchmark" id="toc-text-extraction-benchmark"><span class="toc-section-number">12.3.1</span> Text extraction</a></li>
<li><a href="#table-detection-benchmark" id="toc-table-detection-benchmark"><span class="toc-section-number">12.3.2</span> Table detection</a>
<ul>
<li><a href="#yolo-benchmark-and-table-transformer" id="toc-yolo-benchmark-and-table-transformer"><span class="toc-section-number">12.3.2.1</span> yolo benchmark and table transformer</a></li>
<li><a href="#old-classification-with-llm" id="toc-old-classification-with-llm"><span class="toc-section-number">12.3.2.2</span> old classification with llm</a></li>
</ul></li>
<li><a href="#vllm-batch-speed" id="toc-vllm-batch-speed"><span class="toc-section-number">12.3.3</span> Large language model process speed</a></li>
</ul></li>
<li><a href="#prompts" id="toc-prompts"><span class="toc-section-number">12.4</span> Prompts</a>
<ul>
<li><a href="#toc-understanding-promts" id="toc-toc-understanding-promts"><span class="toc-section-number">12.4.1</span> TOC understanding</a></li>
<li><a href="#classification-prompts" id="toc-classification-prompts"><span class="toc-section-number">12.4.2</span> Classification</a></li>
</ul></li>
<li><a href="#regex-page-identification-code" id="toc-regex-page-identification-code"><span class="toc-section-number">12.5</span> Regular expressions</a></li>
<li><a href="#annual-comprehensive-financial-report-balance-sheet" id="toc-annual-comprehensive-financial-report-balance-sheet"><span class="toc-section-number">12.6</span> Annual Comprehensive Financial Report Balance Sheet</a></li>
<li><a href="#extraction-framework-flow-chart" id="toc-extraction-framework-flow-chart"><span class="toc-section-number">12.7</span> Extraction framework flow chart</a></li>
<li><a href="#regex-extraction-mistakes" id="toc-regex-extraction-mistakes"><span class="toc-section-number">12.8</span> Table extraction with regular expressions</a></li>
</ul></li>
<li><a href="#tables" id="toc-tables"><span class="toc-section-number">13</span> Tables</a>
<ul>
<li><a href="#classification-1" id="toc-classification-1"><span class="toc-section-number">13.1</span> Classification</a></li>
<li><a href="#table-extraction-3" id="toc-table-extraction-3"><span class="toc-section-number">13.2</span> Table extraction</a>
<ul>
<li><a href="#hybrid-approach-2" id="toc-hybrid-approach-2"><span class="toc-section-number">13.2.1</span> Hybrid approach</a></li>
</ul></li>
</ul></li>
<li><a href="#figures" id="toc-figures"><span class="toc-section-number">14</span> Figures</a>
<ul>
<li><a href="#page-identification-5" id="toc-page-identification-5"><span class="toc-section-number">14.1</span> Page identification</a>
<ul>
<li><a href="#regex-baseline-1" id="toc-regex-baseline-1"><span class="toc-section-number">14.1.1</span> Regex baseline</a></li>
<li><a href="#toc-understanding-1" id="toc-toc-understanding-1"><span class="toc-section-number">14.1.2</span> TOC understanding</a></li>
<li><a href="#classification-2" id="toc-classification-2"><span class="toc-section-number">14.1.3</span> Classification</a>
<ul>
<li><a href="#binary" id="toc-binary"><span class="toc-section-number">14.1.3.1</span> Binary</a></li>
<li><a href="#multi-class-classification-2" id="toc-multi-class-classification-2"><span class="toc-section-number">14.1.3.2</span> Multi-class classification</a></li>
</ul></li>
</ul></li>
<li><a href="#table-extraction-4" id="toc-table-extraction-4"><span class="toc-section-number">14.2</span> Table extraction</a>
<ul>
<li><a href="#regex-approach" id="toc-regex-approach"><span class="toc-section-number">14.2.1</span> Regex approach</a>
<ul>
<li><a href="#real-tables-3" id="toc-real-tables-3"><span class="toc-section-number">14.2.1.1</span> Real tables</a></li>
<li><a href="#synthetic-tables-2" id="toc-synthetic-tables-2"><span class="toc-section-number">14.2.1.2</span> Synthetic tables</a></li>
</ul></li>
<li><a href="#real-tables-4" id="toc-real-tables-4"><span class="toc-section-number">14.2.2</span> Real tables</a>
<ul>
<li><a href="#examples-from-same-company" id="toc-examples-from-same-company"><span class="toc-section-number">14.2.2.1</span> Examples from same company</a></li>
<li><a href="#openai-models-1" id="toc-openai-models-1"><span class="toc-section-number">14.2.2.2</span> OpenAI models</a></li>
<li><a href="#hypotheses-5" id="toc-hypotheses-5"><span class="toc-section-number">14.2.2.3</span> Hypotheses</a></li>
</ul></li>
<li><a href="#synthetic-tables-3" id="toc-synthetic-tables-3"><span class="toc-section-number">14.2.3</span> Synthetic tables</a>
<ul>
<li><a href="#confidence-4" id="toc-confidence-4"><span class="toc-section-number">14.2.3.1</span> Confidence</a></li>
</ul></li>
<li><a href="#hybrid-approach-3" id="toc-hybrid-approach-3"><span class="toc-section-number">14.2.4</span> Hybrid approach</a></li>
</ul></li>
</ul></li>
<li><a href="#layout-testing" id="toc-layout-testing"><span class="toc-section-number">15</span> Layout testing</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extraction of tabular data from annual reports with LLMs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="section" class="section level1 unlisted unnumbered">
<h1 class="unlisted unnumbered"></h1>
<div id="abstract" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Abstract<a href="#abstract" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Content of this thesis is a benchmark on information extraction from PDFs. The focus are annual reports of German companies. Special characteristic of the task is handling hierarchies in tables with financial data to prepare the data for import into a relational database.</p>
<p>The benchmark is composed of two sub tasks and the performance of different open source large language models is tested with different prompting approaches and compared to alternative methods.</p>
<p>This can be seen as a reimplementation study of “Extracting Financial Data from Unstructured Sources: Leveraging Large Language Models” - a paper published by <span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span>. The key differences are the application on German documents using open source large language models.</p>
<p>We show, that also smaller open source <a href="#acronyms_LLM">LLM (large language model)</a>s can be used to identify the pages that contain the information of interest and to extract it. Based on these findings we sketch a process, how humans can use <a href="#acronyms_LLM">LLM</a>s to extract information from financial reports.</p>
</div>
<div id="zusammenfassung" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Zusammenfassung<a href="#zusammenfassung" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Gegenstand dieser Arbeit ist ein Benchmark zur Informationsextraktion aus PDF-Dateien. Dabei wird sich auf das Auslesen der Bilanzen und Gewinn- und Verlustrechnungen aus Jahresabschlüssen deutscher Unternehmen beschränkt. Ein besonderer Aspekt der Aufgabe ist die Berücksichtigung der Hierarchie innerhalb der Tabellen, um die Werte einem festen Schema zuzuordnen und so den Import in eine relationale Datenbank vorzubereiten.</p>
</div>
<div id="reading-advices" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Reading advices<a href="#reading-advices" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The author recommends to read the thesis in its <a href="https://famondir.github.io/Thesis/">digital gitbook version</a> instead of the PDF version. Furthermore, the author recommends to read the thesis (any version) on a screen that is larger than 21” and has at least full HD resolution<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The more, the merrier.</p>
<p><span style="font-size: 1.5em;">😊</span> </p>
</div>
<div id="declaration-of-the-use-of-artificial-intelligence" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Declaration of the Use of Artificial Intelligence<a href="#declaration-of-the-use-of-artificial-intelligence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use Github Copilot in VSCode for coding assistance. Mostly the GPT-4.1 is used. Sometimes Claude Sonnet 4.</p>
<p>We use perplexity.ai in our literature research process.</p>
<p>We use [] for</p>
</div>
<div id="goals-and-learnings" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Goals and Learnings<a href="#goals-and-learnings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Achieved:</p>
<ul>
<li>thesis with bookdown</li>
<li>docker image creation</li>
<li>cluster orchestration</li>
<li>llm usage</li>
<li>guided decoding</li>
</ul>
<p>Missed:</p>
<ul>
<li>Administrating a k8s cluster</li>
<li>Fine tuning a model</li>
<li>using small language models</li>
<li>training a lm</li>
<li>using vllms</li>
</ul>
</div>
<div id="dedication" class="section level2 unlisted unnumbered hasAnchor">
<h2 class="unlisted unnumbered hasAnchor">Dedication<a href="#dedication" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Micha</p>
<p></p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="introduction" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Information is generated and processed by humans. And it is shared among
humans. At first this information sharing was done synchronous using
their voice. Later they developed the capabilities to store information
at clay tablets, paper and most recently in digital files
<span class="citation">(<a href="#ref-bentleyKnowingYouKnow2025">Bentley, 2025</a>)</span>. The amount of stored information, the
human knowledge base grew paper by paper, file by file. The field of
library and information science emerged, to organize these information,
in order to allow efficient access. Since the information was shared
only among humans, the format of stored data was optimized for human
perception as well.</p>
<p>But things have changed in multiple ways. First, the amount of
information generation is growing rapidly and the amount of relevant
knowledge is increasing faster, than humans can absorb
<span class="citation">(<a href="#ref-chamberlainKnowledgeNotEverything2020">Chamberlain, 2020</a>)</span>. Alone in the field of science
each year volumes of new information is beyond any human’s ability to
read are created <span class="citation">(<a href="#ref-hongChallengesAdvancesInformation2021">Hong et al., 2021</a>)</span>. Luckily, the
advent of recent <a href="#acronyms_LLM">LLM</a>s gives us a tool to compress this information
before reception by summarizing texts.</p>
<p>But on the same time generative <a href="#acronyms_AI">AI (artificial intelligence)</a> drives the increasing rate of
information generation. A human can initiate the generation of a whole
website or book with a single sentence of natural language. Most
recently <a href="#acronyms_AI">AI</a> agents can, once created, react to triggers in the
digital or real world and automatically generate content. Together with
the information generated by devices in the Internet of Things the
extrapolation of a information duplication every eleven hours
<span class="citation">(<a href="#ref-ibmglobaltechnologyservicesToxicTerabyte2006">IBM Global Technology Services, 2006</a>)</span> might have become
reality. This is the second thing that changed: algorithms generate,
process and share information too.</p>
<p>What often remains unchanged until today: a lot of the published
information is optimized for human processing, e.g. in <a href="#acronyms_PDF">PDF (Portable Document Format)</a>
documents. Algorithms can be very efficient in information processing,
iff the information is machine readable. Since it is inefficient and
error-prone to let humans encode the information, the field of
information retrieval emerged as a new field of research. <a href="#acronyms_LLM">LLM</a>s can
help to retrieve information, even in a structured format, that can be
used from other algorithms in downstream tasks.</p>
<p>For older sources of information this is the only way possible. For
information shared in future there is another, more direct solution:
additionally providing the information in a machine readable format in
the first place. Otherwise we keep facing the “Last Mile Problem”
<span class="citation">(<a href="#ref-liAddressingLastMile2023">H. Li, Wei, et al., 2023</a>)</span>. Since the format, data is provided in, can
only be changed for the data owned by one self, one has to cope with the
data received, until the needs for machine-readable formats is
successfully communicated to and served by the data owners.</p>
<p>Section @ref(motivation) describes, that the amount and format of
information provided to the <a href="#acronyms_RHvB">RHvB (Rechnungshof von Berlin)</a> are raising challenges for the
audition process. Section @ref(objectives) specifies these challenges
to specific real world problem. We derive our research questions from
this use case. Section @ref(introduction-methodology) gives an overview
of our methodology and the thesis outline can be found in section
@ref(thesis-outline).</p>
<div id="motivation" class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> Motivation<a href="#motivation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the last decades the digital transformation accelerated and
“electronic documents have increasingly supplanted paper documents as
the primary medium for information exchange across various industries”
<span class="citation">(<a href="#ref-zhangDocumentParsingUnveiled2024">Q. Zhang et al., 2024, p. 1</a>)</span>. And also within the finance
industry a lot of information is stored in (unstructured) digital
formats, i.e. in <a href="#acronyms_PDF">PDF</a> files <span class="citation">(<a href="#ref-liExtractingFinancialData2023">H. Li, Gao, et al., 2023</a>)</span>. This
is not only impeding investment decisions
<span class="citation">(<a href="#ref-el-hajRetrievingClassifyingAnalysing2020">El-Haj et al., 2020</a>)</span> and academic research
<span class="citation">(<a href="#ref-jrHowBigData2015">Jr et al., 2015</a>)</span> but also regulatory processes
<span class="citation">(<a href="#ref-liAddressingLastMile2023">H. Li, Wei, et al., 2023</a>)</span>.</p>
<p>Such regulatory processes may be grounded on the audition reports by the
<a href="#acronyms_RHvB">RHvB</a>. The <a href="#acronyms_RHvB">RHvB</a> is contributing to the transparent usage of
tax money in Berlin by auditing public administrations and companies,
where the state of Berlin is a shareholder or that get funded with
public money. This prevents corruption and ensures efficient spending
procedures.</p>
<p>In the audition process the employees at <a href="#acronyms_RHvB">RHvB</a> are faced with a lot
of information embedded in <a href="#acronyms_PDF">PDF</a> documents. Some are native digital
documents, while other are just scanned paper pages.For the audition of
the UEFA football championship they receive gigabytes of data. To
extract the information necessary to perform the audition is a big
challenge and would require a huge amount of human work force.
Algorithmic assistance is highly welcome.</p>
<p>Since the targets of the audition change frequently, classical rule
based approaches seem to have a rather limited payoff, comparing time
used programming the system and the times it gets used. Thus, leveraging
the flexible automation capabilities through programming by examples
with <a href="#acronyms_LLM">LLM</a>s <span class="citation">(<a href="#ref-liProgrammingExampleSolved2024">W.-D. Li &amp; Ellis, 2024</a>)</span> seems promising. The
need for automation is also driven by the impending shortage of
experienced employees due to large number of retirements.</p>
</div>
<div id="objectives" class="section level2 hasAnchor" number="1.2">
<h2 class="hasAnchor"><span class="header-section-number">1.2</span> Objectives<a href="#objectives" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The sixth division at <a href="#acronyms_RHvB">RHvB</a> is auditing the companies where Berlin
is a shareholder (see Figure @ref(fig:beteiligungsunternehmen). They
have to process the balance sheets and profit and loss accounting as a
fundamental information. Those information is provided via the companies
annual reports in form of <a href="#acronyms_PDF">PDF</a> files. Automate the extraction of
those information would be a good starting point for <a href="#acronyms_AI">AI</a> assisted
information retrieval from <a href="#acronyms_PDF">PDF</a>s for the <a href="#acronyms_RHvB">RHvB</a> overall. It
especially is worth the effort invested in a thesis, because exporting
financial data from the 59 companies is a recurring task.</p>
<div class="figure">
<img src="images/beteiligungsunternehmen.png" alt="Overview of the 59 companies Berlin holds share at." width="100%" />
<p class="caption">
(#fig:beteiligungsunternehmen)Overview of the 59 companies Berlin holds share at.
</p>
</div>
<p>The provided annual reports often differ from the publicly available
ones in matter of information granularity and design and are treated as
non public information. For this thesis we use the publicly available
versions to allow a comparison of open-source models with OpenAIs
<a href="#acronyms_GPT">GPT (generative pre-trained transformers)</a> models. We focus on open-source models, because the
information in the non public reports might be confidential. The
Berliner IKT-Richtlinie prohibits the processing of such information at
public clouds and empowers the usage of open-source solutions.</p>
<p>We limit the broad field of information retrieval for this thesis on the
extraction of the assets table, that is part of the balance sheet. To
reach a high degree of automation, we investigate the possibilities of
detecting the table, without having the user to provide the page number
or area, as a second task. We formulate our two main research questions:</p>
<ol class="rs-questions">
<li>
How can we use LLMs effectively to locate specific information in a financial report?
</li>
<li>
How can we use LLMs effectively to extract these information from the document?
</li>
</ol>
<p>Since the results of this thesis will be used to create an application
with <a href="#acronyms_HITL">HITL (human-in-the-loop)</a> approach, we want to investigate an additional side
research question. Section @ref(hitl) presents the idea for the
application. The user should check the information extraction results
and resolve issues, the system alone could not handle. But redundant
double work should be minimized. Therefore we formulate our third
research question:</p>
<ol class="rs-questions" style="--counter: 3;">
<li>
Can we use additional information from the extraction process, to guide the user which values need to be checked and which can be trusted as they are?
</li>
</ol>
<p>The following section will briefly describe our methodology to
investigate our research questions. The corresponding hypotheses are
formulated in section @ref(research-questions).</p>
</div>
<div id="introduction-methodology" class="section level2 hasAnchor" number="1.3">
<h2 class="hasAnchor"><span class="header-section-number">1.3</span> Methodology<a href="#introduction-methodology" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This thesis is aiming to give a recommendation, how to solve the
described extraction task best. Thus, it is placed in the field of
applied research. We benchmark a broad variety of approaches and conduct
experiments, to identify general predictors for the task performance. We
start our investigation, implementing the framework described by
<span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span>. Figure
@ref(fig:extraction-framework-flow-chart) shows that they describe two
stages, that match with our main research questions.</p>
<p>First, they show different approaches to identify the page, that
contains the searched information, and how to combine those approaches
efficiently. Additionally to a <a href="#acronyms_regex">regex (regular expression)</a> based and a <a href="#acronyms_LLM">LLM</a> driven
<a href="#acronyms_TOC">TOC (table of contents)</a> based approach, we test a <a href="#acronyms_LLM">LLM</a> driven classification
approach, as well as a term-frequency based ranking approach.</p>
<p>Second, they show that <a href="#acronyms_LLM">LLM</a>s can effectively extract the target
information with the correct prompting strategy. We extend their task by
testing, how well <a href="#acronyms_LLM">LLM</a> can extract multiple values in a single
prompt and designed experiments measure the effect of different
influence factors. Besides model and prompting specific predictors, we
systematically evaluate characteristics of the tabular structure as
well.</p>
<p>Furthermore, we test the upper limits for the extraction performance
with a synthetic dataset, that is free of unknown target row
identifiers. This allows us, to test, if a simple text extract can be
sufficient as input or if additional effort - e.g. performing a document
layout analysis or using specialiced table extraction techniques -
should be invested, to extract the assets tables structure as well.</p>
<p>Our work is also contributing to the question, if the presented
framework is promising on more heterogeneous documents, how open-source
models perform and if the German language of the annual reports may hold
unique challenges.</p>
</div>
<div id="thesis-outline" class="section level2 hasAnchor" number="1.4">
<h2 class="hasAnchor"><span class="header-section-number">1.4</span> Thesis Outline<a href="#thesis-outline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Chapter @ref(literature-review) briefly introduces into the theoretical
background of the used concepts and references literature, that is
describing them in depth.</p>
<p>Chapter @ref(methodology) is describing our research design, research
questions and hypotheses. Separate for our three research questions, it
presents our evaluation and data strategy. It gives an overview about
the experimental setting, including the used evaluation methods and
expected error types .</p>
<p>Chapter @ref(implementation) describes the hardware the experiments run
on and the software used to implement them. It presents a flow chart and
description of the data processing workflow.</p>
<p>Chapter @ref(results) briefly presents the results for the three
investigated research questions. Detailed descriptions, how the results
are obtained can be found in the appendix.</p>
<p>Chapter @ref(discussion) discusses the results. It interprets the
results in regard to the research questions and hypotheses. It contains
the error analysis. It shows the limitations of this study and names
what is not covered yet. It gives an outlook, on how we will proceed
with the results of this thesis, to solve the real life problem.</p>
<p>Chapter @ref(conclusion) summarizes the answers on our research
questions.</p>
</div>
<div id="summary" class="section level2 hasAnchor" number="1.5">
<h2 class="hasAnchor"><span class="header-section-number">1.5</span> Summary<a href="#summary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter, showed the challenges that result from the ever growing
amount of information to process and the hurdles that
non-machine-readable data is placing on the way to use algorithms, to
handle the information overflow. It described the specific problem we
tackle with this thesis of extracting financial information from annual
reports, to prepare the audition processes at <a href="#acronyms_RHvB">RHvB</a>. We formulated
our research questions, sketched our methodology to investigate them and
gave an outlook on the subsequent chapters.</p>
</div>
<div id="to-place-in-chapters-above" class="section level2 hasAnchor" number="1.6">
<h2 class="hasAnchor"><span class="header-section-number">1.6</span> To place in chapters above<a href="#to-place-in-chapters-above" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>XBRL reports instead of PDFs? employees need to know, that they exist
and how to work with those</p>
<p>It is important to get numeric values totally accurate; numeric values
are difficult to handle for langauge models</p>
<p>Research questions and hypothesss</p>
<p>Q1: Can a <a href="#acronyms_LLM">LLM</a> be used to efficiently extract financial information
from German annual reports? Q2. Can LLMs be used to identify the page of
interest automatically?</p>
<p>Q3: Can confidence scores be used to head up the human in the loop on
which results to double check? (How can sources of the automatic
extraction being communicated down stream in order to make double
checking easy before making decisions?) Q4: Can contextual information
from similar documents reduce errors made during table extraction? Q5:
What are characteristics of financial tables that make it hard for LLMs
to identify / extract them? (How does the length and complexity of
financial documents (e.g., multi-column layouts, nested tables) affect
table extraction performance?)</p>
<p>missing law to access digital data and no law to choose the format of
the data <a href="https://de.xbrl.org/">extensible Business Reporting Language</a>
as a standard changing from HGB to IFSR</p>
</div>
<div id="unstrukturierte-daten" class="section level2 hasAnchor" number="1.7">
<h2 class="hasAnchor"><span class="header-section-number">1.7</span> Unstrukturierte Daten<a href="#unstrukturierte-daten" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Beispielbilder</li>
</ul>
<div id="portable-document-format" class="section level3 hasAnchor" number="1.7.1">
<h3 class="hasAnchor"><span class="header-section-number">1.7.1</span> Portable Document Format<a href="#portable-document-format" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>print optimized</li>
<li>Table structure information gets lost</li>
<li>Bild und Textextract</li>
<li>see Erics thesis ;)</li>
</ul>
<!--chapter:end:01_Introduction.Rmd-->
</div>
</div>
</div>
<div id="literature-review" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Literature review<a href="#literature-review" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>(less than 10 p)</p>
<p>The introduction described, that the problem, we want to solve with thesis, is part of the field of information retrieval. Thus, section @ref(information-retrieval) describes methods, used to retrieve information from documents. It gives a brief overview on <a href="#acronyms_regex">regex (regular expression)</a>, before subsection @ref(llm-theory) describes the mechanisms and architecture of recent <a href="#acronyms_LLM">LLM (large language model)</a>s, including <a href="#acronyms_MoE">MoE (mixture of experts)</a> architecture.</p>
<p>Afterwards, subsection @ref(llm-methods) describes the method of few-shot prompting, that leverages the programming by example paradigm, and how <a href="#acronyms_RAG">RAG (retrieval augmanted generation)</a> fits in this picture. We show how guided decoding can be used to generated structured responses for usage in down stream tasks.</p>
<p>Section @ref(other-concepts) presents the <a href="#acronyms_SHAP">SHAP (SHapley Additive exPlanations)</a> framework. It is a unified explanation model for machine learning models and can be applied to complex models like deep neutral networks or random forests. The latter are briefly introduced as well. We use random forests and <a href="#acronyms_SHAP">SHAP</a> to check our hypotheses on possible predictors for the information extraction task (see @ref(research-questions)).</p>
<div id="information-retrieval" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Information extraction / retrieval<a href="#information-retrieval" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>closed-domain vs open-domain</p>
<div id="term-frequency" class="section level3 hasAnchor" number="2.1.1">
<h3 class="hasAnchor"><span class="header-section-number">2.1.1</span> Term frequency<a href="#term-frequency" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Term frequency <span class="math inline">\(\mathrm{tf}_{t,d}\)</span> is a very simple measure. It just counts the number of occurrences of a term in a document. Document is an abstraction in this case. It can be a sentence, a page or a file. Since longer documents might have higher term frequency for each term, it is useful to normalize the value by the document length <span class="math inline">\(|d|\)</span>. This measure could be called term rate:</p>
<p><span class="math display">\[\begin{equation}
\mathrm{tr}_t = \frac{\mathrm{tf}_{t,d}}{|d|}
(\#eq:term-rate)
\end{equation}\]</span></p>
<p>It is part of well established measures as <a href="#acronyms_TF-IDF">TF-IDF (Frequency-Inverse Document Frequency)</a> and Okapi <a href="#acronyms_BM25">BM25 (best matching 25)</a>. Both are used for ranking, how relevant a document is for a given search query and are widely used in information retrieval systems <span class="citation">(<a href="#ref-robertsonUnderstandingInverseDocument2004">Robertson, 2004</a>; <a href="#ref-robertsonProbabilisticRelevanceFramework2009">Robertson &amp; Zaragoza, 2009</a>)</span> and thus can be part of a <a href="#acronyms_RAG">RAG</a> architecture too. <a href="#acronyms_BM25">BM25</a> is one of the “most successful Web-search and corporate-search algorithms” <span class="citation">(<a href="#ref-robertsonProbabilisticRelevanceFramework2009">Robertson &amp; Zaragoza, 2009, p. 1</a>)</span>.</p>
<p>The <a href="#acronyms_IDF">IDF (Inverse Document Frequency)</a> is often used as a weighting function. If the ranking of possible results of a search query is simply calculated as sum of all term frequencies in a document, that are present in the query as well less informative terms get equal weight.</p>
<p>Looking at the search query: “Is the positron blue?”, helps to illustrate the problem. The terms <em>is</em>, <em>the</em> and <em>blue</em> might be present often in a document for children that is talking about the sky or sea. Such a document could get high score, even though <em>positron</em> is never mentioned. It would be good, if it is most important if the term <em>positron</em> is in the document. We can achieve this by multiplying all term frequencies with the <a href="#acronyms_IDF">IDF</a> score <span class="citation">(<a href="#ref-manningIntroductionInformationRetrieval2008">Manning et al., 2008, p. 118</a>)</span>:</p>
<p><span class="math display">\[\begin{equation}
\mathrm{idf}_t = \log \frac{N}{\mathrm{df}_t}
(\#eq:idf)
\end{equation}\]</span></p>
<p><span class="math inline">\(N\)</span> is the number of documents in the collection of documents and <span class="math inline">\(\mathrm{df}_t\)</span> the number of documents, that contain term <span class="math inline">\(t\)</span>. While the term frequencies <span class="math inline">\(\mathrm{tf}_{t,d}\)</span> are calculated separate for each document, the <a href="#acronyms_IDF">IDF</a> score is computed once for the whole collection. The <a href="#acronyms_TF-IDF">TF-IDF</a> score is then defined by:</p>
<p><span class="math display">\[\begin{equation}
\mathrm{tf\text{-}idf}_t = \mathrm{idf}_t \cdot \mathrm{tf}_{t,d}
(\#eq:tf-idf)
\end{equation}\]</span></p>
<p>The more advanced measure <a href="#acronyms_BM25">BM25</a> is derived in <span class="citation">Manning et al. (<a href="#ref-manningIntroductionInformationRetrieval2008">2008</a>)</span>.</p>
<p>Measures as <a href="#acronyms_TF-IDF">TF-IDF</a> are also used for classification tasks, i.e. in the context of sentiment analysis <span class="citation">(<a href="#ref-carvalhoTFIDFCRFNovelSupervised2020">Carvalho &amp; Guedes, 2020</a>)</span> and semantic understanding <span class="citation">(<a href="#ref-rathiImportanceTermWeighting2023">Rathi &amp; Mustafi, 2023</a>)</span>.</p>
</div>
<div id="text-processing" class="section level3 hasAnchor" number="2.1.2">
<h3 class="hasAnchor"><span class="header-section-number">2.1.2</span> Text processing<a href="#text-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>document layout analysis?</p>
</div>
<div id="regular-expressions" class="section level3 hasAnchor" number="2.1.3">
<h3 class="hasAnchor"><span class="header-section-number">2.1.3</span> Regular expressions<a href="#regular-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="llm-theory" class="section level3 hasAnchor" number="2.1.4">
<h3 class="hasAnchor"><span class="header-section-number">2.1.4</span> Large Language Models<a href="#llm-theory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Wichtig</p>
<div id="transformers" class="section level4 hasAnchor" number="2.1.4.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.1</span> Transformers<a href="#transformers" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
<p>hauptsächlich decoder (generieren)</p>
<p>seit 2017</p>
</div>
<div id="encoder" class="section level4 hasAnchor" number="2.1.4.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.2</span> Encoder<a href="#encoder" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
</div>
<div id="decoder" class="section level4 hasAnchor" number="2.1.4.3">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.3</span> Decoder<a href="#decoder" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
<p>Token sampling, temperature 0</p>
</div>
<div id="gpt-generative-pretrained-transformers" class="section level4 hasAnchor" number="2.1.4.4">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.4</span> GPT (Generative Pretrained Transformers)<a href="#gpt-generative-pretrained-transformers" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
</div>
<div id="mixture-of-experts" class="section level4 hasAnchor" number="2.1.4.5">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.5</span> Mixture of Experts<a href="#mixture-of-experts" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recent <a href="#acronyms_LLM">LLM (large language model)</a>s often use a <a href="#acronyms_MoE">MoE</a> architecture. The models of Llama 4, Qwen3 and GPT-4.1 are prominent examples for this kind of <a href="#acronyms_LLM">LLM</a>s. <span class="citation">D. Zhang et al. (<a href="#ref-zhangMixtureExpertsLarge2025">2025</a>)</span> and <span class="citation">Cai et al. (<a href="#ref-caiSurveyMixtureExperts2025a">2025</a>)</span> give an exhaustive overview of different types of <a href="#acronyms_MoE">MoE</a> architectures. While <span class="citation">D. Zhang et al. (<a href="#ref-zhangMixtureExpertsLarge2025">2025</a>)</span> lists also models released this year and shows some applications of <a href="#acronyms_MoE">MoE</a>, is <span class="citation">Cai et al. (<a href="#ref-caiSurveyMixtureExperts2025a">2025</a>)</span> discussing different architecture types in more detail. <span class="citation">Grootendorst (<a href="#ref-grootendorstVisualGuideMixture2024">2024</a>)</span> gives a guid to <a href="#acronyms_MoE">MoE</a> with many helpful illustrations.</p>
<p>The basic idea of <a href="#acronyms_MoE">MoE</a> models is to combine multiple smaller, specialized <a href="#acronyms_FFN">FFN (feed forward network)</a>s to achieve better predictions overall. The <a href="#acronyms_MoE">MoE</a> “paradigm offers a compelling method to significantly expand model capacity while avoiding a corresponding surge in computational demands during training and inference phases” <span class="citation">(<a href="#ref-caiSurveyMixtureExperts2025a">Cai et al., 2025, p. 21</a>)</span>.</p>
<p>Figure @ref(fig:moe-architecture) shows two main differences in the architecture. One one hand there is the dense (a) architecture. Here, each token is fed into every <a href="#acronyms_FFN">FFN</a> and all results are pooled. On the other hand, there is the sparse architecture. Here, each token is just fed into a subset of <a href="#acronyms_FFN">FFN</a>s. Dense <a href="#acronyms_MoE">MoE</a> models often yield higher prediction accuracy, but also significantly increase the computational overhead <span class="citation">(<a href="#ref-caiSurveyMixtureExperts2025a">Cai et al., 2025</a>)</span>.</p>
<p>The gate (also router) takes care of the distribution of tokens to the <a href="#acronyms_FFN">FFN</a>s. There is a high diversity of the routing algorithms and its goals are to “ensure expert diversity while minimizing redundant computation” <span class="citation">(<a href="#ref-zhangMixtureExpertsLarge2025">D. Zhang et al., 2025</a>)</span>. There are algorithms that focus on load-balancing, domain specific routing and many more. Traditional <a href="#acronyms_MoE">MoE</a> assumes homogeneous experts, where load balancing might be the paramount goal. Recent advances explore more heterogeneous sets of experts and flexible routing strategies, that promise more efficiency <span class="citation">(<a href="#ref-zhangMixtureExpertsLarge2025">D. Zhang et al., 2025</a>)</span>.</p>
<div class="figure">
<img src="images/moe_architecture.png" alt="Showing schemas of the dense and sparse mixture of experts architecture." width="100%" />
<p class="caption">
(#fig:moe-architecture)Showing schemas of the dense and sparse mixture of experts architecture.
</p>
</div>
<p>Most of the Qwen3 models have a dense <a href="#acronyms_MoE">MoE</a> architecture. Only the two models released in July 2025 have a sparse architecture. These models have two parameter specifications. For example Qwen3-235B-A22B is specifying that the model has 235B token in total. But per token processed it uses (activates) just 22B parameters. In their mixture of experts architecture this means that 8 of 128 experts are participating in processing each token.</p>
<p>The Llama 4 models have a shared expert <a href="#acronyms_MoE">MoE</a> architecture. It combines a shared, fixed expert that processes every token and combines those results with results from a sparse <a href="#acronyms_MoE">MoE</a> layer.</p>
<p>Googles gemma-3n-E4B uses a selective parameter activation as well. They use the prefix E for effective instead of A for active <span class="citation">(<a href="#ref-googleGemma3nModel">Google, n.d.</a>)</span>. In gemma-3n there are parameters to handle input of different types - text, vision and audio - and they get loaded and activated as necessary. This allows a multi modal functionality. It additionally caches the <a href="#acronyms_PLE">PLE (Per-Layer Embedding)</a> in fast storage (RAM) instead of keeping it in the model memory space (VRAM), allowing to run models in low resource environments.</p>
<p>Raus oder woanders hin: The Qwen3 models support two operating modes: A thining mode and a non-thinking mode. The thinking mode should yield better answers in complex tasks and the additional amount of processing can be controlled by setting a thinking budget <span class="citation">(<a href="#ref-qwenteamQwen3ThinkDeeper2025">Qwen Team, 2025</a>)</span>. This thinking budget can be seen as the amount of tokens used for a step wise solution.</p>
</div>
<div id="mixed-modal" class="section level4 hasAnchor" number="2.1.4.6">
<h4 class="hasAnchor"><span class="header-section-number">2.1.4.6</span> Mixed modal<a href="#mixed-modal" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="citation">(<a href="#ref-teamChameleonMixedModalEarlyFusion2024">Team, 2024</a>)</span></p>
</div>
</div>
<div id="llm-methods" class="section level3 hasAnchor" number="2.1.5">
<h3 class="hasAnchor"><span class="header-section-number">2.1.5</span> Methods for LLM application<a href="#llm-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="few-shot-learning" class="section level4 hasAnchor" number="2.1.5.1">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.1</span> Few-shot Learning<a href="#few-shot-learning" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
</div>
<div id="rag" class="section level4 hasAnchor" number="2.1.5.2">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.2</span> RAG<a href="#rag" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Wichtig</p>
</div>
<div id="guided-and-restricted-decoding" class="section level4 hasAnchor" number="2.1.5.3">
<h4 class="hasAnchor"><span class="header-section-number">2.1.5.3</span> Guided and restricted decoding<a href="#guided-and-restricted-decoding" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>generation template strict (closed) vs open</p>
<p>always selecting the most probable response (temp = 0), so numeric values are correct and classification as well</p>
</div>
</div>
</div>
<div id="other-concepts" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> Other concepts<a href="#other-concepts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="sample-distribution-visualization-methods" class="section level3 hasAnchor" number="2.2.1">
<h3 class="hasAnchor"><span class="header-section-number">2.2.1</span> Sample distribution visualization methods<a href="#sample-distribution-visualization-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="boxplots" class="section level5 hasAnchor" number="2.2.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">2.2.1.0.1</span> Boxplots<a href="#boxplots" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><span class="citation">Wickham &amp; Stryjewski (<a href="#ref-wickham40YearsBoxplots2011">2011</a>)</span> describe boxplots as “a compact distributional summary, displaying less detail than a histogram or kernel density, but also taking up less space. Boxplots use robust summary statistics that are always located at actual data points, are quickly computable (originally by hand), and have no tuning parameters. They are particularly useful for comparing distributions across groups.”</p>
<p>Figure @ref(fig:boxplot-gauss) shows a box and whiskers plot and its components and compares it to a gaussian probability distribution. Half of all observations fall within the box and the median is marked by a thick line. Outliers are defined as observations that are outside the area marked with the (horizontal) lines -called whiskers - that potentially have small bars at their ends. Outliers can be shown by circles or dots.</p>
<p>(ref:boxplot-gauss-caption) Showing a box and whiskers plot with its components - median, quartiles, whiskers and outliers - and compare it with a gaussian probability distribution. Graphic adjusted from <span class="citation">Jhguch (<a href="#ref-jhguchBoxPlot2025">2025</a>)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/Boxplot_vs_PDF.png" alt="(ref:boxplot-gauss-caption)" width="80%" />
<p class="caption">
(#fig:boxplot-gauss)(ref:boxplot-gauss-caption)
</p>
</div>
<p>The median and quartiles are less sensitive to outliers, than the mean and standard deviation of a sample. Thus, they are more suitable for distributions that are asymmetric or irregularly shaped and for samples with extreme outliers <span class="citation">(<a href="#ref-krzywinskiVisualizingSamplesBox2014">Krzywinski &amp; Altman, 2014</a>)</span>. They can be used with five observations and more. But even for large samples <span class="math inline">\((n \geq 50)\)</span>, whisker positions can vary greatly.</p>
</div>
<div id="violin-plots" class="section level5 hasAnchor" number="2.2.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">2.2.1.0.2</span> Violin plots<a href="#violin-plots" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>There are variations, that try to communicate the sample size of a box plot, either by adjusting the width of the whole box or by introducing notches, that indicate the confidence interval for the median <span class="citation">(<a href="#ref-wickham40YearsBoxplots2011">Wickham &amp; Stryjewski, 2011</a>)</span>. Violin plots <span class="citation">(<a href="#ref-hintzeViolinPlotsBox1998">Hintze &amp; Nelson, 1998</a>)</span> additionally indicate an density estimate, dropping the strict rectangular shape of the box. Figure @ref(fig:violinplot) shows, that the shapes can be necessary to identify multi-modal distributions, that are invisible with regular boxplots <span class="citation">(<a href="#ref-wickham40YearsBoxplots2011">Wickham &amp; Stryjewski, 2011</a>)</span>. One can tackle this problem by adding a jitter plot layer to the boxplots. Violin plots can also be used for large datasets, preventing to plot a lot of outliers.</p>
<p>(ref:violinplot-caption) Comparing boxplots and violinplots, showing that boxplots can not identify multi-modal distributions on their own. Graphic adjusted from <span class="citation">Amgen Scholars Program (<a href="#ref-amgenscholarsprogramHowInterpretViolin">n.d.</a>)</span>.</p>
<div class="figure">
<img src="images/violin_plots_horizontal.png" alt="(ref:violinplot-caption)" width="100%" />
<p class="caption">
(#fig:violinplot)(ref:violinplot-caption)
</p>
</div>
</div>
</div>
<div id="tree-based-machine-learning-algorithms" class="section level3 hasAnchor" number="2.2.2">
<h3 class="hasAnchor"><span class="header-section-number">2.2.2</span> Tree based machine learning algorithms<a href="#tree-based-machine-learning-algorithms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Random forests are a ensemble supervised machine learning technique, composed of multiple decision trees <span class="citation">(<a href="#ref-kulkarniRandomForestClassifiers2013">V. Kulkarni &amp; Sinha, 2013</a>)</span>. <span class="citation">Mienye &amp; Jere (<a href="#ref-mienyeSurveyDecisionTrees2024">2024</a>)</span> give a detailed insight into decision trees and their high-performing ensemble algorithms. Tree based machine learning algorithms have gained significant popularity, due to their simplicity and good interpretability <span class="citation">(<a href="#ref-mienyeSurveyDecisionTrees2024">Mienye &amp; Jere, 2024</a>)</span>.</p>
<div id="decision-tree" class="section level5 hasAnchor" number="2.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">2.2.2.0.1</span> Decision tree<a href="#decision-tree" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>“The basic idea behind decision tree-based algorithms is that they recursively partition the data into subsets based on the values of different attributes until a stopping criterion is met” <span class="citation">(<a href="#ref-mienyeSurveyDecisionTrees2024">Mienye &amp; Jere, 2024</a>)</span>. Figure @ref(fig:decision-tree) shows this for artificial data of two continuous features. Popular measures to determine how to split a set of observations are the Gini index, information gain or information gain criteria <span class="citation">(<a href="#ref-mienyeSurveyDecisionTrees2024">Mienye &amp; Jere, 2024</a>)</span>.</p>
<p>The tree shown is used for a regression task and will predict the average of all values of the corresponding terminal node (leaf). To find out, which leaf will be the target terminal node for a given set of features one just follows the path from the top node (root) downwards, checking the splitting criteria. Thus, the interpretation of decisions made by a decision tree is very easy.</p>
<p>(ref:decision-tree-caption) Visualizing the of partitioning of a two-dimensional continuous feature space based on multiple splitting criteria for decision tree inducing. Graphic adjusted from <span class="citation">Molnar (<a href="#ref-molnarInterpretableMachineLearning2025">2025</a>)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/tree_simple.png" alt="(ref:decision-tree-caption)" width="80%" />
<p class="caption">
(#fig:decision-tree)(ref:decision-tree-caption)
</p>
</div>
<p>Further benefits of decision trees - besides the good interpretability and computational efficiency - are the native capturing of interactions between features <span class="citation">(<a href="#ref-molnarInterpretableMachineLearning2025">Molnar, 2025</a>)</span>, without modeling this explicitly, as it would for example be necessary in a linear regression. Decision trees can be used for classification and regression. They even can incorporate linear functions as leafs, enabling them to better capture linear relationships <span class="citation">(<a href="#ref-raymaekersFastLinearModel2024">Raymaekers et al., 2024</a>)</span>.</p>
<p>Problems of decision trees are, that they lack resilience against data changes and a tendency to overfitting. A method against overfitting is pruning <span class="citation">(<a href="#ref-mienyeSurveyDecisionTrees2024">Mienye &amp; Jere, 2024</a>)</span>. Building an ensemble of decision trees is another possibility, that results in the random forest algorithm, described in the next paragraph .</p>
<p><span class="citation">Rivera-Lopez et al. (<a href="#ref-rivera-lopezInductionDecisionTrees2022">2022</a>)</span> are focusing on decision trees, describing multiple decision tree types, e.g. based on the splitting procedure (see Figure @ref(fig:advanced-tree-splitting)). In addition to axis-parallel splitting, they show oblique and non-linear splitting criteria. They present a state-of-the-art review and a summary analysis of metaheuristics based approaches for decision tree induction.</p>
<p>(ref:advanced-tree-splitting-caption) Visualizing the of partitioning of a two-dimensional continuous feature space based on multiple splitting criteria for decision tree inducing. Graphic adjusted from <span class="citation">Rivera-Lopez et al. (<a href="#ref-rivera-lopezInductionDecisionTrees2022">2022</a>)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/tree_types.jpg" alt="(ref:advanced-tree-splitting-caption)" width="100%" />
<p class="caption">
(#fig:advanced-tree-splitting)(ref:advanced-tree-splitting-caption)
</p>
</div>
</div>
<div id="random-forest" class="section level5 hasAnchor" number="2.2.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">2.2.2.0.2</span> Random forest<a href="#random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A random forest is using the principle of bagging and applies it on the level of features and observations. This means, it starts, creating basic decision trees with differing subsets of features and uses bootstrapping to select a randomized set of observations to train the tree with. The final prediction is then determined by voting (for classification) or averaging (for regression) the predictions of all trees in the ensemble.</p>
<p>The induction of the trees can be be parallelized, making it efficient on modern hardware. Random forests can cope with thousands of features and can be applied to large datasets <span class="citation">(<a href="#ref-breimanRandomForests2001">Breiman, 2001</a>)</span>. There are methods that address the problems of imbalanced datasets too. As there are methods to prune a decision tree to fight overfitting, there are methods to prune a random forest by removing whole trees, to improve the learning and classification performance, too <span class="citation">(<a href="#ref-kulkarniPruningRandomForest2012">V. Y. Kulkarni &amp; Sinha, 2012</a>)</span>.</p>
<p>Random forests are “powerful learning ensemble[s] given its predictive performance, flexibility, and ease of use <span class="citation">(<a href="#ref-haddouchiSurveyTaxonomyMethods2024">Haddouchi &amp; Berrado, 2024</a>)</span>. While it is based on decision trees, that are considered to be <em>white boxes</em>, because of their easy interpretability, random forests are seen as <em>black boxes</em>. The decision could be tracked without complicated math, but is tedious, because it would require propagating through many decision trees, noting their predictions and then averaging those.</p>
<p>The fact that the RF model is categorized as a black-box model restricts its deployment in many fields of application <span class="citation">(<a href="#ref-haddouchiSurveyTaxonomyMethods2024">Haddouchi &amp; Berrado, 2024</a>)</span>. One feature oriented tool for explainability is the <a href="#acronyms_SHAP">SHAP</a> framework, presented in section @ref(shap). It allows local explanation, a global overview and pattern discovery for random forests <span class="citation">(<a href="#ref-haddouchiSurveyTaxonomyMethods2024">Haddouchi &amp; Berrado, 2024</a>)</span>.</p>
</div>
<div id="gradient-boosted-decision-trees" class="section level5 hasAnchor" number="2.2.2.0.3">
<h5 class="hasAnchor"><span class="header-section-number">2.2.2.0.3</span> Gradient boosted decision trees<a href="#gradient-boosted-decision-trees" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Another highly effective and widely used advancement to decision trees are gradient boosted decision trees <span class="citation">(<a href="#ref-chenXGBoostScalableTree2016">Chen &amp; Guestrin, 2016</a>)</span>. Instead of the principle of bagging it applies the principle of boosting. it is sequentially building decision trees, where the later ones correct the errors in predictions made by the former trees. It uses gradient descent to minimize those errors <span class="citation">(<a href="#ref-mienyeSurveyDecisionTrees2024">Mienye &amp; Jere, 2024</a>)</span>.</p>
<p>The <a href="#acronyms_XGBoost">XGBoost (Extreme Gradient Boosting)</a> algorithm is a famous member of this family, with “an outstanding performance record” <span class="citation">(<a href="#ref-burnwalComprehensiveSurveyPrediction2023">Burnwal &amp; Jaiswal, 2023</a>)</span>. “Among the 29 challenge winning solutions published at Kaggle’s blog during 2015, 17 solutions used XGBoost” <span class="citation">(<a href="#ref-chenXGBoostScalableTree2016">Chen &amp; Guestrin, 2016</a>)</span>.</p>
<p>In the following we will emphasize some of its benefits as described by <span class="citation">Burnwal &amp; Jaiswal (<a href="#ref-burnwalComprehensiveSurveyPrediction2023">2023</a>)</span>:</p>
<ul>
<li><p><a href="#acronyms_XGBoost">XGBoost</a> employs both L1 (Lasso) and L2 (Ridge) regularization in its objective function to penalize model complexity, mitigating overfitting. However, overfitting can occur, especially if hyperparameters are not adjusted properly.</p></li>
<li><p><a href="#acronyms_XGBoost">XGBoost</a> provides feature importance metrics to facilitate model interpretation, facilitating feature selection and improving the understanding of the model’s decision-making process.</p></li>
<li><p><a href="#acronyms_XGBoost">XGBoost</a> “runs more than ten times faster than existing popular solutions on a single machine and scales to billions of examples in distributed or memory-limited settings” <span class="citation">(<a href="#ref-chenXGBoostScalableTree2016">Chen &amp; Guestrin, 2016</a>)</span> using parallelization techniques.</p></li>
</ul>
<p>But there are some challenges, that are to investigate in future research. E.g. finding methods to handle imbalanced data and automate the hyperparameter tuning process.</p>
</div>
</div>
<div id="shap" class="section level3 hasAnchor" number="2.2.3">
<h3 class="hasAnchor"><span class="header-section-number">2.2.3</span> Model agnostic explanation models<a href="#shap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="shapley-values" class="section level5 hasAnchor" number="2.2.3.0.1">
<h5 class="hasAnchor"><span class="header-section-number">2.2.3.0.1</span> Shapley values<a href="#shapley-values" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Shapley values are introduced by <span class="citation">Shapley (<a href="#ref-shapley17ValueNPerson2016">2016</a>)</span> originally in 1952 in the field of game theory. He defined three axioms that a fair allocation of value must fulfill:</p>
<ol style="list-style-type: decimal">
<li><p>Symmetry: If two players contribute the same amount, they are interchangeable and should gain equal reward.</p></li>
<li><p>Efficiency: The whole value of the game is distributed among the players.</p></li>
<li><p>Law of aggregation: If a player contributes to multiple independent games, his contribution in total should be the sum of contributions in each game.</p></li>
</ol>
<p>From the third axiom a fourth property derives, that is sometimes named independently. If a player is not contributing to a game, he gets no share. <span class="citation">O’Sullivan (<a href="#ref-osullivanMathematicsShapleyValues2023">2023</a>)</span> calls this the <em>null player</em> property.</p>
<p>The formula for a single shapley values is given by <span class="citation">(<a href="#ref-lundbergUnifiedApproachInterpreting2017">S. Lundberg &amp; Lee, 2017</a>)</span><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>:</p>
<p><span class="math display">\[\begin{equation}
\phi_{i} = \sum_{S \subseteq P \setminus \{i\}}{\frac{|S|! \left( |P|-|S|-1 \right) !}{|P|!} \left[ val \left( S \cup \{i\} \right) - val\left(S\right) \right]}
(\#eq:shapley)
\end{equation}\]</span></p>
<p><span class="citation">Molnar (<a href="#ref-molnarInterpretableMachineLearning2025">2025</a>)</span> bridges the game theory terms to the field of machine learning as follows: “The <em>game</em> is the prediction task for a single instance of the dataset. The <em>gain</em> is the actual prediction for this instance minus the average prediction for all instances. The <em>players</em> are the feature values of the instance that collaborate to receive the gain (= predict a certain value).”</p>
</div>
<div id="shap-framework" class="section level5 hasAnchor" number="2.2.3.0.2">
<h5 class="hasAnchor"><span class="header-section-number">2.2.3.0.2</span> SHAP framework<a href="#shap-framework" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><span class="citation">S. Lundberg &amp; Lee (<a href="#ref-lundbergUnifiedApproachInterpreting2017">2017</a>)</span> are presenting “A Unified Approach to Interpreting Model Predictions” based on shapley values, called <a href="#acronyms_SHAP">SHAP (SHapley Additive exPlanations)</a>. It assigns each feature an importance value for every observation. This allows to inspect, why a specific prediction is made and might explain, why a model makes a mistake for specific observations. Inspecting the predictions for all observations can show generalized effects of features.</p>
<p><span class="citation">S. Lundberg &amp; Lee (<a href="#ref-lundbergUnifiedApproachInterpreting2017">2017</a>)</span> show that their approach is the only possible explanation model for the class of additive feature attribution methods, that has three desirable characteristics: local accuracy, missingness and consistency. Shapely values can be computed for any machine learning model, but its exact calculation is computationally extremely expensive <span class="citation">(<a href="#ref-huComputingSHAPEfficiently2023">Hu &amp; Wang, 2023</a>)</span>, since it is of exponential complexity <span class="math inline">\(\mathcal{O}(2^p)\)</span> regarding the number of features (or predictors) <span class="math inline">\(p = |P|\)</span>.</p>
<p>Even with the approximation of the shapley values, introduced in <span class="citation">S. Lundberg &amp; Lee (<a href="#ref-lundbergUnifiedApproachInterpreting2017">2017</a>)</span> as Kernel SHAP, the complexity for tree based algorithms is <span class="math inline">\(\mathcal{O}(MTL2^p)\)</span>, with the number of samples <span class="math inline">\(M\)</span>, number of trees <span class="math inline">\(T\)</span> and the number of leaves <span class="math inline">\(L\)</span>. The tree based optimization of the algorithm, TreeSHAP, allows an approximation in <span class="math inline">\(\mathcal{O}(MTLD^2)\)</span> <span class="citation">(<a href="#ref-lundbergExplainableAITrees2019">S. M. Lundberg et al., 2019</a>)</span>, with the maximum tree depth <span class="math inline">\(D\)</span>. Depending on the number of observations to calculate shapley values for (<span class="math inline">\(M\)</span>), the Fast TreeSHAP algorithm has a even lower time complexity of <span class="math inline">\(\mathcal{O}(TLD2^D+MTLD)\)</span> <span class="citation">(<a href="#ref-yangFastTreeSHAPAccelerating2022">Yang, 2022</a>)</span>.</p>
<p>Calculating the effect a feature has for the whole model, we calculate the mean of the absolute for single shapley values. Adjusting <span class="citation">Molnar (<a href="#ref-molnarInterpretableMachineLearning2025">2025</a>)</span> so it follows the notation of Equation @ref(eq:shapley) yields:</p>
<p><span class="math display">\[\begin{equation}
mean\left(|SHAP|\right) = \frac{1}{n} \sum_{k=1}^n | \phi_{i}^{\left( k \right)} |
(\#eq:meanSHAP)
\end{equation}\]</span></p>
<p>This value is called <a href="#acronyms_SHAP">SHAP</a> feature importance. It can be interpreted similar to standardized beta values for a linear regression. In some cases it would be possible to calculate an effect direction for the feature importance. But it is not common practice. Instead visual representations presented in section @ref() are used for such interpretations.</p>
<p><span class="citation">S. Lundberg &amp; Lee (<a href="#ref-lundbergUnifiedApproachInterpreting2017">2017</a>)</span> also showed that SHAP values are more consistent with human intuition than preceding local explainable models. <span class="citation">Z. Li et al. (<a href="#ref-liBuildingTrustMachine2024">2024</a>)</span> mention, that explainability of machine learning models is not only important for researches but also for practitioners, to demonstrate their reliability to potential users and build trust. Regardless of the popularity of <a href="#acronyms_SHAP">SHAP</a> scores, there are claims that they can be inadequate as a measure of feature importance <span class="citation">(<a href="#ref-huangFailingsShapleyValues2024">Huang &amp; Marques-Silva, 2024</a>)</span>. The approximated as well as exact <a href="#acronyms_SHAP">SHAP</a> scores can assign higher value to unimportant features than to important ones.</p>
<p>However, the need for a high explainability of machine learning algorithms is more urgent than ever, since the EU’s regulatory ecosystem is emphasizing the importance of <a href="#acronyms_XAI">XAI (explainable artificial intelligence)</a> <span class="citation">(<a href="#ref-nanniniOperationalizingExplainableArtificial2024">Nannini et al., 2024</a>)</span>.</p>
</div>
</div>
</div>
<div id="summary-0.5-p" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Summary (0.5 p)<a href="#summary-0.5-p" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>lessons learned</li>
<li>link to goal thesis</li>
<li>link to next chapter</li>
</ul>
</div>
<div id="to-place-in-chapters-above-1" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> To place in chapters above<a href="#to-place-in-chapters-above-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="table-extraction-tasks" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Table extraction tasks<a href="#table-extraction-tasks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="difficulties" class="section level3 hasAnchor" number="2.5.1">
<h3 class="hasAnchor"><span class="header-section-number">2.5.1</span> Difficulties<a href="#difficulties" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Beispielbilder</li>
</ul>
</div>
</div>
<div id="document-extraction-process" class="section level2 hasAnchor" number="2.6">
<h2 class="hasAnchor"><span class="header-section-number">2.6</span> Document Extraction Process<a href="#document-extraction-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="document-layout-analysis" class="section level3 hasAnchor" number="2.6.1">
<h3 class="hasAnchor"><span class="header-section-number">2.6.1</span> Document Layout Analysis<a href="#document-layout-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An important step in the process of extracting information from documents is to recognize the layout of a document <span class="citation">(<a href="#ref-zhongPubLayNetLargestDataset2019">Zhong et al., 2019</a>)</span>.</p>
<p>Getting the order of texts correct align captions to tables and figure identify headings, tables and figures</p>
<p>One of the most popular datasets used for training and benchmarking is PubLayNet (see <a href="https://paperswithcode.com/sota/document-layout-analysis-on-publaynet-val">PubLayNet on paperswithcode.com</a>). It contains over 360_000 document automatically annotated images from scientific articles publicly available on PubMed Central <span class="citation">(<a href="#ref-zhongPubLayNetLargestDataset2019">Zhong et al., 2019, p. 1</a>)</span>. This was possible, because the articles have been provided in PDF and XML format. For the annotations most text categories (e.g. text, caption, footnote) have been aggregated into one category. &lt;– is this a problem for later approaches where a visual and textual model work hand in hand to identify e.g. table captions?</p>
<p>Manual annotated datasets often were limited to several hundred pages. Deep learning methods need a much larger training dataset. Previously optical character recognition (OCR) methods were used.</p>
<p>Identify potentially interesting pages with text / regex search. Check if there is a table present on this page.</p>
<p>Object detection</p>
</div>
</div>
<div id="tools" class="section level2 hasAnchor" number="2.7">
<h2 class="hasAnchor"><span class="header-section-number">2.7</span> Tools<a href="#tools" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vlt egal oder outlook</p>
<div id="vision-grid-transformer" class="section level4 hasAnchor" number="2.7.0.1">
<h4 class="hasAnchor"><span class="header-section-number">2.7.0.1</span> Vision Grid Transformer<a href="#vision-grid-transformer" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="tableformer" class="section level4 hasAnchor" number="2.7.0.2">
<h4 class="hasAnchor"><span class="header-section-number">2.7.0.2</span> TableFormer<a href="#tableformer" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>SynthTabNet &lt;– has it: - nested / hierarchical tables, where rows add up to another row? - identifying units and unit cols/rows</p>
<!--chapter:end:02_Literature_review.Rmd-->
</div>
</div>
</div>
<div id="methodology" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Methodology<a href="#methodology" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter describes the research design of this thesis. In the subsequent sections it elaborates</p>
<div id="problem-definition" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Problem Definition<a href="#problem-definition" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This thesis aims to evaluate a framework for information extraction from financial reports using advanced computing algorithms as <a href="#acronyms_LLM">LLM</a>s, presented by <span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span>. We apply this framework on German annual reports of multiple companies and focus on using open source <a href="#acronyms_LLM">LLM</a>s. This task requires two problems to be solved:</p>
<ol style="list-style-type: decimal">
<li>The information to extract has to be located in the document.</li>
<li>The information has to be extracted correct and in form that allows further processing in down stream tasks.</li>
</ol>
<p>We limit the information of interest on the data found in the balance sheet and profit and loss statement. Both are found on separate pages and have a table-like structure. The information of interest is ordered by a hierarchy defined in <span class="citation">HGB (<a href="#ref-hgbHandelsgesetzbuchImBundesgesetzblatt2025">2025</a>)</span>. The information to extract are numeric values.</p>
<p>Since the information of interest is placed on separated pages, the first problem is to find the pages that contain the balance sheet and profit and loss statement. We do not attempt to select a specific part of the page, where the data can be found. Thus, this becomes a classification task, if a page contains the information of interest. Spatial information is not processed.</p>
<p>The second problem is an information extraction task. Potential information has to be identified, its entity has to recognized and finally its numeric value has to be extracted. In this thesis no special techniques for the table extraction sub field are used.</p>
</div>
<div id="research-design-philosophy" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> Research Design &amp; Philosophy<a href="#research-design-philosophy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The research design for this thesis is set up, following the guideline found in <span class="citation">Wohlin et al. (<a href="#ref-wohlinExperimentationSoftwareEngineering2024">2024</a>)</span> and Figure @ref(fig:reasearch-design-image) shows the decisions made. According to <span class="citation">Collis &amp; Hussey (<a href="#ref-collisBusinessResearchPractical2014">2014</a>)</span> research classification the outcome of this thesis is applied research, focusing on solving a practical problem. Its purpose is evaluation research, comparing different approaches with each other. The data collected in our experiments is of quantitative nature and its evaluation uses (semi-)quantitative methods.</p>
<p>Research logic? Methods fit deductive. But I start with a very specific problem. Literature describing basic approaches?</p>
<p>(ref:reasearch-design-caption) Showing the decisions made regarding the research design. (The figure is adapted from <span class="citation">Wohlin &amp; Aurum (<a href="#ref-wohlinDecisionmakingStructureSelecting2015">2015</a>)</span>. The copyright for the original figure is held by Springer Science+Business Media New York 2014.)</p>
<div class="figure">
<img src="images/research_design.png" alt="(ref:reasearch-design-caption)" width="100%" />
<p class="caption">
(#fig:reasearch-design-image)(ref:reasearch-design-caption)
</p>
</div>
<div id="research-questions" class="section level3 hasAnchor" number="3.2.1">
<h3 class="hasAnchor"><span class="header-section-number">3.2.1</span> Research questions<a href="#research-questions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this thesis we formulate two main research questions:</p>
<ol class="rs-questions" style="--counter: 1;">
<li>
How can we use LLMs effectively to locate specific information in a financial report?
</li>
<li>
How can we use LLMs effectively to extract these information from the document?
</li>
</ol>
<p>Each of this questions is investigated with its own methods and experiments. In the following we will use the term <em>page identification</em> to refer to the first research question and <em>information extraction</em> to refer to the second.</p>
<p>Additionally, we formulate a <a href="#acronyms_UX">UX (user experience)</a> motivated side research question:</p>
<ol class="rs-questions" style="--counter: 3;">
<li>
Can we use additional information from the extraction process, to guide the user which values need to be checked and which can be trusted as they are?
</li>
</ol>
<p>The third question is refered to, using the term <em>error rate guidiance</em>.</p>
</div>
<div id="evaluation-framework" class="section level3 hasAnchor" number="3.2.2">
<h3 class="hasAnchor"><span class="header-section-number">3.2.2</span> Evaluation framework<a href="#evaluation-framework" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="page-identification" class="section level5 hasAnchor paragraph-start" number="3.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">3.2.2.0.1</span> Page identification<a href="#page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The page identification task is successful, if a page is correctly classified to contain the information of interest. The balance sheet is composed of the assets (<em>Aktiva</em>) and liabilities (<em>Passiva</em>) table. Together with the profit an loss statement (<em>Gewinn- und Verlustrechnung, GuV</em>) they form the three target classes. The fourth class is called <em>other</em>. Subsequently will will use the German terms for the target classes (or table types): <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong>.</p>
</div>
<div id="information-extraction" class="section level5 hasAnchor paragraph-start" number="3.2.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">3.2.2.0.2</span> Information extraction<a href="#information-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The information extraction task if successful, if the correct numeric value is extracted with the correct entity identifier in the correct <a href="#acronyms_json">json (JavaScript Object Notation)</a> format. If a value, defined by the legal text, is not present <em>null</em> should be returned with the corresponding entity identifier. The entity identifier can be composed of up to three labels, representing the hierarchy defined in the legal text.</p>
</div>
<div id="error-rate-guidance" class="section level5 hasAnchor paragraph-start" number="3.2.2.0.3">
<h5 class="hasAnchor"><span class="header-section-number">3.2.2.0.3</span> Error rate guidance<a href="#error-rate-guidance" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A error rate guided result checking process can be implemented, if we can use extraction task related information, to identify thrust worthy. This means, we could white list these values and red flag the remaining ones. Thus, we could guide the users attention in the error checking process on those values, that empirically tend to have a high chance to be faulty.</p>
</div>
</div>
<div id="evaluation-research" class="section level3 hasAnchor" number="3.2.3">
<h3 class="hasAnchor"><span class="header-section-number">3.2.3</span> Evaluation research<a href="#evaluation-research" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We compare different approaches to solve the two tasks, searching for the most effective setup, to solve the problems. A task is considered effective if it achieves good results while being as computationally efficient as possible. As a baseline for each task a <a href="#acronyms_regex">regex (regular expression)</a> based approach is set up. Regular expressions are chosen as baseline because they are computationally efficient. The results are compared with the authors performance as well.</p>
<p>The results should be used to implement an application that is used by the employees of <a href="#acronyms_RHvB">RHvB</a> in future.</p>
</div>
</div>
<div id="evaluation-strategy" class="section level2 hasAnchor" number="3.3">
<h2 class="hasAnchor"><span class="header-section-number">3.3</span> Evaluation Strategy<a href="#evaluation-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="metrics" class="section level3 hasAnchor" number="3.3.1">
<h3 class="hasAnchor"><span class="header-section-number">3.3.1</span> Metrics<a href="#metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="page-identification-1" class="section level5 hasAnchor paragraph-start" number="3.3.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">3.3.1.0.1</span> Page identification<a href="#page-identification-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The distribution of target classes and pages of type <em>other</em> is highly imbalanced. At most two pages per target class are found in documents with up to 152 pages. Thus, following <span class="citation">Saito &amp; Rehmsmeier (<a href="#ref-saitoPrecisionRecallPlotMore2015">2015</a>)</span> suggestion, we report measures as precision, recall and F1 score instead of accuracy, to describe the approaches performances.</p>
</div>
<p>In a <a href="#acronyms_HITL">HITL</a> application the recall value might be of higher interest than the F1 score. More precisely, in those cases the number of pages to check until the correct page is found is of interest. Thus, the top k recall is reported additionally, if the approach permits to rank the classified pages according to a score.</p>
<p>Precision-recall curve</p>
<div id="information-extraction-1" class="section level5 hasAnchor paragraph-start" number="3.3.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">3.3.1.0.2</span> Information extraction<a href="#information-extraction-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use two measures to describe the approaches performances for the information extraction task. First, we check how many of the predicted numeric value are matching the numeric values in the ground truth. The only permitted differences are based on the number of trailing zeros. We do not check for partial correctness, since the real life application requires totally correct extracted numbers.</p>
</div>
<p>Second, we report the F1 score for correctly predicting values as missing and thus returning <em>null</em>. The distribution of missing values and given numeric values is not very imbalanced. Nevertheless, we report the F1 score to establish a comparability with the results od the page identification task.</p>
<div id="error-rate-guidiance" class="section level5 hasAnchor paragraph-start" number="3.3.1.0.3">
<h5 class="hasAnchor"><span class="header-section-number">3.3.1.0.3</span> Error rate guidiance<a href="#error-rate-guidiance" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In this thesis we focus our attention on a criteria, which we name <em>confidence</em>. We calculate the <em>confidence</em> score for answers received from <a href="#acronyms_LLM">LLM</a> based on the non-normalized sum of token log probabilities <span class="citation">(<a href="#ref-boseakEvaluatingLogLikelihoodConfidence2025">Boseak, 2025</a>)</span>:</p>
</div>
<p><span class="math display">\[\begin{equation}
confidence = \exp \left( \sum logprob(token_i) \right)
(\#eq:confidence)
\end{equation}\]</span></p>
<p>For the classification tasks this is equal to the normalized sum, since the answer is either containing just one token or the subsequent tokens have a log probability of 0, because the fully answer is determined by the first token.</p>
<p>We are using the non-normalized sum of token log probabilities as well, because we want a single uncertain digit to flag the whole numeric value as as unreliable. This means, that shorter answers tend to have higher <em>confidence</em> scores. This is especially true for predicting <em>null</em>. Thus, we investigate the prediction of numeric values and <em>null</em> separated.</p>
</div>
<div id="benchmarking" class="section level3 hasAnchor" number="3.3.2">
<h3 class="hasAnchor"><span class="header-section-number">3.3.2</span> Benchmarking<a href="#benchmarking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Comparing the performance of different approaches benchmarked in this thesis is possible, because the approaches within a task are performed on a common document base. The task to solve is the same for each approach. The prompts for the different prompting strategies are build systematically and derive from the base prompt formulated for the <em>zero shot</em> strategy. Comparing the runtime or energy consumption gets possible with the <a href="#acronyms_GPU">GPU (graphics processing unit)</a> benchmark data (see section @ref(gpu-benchmark))</p>
</div>
</div>
<div id="data-strategy" class="section level2 hasAnchor" number="3.4">
<h2 class="hasAnchor"><span class="header-section-number">3.4</span> Data Strategy<a href="#data-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The population of annual reports of interest for the work at the <a href="#acronyms_RHvB">RHvB</a> is composed of all annual reports of companies, where the state of Berlin holds a share. There are often multiple versions of those annual reports: one that is publicly available and targeting share- and stakeholders. The structure and layout of there reports is quite heterogeneous. Often there is a second version that is used internally or for communications with public administrations. They often consist of plain text and tables and shows neither diagrams nor photos.</p>
<p>Since the evaluations are run on the <a href="#acronyms_BHT">BHT (Berliner Hochschule für Technik)</a> cluster and partially in the Azure cloud, we work with the publicly available reports, while at <a href="#acronyms_RHvB">RHvB</a> the internal documents are more common. The annual reports mostly are downloaded from the companies websites. Some documents are accessed via <a href="https://www.bundesanzeiger.de">Bundesanzeiger</a> or the <a href="https://digital.zlb.de">digitale Landesbibliothek Berlin</a>.</p>
<p>For the page identification task all kinds of pages from the annual reports are used. For the information extraction only pages with <strong>Aktiva</strong> tables are used. In addition, a set of self-generated synthetic <strong>Aktiva</strong> tables is used for the information extraction task. It is created to systematically investigate potential effects of characteristics financial tables could have.</p>
<div id="sampling-methodology" class="section level3 hasAnchor" number="3.4.1">
<h3 class="hasAnchor"><span class="header-section-number">3.4.1</span> Sampling methodology<a href="#sampling-methodology" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;./scripts/page_identification_preparations.R&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>num_multiple_tables_per_document <span class="ot">&lt;-</span> df_targets_no_ocr <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="fu">anti_join</span>(consecutive_pages, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;page&quot;</span>, <span class="st">&quot;type&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="fu">arrange</span>(filepath, page) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="fu">group_by</span>(filepath, type) <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="fu">group_by</span>(filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>multiple_tables_per_type_and_document <span class="ot">&lt;-</span> data_unnested <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="fu">anti_join</span>(consecutive_pages, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;page&quot;</span>, <span class="st">&quot;type&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="fu">arrange</span>(filepath, page) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  <span class="fu">group_by</span>(filepath, type) <span class="sc">%&gt;%</span> </span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">&quot;multiple targets in document&quot;</span> <span class="ot">=</span> <span class="fu">n</span>())</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>df_special_targets <span class="ot">&lt;-</span> multiple_tables_per_type_and_document <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(consecutive_pages <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="st">&quot;target two pages long&quot;</span> <span class="ot">=</span> <span class="fu">n</span>())) <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.numeric,coalesce,<span class="dv">0</span>)</span></code></pre></div>
</details>
<div id="page-identification-2" class="section level5 hasAnchor paragraph-start" number="3.4.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">3.4.1.0.1</span> Page identification<a href="#page-identification-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure @ref(fig:document-base-page-identification) shows how the document base for the tasks in this section is composed<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. Overall 74 annual reports from 7 companies are used. For this thesis the tables of interest are those that show <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong>. Among the 4981 pages 265 tables have to be identified on 251 pages. Figure @ref(fig:document-base-page-identification) also gives an impression on how many pages the documents have. The documents of <em>IBB</em> tend to be longer. The documents of <em>Amt für Statistik Berlin-Brandenburg</em> tend to be shorter.</p>
</div>
<div class="pre-detail">
<p>
You can have a look at the ground truth data unfolding the following details element.
</p>
</div>
<div class="hideme">
<table>
<caption>
(#tab:ground-truth-tables-of-interest)Showing all pages of interest with the target table type and filepath.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6d23ac556845e9e21852" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6d23ac556845e9e21852">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251"],["../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2022_<wbr>low.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2023_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2023_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2023_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2020.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2020_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2020_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2020_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2023.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2021_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2021_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2021_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2019.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2019.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2019.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2019.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2022_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2022_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2022_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2019_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/2019_<wbr>Geschaeftsbericht_<wbr>BBB.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/Berliner Bäder Betriebe/GB_<wbr>BBB_<wbr>Infra_<wbr>2021.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2023.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2023.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2023.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/IBB/ibb-geschaeftsbericht-2021.pdf","../Geschaeftsberichte/IBB/ibb-geschaeftsbericht-2021.pdf","../Geschaeftsberichte/IBB/ibb-geschaeftsbericht-2021.pdf","../Geschaeftsberichte/IBB/ibb-geschaeftsbericht-2021.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>digitaler_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>digitaler_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>digitaler_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>digitaler_<wbr>geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2007.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2007.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2007.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2007.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2008.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2008.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2008.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2008.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2011.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2011.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2011.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2011.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2010.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2010.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2010.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2010.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2009.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2009.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2009.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2009.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2004.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2004.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2004.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2004.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2024.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2024.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2024.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2024.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2024.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2006.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2006.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2006.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2006.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2005.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2005.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2005.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2005.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/IBB/ibb_<wbr>geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2022.pdf","../Geschaeftsberichte/IBB/ibb-jahresabschluss-und-lagebericht-2022.pdf","../Geschaeftsberichte/Berlinovo/geschaeftsbericht_<wbr>berlinovo_<wbr>2017_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/geschaeftsbericht_<wbr>berlinovo_<wbr>2017_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/geschaeftsbericht_<wbr>berlinovo_<wbr>2017_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/040815_<wbr>berlinovo_<wbr>gb_<wbr>online_<wbr>rz.pdf","../Geschaeftsberichte/Berlinovo/040815_<wbr>berlinovo_<wbr>gb_<wbr>online_<wbr>rz.pdf","../Geschaeftsberichte/Berlinovo/040815_<wbr>berlinovo_<wbr>gb_<wbr>online_<wbr>rz.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2016_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2016_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2016_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023_<wbr>barrierearm.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023_<wbr>barrierearm.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023_<wbr>barrierearm.pdf","../Geschaeftsberichte/Berlinovo/020712_<wbr>BIH_<wbr>Jaresabschluss_<wbr>2010_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/020712_<wbr>BIH_<wbr>Jaresabschluss_<wbr>2010_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/020712_<wbr>BIH_<wbr>Jaresabschluss_<wbr>2010_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/210512_<wbr>BIH_<wbr>Jahresabschluss_<wbr>2011_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/210512_<wbr>BIH_<wbr>Jahresabschluss_<wbr>2011_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/210512_<wbr>BIH_<wbr>Jahresabschluss_<wbr>2011_<wbr>online.pdf","../Geschaeftsberichte/Berlinovo/070813_<wbr>GB_<wbr>berlinovo_<wbr>2012_<wbr>screen%2520-%2520Korrekturfassung.pdf","../Geschaeftsberichte/Berlinovo/070813_<wbr>GB_<wbr>berlinovo_<wbr>2012_<wbr>screen%2520-%2520Korrekturfassung.pdf","../Geschaeftsberichte/Berlinovo/070813_<wbr>GB_<wbr>berlinovo_<wbr>2012_<wbr>screen%2520-%2520Korrekturfassung.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>bf_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>bf_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>bf_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2023.pdf","../Geschaeftsberichte/Berlinovo/200514_<wbr>gb_<wbr>2013_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/200514_<wbr>gb_<wbr>2013_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/200514_<wbr>gb_<wbr>2013_<wbr>online_<wbr>2.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2015_<wbr>online_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2015_<wbr>online_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb_<wbr>2015_<wbr>online_<wbr>0.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb2019_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb2019_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2021.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2021.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>Finanzbericht_<wbr>2021.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/Finanzbericht_<wbr>Berlinovo_<wbr>2022_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb2018_<wbr>s.pdf","../Geschaeftsberichte/Berlinovo/berlinovo_<wbr>gb2018_<wbr>s.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2019_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2019_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2019_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2021_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2021_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2021_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2023_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2023_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2023_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2011_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2011_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2011_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2018_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2018_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2018_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2022_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2022_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2022_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2016_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2016_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2016_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2009_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2009_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2009_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2014_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2014_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2014_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2007_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2007_<wbr>BBB.pdf","../Geschaeftsberichte/Amt für Statistik Berlin-Brandenburg/AP_<wbr>Geschaeftsbericht_<wbr>DE_<wbr>2007_<wbr>BBB.pdf","../Geschaeftsberichte/degewo AG/212131_<wbr>degewo_<wbr>2022_<wbr>Konzernlagebericht_<wbr>Konzernabschluss.pdf","../Geschaeftsberichte/degewo AG/212131_<wbr>degewo_<wbr>2022_<wbr>Konzernlagebericht_<wbr>Konzernabschluss.pdf","../Geschaeftsberichte/degewo AG/212131_<wbr>degewo_<wbr>2022_<wbr>Konzernlagebericht_<wbr>Konzernabschluss.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss_<wbr>2021_<wbr>BEN_<wbr>GmbH.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss_<wbr>2021_<wbr>BEN_<wbr>GmbH.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss-BEN-GmbH-2023.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss-BEN-GmbH-2023.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss-BEN-GmbH-2023.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/Jahresabschluss-BEN-GmbH-2023.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/SIGNATURE_<wbr>DEE00084236.1.1_<wbr>550912_<wbr>Endexemplar_<wbr>20230331.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/SIGNATURE_<wbr>DEE00084236.1.1_<wbr>550912_<wbr>Endexemplar_<wbr>20230331.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/SIGNATURE_<wbr>DEE00084236.1.1_<wbr>550912_<wbr>Endexemplar_<wbr>20230331.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/SIGNATURE_<wbr>DEE00084236.1.1_<wbr>550912_<wbr>Endexemplar_<wbr>20230331.pdf","../Geschaeftsberichte/Berlin Energie und Netzholding/SIGNATURE_<wbr>DEE00084236.1.1_<wbr>550912_<wbr>Endexemplar_<wbr>20230331.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2019.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2018.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2020.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2021.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2021.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaftsbericht_<wbr>2023_<wbr>bf.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaftsbericht_<wbr>2023_<wbr>bf.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2012.pdf","../Geschaeftsberichte/GESOBAU AG/Gesch%C3%A4ftsbericht_<wbr>2022_<wbr>bf.pdf","../Geschaeftsberichte/GESOBAU AG/Gesch%C3%A4ftsbericht_<wbr>2022_<wbr>bf.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2013.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2015.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2024.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2024.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Gesch%C3%A4ftsbericht_<wbr>2024.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2014.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2016.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2017.pdf","../Geschaeftsberichte/GESOBAU AG/GESOBAU_<wbr>Geschaeftsbericht_<wbr>2017.pdf"],["10","11","13","28","29","31","16","17","19","10","11","13","28","29","31","36","37","39","7","8","10","25","26","28","34","35","37","6","7","15","16","20","21","23","20","21","10","11","13","26","27","29","42","43","44","45","4","5","6","55","56","57","58","98","99","100","101","74","75","76","77","69","70","71","72","14","15","16","17","74","75","76","77","72","73","74","75","115","116","117","118","116","117","118","119","106","107","108","109","44","45","46","47","44","45","46","47","89","90","91","92","66","67","68","69","32","33","34","36","37","68","69","70","71","66","67","68","69","44","45","46","47","47","48","49","50","4","5","50","51","52","60","61","62","53","54","55","44","45","46","20","21","22","20","21","22","50","51","52","42","43","44","44","45","46","50","51","52","62","63","64","37","38","40","41","42","42","43","44","32","33","32","33","34","8","9","10","7","8","9","18","19","20","28","29","30","8","9","10","32","33","34","26","27","28","24","25","26","16","17","18","30","31","33","9","10","21","23","42","43","20","21","23","42","43","54","55","56","52","53","54","29","30","34","35","38","39","40","41","42","32","33","40","41","42","40","41","42","62","63","64","40","41","42","42","43","44","62","52","53","54"],["Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva&Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva&Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva&Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","GuV"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>filepath<\/th>\n      <th>page<\/th>\n      <th>type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"filepath","targets":1},{"name":"page","targets":2},{"name":"type","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>df_pages <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">docs_per_company =</span> <span class="fu">n</span>(), <span class="at">pages_per_company =</span> <span class="fu">sum</span>(pages)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> pages, <span class="at">fill =</span> needs_ocr), <span class="at">color =</span> <span class="st">&quot;#00000033&quot;</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> pages_per_company, <span class="at">label =</span> docs_per_company, <span class="at">group =</span> company),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/document-base-page-identification-1.png" alt="Showing the number of pages (bar height) and number of documents (number above the bar) per company for the data used for the page identification task. Some documents would require ocr before being processed and were not used." width="672" />
<p class="caption">
(#fig:document-base-page-identification)Showing the number of pages (bar height) and number of documents (number above the bar) per company for the data used for the page identification task. Some documents would require ocr before being processed and were not used.
</p>
</div>
<p>Table @ref(tab:display-multiple-tables-per-type-and-document) shows how many documents have multiple target tables per type and how many target tables span two pages. In total 21 tables are distributed on two pages. In 8 documents there are multiple tables per type of interest. There are 14 pages with two target tables (<strong>Aktiva</strong> and <strong>Passiva</strong>) on it.</p>
<table>
<caption>
(#tab:display-multiple-tables-per-type-and-document)Showing the number of documents with multiple target tables per type and the number of target tables that span two pages.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-31917d2f7d554c021bbd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-31917d2f7d554c021bbd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["Aktiva","GuV","Passiva"],["7","8","7"],["1","20","0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type<\/th>\n      <th>multiple targets in document<\/th>\n      <th>target two pages long<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"type","targets":1},{"name":"multiple targets in document","targets":2},{"name":"target two pages long","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="information-extraction-2" class="section level5 hasAnchor paragraph-start" number="3.4.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">3.4.1.0.2</span> Information extraction<a href="#information-extraction-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the manual information extraction we need up to 12 minutes per table. The maximum amount of values to copy and format (or type manually) among the tables used is 40. In addition to this manual process conceptional process can be necessary, because the values have to matched to the strict grammar. Sometimes we have to decide that there is no row a value fits in or there are multiple values that have to get summed up in order to calculate the value that fits in the predefined schema.</p>
</div>
<p>This manual work was done for 36 documents. For every company that published the detailed form of balance sheets a single document was included. Additionally documents were included for <em>Amt für Statistik und Brandenburg</em> to check, if a context learning approach is benefiting from documents from the same company. Later, the predictions of the <a href="#acronyms_LLM">LLM</a>s were used, to create additional 106 ground truth tables. The old ground truth tables were checked in this this iteration and an error rate of 2.4 % was detected. Thus, the human reference score for percentage of correct predictions is 0.976. Figure @ref(fig:table-extraction-doc-base) shows how many <strong>Aktiva</strong> tables are used for all tasks in this subsection, that use real data instead of synthetic data.</p>
<p>To overcome the limited amount of real data and to allow the systematic investigation of potential predictors for the extraction performance, even if their occurrence is very unbalanced within the real data, synthetic <strong>Aktiva</strong> tables were created (see subsection @ref(synthetic-table-extraction)).</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>new_doc_base <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="at">.before =</span> <span class="dv">1</span>, </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="at">company =</span> <span class="fu">str_match</span>(filepath, <span class="st">&quot;/pvc/benchmark_truth/real_tables_extended/(.*)__&quot;</span>)[<span class="dv">2</span>],</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">initial_doc_base =</span> <span class="fu">str_remove</span>(filepath, <span class="st">&quot;_extended&quot;</span>) <span class="sc">%in%</span> old_doc_base<span class="sc">$</span>filepath</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">fill =</span> initial_doc_base)) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-doc-base-1.png" alt="Showing the number of documents used for the table extraction task. The number of Aktiva tables is equal to the number documents." width="100%" />
<p class="caption">
(#fig:table-extraction-doc-base)Showing the number of documents used for the table extraction task. The number of Aktiva tables is equal to the number documents.
</p>
</div>
<div id="error-rate-guidiance-1" class="section level5 hasAnchor paragraph-start" number="3.4.1.0.3">
<h5 class="hasAnchor"><span class="header-section-number">3.4.1.0.3</span> Error rate guidiance<a href="#error-rate-guidiance-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We investigate the third research question on the two datasets described above, instead of creating a separate dataset.</p>
</div>
</div>
<div id="ground-truth-creation-process" class="section level3 hasAnchor" number="3.4.2">
<h3 class="hasAnchor"><span class="header-section-number">3.4.2</span> Ground truth creation process<a href="#ground-truth-creation-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ground truth for both tasks is created by by manual labor of the authors. The results of early experiments are used to check the ground truth for mistakes or missed items.</p>
<div id="page-identification-3" class="section level5 hasAnchor paragraph-start" number="3.4.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">3.4.2.0.1</span> Page identification<a href="#page-identification-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the page identification task the chosen documents are searched for the target pages either by using the search functionality, <a href="#acronyms_TOC">TOC</a> or scrolling through all pages. For each target page the filepath, page and type is listed in a csv file. For some reports there are multiple pages present for a single target type. In this case, both pages are added to the ground truth. Sometimes the <strong>Aktiva</strong> and <strong>Passiva</strong> page are on a single page. In this case a single entry is made and its type is <em>Aktiva&amp;Passiva</em>. If a table spans two pages, both pages are recorded. Excluding pages that need <a href="#acronyms_OCR">OCR (optical character recognition)</a> processing we created 252 entries.</p>
</div>
<p>For double checking all identified pages are extracted from their original PDF files and combined in a single file. Thus, problems with the numbers shown in the PDF viewer and the actual page number in the file are identified and resolved. After the first experiments pages, that have been classified as a target by multiple models, are checked. Thus, some additional target tables, that span two pages, are identified.</p>
<div id="information-extraction-3" class="section level5 hasAnchor paragraph-start" number="3.4.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">3.4.2.0.2</span> Information extraction<a href="#information-extraction-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the information extraction task we copy the numeric values from the annual reports into csv files, replace the thousands separators and floating point delimiters and multiply those values by 1_000, if a currency unit is given for the column the value comes from. The csv files are already prefilled with all entities defined in the legal text, identified by their full hierarchy. Thus, we choose which line to put the value in, if the description in the annual report is different.</p>
</div>
<p>There are cases, where a single line defined in the legal text is split up into multiple lines in the annual reports. In those cases we enter the sum into the according row in the csv file. If entities are found, that do not fit any entity given in the legal text, this entry is dropped. For the first iteration the csv files just contained the entities and column names but no values.</p>
<p>In the second iteration we use the predictions of Qwen3-235B, check the values and mark mistakes, correct the values and log all mistakes found. In this iteration we check the ground truth created in the first iteration as well and correct mistakes made earlier.</p>
<div id="error-rate-guidiance-2" class="section level5 hasAnchor paragraph-start" number="3.4.2.0.3">
<h5 class="hasAnchor"><span class="header-section-number">3.4.2.0.3</span> Error rate guidiance<a href="#error-rate-guidiance-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>There is not ground truth for the calculated <em>confidence</em> scores. We will simply check, if the true and false predictions can be separated based on the returned <em>confidence scores</em>.</p>
</div>
</div>
<div id="preprocessing" class="section level3 hasAnchor" number="3.4.3">
<h3 class="hasAnchor"><span class="header-section-number">3.4.3</span> Preprocessing<a href="#preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use plain text extracted from the annual reports for all tasks. We do not extract geometric coordinates for the text. <span class="citation">Auer et al. (<a href="#ref-auerDoclingTechnicalReport2024">2024</a>)</span> describes, that available open-source PDF parsing libraries may show issues as poor extraction speed or randomly merged text cells. We tested five PDF extraction libraries, because the results of all subsequent experiments will depend on the text extracts. Section @ref(text-extraction-benchmark) shows the results.</p>
<p>We perform no manual data cleaning, because this will not be done from the employees of <a href="#acronyms_RHvB">RHvB</a> either.</p>
</div>
<div id="data-splitting" class="section level3 hasAnchor" number="3.4.4">
<h3 class="hasAnchor"><span class="header-section-number">3.4.4</span> Data splitting<a href="#data-splitting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we train a machine learning model, we split the data into train and a test set. We do not use a validation set, because we do not compare models using an extended hyper-parameter variation strategy. Instead we just report the performance found for the models build with default settings. We build two random forests for the term frequency approach in the page identification task and more random forests for evaluating the hypotheses for the information extraction task.</p>
<p>Building the term frequency random forest, we face a highly imbalanced dataset. We apply undersampling for the training and evaluate the model on the imbalanced test set.</p>
</div>
</div>
<div id="experimental-framework" class="section level2 hasAnchor" number="3.5">
<h2 class="hasAnchor"><span class="header-section-number">3.5</span> Experimental Framework<a href="#experimental-framework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="llm-overview" class="section level3 hasAnchor" number="3.5.1">
<h3 class="hasAnchor"><span class="header-section-number">3.5.1</span> LLM overview<a href="#llm-overview" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table @ref(tab:llm-overview) einbinden</p>
<table>
<caption>
(#tab:llm-overview)Overview of benchmarked LLMs for all tasks. Parameter shows passive parametercount in billions.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4cc742f1c2e7acd916db" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4cc742f1c2e7acd916db">{"x":{"filter":"none","vertical":false,"class":"display","extensions":["RowGroup"],"data":[["chat-gpt","chat-gpt","chat-gpt","chat-gpt","chat-gpt","google","google","google","google","Llama-3","Llama-3","Llama-3","Llama-4","Llama-4","microsoft","mistralai","mistralai","mistralai","openai","openai","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 3","Qwen 3","Qwen 3","Qwen 3","Qwen 3","Qwen 3","Qwen 3","Qwen 3","Qwen 3","tiiuae"],["gpt-4.1","gpt-4.1-mini","gpt-4.1-nano","gpt-5-mini","gpt-5-nano","gemma-3-4b-it","gemma-3n-E4B-it","gemma-3-12b-it","gemma-3-27b-it","Llama-3.1-8B-Instruct","Llama-3.1-70B-Instruct","Llama-3.3-70B-Instruct","Llama-4-Scout-17B-16E-Instruct","Llama-4-Maverick-17B-128E-Instruct-FP8","phi-4","Ministral-8B-Instruct-2410","Mistral-Small-3.1-24B-Instruct-2503","Mistral-Large-Instruct-2411","gpt-oss-20b","gpt-oss-120b","Qwen2.5-0.5B-Instruct","Qwen2.5-1.5B-Instruct","Qwen2.5-3B-Instruct","Qwen2.5-7B-Instruct","Qwen2.5-14B-Instruct","Qwen2.5-32B-Instruct","Qwen2.5-72B-Instruct","Qwen3-0.6B","Qwen3-1.7B","Qwen3-4B","Qwen3-8B","Qwen3-14B","Qwen3-30B-A3B-Instruct-2507","Qwen3-32B","Qwen3-235B-A22B-Instruct-2507-FP8","Qwen3-235B-A22B-Instruct-2507","Falcon3-10B-Instruct"],[null,null,null,null,null,"4","4","12","27","8","70","70","109","402","15","8","24","124","20","120","0.5","1.5","3","7","14","32","72","0.6","1.7","4","8","14","30","32","235","235","10"],["X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","X","","X"],["","","","","","","","X","X","X","X","X","X","X","","X","X","X","","","","","","X","","","X","","","","X","","X","X","X","X",""],["","","","","","","","X","X","X","","","X","","","X","","X","","","","","","","","","","","","","X","","","","X","",""],["","","","","","X","X","X","X","X","X","X","X","X","X","X","X","X","","","X","X","X","X","X","X","X","","","","X","","X","X","","X","X"],["","","","","","X","X","X","X","X","X","X","X","X","X","X","X","X","","","X","X","X","X","X","X","X","","","","X","","X","X","","X","X"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th colspan=\"1\" rowspan=\"2\">model_family<\/th>\n      <th colspan=\"1\" rowspan=\"2\">model<\/th>\n      <th colspan=\"1\" rowspan=\"2\">parameter<\/th>\n      <th colspan=\"3\" rowspan=\"1\">information extraction<\/th>\n      <th colspan=\"2\" rowspan=\"1\">page identification<\/th>\n    <\/tr>\n    <tr>\n      <th>real tables<\/th>\n      <th>synth tables<\/th>\n      <th>hybrid<\/th>\n      <th>binary<\/th>\n      <th>multi-class<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","rowGroup":{"dataSrc":0},"ordering":false,"columnDefs":[{"visible":false,"targets":0},{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-center"},{"targets":4,"className":"dt-center"},{"targets":5,"className":"dt-center"},{"targets":6,"className":"dt-center"},{"targets":7,"className":"dt-center"},{"name":"model family","targets":0},{"name":"model","targets":1},{"name":"parameter","targets":2},{"name":"real tables","targets":3},{"name":"synth tables","targets":4},{"name":"hybrid","targets":5},{"name":"binary","targets":6},{"name":"multi-class","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="gpu-benchmark" class="section level3 hasAnchor" number="3.5.2">
<h3 class="hasAnchor"><span class="header-section-number">3.5.2</span> Hardware normalization<a href="#gpu-benchmark" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To make the runtime of different <a href="#acronyms_LLM">LLM</a>s running on different amounts and types of <a href="#acronyms_GPU">GPU</a>s comparable, we conducted a benchmark running the models Qwen2.5-7B and Qwen2.5-32B with different hardware compositions on the Datexis cluster. Figure @ref(fig:gpu-benchmark-plot) shows the runtime for classifying 100 pages with the multi-class approach, providing three random examples for the in-context learning.</p>
<p>The classification time with Qwen2.5-32B on <a href="#acronyms_GPU">GPU</a>s of type B200 is a little faster than running Qwen2.5-7B on the same amount of A100 <a href="#acronyms_GPU">GPU</a>s. We calculate normalized runtimes for our experiments, based on these runtime measures for small and larger <a href="#acronyms_LLM">LLM</a>s on different types and numbers of <a href="#acronyms_GPU">GPU</a>s. A minute of computation on a single B200 is comparable to 4:30 minutes of computation on a single A100.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>df_gpu_benchmark <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_jobs/page_identification/gpu_benchmark/gpu_factors.csv&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>df_gpu_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gpu_number, <span class="at">y =</span> runtime_in_s, <span class="at">color =</span> gpu_type)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> model_name)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/gpu-benchmark-plot-1.png" alt="Showing the runtime to classify 100 pages with the multi-class approach, providing three random examples for the in-context learning." width="672" />
<p class="caption">
(#fig:gpu-benchmark-plot)Showing the runtime to classify 100 pages with the multi-class approach, providing three random examples for the in-context learning.
</p>
</div>
</div>
<div id="error-analysis" class="section level3 hasAnchor" number="3.5.3">
<h3 class="hasAnchor"><span class="header-section-number">3.5.3</span> Error analysis<a href="#error-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ultimate goal is to fully automate the information extraction task at hand. Thus, it is important to analyse potential errors, to identify obstacles that hinder performance and find ways to further improve the system.</p>
<p>We expect to find issues with wrong extracted or hallucinated numbers, wrong entity recognition and false positive <em>null</em> values. Not respected units</p>
<p>Quantitative / stratified: We will compare the error rates based on the different variables of the experiments. For the approaches using <a href="#acronyms_LLM">LLM</a>s to solve the problem there are model specific, prompting strategy specific and example specific variables.</p>
<p>Qualitative: Finally, we investigate some of the erroneous extracted examples manually, and try to identify the underlying issues.</p>
<p>Tools and criteria</p>
<p>Reporting</p>
<p>Example:</p>
<p>To better understand the limitations of the evaluated models, we will conduct a detailed error analysis. We will first quantify the types of errors (e.g., false positives, false negatives, misclassifications) using confusion matrices and error rate statistics. Additionally, we will manually inspect a sample of erroneous predictions to identify common causes, such as ambiguous table layouts, OCR errors, or model misinterpretations. Errors will be categorized by document type and extraction task to reveal systematic weaknesses. Representative error cases will be documented to illustrate typical failure modes and to inform potential improvements for future work.</p>
<p>99.5 % or 96 % accuracy for extracting financial data from Annual Comprehensive Financial Reports <span class="citation">(<a href="#ref-liExtractingFinancialData2023">H. Li, Gao, et al., 2023</a>)</span> In the untabulated test, GPT-4 achieved an average accuracy rate of 96.8%, and Claude 2 achieved 93.7%. Gemini had the lowest accuracy rate at 69%. (ebd.)</p>
<p>Too many hallucinated values when it was NA instead <span class="citation">(<a href="#ref-grandiniMetricsMultiClassClassification2020">Grandini et al., 2020</a>)</span></p>
</div>
<div id="baseline-selection-rationale" class="section level3 hasAnchor" number="3.5.4">
<h3 class="hasAnchor"><span class="header-section-number">3.5.4</span> Baseline selection rationale<a href="#baseline-selection-rationale" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>see section Evaluation research</p>
</div>
<div id="prompt-building" class="section level3 hasAnchor" number="3.5.5">
<h3 class="hasAnchor"><span class="header-section-number">3.5.5</span> Prompt building<a href="#prompt-building" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="evaluation-methods" class="section level3 hasAnchor" number="3.5.6">
<h3 class="hasAnchor"><span class="header-section-number">3.5.6</span> Evaluation methods<a href="#evaluation-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>box plots</p></li>
<li><p>PR-curve</p></li>
<li><p>random forest + SHAP</p></li>
</ul>
<p>XGBoost not used finally, because calculation <a href="#acronyms_SHAP">SHAP</a> values for XGBoost model took to long for just a first glimpse on what might influence the extraction. lm also fitted and not used</p>
</div>
</div>
<div id="ethical-practical-considerations-eher-am-ende-oder-weg" class="section level2 hasAnchor" number="3.6">
<h2 class="hasAnchor"><span class="header-section-number">3.6</span> Ethical &amp; Practical Considerations (eher am Ende oder weg?)<a href="#ethical-practical-considerations-eher-am-ende-oder-weg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="pdf-extraction-limitations" class="section level3 hasAnchor" number="3.6.1">
<h3 class="hasAnchor"><span class="header-section-number">3.6.1</span> PDF extraction limitations<a href="#pdf-extraction-limitations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pdfminer informs that the text of some annual reports from <em>IBB</em> and <em>Berlinovo</em> should not be extracted. This information is given in a meta data field of the PDF. We use the text extract from these documents for our study anyway.</p>
<p>Errors catched by <a href="#acronyms_HITL">HITL</a> approach before they have down stream implications.</p>
</div>
<div id="computational-constraints" class="section level3 hasAnchor" number="3.6.2">
<h3 class="hasAnchor"><span class="header-section-number">3.6.2</span> Computational constraints<a href="#computational-constraints" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The extraction with <a href="#acronyms_LLM">LLM</a>s is computationally demanding and should be run on <a href="#acronyms_GPU">GPU</a>s. To run model that yields the best results four H200 <a href="#acronyms_GPU">GPU</a>s are needed.</p>
</div>
<div id="generalizability-scope" class="section level3 hasAnchor" number="3.6.3">
<h3 class="hasAnchor"><span class="header-section-number">3.6.3</span> Generalizability scope<a href="#generalizability-scope" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The approach tested here is probably using on other companies annual reports as well. To extract information that is only filling a small part of a page the framework may has to be adjusted. The page identification could be trickier with some approaches if only a single key word is searched.</p>
</div>
<div id="ethical-considerations" class="section level3 hasAnchor" number="3.6.4">
<h3 class="hasAnchor"><span class="header-section-number">3.6.4</span> Ethical considerations<a href="#ethical-considerations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The extraction of numeric information is not the same as making decisions. It probably isn’t affected by any bias, that is discriminating humans.</p>
<p>The automatisation of information extraction is potentially replacing low requirements work places. At <a href="#acronyms_RHvB">RHvB</a> there are no jobs for such a task anymore. More free time for other tasks. Shifting to more complex tasks.</p>
<p>AI Act does probably not apply, since decisions are not made on individual level?: Are there restrictions on the use of automated decision-making? Yes, <strong>individuals should not be subject to a decision that is based solely on automated processing</strong> (such as algorithms) and that is legally binding or which significantly affects them.</p>
<!--chapter:end:03_Methodology.Rmd-->
</div>
</div>
</div>
<div id="implementation" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Implementation<a href="#implementation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>(max 5p)</p>
<div id="environments" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> Environments<a href="#environments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The computations for this thesis are performed in two environments. Task that do not require a <a href="#acronyms_GPU">GPU</a> are run locally. You can find the specifications of the local device in section @ref(local-machine). Other tasks are run on the Datexis Kubernetes cluster.</p>
<p>Egal ab hier:</p>
<p>The prototyping for these tasks is performed on the cluster as well. Therefore, a interactive docker image with SSH capabilities and Python has been created based on the <a href="#acronyms_vllm">vLLM (Virtual Large Language Model)</a> docker image. In rare cases a <a href="#acronyms_vllm">vLLM</a> server is deployed on the cluster and queried from the local machine during prototyping.</p>
<p>The experiments run using the same images as the prototyping environment and connects to the persistent volume, where the scripts to run and data(bases) to use are located and saves the results on the persistent volume as well. We do backups of the folder holding the scripts and data to process and download the results via <a href="#acronyms_SSH">SSH (secure shell)</a> protocoll. We use <em>git</em> for version control but do not synchronize the data from the persistent volume with <em>GitHub</em>.</p>
<p>We used 5 TB persistent storage. Most of the space is used for caching the <a href="#acronyms_LLM">LLM</a> sefetensors.</p>
<p>Within the local environment we use <em>git</em> as well. Except for the gigabytes of result files everything is synchronized with <em>GitHub</em>.</p>
<p>Table : what task in what environment? Seems not super important</p>
</div>
<div id="evaluation-and-reporting" class="section level2 hasAnchor" number="4.2">
<h2 class="hasAnchor"><span class="header-section-number">4.2</span> Evaluation and Reporting<a href="#evaluation-and-reporting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We mostly use <em>R</em> for evaluation, visualization and reporting. We use the <em>bookdown</em> library<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, to create a report, that is linked to our data and thus automatically includes new results and updates all figures and tables. This allows us to run small additional experiments until the very end of thesis writing.</p>
<p>Furthermore, this allows us to create a <a href="#acronyms_PDF">PDF</a> version as well as a <a href="#acronyms_HTML">HTML (hyper text markup language)</a> version of the thesis at the same time with low additional effort. The HTML version allows to use some helpful interactive elements as paginated tables with search and sorting capabilities, image light boxes and image sliders. Thus , a lot of information can be offered without occupying pages over pages with tables and figures. The <a href="#acronyms_HTML">HTML</a> version is more machine readable as well. Lacking machine readability is what makes the information extraction from PDFs mandatory in the first place and we want spare others these difficulties.</p>
</div>
<div id="software-packages" class="section level2 hasAnchor" number="4.3">
<h2 class="hasAnchor"><span class="header-section-number">4.3</span> Software Packages<a href="#software-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Macht das Sinn, das hier aufzulisten? Wenn ja, wie detailliert? Vielleiche auf eine requirements Datei je Sprache verweisen?</p>
<p>Einmal die großen und was es macht</p>
<ul>
<li><p>Python</p>
<ul>
<li><p>pandas</p></li>
<li><p>numpy</p></li>
<li><p>scikit learn</p></li>
<li><p>vLLM</p></li>
<li><p>chroma DB</p></li>
</ul></li>
<li><p>R</p>
<ul>
<li>tidyverse</li>
</ul></li>
</ul>
</div>
<div id="speedup-with-vllm-and-batching" class="section level2 hasAnchor" number="4.4">
<h2 class="hasAnchor"><span class="header-section-number">4.4</span> Speedup with vLLM and batching<a href="#speedup-with-vllm-and-batching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We run our final experiments with the <a href="#acronyms_vllm">vLLM</a> library on Python, using its batch processing capabilities. Our first test used the <em>transformers</em> library directly and did not use batch processing. Section @ref(vllm-batch-speed) shows the runtime reduction that is achieved with the final setup.</p>
</div>
<div id="text-extraction" class="section level2 hasAnchor" number="4.5">
<h2 class="hasAnchor"><span class="header-section-number">4.5</span> Text extraction<a href="#text-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use <em>pdfium</em> for the text extraction for all tasks. Some approaches are run with the texts of other PDF extraction libraries as well.</p>
<p>Table : what task had additional extraction backends? Seems not super important</p>
</div>
<div id="data-processing" class="section level2 hasAnchor" number="4.6">
<h2 class="hasAnchor"><span class="header-section-number">4.6</span> Data processing<a href="#data-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="figure">
<img src="images/unified_flowchart.png" alt="Showing the processing steps from input data to the results in this thesis." width="100%" />
<p class="caption">
(#fig:unnamed-chunk-6)Showing the processing steps from input data to the results in this thesis.
</p>
</div>
<p>We start by extracting the text for each page from the annual reports, using PDF extraction libraries like <em>pdfium</em>. We do this once for each document and save all text extracts in a <a href="#acronyms_json">json</a> file together with the original file path and pagenumber.</p>
<p>For <a href="#acronyms_LLM">LLM</a> approaches we embed the texts in the prompt template. The (merged) texts are then processed by the algorithm, predicting, if the text is including a specific type of information or not. The predictions are compared with ground truth.</p>
<p>The results of this check are saved as <a href="#acronyms_json">json</a>. We save the result for every individual check, as well as calculated performance metrics and the runtime needed to process all texts as batch. This allows us to reevaluate or exclude single results and recalculate the aggregated metrics later. All steps from the text extraction to the result saving are implemented in <em>Python</em>.</p>
<p>The process for the information extraction is similar. One difference is, that the algorithm makes multiple predictions per text. Thus, we save not a single prediction and evaluation but a data frame with all predictions and all ground truth values per text. Saving the ground truth values in this data frame is not necessary but allows us a more convenient reevaluation.</p>
<p>The (re)evaluation is done in <em>R</em> instead of <em>Python</em>, because we can seamlessly include it in our reporting engine.</p>
<!--chapter:end:04_Implementation.Rmd-->
</div>
</div>
<div id="results" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Results<a href="#results" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- \addthumb{Chapter~\thechapter.1}{\textbf{\Huge{\thechapter}\Large{.1}}}{white}{gray} -->
<p>This chapter presents the results for the two main and our side research
questions of this thesis:</p>
<ol class="rs-questions" style="--counter: 1;">
<li>
How can we use LLMs effectively to locate specific information in a financial report?
</li>
<li>
How can we use LLMs effectively to extract these information from the document?
</li>
<li>
Can we use additional information from the extraction process, to guide the user which values need to be checked and which can be trusted as they are?
</li>
</ol>
<p>Section @ref(page-identification-introduction) presents the results for
the first research question. Section
@ref(table-extraction-introduction) presents the results for the second
question. Section @ref(error-rate-guidance-results) shows the results
for the side research question. Finally, we will summarize all results
in section @ref(summary-results).</p>
<p>Each section will start with an overview about the specific sub tasks as
well about the models, methods and data used to investigate the research
question. We refer to the sections in the appendix that document our
investigation and the results of the sub tasks in detail.</p>
<div id="page-identification-introduction" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Page identification<a href="#page-identification-introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(ref:page-identification-intro-text) The first research question asks, how <a href="#acronyms_LLM">LLM</a>s can be used, to effectively locate specific information in a financial report. The task
for this thesis is identifying the pages where the balance sheet
(<em>Bilanz</em>) and the profit-and-loss-and-statement (<em>Gewinn- und
Verlustrechnung, GuV</em>) are located. The balance sheet is composed of two
tables showing the assets (<em>Aktiva</em>) and liabilities (<em>Passiva</em>) of a
company. Often these two tables are on separate pages. Hereafter, the
German terms <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong> will be used.</p>
<p>(ref:page-identification-intro-text)</p>
<p><span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span> describes two ways to identify the
relevant pages (see Figure @ref(fig:extraction-framework-flow-chart)).
For longer documents they propose to use the <a href="#acronyms_TOC">TOC</a> to determine a
page range that includes the information of interest. In addition, they
develop target specific regular expressions and rules to filter out
irrelevant pages<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>. The result of this “Page Range
Refinement” is then passed to the <a href="#acronyms_LLM">LLM</a> to extract information from.</p>
<p>This section is presenting the results of four approaches to identify
the page<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> of interest:</p>
<ul>
<li>Subsection @ref(regex-page-identification) presents the findings
of a page range refinement using a list of key words with a regular
expression.</li>
<li>Subsection @ref(toc-understanding) presents the findings of a
<a href="#acronyms_TOC">TOC</a> understanding approach</li>
<li>Subsection @ref(llm-page-identification) presents the findings
of a text classification approach using <a href="#acronyms_LLM">LLM</a>s.</li>
<li>Subsection @ref(tf-classifier) presents the findings of a
term-frequency approach.</li>
</ul>
<p>In subsection @ref(comparison-page-identification) the results get
compared and summarized. Subsection @ref() proposes an efficient
combination of approaches to solve the task of this thesis and discusses
its limitations.</p>
<div id="section-1" class="section level3 unlisted unnumbered">
<h3 class="unlisted unnumbered"></h3>
<p>Woanders hin oder weg:</p>
<ul>
<li>Thus, we prompt the <a href="#acronyms_LLM">LLM</a> to classify if the text extract of a given
page</li>
<li>for implementation: As described in @ref(text-extraction-benchmark)
open source libraries have been used to extract the text from the annual
reports.</li>
</ul>
<div id="dataset-describtion" class="section level5 hasAnchor paragraph-start" number="5.1.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.1.0.0.1</span> Dataset describtion<a href="#dataset-describtion" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the page identification task companies (mainly) from the first row of Figure @ref(fig:beteiligungsunternehmen) have been selected, to build the ground truth from. The idea is that the documents of a companies within a category are more similar to each other, than to documents of companies of other categories. For the chosen companies all available annual reports are selected. Since one of the companies mainly published documents that require <a href="#acronyms_OCR">OCR</a> preprocessing, we include the documents of a second company for this category.</p>
</div>
</div>
<div id="approaches" class="section level3 hasAnchor" number="5.1.1">
<h3 class="hasAnchor"><span class="header-section-number">5.1.1</span> Approaches<a href="#approaches" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The page identification task is broken down to a classification task for all of the approaches presented in this section but the <a href="#acronyms_TOC">TOC</a> understanding approach. This subsection briefly describes our approaches. A detailed report can be found in chapter @ref(page-identification-report).</p>
<div id="regular-expressions-1" class="section level5 hasAnchor paragraph-start" number="5.1.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.1.1.0.1</span> Regular expressions<a href="#regular-expressions-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We develop multiple sets of regular expressions and filter out all pages that do not fulfill all regular expressions of a given set. There are different sets for each target type, <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong>. The sets also differ in how versatile they can cope with additional white space introduced by a imperfect text extraction and how many different words for a given term are accepted. Figure @ref(fig:regex-filter) shows an example for two sets of regular expressions to identify a <strong>Aktiva</strong> page.</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/regex_filtering.png" alt="Comparing the prediction of two different sets of regular expressions on dummy pages. The simple one has a lower recall, while the  expended one has a lower precision." width="100%" />
<p class="caption">
(#fig:regex-filter)Comparing the prediction of two different sets of regular expressions on dummy pages. The simple one has a lower recall, while the expended one has a lower precision.
</p>
</div>
<div id="table-of-contents-understanding" class="section level5 hasAnchor paragraph-start" number="5.1.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">5.1.1.0.2</span> Table of Contents Understanding<a href="#table-of-contents-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use a <a href="#acronyms_LLM">LLM</a> to extract the <a href="#acronyms_TOC">TOC</a> from the first pages from a document or use the embedded <a href="#acronyms_TOC">TOC</a> and prompt a <a href="#acronyms_LLM">LLM</a> to identify the pages where the <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong> are located. Figure @ref(fig:toc-screenshot) shows a screenshot of a annual report with an embedded TOC and its TOC in text form.</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/toc.png" alt="Showing a screenshot of a annual report with an embedded TOC (left) and its TOC in text form (right). The embeded TOC is not listing all entries from the TOC in text form." width="100%" />
<p class="caption">
(#fig:toc-screenshot)Showing a screenshot of a annual report with an embedded TOC (left) and its TOC in text form (right). The embeded TOC is not listing all entries from the TOC in text form.
</p>
</div>
<div id="large-language-model-classification" class="section level5 hasAnchor paragraph-start" number="5.1.1.0.3">
<h5 class="hasAnchor"><span class="header-section-number">5.1.1.0.3</span> Large Language Model Classification<a href="#large-language-model-classification" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use <a href="#acronyms_LLM">LLM</a>s to classify if the text extract of a given page is containing a <strong>Aktiva</strong>, <strong>Passiva</strong> or <strong>GuV</strong> table or something else. We test binary classification and a multi-classification approach. The reported confidence scores can be used to form a ranking, which text extract might be most similar to the target type.</p>
</div>
<p>We test a wide range of open-weight models and compare different prompting techniques. Figure @ref(fig:prompt-setup-classification) shows, how the prompts are composed for the different strategies. Besides a zero shot approach we test few-shot in-context learning with examples that are either chosen randomly or retrieved based on their vector similarity. Finally, we test passing the legal text instead of examples from a annual report.</p>
<div class="figure" style="text-align: center">
<img src="images/promt_building_classification.png" alt="Showing the basic structure of the prompts and which strategies are used to pass additional information to the LLM." width="100%" />
<p class="caption">
(#fig:prompt-setup-classification)Showing the basic structure of the prompts and which strategies are used to pass additional information to the LLM.
</p>
</div>
<div id="term-frequency-ranking" class="section level5 hasAnchor paragraph-start" number="5.1.1.0.4">
<h5 class="hasAnchor"><span class="header-section-number">5.1.1.0.4</span> Term frequency Ranking<a href="#term-frequency-ranking" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use normalized term frequencies and normalized float frequency to as features for a classification using a random forest. The predicted scores are used to build a ranking, which page most probably contains the target pages. Undersampling is used during training, to handle the unbalanced data. Figure @ref(fig:tf-flowchart) visualizes, how the prediction works in this approach.</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/tf_flowchart.png" alt="Visualizing, how term and float frequency get calculated and used to predict, if a page is of the target class." width="100%" />
<p class="caption">
(#fig:tf-flowchart)Visualizing, how term and float frequency get calculated and used to predict, if a page is of the target class.
</p>
</div>
</div>
<div id="comparison-page-identification" class="section level3 hasAnchor" number="5.1.2">
<h3 class="hasAnchor"><span class="header-section-number">5.1.2</span> Comparison<a href="#comparison-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>df_page_identification_comparing_performance <span class="ot">&lt;-</span> readODS<span class="sc">::</span><span class="fu">read_ods</span>(<span class="st">&quot;data_storage/page_identification_summary.ods&quot;</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>df_page_identification_comparing_efficiency <span class="ot">&lt;-</span> readODS<span class="sc">::</span><span class="fu">read_ods</span>(<span class="st">&quot;data_storage/page_identification_summary.ods&quot;</span>, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>df_df_page_identification_comparing_performance_formatted <span class="ot">&lt;-</span> df_page_identification_comparing_performance <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>      <span class="fu">c</span>(precision, recall, F1, <span class="st">`</span><span class="at">top 1 recall</span><span class="st">`</span>),</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">ifelse</span>(      </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>        <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>        )</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(      </span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>        <span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span> <span class="sc">==</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(<span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span>, <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>        <span class="fu">round</span>(<span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span>, <span class="dv">3</span>)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>        ))</span></code></pre></div>
</details>
<p>This subsection presents the performance and efficiency for all
four presented approaches and compare it with the the results a human
achieves manually</p>
<div id="prediction-performance" class="section level5 hasAnchor paragraph-start" number="5.1.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.1.2.0.1</span> Prediction performance<a href="#prediction-performance" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:page-identification-performance-overview-all) shows the
best performance achieved by the four presented approaches regarding precision, recall and F1 score.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>df_df_page_identification_comparing_performance_formatted <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">top 1 recall</span><span class="st">`</span>, <span class="st">`</span><span class="at">k for full recall</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">arrange</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lllrrr&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing page identification perfromance among all four approaches.&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>),</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="at">row_group_col =</span> <span class="dv">3</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-identification-performance-overview-all)Comparing page identification perfromance among all four approaches.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2aad77e517a265f5b444" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2aad77e517a265f5b444">{"x":{"filter":"none","vertical":false,"extensions":["RowGroup"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],["Regex","TOC","TOC","LLM binary","LLM multi-class","LLM multi-class","TF","human","Regex","TOC","TOC","LLM binary","LLM multi-class","LLM multi-class","TF","Regex","TOC","TOC","LLM binary","LLM multi-class","LLM multi-class","TF"],["exhaustive","machine readable","combi","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall","manual","exhaustive restricted","machine readable","combi","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall","exhaustive","machine readable","combi","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall"],["Aktiva","Aktiva","Aktiva","Aktiva","Aktiva","Aktiva","Aktiva","Aktiva","GuV","GuV","GuV","GuV","GuV","GuV","GuV","Passiva","Passiva","Passiva","Passiva","Passiva","Passiva","Passiva"],["0.132","0.6","0.338","0.906","0.987","<b>1<\/b>","0.193",null,"0.21","0.446","0.378","<b>0.981<\/b>","0.903","0.944","0.131","0.13","0.5","0.281","0.937","<b>1<\/b>","0.985","0.21"],["0.997","0.256","0.268","0.939","0.937","<b>1<\/b>","<b>1<\/b>",null,"<b>1<\/b>","0.245","0.363","0.99","<b>1<\/b>","<b>1<\/b>","<b>1<\/b>","0.993","0.21","0.222","0.914","0.761","<b>1<\/b>","<b>1<\/b>"],["0.233","0.359","0.299","0.922","0.961","<b>1<\/b>","0.324","0.981","0.35","0.316","0.37","<b>0.985<\/b>","0.949","0.971","0.232","0.23","0.296","0.248","0.925","0.864","<b>0.993<\/b>","0.347"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>approach<\/th>\n      <th>strategy<\/th>\n      <th>type<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","rowGroup":{"dataSrc":3},"ordering":false,"columnDefs":[{"visible":false,"targets":3},{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"approach","targets":1},{"name":"strategy","targets":2},{"name":"type","targets":3},{"name":"precision","targets":4},{"name":"recall","targets":5},{"name":"F1","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The best
F1 score is reached by Llama 4 Scout for the target types <strong>Akiva</strong> and
<strong>Passiva</strong> in the multi-class classification approach. For <strong>GuV</strong> the
best F1 score (0.985) is found with Ministral-8B-Instruct in the binary
classification approach. Llama 4 Scout reaches a F1 score of 0.971 for
target type <strong>GuV</strong> and multi-class classification.</p>
</div>
<p>In the dataset preparation for the table extraction task (see section
@ref(table-extraction-introduction) 107 <strong>Aktiva</strong> pages have been
selected. In this manual process we made two mistakes, accidently
selecting one <strong>Passiva</strong> and one <strong>GuV</strong> page. Thus the human baseline
to compete with is 0.981. Thus, Llama 4 Scout is more precise than us.</p>
<p>Furthermore, Llama 4 Scout reached a recall of 1.0 for all target types.
This means, the results can be used downstream, even though the
precision is not always perfect. The pages classified as target can be
double checked by a human, without missing any page.</p>
<p>The other approaches’ performance is way worse.</p>
<p>Only the term-frequency approach’s results could be used downstream, because we find a recall of 1.0. Table @ref(tab:page-identification-performance-overview-top-k-recall) shows the results of the top k recall for the term-frequency and <a href="#acronyms_LLM">LLM</a>
approaches. The <a href="#acronyms_LLM">LLM</a>s always rate the correct <strong>GuV</strong> page highest.
With Llama Scout 4 we find all target pages within the first two ranked
pages. For the term-frequency approach a human sometimes has to check up
to five pages.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>df_df_page_identification_comparing_performance_formatted <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(precision, recall, F1)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">top 1 recall</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">arrange</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lllrr&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing the top k recall for the term-frequency and LLM approaches.&quot;</span>,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="at">row_group_col =</span> <span class="dv">3</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-identification-performance-overview-top-k-recall)Comparing the top k recall for the term-frequency and LLM approaches.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-159566af3eb2484d2581" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-159566af3eb2484d2581">{"x":{"filter":"none","vertical":false,"extensions":["RowGroup"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12"],["LLM binary","LLM multi-class","LLM multi-class","TF","LLM binary","LLM multi-class","LLM multi-class","TF","LLM binary","LLM multi-class","LLM multi-class","TF"],["Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall"],["Aktiva","Aktiva","Aktiva","Aktiva","GuV","GuV","GuV","GuV","Passiva","Passiva","Passiva","Passiva"],["0.959","0.932","<b>1<\/b>","0.826","<b>1<\/b>","<b>1<\/b>","<b>1<\/b>","0.7","0.932","0.824","<b>0.973<\/b>","0.808"],["2","3","<b>1<\/b>","5","<b>1<\/b>","<b>1<\/b>","<b>1<\/b>","5","<b>2<\/b>","3","<b>2<\/b>","5"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>approach<\/th>\n      <th>strategy<\/th>\n      <th>type<\/th>\n      <th>top 1 recall<\/th>\n      <th>k for full recall<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","rowGroup":{"dataSrc":3},"ordering":false,"columnDefs":[{"visible":false,"targets":3},{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"approach","targets":1},{"name":"strategy","targets":2},{"name":"type","targets":3},{"name":"top 1 recall","targets":4},{"name":"k for full recall","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="energy-usage-and-runtime" class="section level5 hasAnchor paragraph-start" number="5.1.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">5.1.2.0.2</span> Energy usage and runtime<a href="#energy-usage-and-runtime" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:page-identification-efficiency-overview-all) shows the
runtime in seconds per document, estimated energy consumption in Joule
per document and costs in <strong>CENTS per 1000 documents</strong>. The runtime for
the <a href="#acronyms_LLM">LLM</a>s was normalized to seconds on a nvidia B200 and thus the
TDP of 700 W is used to calculate the energy consumption. For the other
approaches, running on my laptop (see section @ref(local-machine)) a
TDP of 28 Watts is used. For manual work by a human additional 60 W are
added for the screen used. It is assumed that the <a href="#acronyms_LLM">LLM</a> is hosted
locally.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>df_page_identification_comparing_efficiency <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>drop <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">select</span>(approach, strategy, <span class="st">`</span><span class="at">runtime per document in s</span><span class="st">`</span>, <span class="st">`</span><span class="at">energy in J</span><span class="st">`</span>, <span class="st">`</span><span class="at">costs in CENTS per 1000 documents</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>      <span class="fu">where</span>(is.numeric),</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">ifelse</span>(      </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>        . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>        <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>        )</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llrrr&quot;</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing page identification efficiency among all four approaches.&quot;</span>,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-identification-efficiency-overview-all)Comparing page identification efficiency among all four approaches.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1714ab036aac2a99c573" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1714ab036aac2a99c573">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Regex","TOC","TOC","LLM binary","LLM multi-class","LLM multi-class","TF","human"],["exhaustive","machine readable","text based","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Ministral-8B-Instruct-2410, 3_<wbr>rag_<wbr>examples","Llama-4-Scout-17B-16E-Instruct, 3_<wbr>rag_<wbr>examples","high recall","manual"],["<b>0.005<\/b>","0.202","1.939","35.851","18.905","60.149","0.138","61"],["<b>0.151<\/b>","141.58","1357.534","25095.946","13233.784","42104.054","3.859","5368"],["<b>0.001<\/b>","1.062","10.182","188.22","99.253","315.78","0.029","40.26"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>approach<\/th>\n      <th>strategy<\/th>\n      <th>runtime per document in s<\/th>\n      <th>energy in J<\/th>\n      <th>costs in CENTS per 1000 documents<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"approach","targets":1},{"name":"strategy","targets":2},{"name":"runtime per document in s","targets":3},{"name":"energy in J","targets":4},{"name":"costs in CENTS per 1000 documents","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Table @ref(tab:page-identification-efficiency-overview-all) shows, that
the regular expression approach is fastest and consumes least energy.
Nevertheless, since the results are not sufficient another approach has
to be chosen if the amount of manual labor should be reduced for the
human inn the loop.</p>
<p>Second place regarding all these criteria is the term-frequency
approach, which guarantees a perfect recall, while reducing the number
of pages to investigate to five per target type. This is similar to the
number of pages a human has to investigate to find the <a href="#acronyms_TOC">TOC</a> of the
document. And it is a reduction to 7.4 % of the average 67 pages the
documents in this dataset have. The costs are still negligible.</p>
<p>The <a href="#acronyms_LLM">LLM</a> approaches have the highest runtime and energy
consumption. This is the case, because they process every page with very
computational demanding algorithms. The fastest and least energy
consuming strategy is to use a small model as Ministral-8B-Instruct for
the multi-class approach. This is more effective than running three
binary classifications.</p>
<p>An alternative approach could be to binary
predict if the page is of any target type and then perform a
classification, which type exactly the page is of. But the results of
the multi-class strategy are good enough as well. In both strategies the
k required for perfect recall is three, using the Ministral-8B-Instruct
model<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<p>For the <a href="#acronyms_TOC">TOC</a> approach <a href="#acronyms_LLM">LLM</a>s are used as well, but they process
far less of the documents pages. This can be achieved for the good
performing <a href="#acronyms_LLM">LLM</a> classification strategy too, by combining the term-frequency
approach with the <a href="#acronyms_LLM">LLM</a> approach.</p>
<div id="compare-with-manual-page-identification" class="section level6 hasAnchor paragraph-start" number="5.1.2.0.2.1">
<h6 class="hasAnchor"><span class="header-section-number">5.1.2.0.2.1</span> Compare with manual page identification<a href="#compare-with-manual-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>The manual approach is the slowest. For the benchmark ten random
documents were processed by us. We used the <a href="#acronyms_TOC">TOC</a> and the search
function to find key words like <strong>Aktiva</strong> or <strong>Bilanz</strong>. Anyhow, its
almost as fast as the multi-classification using Llama 4 Scout, while
consuming eight times less energy. Comparing it to Ministral-8B-Instruct
it take three times longer but consumes less then half of the energy.</p>
</div>
<p>Not taken into account fo this comparison are factors like</p>
<ul>
<li><p>costs to buy and maintain hardware (i.e. a GPU cluster).</p></li>
<li><p>higher costs per runtime if the <a href="#acronyms_LLM">LLM</a> compute is purchased from
cloud providers. CLOUD: price if LLM is in the cloud &lt;– print
tokens used</p>
<ul>
<li><p>four classes (3 random examples): 11 k tokens</p></li>
<li><p>binary (3 random examples): 6.5 k tokens</p></li>
</ul></li>
<li><p>payment and insurance to pay for a human (e.g . student coworker).</p></li>
<li><p>the training time and energy consumption for training either</p>
<ul>
<li><p>a <a href="#acronyms_LLM">LLM</a> (probably done by the <a href="#acronyms_LLM">LLM</a> provider).</p></li>
<li><p>a human (growing up, getting educated).</p></li>
</ul></li>
<li><p>the energy consumed with the food humans eat.</p></li>
</ul>
<p>Since all approaches but the manual identification need the text
extract, this runtime and energy consumption are also not listed (but
low).</p>
</div>
</div>
<div id="table-extraction-introduction" class="section level2 hasAnchor" number="5.2">
<h2 class="hasAnchor"><span class="header-section-number">5.2</span> Information extraction<a href="#table-extraction-introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- \addthumb{Chapter~\thechapter.2}{\textbf{\Huge{\thechapter}\Large{.2}}}{white}{gray} -->
<p>(ref:information-extraction-intro-text) The second research question asks, how <a href="#acronyms_LLM">LLM</a>s can be used, to
effectively extract specific information from a financial report. The
task for this thesis is to extract the numeric values for the assets
(<em>Aktiva</em>) table, which is part of the balance sheet (<em>Bilanz</em>).
Hereafter, the German term <strong>Aktiva</strong> will be used. We are limiting the
scope even further than in subsection
@ref(page-identification-introduction), because it takes more time to
manually create the first reference dataset.</p>
<p>(ref:information-extraction-intro-text)</p>
<div id="section-2" class="section level3 unlisted unnumbered">
<h3 class="unlisted unnumbered"></h3>
<div id="structured-output" class="section level5 hasAnchor paragraph-start" number="5.2.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.2.0.0.1</span> Structured output<a href="#structured-output" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We are using a strict schema for the extraction process that is derived
from the legal text <span class="citation">(<a href="#ref-hgbHandelsgesetzbuchImBundesgesetzblatt2025">HGB, 2025, Section 266</a>)</span>. Actually, there are three types of verbosity, that are defined in
the law. Smaller companies are permitted to create less detailed balance
sheets. Our schema is created based on the most detailed level. This is
the form most often found in the document base<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
</div>
<p>Using a strict schema has advantages for processing the
results in downstream tasks - i.e. for adding the results to a
relational database. It is also easier to compare the results with a
ground truth if the names of all rows and their order is fixed. The
schema is defined as <a href="#acronyms_ebnf">ebnf (extended Backus–Naur form)</a>-grammar and passed as an argument to
<a href="#acronyms_vllm">vLLM</a>.</p>
<div id="gound-truth-dataset" class="section level5 hasAnchor paragraph-start" number="5.2.0.0.2">
<h5 class="hasAnchor"><span class="header-section-number">5.2.0.0.2</span> Gound truth dataset<a href="#gound-truth-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the information extraction task two datasets are used. First, a collection of 107 real <strong>Aktiva</strong> tables is created, going through two sampling iterations. In the first iteration a single report is selected for each company. In addition, all available reports from the first listed company are chosen, to test an in-company learning approach. In the second iteration more reports of the other companies are added, to increase the ground truth size and allow to test the in-company approach for all companies.</p>
</div>
<p>Second, a dataset of 16_504 synthetic <strong>Aktiva</strong> tables is created. These tables are generated based on the extraction schema and filled with random numeric values. Different table characteristics are systematically combined, to investigate potential effects of these features on the extraction performance. The tables are created as <a href="#acronyms_PDF">PDF</a>, <a href="#acronyms_HTML">HTML</a> and Markdown files each. This dataset allows to estimate the extraction performance, if there are no unknown row identifiers present.</p>
</div>
<div id="approaches-1" class="section level3 hasAnchor" number="5.2.1">
<h3 class="hasAnchor"><span class="header-section-number">5.2.1</span> Approaches<a href="#approaches-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="regular-expressions-2" class="section level5 hasAnchor paragraph-start" number="5.2.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.2.1.0.1</span> Regular expressions<a href="#regular-expressions-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use regular expressions to extract the numeric values for matching row identifiers. The regular expressions handle line breaks between words in the row identifiers, but not within a word. They can handle multiple signs of white space. Besides that, they try to fully match the labels from the legal text with the text extract, ignoring upper case. They extract numbers with “.” as thousands separator.</p>
</div>
<div id="real-tables" class="section level5 hasAnchor paragraph-start" number="5.2.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">5.2.1.0.2</span> Real tables<a href="#real-tables" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use <a href="#acronyms_LLM">LLM</a>s to extract the numeric values of real <strong>Aktiva</strong> tables with restricted generation. The <a href="#acronyms_LLM">LLM</a> has to group row identifiers and corresponding numeric values and match the row identifier with the labels of the schema. If a row identifier is unknown, the values have to be discarded. If a label is not present among the row identifiers, the model predicts <em>null</em>. All values are extracted in one pass. We do not include any instruction, how to proceed with currency units, that might be given for certain columns.</p>
</div>
<p>We test a wide range of open-weight models and compare different prompting techniques. Figure @ref(fig:prompt-setup-extraction) shows, how the prompts are composed for the different strategies. Besides a zero shot approach we test few-shot in-context learning with examples that are either chosen randomly or retrieved based on their vector similarity. Finally, we test passing a synthetic <strong>Aktiva</strong> table as example. We test models from OpenAIs GPT family in addition to the open-weight models.</p>
<div class="figure" style="text-align: center">
<img src="images/promt_building_classification.png" alt="Showing the basic structure of the prompts and which strategies are used to pass additional information to the LLM for the information extraction task." width="100%" />
<p class="caption">
(#fig:prompt-setup-extraction)Showing the basic structure of the prompts and which strategies are used to pass additional information to the LLM for the information extraction task.
</p>
</div>
<div id="synthetic-tables" class="section level5 hasAnchor paragraph-start" number="5.2.1.0.3">
<h5 class="hasAnchor"><span class="header-section-number">5.2.1.0.3</span> Synthetic tables<a href="#synthetic-tables" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use <a href="#acronyms_LLM">LLM</a>s to extract the numeric values of synthetic <strong>Aktiva</strong> tables with restricted generation. The procedure is identical as with the real <strong>Aktiva</strong> tables. We extract all values with and without an explicit instruction on how to proceed with currency units. We limit our test on the open-weight models.</p>
</div>
<div id="hybrid-approach" class="section level5 hasAnchor paragraph-start" number="5.2.1.0.4">
<h5 class="hasAnchor"><span class="header-section-number">5.2.1.0.4</span> Hybrid approach<a href="#hybrid-approach" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We use <a href="#acronyms_LLM">LLM</a>s to extract the numeric values of real <strong>Aktiva</strong> tables with restricted generation, providing examples from synthetic <strong>Aktiva</strong> tables. The procedure is identical as with the real <strong>Aktiva</strong> tables. We extract all values with and without an explicit instruction on how to proceed with currency units. We limit our test on the open-weight models.</p>
</div>
</div>
<div id="comparing-table-extraction-methods" class="section level3 hasAnchor" number="5.2.2">
<h3 class="hasAnchor"><span class="header-section-number">5.2.2</span> Comparison<a href="#comparing-table-extraction-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This subsection compares the results for the table extraction tasks. It
will discuss the findings about performance and runtime and compare it
with the results a human may achieve wit manual labor.</p>
<div id="performance" class="section level5 hasAnchor paragraph-start" number="5.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">5.2.2.0.1</span> Performance<a href="#performance" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:compare-extraction-performance) summarizes the mean
percentage of correct predictions total for all approaches and both
types of <strong>Aktiva</strong> tables. The highest baseline for the extraction
tasks is set by our own manual performance. We achieve 97.6 % correct
extracted values on the real <strong>Aktiva</strong> tables. The <a href="#acronyms_regex">regex</a>
performance on the synthetic <strong>Aktiva</strong> tables comes close but on real
<strong>Aktiva</strong> tables it is far off.</p>
</div>
<p>The mean performance of Qwen3-235B does not match our baseline on the
real <strong>Akiva</strong> tables. But its median performance already is 100 %. The
extraction performance may get higher, if the in-context learning
examples show how to deal with columns that have a currency unit. But
the strong performance observed right now is already based on implicit
numeric transformations, since 19.2 % of all numeric values have <em>T€</em> as
unit. Furthermore, both measures, percentage of correct numeric
predictions (98.0 %) and F1 score (98.1 %) are not perfect yet and could
be improved.</p>
<p>On synthetic tables its mean performance is almost perfect, if currency
units get respected. The 0.1 % incorrect prediction from the PDF
documents could be caused by faulty text extracts by <em>pdfium</em>. With HTML
documents we find 100 % correct predictions. With Markdown documents we
find 99.9 % correct predictions as well. Figure
@ref(fig:comparing-table-extraction-performance-among-real-and-synth-aktiva-data)
shows, that the better performance on the synthetic tables is found for
almost all models.</p>
<p>Qwen3-8B performed best among the small models <a href="#acronyms_LLM">LLM</a>s but shows over
4 % more wrong predictions than Qwen3-235B. Using synthetic examples,
results in worse performance. But it can be used to show how to handle
currency units.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="sc">~</span>approach, <span class="sc">~</span>strategy, <span class="sc">~</span>table_type, <span class="sc">~</span>percentage_correct_total,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="st">&quot;human&quot;</span>, <span class="st">&quot;manual&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="fl">97.6</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="st">&quot;regex&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="fl">68.6</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="st">&quot;llm&quot;</span>, <span class="st">&quot;Qwen3-235B, top_5_rag_examples&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="fl">97.0</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="st">&quot;llm&quot;</span>, <span class="st">&quot;Qwen3-8B, top_5_rag_examples&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="fl">92.7</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="st">&quot;llm&quot;</span>, <span class="st">&quot;Qwen3-235B, top_5_rag_examples, synth examples&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="fl">91.8</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="st">&quot;regex&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;synth&quot;</span>, <span class="fl">96.9</span>,</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="st">&quot;llm&quot;</span>, <span class="st">&quot;Qwen3-235B, top_5_rag_examples, respect_units&quot;</span>, <span class="st">&quot;synth&quot;</span>, <span class="fl">99.9</span>,</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="st">&quot;llm&quot;</span>, <span class="st">&quot;Qwen3-8B, top_5_rag_examples&quot;</span>, <span class="st">&quot;synth&quot;</span>, <span class="fl">94.6</span>,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="co"># arrange(table_type) %&gt;% </span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="fu">group_by</span>(table_type) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>      <span class="fu">c</span>(percentage_correct_total),</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">ifelse</span>(      </span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>        . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>        <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>        )</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lllr&quot;</span>,</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing the mean percentage of correct predictions total among all approaches and table types.&quot;</span>,</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>),</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    <span class="at">row_group_col =</span> <span class="dv">3</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:compare-extraction-performance)Comparing the mean percentage of correct predictions total among all approaches and table types.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9f82f9a7fb8e6d9bcf8c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9f82f9a7fb8e6d9bcf8c">{"x":{"filter":"none","vertical":false,"extensions":["RowGroup"],"data":[["1","2","3","4","5","6","7","8"],["human","regex","llm","llm","llm","regex","llm","llm"],["manual","","Qwen3-235B, top_<wbr>5_<wbr>rag_<wbr>examples","Qwen3-8B, top_<wbr>5_<wbr>rag_<wbr>examples","Qwen3-235B, top_<wbr>5_<wbr>rag_<wbr>examples, synth examples","","Qwen3-235B, top_<wbr>5_<wbr>rag_<wbr>examples, respect_<wbr>units","Qwen3-8B, top_<wbr>5_<wbr>rag_<wbr>examples"],["real","real","real","real","real","synth","synth","synth"],["<b>97.6<\/b>","68.6","97","92.7","91.8","96.9","<b>99.9<\/b>","94.6"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>approach<\/th>\n      <th>strategy<\/th>\n      <th>table type<\/th>\n      <th>percentage correct total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","rowGroup":{"dataSrc":3},"ordering":false,"columnDefs":[{"visible":false,"targets":3},{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"approach","targets":1},{"name":"strategy","targets":2},{"name":"table type","targets":3},{"name":"percentage correct total","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="runtime" class="section level5 hasAnchor paragraph-start" number="5.2.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">5.2.2.0.2</span> Runtime<a href="#runtime" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Extracting the values from all 106 tables took Qwen3-235B around six
minutes. Thus, excluding the setup time for the LLM,
Qwen3-235B-A22B-Instruct is around 100 times faster than a human.
Checking the extracted values takes up to three minutes. This totals in
300 minutes prediction checking. Thus, selecting a smaller model that is
finishing after 2:30 minutes is not speeding up the process a lot. Once
we get a sufficient good performance with the big models the prediction
checking can be dropped. This would bring th real benefit.</p>
</div>
<div id="hypotheses" class="section level5 hasAnchor paragraph-start" number="5.2.2.0.3">
<h5 class="hasAnchor"><span class="header-section-number">5.2.2.0.3</span> Hypotheses<a href="#hypotheses" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The predictor that showed a strong effect in all approaches is currency
unit. Reflecting this in the table extraction is a key factor to
optimize the performance. For the approaches that use <a href="#acronyms_LLM">LLM</a>s most of
the model and method related variables showed a strong effect. Using a
versatile model and providing good learning examples is mandatory.</p>
</div>
<p>Especially for the approaches that use synthetic tables show that the
input format could also have a meaningful effect. It seems important to
prevent erroneous text extraction and converting the extracted text in
HTML might be helpful to eliminate last unclarities. But the question,
if a perfect text extract would be as good as HTML or Markdown, is not
answered yet.</p>
</div>
</div>
<div id="error-rate-guidance-results" class="section level2 hasAnchor" number="5.3">
<h2 class="hasAnchor"><span class="header-section-number">5.3</span> Error rate guidance<a href="#error-rate-guidance-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(ref:error-rate-guidance-intro-text) The side research question asks, if it is possible to guide the users attention to predictions that have a higher empirical rate of errors. In this thesis we focus the confidence score reported with <a href="#acronyms_LLM">LLM</a>s responses.</p>
<p>(ref:error-rate-guidance-intro-text)</p>
<p>Subsection @ref(page-identification-error-rate-results) presents the results found regarding our side research question for the page identification task. Subsection @ref(information-extraction-error-rate-results) presents the results found regarding our side research question for the information extraction task.</p>
<div id="page-identification-error-rate-results" class="section level3 hasAnchor" number="5.3.1">
<h3 class="hasAnchor"><span class="header-section-number">5.3.1</span> Page identification<a href="#page-identification-error-rate-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We find, that the confidence score can be used in the page identification task, to identify confidence intervals, that contain no or only a few error. The amount of predictions falling in these intervals varies among models and classification task and target class.</p>
<p>The</p>
</div>
<div id="information-extraction-error-rate-results" class="section level3 hasAnchor" number="5.3.2">
<h3 class="hasAnchor"><span class="header-section-number">5.3.2</span> Information extraction<a href="#information-extraction-error-rate-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Other possibilities narrow the selection down and get a more concrete error rate score for similar texts can be the type of information to extract, the company, …</p>
</div>
</div>
<div id="summary-results" class="section level2 hasAnchor" number="5.4">
<h2 class="hasAnchor"><span class="header-section-number">5.4</span> Summary<a href="#summary-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--chapter:end:05_Results.Rmd-->
</div>
</div>
<div id="discussion" class="section level1 hasAnchor" number="6">
<h1 class="hasAnchor"><span class="header-section-number">6</span> Discussion<a href="#discussion" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="interpretations" class="section level2 hasAnchor" number="6.1">
<h2 class="hasAnchor"><span class="header-section-number">6.1</span> Interpretations<a href="#interpretations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="table-extraction" class="section level4 hasAnchor" number="6.1.0.1">
<h4 class="hasAnchor"><span class="header-section-number">6.1.0.1</span> Table extraction<a href="#table-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="regular-expression-approach" class="section level5 hasAnchor" number="6.1.0.1.1">
<h5 class="hasAnchor"><span class="header-section-number">6.1.0.1.1</span> Regular expression approach<a href="#regular-expression-approach" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Some possible explanations for the different performance on the extracted texts are:</p>
<ul>
<li>a duplicated row name<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></li>
<li>numeric columns extracted separated from row names by extraction libraries</li>
<li>sums in the same row as the single values<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></li>
<li>with pdfium: missing white space<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></li>
<li>with pdfium: random line breaks<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></li>
</ul>
<p>You can find some examples for incorrect extracted texts in section @ref(regex-extraction-mistakes).</p>
<p>The random line breaks result in some missed row names which is reflected by the bigger spread for NA precision with <em>pdfium</em> on the synthetic dataset (see Figure @ref(fig:table-extraction-regex-performance) B). Nevertheless, the NA precision for the majority of the cases is perfect. This is different with the real dataset. The NA precision is found to be at only 0.68.</p>
</div>
</div>
</div>
<div id="limitations" class="section level2 hasAnchor" number="6.2">
<h2 class="hasAnchor"><span class="header-section-number">6.2</span> Limitations<a href="#limitations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="table-extraction-1" class="section level3 hasAnchor" number="6.2.1">
<h3 class="hasAnchor"><span class="header-section-number">6.2.1</span> table extraction<a href="#table-extraction-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>found mistakes in gold standard with the llm results; mistakes found by human double check</li>
<li>new lines / splitted lines</li>
<li>test synthetic hypothesis with pymupdf extract</li>
<li>2.4 % wrong gold standard creation</li>
<li>confidence intervals based on company (know which formats are tricky)</li>
</ul>
<div id="regex-baseline" class="section level4 hasAnchor" number="6.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">6.2.1.1</span> Regex baseline<a href="#regex-baseline" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>synthetic tables have been generated with cell lines because this should have improved the performance of a table extraction approach (not conducted)- maybe this is confusing pdfium? Or the zoom level?</li>
</ul>
</div>
</div>
<div id="classification" class="section level3 hasAnchor" number="6.2.2">
<h3 class="hasAnchor"><span class="header-section-number">6.2.2</span> classification<a href="#classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Qwen 2.5 hat zweiseitige GuV von IBB entdeckt und zur Anpassung der Ground Truth</li>
<li>predictor: n_big_tables (tf or llm relevant?)</li>
<li>Why it is important to have a good recall (or top n accuracy)</li>
<li>bad performance for Maverick with more models relied to FP8 model version? No. Same reults with FP16</li>
</ul>
<p>One could build an application that is not asking for a human intervention for reported confidences over 0.9 and then give the possibility to change the page to extract information from later on.</p>
<p>For humans: Easily identifiable if page has a big table with numbers but not so easy to spot the Aktiva / Passiva label.</p>
</div>
</div>
<div id="not-covered" class="section level2 hasAnchor" number="6.3">
<h2 class="hasAnchor"><span class="header-section-number">6.3</span> Not covered<a href="#not-covered" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>OCR</li>
<li>fine-tuning</li>
<li>using something smaller (e.g. LSTMs) instead LLMs</li>
<li>building application, UX design (ref Ambacher 2024)</li>
<li>table extraction (either VLLMs (visual) or classic approaches &lt;– tried tabula but was not successful (because of missing visual traits)?) to prevent wrong text flow and have clear cell borders</li>
<li>classification oriented models with softmax</li>
</ul>
<p>in company document next / previous year more helpful than years further away?</p>
<div id="table-detection-extraction" class="section level3 hasAnchor" number="6.3.1">
<h3 class="hasAnchor"><span class="header-section-number">6.3.1</span> Table detection / extraction<a href="#table-detection-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Can be used to narrow down set of possible pages</p>
<p>Can be used to focus only on the table content (measure if correct area was identified would be necessary)</p>
<p>Vision model as baseline</p>
</div>
</div>
<div id="outlook" class="section level2 hasAnchor" number="6.4">
<h2 class="hasAnchor"><span class="header-section-number">6.4</span> Outlook<a href="#outlook" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>ensemble from multiple models or are errors systematic? (e.g. Wohnungsbaugenossenschaften splitting some rows in multiple and none is picked?)</li>
<li>check for halluzination vs wrong placed / repeated numbers</li>
<li>no perfect score even with synthetic data</li>
<li>flexible extraction (name something, find it, get it)</li>
<li>UI
<ul>
<li>checking results / correct errors; col by col; match entities</li>
<li>add unused entries (backlog? extra table?)</li>
<li>possibilities for rerun / flagging the source of issue</li>
</ul></li>
<li>ml health check / benchmark framework
<ul>
<li>test new models performance</li>
<li>check if new examples might be harmful (repredicting)</li>
</ul></li>
</ul>
<p>Ad-hocs for monitoring during the year</p>
<div id="vision-model" class="section level3 hasAnchor" number="6.4.1">
<h3 class="hasAnchor"><span class="header-section-number">6.4.1</span> Vision Model<a href="#vision-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Yolo</p>
</div>
<div id="docling-and-co" class="section level3 hasAnchor" number="6.4.2">
<h3 class="hasAnchor"><span class="header-section-number">6.4.2</span> Docling and Co<a href="#docling-and-co" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="table-extraction-2" class="section level3 hasAnchor" number="6.4.3">
<h3 class="hasAnchor"><span class="header-section-number">6.4.3</span> Table extraction<a href="#table-extraction-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>building a document extraction database document by document can improve performance taking advantage of same-company rag in-context learning</p>
<p>predictions for barrierefreie documents of WBM empty, one time because the pages showed <strong>GuV</strong>; also no predictions for Zoo 2024 <strong>Passiva</strong></p>
</div>
<div id="sophisticated-approaches-for-text-extraction" class="section level3 hasAnchor" number="6.4.4">
<h3 class="hasAnchor"><span class="header-section-number">6.4.4</span> Sophisticated approaches for text extraction<a href="#sophisticated-approaches-for-text-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>docling</li>
</ul>
<p>not implemented</p>
<ul>
<li>Nougat</li>
<li>maker</li>
<li>Azure</li>
</ul>
</div>
</div>
<div id="error-analysis-1" class="section level2 hasAnchor" number="6.5">
<h2 class="hasAnchor"><span class="header-section-number">6.5</span> Error analysis<a href="#error-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>errors from wrong formatted numbers</p></li>
<li><p>errors from wrong / unclear entity mapping</p></li>
</ul>
<!--chapter:end:06_Discussion.Rmd-->
</div>
</div>
<div id="conclusion" class="section level1 hasAnchor" number="7">
<h1 class="hasAnchor"><span class="header-section-number">7</span> Conclusion<a href="#conclusion" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!--chapter:end:07_Conclusion.Rmd-->
</div>
<div id="references" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">References<a href="#references" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-amgenscholarsprogramHowInterpretViolin" class="csl-entry">
Amgen Scholars Program. (n.d.). <em>How to <span>Interpret Violin Charts</span></em>. https://www.labxchange.org/library/items/lb:LabXchange:46f64d7a:html:1.
</div>
<div id="ref-auerDoclingTechnicalReport2024" class="csl-entry">
Auer, C., Lysak, M., Nassar, A., Dolfi, M., Livathinos, N., Vagenas, P., Ramis, C. B., Omenetti, M., Lindlbauer, F., Dinkla, K., Mishra, L., Kim, Y., Gupta, S., Lima, R. T. de, Weber, V., Morin, L., Meijer, I., Kuropiatnyk, V., &amp; Staar, P. W. J. (2024). <em>Docling <span>Technical Report</span></em> (arXiv:2408.09869). arXiv. <a href="https://doi.org/10.48550/arXiv.2408.09869">https://doi.org/10.48550/arXiv.2408.09869</a>
</div>
<div id="ref-bentleyKnowingYouKnow2025" class="csl-entry">
Bentley, S. V. (2025). Knowing you know nothing in the age of generative <span>AI</span>. <em>Humanities and Social Sciences Communications</em>, <em>12</em>(1), 409. <a href="https://doi.org/10.1057/s41599-025-04731-0">https://doi.org/10.1057/s41599-025-04731-0</a>
</div>
<div id="ref-boseakEvaluatingLogLikelihoodConfidence2025" class="csl-entry">
Boseak, C. (2025). Evaluating <span>Log-Likelihood</span> for <span>Confidence Estimation</span> in <span>LLM-Based Multiple-Choice Question Answering</span>. <em>Innovative Journal of Applied Science</em>, <em>02</em>(04). <a href="https://doi.org/10.70844/ijas.2025.2.29">https://doi.org/10.70844/ijas.2025.2.29</a>
</div>
<div id="ref-breimanRandomForests2001" class="csl-entry">
Breiman, L. (2001). Random <span>Forests</span>. <em>Machine Learning</em>, <em>45</em>(1), 5–32. <a href="https://doi.org/10.1023/A:1010933404324">https://doi.org/10.1023/A:1010933404324</a>
</div>
<div id="ref-burnwalComprehensiveSurveyPrediction2023" class="csl-entry">
Burnwal, Y., &amp; Jaiswal, Dr. R. C. (2023). A <span>Comprehensive Survey</span> on <span>Prediction Models</span> and the <span>Impact</span> of <span>XGBoost</span>. <em>International Journal for Research in Applied Science and Engineering Technology</em>, <em>11</em>(12), 1552–1556. <a href="https://doi.org/10.22214/ijraset.2023.57625">https://doi.org/10.22214/ijraset.2023.57625</a>
</div>
<div id="ref-caiSurveyMixtureExperts2025a" class="csl-entry">
Cai, W., Jiang, J., Wang, F., Tang, J., Kim, S., &amp; Huang, J. (2025). A <span>Survey</span> on <span>Mixture</span> of <span>Experts</span> in <span>Large Language Models</span>. <em>IEEE Transactions on Knowledge and Data Engineering</em>, 1–20. <a href="https://doi.org/10.1109/TKDE.2025.3554028">https://doi.org/10.1109/TKDE.2025.3554028</a>
</div>
<div id="ref-carvalhoTFIDFCRFNovelSupervised2020" class="csl-entry">
Carvalho, F., &amp; Guedes, G. P. (2020). <em><span>TF-IDFC-RF</span>: <span>A Novel Supervised Term Weighting Scheme</span></em> (arXiv:2003.07193). arXiv. <a href="https://doi.org/10.48550/arXiv.2003.07193">https://doi.org/10.48550/arXiv.2003.07193</a>
</div>
<div id="ref-chamberlainKnowledgeNotEverything2020" class="csl-entry">
Chamberlain, P. (2020). Knowledge is not everything. <em>Design for Health</em>, <em>4</em>(1), 1–3. <a href="https://doi.org/10.1080/24735132.2020.1731203">https://doi.org/10.1080/24735132.2020.1731203</a>
</div>
<div id="ref-chenXGBoostScalableTree2016" class="csl-entry">
Chen, T., &amp; Guestrin, C. (2016). <span>XGBoost</span>: <span>A Scalable Tree Boosting System</span>. <em>Proceedings of the 22nd <span>ACM SIGKDD International Conference</span> on <span>Knowledge Discovery</span> and <span>Data Mining</span></em>, 785–794. <a href="https://doi.org/10.1145/2939672.2939785">https://doi.org/10.1145/2939672.2939785</a>
</div>
<div id="ref-collisBusinessResearchPractical2014" class="csl-entry">
Collis, J., &amp; Hussey, R. (2014). <em>Business research: A practical guide for undergraduate &amp; postgraduate students</em> (1. Publ.; 4. ed). Palgrave Macmillan.
</div>
<div id="ref-el-hajRetrievingClassifyingAnalysing2020" class="csl-entry">
El-Haj, M., Alves, P., Rayson, P., Walker, M., &amp; Young, S. (2020). Retrieving, classifying and analysing narrative commentary in unstructured (glossy) annual reports published as <span>PDF</span> files. <em>Accounting and Business Research</em>, <em>50</em>(1), 6–34. <a href="https://doi.org/10.1080/00014788.2019.1609346">https://doi.org/10.1080/00014788.2019.1609346</a>
</div>
<div id="ref-googleGemma3nModel" class="csl-entry">
Google. (n.d.). Gemma 3n model overview. In <em>Google AI for Developers</em>. https://ai.google.dev/gemma/docs/gemma-3n.
</div>
<div id="ref-grandiniMetricsMultiClassClassification2020" class="csl-entry">
Grandini, M., Bagli, E., &amp; Visani, G. (2020). <em>Metrics for <span>Multi-Class Classification</span>: An <span>Overview</span></em> (arXiv:2008.05756). arXiv. <a href="https://doi.org/10.48550/arXiv.2008.05756">https://doi.org/10.48550/arXiv.2008.05756</a>
</div>
<div id="ref-grootendorstVisualGuideMixture2024" class="csl-entry">
Grootendorst, M. (2024). <em>A <span>Visual Guide</span> to <span>Mixture</span> of <span>Experts</span> (<span>MoE</span>)</em>. https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-mixture-of-experts.
</div>
<div id="ref-haddouchiSurveyTaxonomyMethods2024" class="csl-entry">
Haddouchi, M., &amp; Berrado, A. (2024). <em>A survey and taxonomy of methods interpreting random forest models</em> (arXiv:2407.12759). arXiv. <a href="https://doi.org/10.48550/arXiv.2407.12759">https://doi.org/10.48550/arXiv.2407.12759</a>
</div>
<div id="ref-hgbHandelsgesetzbuchImBundesgesetzblatt2025" class="csl-entry">
HGB. (2025). <em>Handelsgesetzbuch in der im <span>Bundesgesetzblatt Teil III</span>, <span>Gliederungsnummer</span> 4100-1, ver<span>ö</span>ffentlichten bereinigten <span>Fassung</span>, das zuletzt durch <span>Artikel</span> 1 des <span>Gesetzes</span> vom 28. <span>Februar</span> 2025 (<span>BGBl</span>. 2025 <span>I Nr</span>. 69) ge<span>ä</span>ndert worden ist</em>.
</div>
<div id="ref-hintzeViolinPlotsBox1998" class="csl-entry">
Hintze, J. L., &amp; Nelson, R. D. (1998). Violin <span>Plots</span>: <span>A Box Plot-Density Trace Synergism</span>. <em>The American Statistician</em>, <em>52</em>(2), 181–184. <a href="https://doi.org/10.1080/00031305.1998.10480559">https://doi.org/10.1080/00031305.1998.10480559</a>
</div>
<div id="ref-hongChallengesAdvancesInformation2021" class="csl-entry">
Hong, Z., Ward, L., Chard, K., Blaiszik, B., &amp; Foster, I. (2021). Challenges and <span>Advances</span> in <span>Information Extraction</span> from <span>Scientific Literature</span>: A <span>Review</span>. <em>JOM</em>, <em>73</em>, 1–18. <a href="https://doi.org/10.1007/s11837-021-04902-9">https://doi.org/10.1007/s11837-021-04902-9</a>
</div>
<div id="ref-huComputingSHAPEfficiently2023" class="csl-entry">
Hu, L., &amp; Wang, K. (2023). <em>Computing <span>SHAP Efficiently Using Model Structure Information</span></em> (arXiv:2309.02417). arXiv. <a href="https://doi.org/10.48550/arXiv.2309.02417">https://doi.org/10.48550/arXiv.2309.02417</a>
</div>
<div id="ref-huangFailingsShapleyValues2024" class="csl-entry">
Huang, X., &amp; Marques-Silva, J. (2024). On the failings of <span>Shapley</span> values for explainability. <em>International Journal of Approximate Reasoning</em>, <em>171</em>, 109112. <a href="https://doi.org/10.1016/j.ijar.2023.109112">https://doi.org/10.1016/j.ijar.2023.109112</a>
</div>
<div id="ref-ibmglobaltechnologyservicesToxicTerabyte2006" class="csl-entry">
IBM Global Technology Services. (2006). <em>The toxic terabyte</em>.
</div>
<div id="ref-jhguchBoxPlot2025" class="csl-entry">
Jhguch. (2025). Box plot. <em>Wikipedia</em>.
</div>
<div id="ref-jrHowBigData2015" class="csl-entry">
Jr, J., Moffitt, K., &amp; Byrnes, P. (2015). How <span>Big Data Will Change Accounting</span>. <em>Accounting Horizons</em>, <em>29</em>, 150227130540002. <a href="https://doi.org/10.2308/acch-51069">https://doi.org/10.2308/acch-51069</a>
</div>
<div id="ref-krzywinskiVisualizingSamplesBox2014" class="csl-entry">
Krzywinski, M., &amp; Altman, N. (2014). Visualizing samples with box plots. <em>Nature Methods</em>, <em>11</em>(2), 119–120. <a href="https://doi.org/10.1038/nmeth.2813">https://doi.org/10.1038/nmeth.2813</a>
</div>
<div id="ref-kulkarniPruningRandomForest2012" class="csl-entry">
Kulkarni, V. Y., &amp; Sinha, P. K. (2012). Pruning of <span>Random Forest</span> classifiers: <span>A</span> survey and future directions. <em>2012 <span>International Conference</span> on <span>Data Science</span> &amp; <span>Engineering</span> (<span>ICDSE</span>)</em>, 64–68. <a href="https://doi.org/10.1109/ICDSE.2012.6282329">https://doi.org/10.1109/ICDSE.2012.6282329</a>
</div>
<div id="ref-kulkarniRandomForestClassifiers2013" class="csl-entry">
Kulkarni, V., &amp; Sinha, P. (2013). Random forest classifiers: <span>A</span> survey and future research directions. <em>International Journal of Advanced Computing</em>, <em>36</em>, 1144–1153.
</div>
<div id="ref-liExtractingFinancialData2023" class="csl-entry">
Li, H., Gao, H. (Harry)., Wu, C., &amp; Vasarhelyi, M. A. (2023). <em>Extracting <span>Financial Data</span> from <span>Unstructured Sources</span>: <span>Leveraging Large Language Models</span></em> ({{SSRN Scholarly Paper}} 4567607). Social Science Research Network. <a href="https://doi.org/10.2139/ssrn.4567607">https://doi.org/10.2139/ssrn.4567607</a>
</div>
<div id="ref-liAddressingLastMile2023" class="csl-entry">
Li, H., Wei, D. (Kathy)., Moffitt, K., &amp; Vasarhelyi, M. A. (2023). <em>Addressing the <span>Last Mile Problem</span> in <span>Open Government Data</span>: <span>Using AIS Technologies</span> to <span>Enhance Governmental Financial Reporting</span></em> ({{SSRN Scholarly Paper}} 4385883). Social Science Research Network. <a href="https://doi.org/10.2139/ssrn.4385883">https://doi.org/10.2139/ssrn.4385883</a>
</div>
<div id="ref-liProgrammingExampleSolved2024" class="csl-entry">
Li, W.-D., &amp; Ellis, K. (2024). <em>Is <span>Programming</span> by <span>Example</span> solved by <span>LLMs</span>?</em> (arXiv:2406.08316). arXiv. <a href="https://doi.org/10.48550/arXiv.2406.08316">https://doi.org/10.48550/arXiv.2406.08316</a>
</div>
<div id="ref-liBuildingTrustMachine2024" class="csl-entry">
Li, Z., Bouazizi, M., Ohtsuki, T., Ishii, M., &amp; Nakahara, E. (2024). Toward <span>Building Trust</span> in <span>Machine Learning Models</span>: <span>Quantifying</span> the <span>Explainability</span> by <span>SHAP</span> and <span>References</span> to <span>Human Strategy</span>. <em>IEEE Access</em>, <em>12</em>, 11010–11023. <a href="https://doi.org/10.1109/ACCESS.2023.3347796">https://doi.org/10.1109/ACCESS.2023.3347796</a>
</div>
<div id="ref-lundbergExplainableAITrees2019" class="csl-entry">
Lundberg, S. M., Erion, G., Chen, H., DeGrave, A., Prutkin, J. M., Nair, B., Katz, R., Himmelfarb, J., Bansal, N., &amp; Lee, S.-I. (2019). <em>Explainable <span>AI</span> for <span>Trees</span>: <span>From Local Explanations</span> to <span>Global Understanding</span></em>. arXiv. <a href="https://doi.org/10.48550/ARXIV.1905.04610">https://doi.org/10.48550/ARXIV.1905.04610</a>
</div>
<div id="ref-lundbergUnifiedApproachInterpreting2017" class="csl-entry">
Lundberg, S., &amp; Lee, S.-I. (2017). <em>A <span>Unified Approach</span> to <span>Interpreting Model Predictions</span></em> (arXiv:1705.07874). arXiv. <a href="https://doi.org/10.48550/arXiv.1705.07874">https://doi.org/10.48550/arXiv.1705.07874</a>
</div>
<div id="ref-manningIntroductionInformationRetrieval2008" class="csl-entry">
Manning, C. D., Raghavan, P., &amp; Schütze, H. (2008). Introduction to <span>Information Retrieval</span>. In <em>Cambridge Aspire website</em>. https://www.cambridge.org/highereducation/books/introduction-to-information-retrieval/669D108D20F556C5C30957D63B5AB65C; Cambridge University Press. <a href="https://doi.org/10.1017/CBO9780511809071">https://doi.org/10.1017/CBO9780511809071</a>
</div>
<div id="ref-mienyeSurveyDecisionTrees2024" class="csl-entry">
Mienye, I. D., &amp; Jere, N. (2024). A <span>Survey</span> of <span>Decision Trees</span>: <span>Concepts</span>, <span>Algorithms</span>, and <span>Applications</span>. <em>IEEE Access</em>, <em>12</em>, 86716–86727. <a href="https://doi.org/10.1109/ACCESS.2024.3416838">https://doi.org/10.1109/ACCESS.2024.3416838</a>
</div>
<div id="ref-molnarInterpretableMachineLearning2025" class="csl-entry">
Molnar, C. (2025). <em>Interpretable machine learning: A guide for making black box models explainable</em> (Third edition). Christoph Molnar.
</div>
<div id="ref-mosqueira-reyHumanintheloopMachineLearning2023" class="csl-entry">
Mosqueira-Rey, E., Hernández-Pereira, E., Alonso-Ríos, D., Bobes-Bascarán, J., &amp; Fernández-Leal, Á. (2023). Human-in-the-loop machine learning: A state of the art. <em>Artificial Intelligence Review</em>, <em>56</em>(4), 3005–3054. <a href="https://doi.org/10.1007/s10462-022-10246-w">https://doi.org/10.1007/s10462-022-10246-w</a>
</div>
<div id="ref-nanniniOperationalizingExplainableArtificial2024" class="csl-entry">
Nannini, L., Alonso-Moral, J. M., Catalá, A., Lama, M., &amp; Barro, S. (2024). Operationalizing <span>Explainable Artificial Intelligence</span> in the <span>European Union Regulatory Ecosystem</span>. <em>IEEE Intelligent Systems</em>, <em>39</em>(4), 37–48. <a href="https://doi.org/10.1109/MIS.2024.3383155">https://doi.org/10.1109/MIS.2024.3383155</a>
</div>
<div id="ref-natarajanHumanintheloopAIintheloopAutomate2024" class="csl-entry">
Natarajan, S., Mathur, S., Sidheekh, S., Stammer, W., &amp; Kersting, K. (2024). <em>Human-in-the-loop or <span class="nocase">AI-in-the-loop</span>? <span>Automate</span> or <span>Collaborate</span>?</em> (arXiv:2412.14232). arXiv. <a href="https://doi.org/10.48550/arXiv.2412.14232">https://doi.org/10.48550/arXiv.2412.14232</a>
</div>
<div id="ref-osullivanMathematicsShapleyValues2023" class="csl-entry">
O’Sullivan, C. (2023). <em>The mathematics behind <span>Shapley Values</span></em>.
</div>
<div id="ref-qwenteamQwen3ThinkDeeper2025" class="csl-entry">
Qwen Team. (2025). Qwen3: <span>Think Deeper</span>, <span>Act Faster</span>. In <em>Qwen</em>. https://qwenlm.github.io/blog/qwen3/.
</div>
<div id="ref-rathiImportanceTermWeighting2023" class="csl-entry">
Rathi, R. N., &amp; Mustafi, A. (2023). The importance of <span>Term Weighting</span> in semantic understanding of text: <span>A</span> review of techniques. <em>Multimedia Tools and Applications</em>, <em>82</em>(7), 9761–9783. <a href="https://doi.org/10.1007/s11042-022-12538-3">https://doi.org/10.1007/s11042-022-12538-3</a>
</div>
<div id="ref-raymaekersFastLinearModel2024" class="csl-entry">
Raymaekers, J., Rousseeuw, P. J., Verdonck, T., &amp; Yao, R. (2024). Fast <span>Linear Model Trees</span> by <span>PILOT</span>. <em>Machine Learning</em>, <em>113</em>(9), 6561–6610. <a href="https://doi.org/10.1007/s10994-024-06590-3">https://doi.org/10.1007/s10994-024-06590-3</a>
</div>
<div id="ref-rivera-lopezInductionDecisionTrees2022" class="csl-entry">
Rivera-Lopez, R., Canul-Reich, J., Mezura-Montes, E., &amp; Cruz-Chávez, M. A. (2022). Induction of decision trees as classification models through metaheuristics. <em>Swarm and Evolutionary Computation</em>, <em>69</em>, 101006. <a href="https://doi.org/10.1016/j.swevo.2021.101006">https://doi.org/10.1016/j.swevo.2021.101006</a>
</div>
<div id="ref-robertsonUnderstandingInverseDocument2004" class="csl-entry">
Robertson, S. (2004). Understanding inverse document frequency: On theoretical arguments for <span>IDF</span>. <em>Journal of Documentation</em>, <em>60</em>(5), 503–520. <a href="https://doi.org/10.1108/00220410410560582">https://doi.org/10.1108/00220410410560582</a>
</div>
<div id="ref-robertsonProbabilisticRelevanceFramework2009" class="csl-entry">
Robertson, S., &amp; Zaragoza, H. (2009). The <span>Probabilistic Relevance Framework</span>: <span>BM25</span> and <span>Beyond</span>. <em>Foundations and Trends in Information Retrieval</em>, <em>3</em>, 333–389. <a href="https://doi.org/10.1561/1500000019">https://doi.org/10.1561/1500000019</a>
</div>
<div id="ref-saitoPrecisionRecallPlotMore2015" class="csl-entry">
Saito, T., &amp; Rehmsmeier, M. (2015). The <span>Precision-Recall Plot Is More Informative</span> than the <span>ROC Plot When Evaluating Binary Classifiers</span> on <span>Imbalanced Datasets</span>. <em>PLOS ONE</em>, <em>10</em>(3), e0118432. <a href="https://doi.org/10.1371/journal.pone.0118432">https://doi.org/10.1371/journal.pone.0118432</a>
</div>
<div id="ref-shapley17ValueNPerson2016" class="csl-entry">
Shapley, L. S. (2016). 17. <span>A Value</span> for n-<span>Person Games</span>. In H. W. Kuhn &amp; A. W. Tucker (Eds.), <em>Contributions to the <span>Theory</span> of <span>Games</span>, <span>Volume II</span></em> (pp. 307–318). Princeton University Press.
</div>
<div id="ref-teamChameleonMixedModalEarlyFusion2024" class="csl-entry">
Team, C. (2024). <em>Chameleon: <span>Mixed-Modal Early-Fusion Foundation Models</span></em> (arXiv:2405.09818). arXiv. <a href="https://doi.org/10.48550/arXiv.2405.09818">https://doi.org/10.48550/arXiv.2405.09818</a>
</div>
<div id="ref-wickham40YearsBoxplots2011" class="csl-entry">
Wickham, H., &amp; Stryjewski, L. (2011). <em>40 years of boxplots</em>.
</div>
<div id="ref-wohlinDecisionmakingStructureSelecting2015" class="csl-entry">
Wohlin, C., &amp; Aurum, A. (2015). Towards a decision-making structure for selecting a research design in empirical software engineering. <em>Empirical Software Engineering</em>, <em>20</em>(6), 1427–1455. <a href="https://doi.org/10.1007/s10664-014-9319-7">https://doi.org/10.1007/s10664-014-9319-7</a>
</div>
<div id="ref-wohlinExperimentationSoftwareEngineering2024" class="csl-entry">
Wohlin, C., Runeson, P., Höst, M., Ohlsson, M. C., Regnell, B., &amp; Wesslén, A. (2024). <em>Experimentation in <span>Software Engineering</span></em>. Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/978-3-662-69306-3">https://doi.org/10.1007/978-3-662-69306-3</a>
</div>
<div id="ref-wuSurveyHumanintheloopMachine2022" class="csl-entry">
Wu, X., Xiao, L., Sun, Y., Zhang, J., Ma, T., &amp; He, L. (2022). A <span>Survey</span> of <span class="nocase">Human-in-the-loop</span> for <span>Machine Learning</span>. <em>Future Generation Computer Systems</em>, <em>135</em>, 364–381. <a href="https://doi.org/10.1016/j.future.2022.05.014">https://doi.org/10.1016/j.future.2022.05.014</a>
</div>
<div id="ref-yangFastTreeSHAPAccelerating2022" class="csl-entry">
Yang, J. (2022). <em>Fast <span>TreeSHAP</span>: <span>Accelerating SHAP Value Computation</span> for <span>Trees</span></em> (arXiv:2109.09847). arXiv. <a href="https://doi.org/10.48550/arXiv.2109.09847">https://doi.org/10.48550/arXiv.2109.09847</a>
</div>
<div id="ref-zhangMixtureExpertsLarge2025" class="csl-entry">
Zhang, D., Song, J., Bi, Z., Yuan, Y., Wang, T., Yeong, J., &amp; Hao, J. (2025). <em>Mixture of <span>Experts</span> in <span>Large Language Models</span></em> (arXiv:2507.11181). arXiv. <a href="https://doi.org/10.48550/arXiv.2507.11181">https://doi.org/10.48550/arXiv.2507.11181</a>
</div>
<div id="ref-zhangDocumentParsingUnveiled2024" class="csl-entry">
Zhang, Q., Huang, V. S.-J., Wang, B., Zhang, J., Wang, Z., Liang, H., Wang, S., Lin, M., Zhang, W., &amp; He, C. (2024). <em>Document <span>Parsing Unveiled</span>: <span>Techniques</span>, <span>Challenges</span>, and <span>Prospects</span> for <span>Structured Information Extraction</span></em> (arXiv:2410.21169). arXiv. <a href="https://doi.org/10.48550/arXiv.2410.21169">https://doi.org/10.48550/arXiv.2410.21169</a>
</div>
<div id="ref-zhongPubLayNetLargestDataset2019" class="csl-entry">
Zhong, X., Tang, J., &amp; Yepes, A. J. (2019). <em><span>PubLayNet</span>: Largest dataset ever for document layout analysis</em> (arXiv:1908.07836). arXiv. <a href="https://doi.org/10.48550/arXiv.1908.07836">https://doi.org/10.48550/arXiv.1908.07836</a>
</div>
</div>
</div>
<div id="glossary" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Glossary<a href="#glossary" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<dl>
<dt><span id="acronyms_LLM">LLM</span></dt>
<dd>
large language model
</dd>
<dt><span id="acronyms_AI">AI</span></dt>
<dd>
artificial intelligence
</dd>
<dt><span id="acronyms_PDF">PDF</span></dt>
<dd>
Portable Document Format
</dd>
<dt><span id="acronyms_RHvB">RHvB</span></dt>
<dd>
Rechnungshof von Berlin
</dd>
<dt><span id="acronyms_GPT">GPT</span></dt>
<dd>
generative pre-trained transformers
</dd>
<dt><span id="acronyms_HITL">HITL</span></dt>
<dd>
human-in-the-loop
</dd>
<dt><span id="acronyms_regex">regex</span></dt>
<dd>
regular expression
</dd>
<dt><span id="acronyms_TOC">TOC</span></dt>
<dd>
table of contents
</dd>
<dt><span id="acronyms_MoE">MoE</span></dt>
<dd>
mixture of experts
</dd>
<dt><span id="acronyms_RAG">RAG</span></dt>
<dd>
retrieval augmanted generation
</dd>
<dt><span id="acronyms_SHAP">SHAP</span></dt>
<dd>
SHapley Additive exPlanations
</dd>
<dt><span id="acronyms_TF-IDF">TF-IDF</span></dt>
<dd>
Frequency-Inverse Document Frequency
</dd>
<dt><span id="acronyms_BM25">BM25</span></dt>
<dd>
best matching 25
</dd>
<dt><span id="acronyms_IDF">IDF</span></dt>
<dd>
Inverse Document Frequency
</dd>
<dt><span id="acronyms_FFN">FFN</span></dt>
<dd>
feed forward network
</dd>
<dt><span id="acronyms_PLE">PLE</span></dt>
<dd>
Per-Layer Embedding
</dd>
<dt><span id="acronyms_XGBoost">XGBoost</span></dt>
<dd>
Extreme Gradient Boosting
</dd>
<dt><span id="acronyms_XAI">XAI</span></dt>
<dd>
explainable artificial intelligence
</dd>
<dt><span id="acronyms_UX">UX</span></dt>
<dd>
user experience
</dd>
<dt><span id="acronyms_json">json</span></dt>
<dd>
JavaScript Object Notation
</dd>
<dt><span id="acronyms_GPU">GPU</span></dt>
<dd>
graphics processing unit
</dd>
<dt><span id="acronyms_BHT">BHT</span></dt>
<dd>
Berliner Hochschule für Technik
</dd>
<dt><span id="acronyms_OCR">OCR</span></dt>
<dd>
optical character recognition
</dd>
<dt><span id="acronyms_vllm">vLLM</span></dt>
<dd>
Virtual Large Language Model
</dd>
<dt><span id="acronyms_SSH">SSH</span></dt>
<dd>
secure shell
</dd>
<dt><span id="acronyms_HTML">HTML</span></dt>
<dd>
hyper text markup language
</dd>
<dt><span id="acronyms_ebnf">ebnf</span></dt>
<dd>
extended Backus–Naur form
</dd>
<dt><span id="acronyms_ACFR">ACFR</span></dt>
<dd>
Annual Comprehensive Financial Report
</dd>
<dt><span id="acronyms_mcc">mcc</span></dt>
<dd>
multi-class classification
</dd>
<dt><span id="acronyms_AUC">AUC</span></dt>
<dd>
area under the curve
</dd>
<dt><span id="acronyms_UI">UI</span></dt>
<dd>
user interface
</dd>
</dl>
<!--chapter:end:08_Reference_list.Rmd-->
</div>
<div id="page-identification-report" class="section level1 hasAnchor" number="8">
<h1 class="hasAnchor"><span class="header-section-number">8</span> Appendix A - Page identification report<a href="#page-identification-report" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>(ref:page-identification-intro-text)</p>
<div id="regex-page-identification" class="section level2 hasAnchor" number="8.1">
<h2 class="hasAnchor"><span class="header-section-number">8.1</span> Baseline: Regex<a href="#regex-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>data_page_identification_regex <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/page_identification_regex.rds&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metrics</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>metric_summaries <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metric_summaries</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>metrics_by_company_and_type <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metrics_by_company_and_type</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>metrics_plot_regex_page_identification <span class="ot">&lt;-</span> metrics <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(package, method, classification_type),</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    <span class="co"># &quot;acc&quot;, </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;recall&quot;</span>, <span class="st">&quot;F1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> value, <span class="at">color =</span> package), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(metric<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="co"># creating combi table</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>df_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="cf">for</span> (type <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>)) {</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> metric_summaries[type][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>    <span class="fu">mutate_if</span>(</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>        is.numeric, </span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>        <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>            . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">format</span>(<span class="fu">round</span>(., <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>            <span class="fu">format</span>(<span class="fu">round</span>(., <span class="dv">3</span>), <span class="at">nsmall=</span><span class="dv">3</span>)</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>        )</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> <span class="fu">c</span>(precision, recall, F1)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>        <span class="at">precision =</span> <span class="fu">paste</span>(precision_mean, <span class="st">&quot;±&quot;</span>, precision_sd),</span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>        <span class="at">recall =</span> <span class="fu">paste</span>(recall_mean, <span class="st">&quot;±&quot;</span>, recall_sd),</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>        <span class="at">F1 =</span> <span class="fu">paste</span>(F1_mean, <span class="st">&quot;±&quot;</span>, F1_sd),</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_mean&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;_sd&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove</span>(., <span class="st">&quot; ± NA&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(method)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">.before =</span> <span class="dv">2</span>, <span class="at">type =</span> type)</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>  <span class="co"># rownames(df_temp) &lt;- df_temp$method</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>  </span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>  df_list[[type]] <span class="ot">&lt;-</span> df_temp</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>}</span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>df_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_list) <span class="sc">%&gt;%</span> <span class="fu">bold_value_in_table</span>()</span></code></pre></div>
</details>
<p>The first approach presented in this section is, to use a key word list
and <a href="#acronyms_regex">regex (regular expression)</a> to filter out irrelevant pages. It is setting the
performance baseline for the following approaches. Building a sound
regular expression often is an iterative process. In a first approach a
very <em>simple regex</em> was implemented. To increase the recall to 1.0 the
regular expression was extended<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>. This second regex is
called <em>exhaustive regex</em>. In a third attempt minor changes have been
made to the <em>exhaustive regex</em> to increase the precision without
decreasing the recall. This regular expression is called <em>exhausitve
regex restricted</em>. The regular expressions can be found in the appendix
(see section @ref(regex-page-identification-code)).</p>
<p>Table @ref(tab:display-metrics-regex-page-identification-all) shows the
mean performance for precision, recall and F1 for the three regular
expressions for the three types of pages to identify<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>. It
was possible to create a regular expression that has a high recall for
all target types. The precision is low for all tested regular
expressions and target types. Figure
@ref(fig:display-metrics-plot-regex-page-identification-details) gives
insight into performance differences between the companies. There is
only one document from <em>Berlin Energie und Netzholding</em> where the
<strong>GuV</strong> is not identified except with the <em>exhausitve regex
restricted</em><a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>.</p>
<p>The regular expressions have been tested on the texts extracted with
multiple Python libraries. The reported standard deviations are very
small. This means that there are no substantial differences in the
extracted texts on a word level<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>. But table
@ref(tab:display-data-text-extraction) in section
@ref(text-extraction-benchmark) shows that there are differences in the
extraction speed.</p>
<p>Code can be found at
“benchmark_jobs/page_identification/page_identification_benchmark_regex.ipynb”</p>
<p>Todo: * look into details where they differ and if it is because of a
line break or whitespace?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_html_output</span>()) {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="co"># Set caption</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;&lt;table&gt;&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;&lt;caption&gt;&quot;</span>, <span class="st">&quot;(#tab:&quot;</span>, opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="st">&quot;)&quot;</span>, <span class="st">&quot;Comparing page identification metrics for different regular expressions for each classification task by type of the target table.&quot;</span>, <span class="st">&quot;&lt;/caption&gt;&quot;</span>),<span class="st">&quot;&lt;/table&gt;&quot;</span>, <span class="at">sep =</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  df_combined <span class="sc">%&gt;%</span> <span class="fu">datatable</span>(</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span>, <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>      <span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">dom =</span> <span class="st">&quot;t&quot;</span>, <span class="at">rowGroup =</span> <span class="fu">list</span>(<span class="at">dataSrc=</span><span class="fu">c</span>(<span class="dv">2</span>)), <span class="at">ordering=</span><span class="cn">FALSE</span>, </span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>      <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">visible=</span><span class="cn">FALSE</span>, <span class="at">targets=</span><span class="fu">c</span>(<span class="dv">2</span>)))</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    ), <span class="at">extensions =</span> <span class="st">&#39;RowGroup&#39;</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) {</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  df_combined <span class="sc">%&gt;%</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing page identification metrics for different regular expressions for each classification task by type of the target table.&quot;</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="at">label_row_css =</span> <span class="st">&quot;background-color: #666; color: #fff;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="at">label_row_css =</span> <span class="st">&quot;background-color: #666; color: #fff;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">&quot;GuV&quot;</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="at">label_row_css =</span> <span class="st">&quot;background-color: #666; color: #fff;&quot;</span>)</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>}</span></code></pre></div>
</details>
<table>
<caption>
(#tab:display-metrics-regex-page-identification-all)Comparing page identification metrics for different regular expressions for each classification task by type of the target table.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4721d357650ce18724fa" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4721d357650ce18724fa">{"x":{"filter":"none","vertical":false,"extensions":["RowGroup"],"data":[["1","2","3","4","5","6","7","8","9"],["simple regex","exhaustive regex restricted","exhaustive regex","simple regex","exhaustive regex restricted","exhaustive regex","simple regex","exhaustive regex restricted","exhaustive regex"],["Aktiva","Aktiva","Aktiva","Passiva","Passiva","Passiva","GuV","GuV","GuV"],["<b>0.273<\/b> ± 0.005","0.190","0.132 ± 0.004","<b>0.400<\/b> ± 0.009","0.190","0.130 ± 0.000","0.180 ± 0.006","<b>0.210<\/b>","0.173 ± 0.008"],["0.788 ± 0.010","0.990","<b>0.997<\/b> ± 0.005","0.780 ± 0.009","0.980","<b>0.993<\/b> ± 0.010","0.938 ± 0.008","<b>1.000<\/b>","<b>1.000<\/b> ± 0.000"],["<b>0.403<\/b> ± 0.005","0.320","0.233 ± 0.008","<b>0.530<\/b> ± 0.009","0.320","0.230 ± 0.000","0.302 ± 0.010","<b>0.350<\/b>","0.295 ± 0.012"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>type<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","rowGroup":{"dataSrc":2},"ordering":false,"columnDefs":[{"visible":false,"targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"type","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>metrics_by_company_and_type <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    <span class="fu">select</span>(company, n_files, method, precision, recall, classification_type) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(precision, recall), <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> value, <span class="at">fill =</span> n_files), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> value, <span class="at">color =</span> method), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="fu">facet_grid</span>(classification_type<span class="sc">~</span>metric) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-details-1.png" alt="Comparing the performance among different companies." width="100%" />
<p class="caption">
(#fig:display-metrics-plot-regex-page-identification-details)Comparing the performance among different companies.
</p>
</div>
<div id="summary-1" class="section level5 hasAnchor paragraph-start" number="8.1.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">8.1.0.0.1</span> Summary<a href="#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Nothing works well</p>
</div>
</div>
<div id="toc-understanding" class="section level2 hasAnchor" number="8.2">
<h2 class="hasAnchor"><span class="header-section-number">8.2</span> Table of Contents understanding<a href="#toc-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;scripts/page_identification_toc_data_loading.R&quot;</span>)</span></code></pre></div>
</details>
<p>The second approach presented in this section leverages the <a href="#acronyms_TOC">TOC</a>
understanding capabilities of <a href="#acronyms_LLM">LLM</a>s. <span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span>
use this approach with long documents as a first step to determine a
page range of interest. If the predicted page range is correct and
narrow, this approach is more efficient than processing the whole
document with a <a href="#acronyms_LLM">LLM</a> directly. The <a href="#acronyms_TOC">TOC</a> in a <a href="#acronyms_PDF">PDF</a>
document can be embedded in a standardized, machine readable format or
be presented in varying, human readable forms of text on any page. Of
course there are documents without any <a href="#acronyms_TOC">TOC</a>.</p>
<p>Thus, the task is investigated based on two different input data formats
In one case the <a href="#acronyms_LLM">LLM</a> is provided with text extracted from the
beginning of the document. In the other case the <a href="#acronyms_LLM">LLM</a> is provided
with the Markdown formatted version of the machine readable <a href="#acronyms_TOC">TOC</a>
embedded in the document. Subsection @ref(text-based-toc-understanding)
shows the results for the text based approach. Subsection
@ref(code-based-toc-understanding) shows the results for the approach,
using the embedded <a href="#acronyms_TOC">TOC</a>.</p>
<p>Additionally, each approach is performed three times with minor changes
in the prompt. The prompts used for both approaches can be found at
@ref(toc-understanding-promts). The prompt was adjusted two times to
tackle shortcomings in the results. The first change adds the
information, that assets and liabilities are part of the balance sheet.
It is the balance sheet, that is listed in the <a href="#acronyms_TOC">TOC</a> - not the
assets or liabilities itself. The second change specifies the
information, that assets and liabilities are often on separated pages,
into, liabilities often are found on the page after the assets.</p>
<p>The code can be found in:</p>
<ul>
<li><p>“benchmark_jobs/page_identification/toc_extraction_mistral.ipynb”</p></li>
<li><p>“benchmark_jobs/page_identification/toc_extraction_qwen.ipynb”</p></li>
</ul>
<p>Discussion:</p>
<ul>
<li><span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span> did not report any issues with this
approach. They use few-shot learning and Chain-of-Thought techniques
to help the <a href="#acronyms_LLM">LLM</a> to understand the task. They ask just for one
information at a time.</li>
<li>ChatGPT 4 vs Mistral 2410 8B (huge parameter difference)</li>
<li>For a lot of short annual reports one can find the tables of
interest within the first eight pages as well.</li>
</ul>
<div id="text-based-toc-understanding" class="section level3 hasAnchor" number="8.2.1">
<h3 class="hasAnchor"><span class="header-section-number">8.2.1</span> Details for the approaches<a href="#text-based-toc-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="text-based" class="section level5 hasAnchor paragraph-start" number="8.2.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">8.2.1.0.1</span> Text based<a href="#text-based" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><span class="citation">H. Li, Gao, et al. (<a href="#ref-liExtractingFinancialData2023">2023</a>)</span> used the <a href="#acronyms_TOC">TOC</a> to identify the pages
of interest. In their approach the table of contents is extracted from
the text. Based on their observation, that the <a href="#acronyms_TOC">TOC</a> in <a href="#acronyms_ACFR">ACFR (Annual Comprehensive Financial Report)</a>s
is found within the initial 165 lines of the converted document
<span class="citation">(<a href="#ref-liExtractingFinancialData2023">H. Li, Gao, et al., 2023, p. 20</a>)</span>, they use the first 200 lines of
text.</p>
</div>
<p>My initial expectation was to find the <a href="#acronyms_TOC">TOC</a> within the first five
pages. Often there are way less than 200 lines of text on the five first
pages (see Figure @ref(fig:page-identification-toc-histogram)). In my
approach the first step is to prompt the <a href="#acronyms_LLM">LLM</a> to identify and
extract the <a href="#acronyms_TOC">TOC</a> in a given text extract^[The prompt can be found
in section @ref(toc-understanding-promts)]. For the same documents
Mistral 2410 8B finds^[The strings extracted in this step have not been
checked in detail.]</p>
<ul>
<li><p>63 strings that should represent a table of
contents among the first five pages.</p></li>
<li><p>68 strings that should represent a table of
contents among the first 200 lines.</p></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>df_num_lines <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">filter</span>(filepath <span class="sc">%in%</span> df_targets_no_ocr<span class="sc">$</span>filepath) <span class="sc">%&gt;%</span> <span class="co"># filter documents that would need ocr preprocessing</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_lines), <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of lines in the first 5 pages&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(df_num_lines<span class="sc">$</span>num_lines)))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-histogram-1.png" alt="Histogram of the number of lines in the first 5 pages of the annual reports" width="80%" />
<p class="caption">
(#fig:page-identification-toc-histogram)Histogram of the number of lines in the first 5 pages of the annual reports
</p>
</div>
<div id="code-based-toc-understanding" class="section level5 hasAnchor paragraph-start" number="8.2.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">8.2.1.0.2</span> Machine readable TOC based<a href="#code-based-toc-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>I also tested to use the <a href="#acronyms_TOC">TOC</a> representation embedded within the
PDF files. First, this limits the text amount to process. Second, this
hopefully increases the quality of the data passed to the <a href="#acronyms_LLM">LLM</a>.
43 of the 80 annual reports have a machine
readable embedded <a href="#acronyms_TOC">TOC</a>. The embedded <a href="#acronyms_TOC">TOC</a> is converted into
markdown format before it gets passed to the <a href="#acronyms_LLM">LLM</a>. Here is an
example:</p>
</div>
<pre><code>## |   hierarchy_level | title                       |   page_number |   enumeration |
## |------------------:|:----------------------------|--------------:|--------------:|
## |                 1 | Lagebericht                 |             5 |             1 |
## |                 1 | Bilanz                      |             7 |             2 |
## |                 1 | Gewinn- und Verlustrechnung |            10 |             3 |
## |                 1 | Anhang                      |            13 |             4 |
## |                 1 | Lagebericht                 |            17 |             5 |
## |                 1 | Bilanz                      |            25 |             6 |
## |                 1 | Anhang                      |            31 |             7 |
## |                 1 | Anlagenspiegel              |            39 |             8 |
## |                 1 | Bestätigungsvermerk         |            42 |             9 |</code></pre>
</div>
<div id="results-1" class="section level3 hasAnchor" number="8.2.2">
<h3 class="hasAnchor"><span class="header-section-number">8.2.2</span> Results<a href="#results-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="comparison-of-the-different-approaches-base-prompt" class="section level5 hasAnchor paragraph-start" number="8.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">8.2.2.0.1</span> Comparison of the different approaches: base prompt<a href="#comparison-of-the-different-approaches-base-prompt" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:page-identification-toc-analysis-table) shows that the
machine readable <a href="#acronyms_TOC">TOC</a> approach has the highest rate of correct page
ranges for all types with the base prompt. It also predicts the most
correct page ranges in absolute numbers for <strong>Aktiva</strong> and <strong>GuV</strong>.
Thus, it also has the highest rate of correct page ranges based on the
total number of page ranges to identify over all documents - no matter,
if there was a <a href="#acronyms_TOC">TOC</a> of any type in the document or not - for
<strong>Aktiva</strong> and <strong>GuV</strong> of around 27 %.</p>
</div>
<table>
<caption>
(#tab:page-identification-toc-analysis-table)Comparing the number and percentage of correct identified page ranges among the approaches.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e84b3a1f23112e2d0564" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e84b3a1f23112e2d0564">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["200 lines","200 lines","200 lines","5 pages","5 pages","5 pages","machine readable","machine readable","machine readable"],["Aktiva","GuV","Passiva","Aktiva","GuV","Passiva","Aktiva","GuV","Passiva"],[" 9.0","22.0","<b>6.0<\/b>"," 7.0","15.0","3.0","<b>22.0<\/b>","<b>28.0<\/b>","4.0"],["63","95","62","58","89","57","35","56","34"],["82","102","81","82","102","81","82","102","81"],["14.3","23.2"," 9.7","12.1","16.9"," 5.3","<b>62.9<\/b>","<b>50.0<\/b>","<b>11.8<\/b>"],["11.0","21.6","<b>7.4<\/b>"," 8.5","14.7","3.7","<b>26.8<\/b>","<b>27.5<\/b>","4.9"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark type<\/th>\n      <th>type<\/th>\n      <th>n correct<\/th>\n      <th>n<\/th>\n      <th>n total<\/th>\n      <th>perc correct<\/th>\n      <th>perc correct total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark type","targets":1},{"name":"type","targets":2},{"name":"n correct","targets":3},{"name":"n","targets":4},{"name":"n total","targets":5},{"name":"perc correct","targets":6},{"name":"perc correct total","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Figure @ref(fig:page-identification-toc-analysis) shows that the amount
of correct predicted page ranges for <strong>Passiva</strong> is lowest for all
approaches but can be improved by simply extending the predicted end
page number by one the most. This improvement would be best for the
machine readable <a href="#acronyms_TOC">TOC</a> approach. This approach is the only one,
where the number of correct page ranges <strong>Aktiva</strong> would not increase if
we extend its range by one. Table
@ref(tab:page-identification-toc-analysis-same-end-page) shows that
this is the case, because the machine readable <a href="#acronyms_TOC">TOC</a> approach
predicts the same end page for <strong>Passiva</strong> as for <strong>Aktiva</strong> in
84.8 % of the cases, even though the prompt for
all approaches included the information, that <strong>Aktiva</strong> and <strong>Passiva</strong>
are on separate pages.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range, <span class="at">colour =</span> min_distance <span class="sc">&lt;=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-analysis-1.png" alt="Comparing number of found TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
(#fig:page-identification-toc-analysis)Comparing number of found TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>df_toc_benchmark <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">&quot;GuV&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">group_by</span>(benchmark_type, filepath) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">all_equal =</span> <span class="fu">n_distinct</span>(end_page) <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">group_by</span>(benchmark_type) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">equal_end_page =</span> <span class="fu">sum</span>(all_equal), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_equal_end_page =</span> <span class="fu">round</span>(equal_end_page<span class="sc">/</span>n<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;lrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing the number and percentage end pages prediction for Aktiva and Passiva that are equal.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-identification-toc-analysis-same-end-page)Comparing the number and percentage end pages prediction for Aktiva and Passiva that are equal.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-10fac08efc7c41aa81b9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-10fac08efc7c41aa81b9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["200 lines","5 pages","machine readable"],["20","26","28"],["58","53","33"],["34.5","49.1","84.8"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark type<\/th>\n      <th>equal end page<\/th>\n      <th>n<\/th>\n      <th>perc equal end page<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark type","targets":1},{"name":"equal end page","targets":2},{"name":"n","targets":3},{"name":"perc equal end page","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="comparison-of-the-different-approaches-advanved-prompts" class="section level5 hasAnchor paragraph-start" number="8.2.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">8.2.2.0.2</span> Comparison of the different approaches: advanved prompts<a href="#comparison-of-the-different-approaches-advanved-prompts" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>As a first attempt, to increase the correct page range rate for
<strong>Passiva</strong> I tried to specify, that assets and liabilities are part of
the balance sheet. This did work for the text based approaches, but not
for the machine readable approach (see Figure
@ref(fig:page-identification-toc-analysis-balanced)). Figure
@ref(fig:page-identification-toc-analysis-next-page) shows that it is
more successful, to explicit tell the <a href="#acronyms_LLM">LLM</a> that the liabilities
table is often on the page, after the assets table.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>next_page_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range, <span class="at">colour =</span> min_distance <span class="sc">&lt;=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="co"># +</span></span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-analysis-next-page-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
(#fig:page-identification-toc-analysis-next-page)Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="co">#   legend.position = &quot;bottom&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="co"># )</span></span></code></pre></div>
</details>
<p>Table @ref(tab:page-identification-toc-analysis-table-next-page) shows
the results from the final zero shot prompt. The machine readable
<a href="#acronyms_TOC">TOC</a> approach is now predicting best for all types. Nevertheless, a
correct page range prediction rate below 60, 45, 50
% is still unsufficient to build downstream task on withou human
checkups. Table @ref(tab:page-identification-toc-gpu-time-comparison)
shows, that the machine readable <a href="#acronyms_TOC">TOC</a> approach is the fastest as
well.</p>
<table>
<caption>
(#tab:page-identification-toc-analysis-table-next-page)Comparing the number and percentage of correct identified page ranges among the approaches.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5b41eae9932bbefdda6b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5b41eae9932bbefdda6b">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["200 lines","200 lines","200 lines","5 pages","5 pages","5 pages","machine readable","machine readable","machine readable"],["Aktiva","GuV","Passiva","Aktiva","GuV","Passiva","Aktiva","GuV","Passiva"],[" 9.0","24.0"," 8.0"," 8.0","17.0"," 7.0","<b>21.0<\/b>","<b>25.0<\/b>","<b>17.0<\/b>"],["64","97","63","60","91","59","35","56","34"],["82","102","81","82","102","81","82","102","81"],["14.1","24.7","12.7","13.3","18.7","11.9","<b>60.0<\/b>","<b>44.6<\/b>","<b>50.0<\/b>"],["11.0","23.5"," 9.9"," 9.8","16.7"," 8.6","<b>25.6<\/b>","<b>24.5<\/b>","<b>21.0<\/b>"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark type<\/th>\n      <th>type<\/th>\n      <th>n correct<\/th>\n      <th>n<\/th>\n      <th>n total<\/th>\n      <th>perc correct<\/th>\n      <th>perc correct total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark type","targets":1},{"name":"type","targets":2},{"name":"n correct","targets":3},{"name":"n","targets":4},{"name":"n total","targets":5},{"name":"perc correct","targets":6},{"name":"perc correct total","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>gpu_time_per_document_page_range <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  is.numeric, </span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>    .</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  )</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;lrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing GPU time for page range prediction and table of contents extraction. Time in seconds per text processed.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-identification-toc-gpu-time-comparison)Comparing GPU time for page range prediction and table of contents extraction. Time in seconds per text processed.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c559b644388658c2e5e3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c559b644388658c2e5e3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["200 lines","5 pages","machine readable"],["0.57","<b>0.56<\/b>","0.63"],["3.8","<b>2.19<\/b>",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Benchmark Type<\/th>\n      <th>Page range predicting<\/th>\n      <th>TOC extracting<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Benchmark Type","targets":1},{"name":"Page range predicting","targets":2},{"name":"TOC extracting","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Table @ref(tab:page-range-prediction-performance-table) shows, that
this advantage of the machine readable <a href="#acronyms_TOC">TOC</a> approach is not coming
from wide predicted page ranges. It has the smallest median range size
among all approaches. Figure
@ref(fig:page-identification-toc-range-plot) shows, that especially the
ranges for <strong>GuV</strong> are not normally distributed. Some far off lying
range sizes are shifting the mean off from the median.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>mean_ranges <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">mutate_at</span>(</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    <span class="fu">vars</span>(median_range),</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>      .</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>    )</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;lrrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing the mean and median page range sizes.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:page-range-prediction-performance-table)Comparing the mean and median page range sizes.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5b3e24d10151b849c793" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5b3e24d10151b849c793">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["200 lines","200 lines","200 lines","5 pages","5 pages","5 pages","machine readable","machine readable","machine readable"],["Aktiva","GuV","Passiva","Aktiva","GuV","Passiva","Aktiva","GuV","Passiva"],["2.11","4.25","1.7","2.03","3.15","1.64","1.6","3.89","1.24"],["1.09","3.29","0.59","1.29","2.17","0.89","2.56","5.75","0.74"],["2","4","2","2","2","2","<b>1<\/b>","<b>1<\/b>","<b>1<\/b>"],["1.48","2.97","0","1.48","1.48","0","0","0","0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark type<\/th>\n      <th>type<\/th>\n      <th>mean range<\/th>\n      <th>SD range<\/th>\n      <th>median range<\/th>\n      <th>MAD range<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark type","targets":1},{"name":"type","targets":2},{"name":"mean range","targets":3},{"name":"SD range","targets":4},{"name":"median range","targets":5},{"name":"MAD range","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>next_page_df_toc_benchmark <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="co"># mutate(range = range-1) %&gt;% </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> range), <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> mean_ranges, <span class="fu">aes</span>(<span class="at">xintercept =</span> mean_range), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> mean_ranges, <span class="fu">aes</span>(<span class="at">xintercept =</span> median_range), <span class="at">color =</span> <span class="st">&quot;green&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>(benchmark_type<span class="sc">~</span>type)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-range-plot-1.png" alt="Comparint the predicted page range sizes. The red vertical line shows the mean and the green one shows the median of these sizes." width="100%" />
<p class="caption">
(#fig:page-identification-toc-range-plot)Comparint the predicted page range sizes. The red vertical line shows the mean and the green one shows the median of these sizes.
</p>
</div>
<p>Figure @ref(fig:page-identification-toc-range-logprobs) shows that the
confidence of the <a href="#acronyms_LLM">LLM</a>s responses is higher for the machine
readable <a href="#acronyms_TOC">TOC</a> approach as well. Besides a single group that was
predicted far off, the page ranges are closer to the correct pages too.
A linear regression of the correlation between minimal page distance and
logistic probability shows that is has a similar slope for all
approaches and target types.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>next_page_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(filepath, benchmark_type) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">distance_confidence_plot</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type<span class="sc">~</span>benchmark_type) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-range-logprobs-1.png" alt="Showing the minimal distance of the predicted page range to the actual page number overthe logprobs of the models response confidence." width="100%" />
<p class="caption">
(#fig:page-identification-toc-range-logprobs)Showing the minimal distance of the predicted page range to the actual page number overthe logprobs of the models response confidence.
</p>
</div>
</div>
<div id="machine-readable-toc-approach-specific-results" class="section level3 hasAnchor paragraph-start" number="8.2.3">
<h3 class="hasAnchor"><span class="header-section-number">8.2.3</span> Machine readable TOC approach specific results<a href="#machine-readable-toc-approach-specific-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Figure @ref(fig:page-identification-toc-mr-degration) shows, that
correct predictions for the page range are more probable when the
embedded <a href="#acronyms_TOC">TOC</a> has a medium number of entries. It is possible to
drop documents with less than 9 without
loosing a single correct prediction. This means that the <a href="#acronyms_LLM">LLM</a> was
not able to make a correct prediction for documents with <a href="#acronyms_TOC">TOC</a>, that
have less then 9 entries. This is not
surprising since neither <strong>Bilanz</strong> nor <strong>GuV</strong> are mentioned there
explicit.</p>
</div>
<p>It has no big influence on the predictions, if the <a href="#acronyms_TOC">TOC</a> is passed
formatted as markdown or json. With the json formatted <a href="#acronyms_TOC">TOC</a> it
found two more correct page ranges<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>. This was tested
because the relation between heading and value for the column
<em>page_number</em> might have been clearer<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a> in json for a
one-dimensional working <a href="#acronyms_LLM">LLM</a>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>df_toc_benchmark_mr_degration_next_page <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_entries, <span class="at">y =</span> value, <span class="at">fill =</span> correct)) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(n_entries), <span class="at">y =</span> <span class="dv">100</span><span class="sc">*</span>perc_correct, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-mr-degration-1.png" alt="Showing the amount of correct and incorrect predicted page ranges (bars) and the percentage of correct predictions (black line)." width="672" />
<p class="caption">
(#fig:page-identification-toc-mr-degration)Showing the amount of correct and incorrect predicted page ranges (bars) and the percentage of correct predictions (black line).
</p>
</div>
<p>Delete or place somewhere else?:</p>
<ul>
<li><p>Thus it is safer to go with the 200 lines approach. But it also
takes longer. @ref(tab:page-identification-toc-gpu-time-comparison)</p></li>
<li><p>Values can be higher than 80, the total number of PDF files, since
there can be multiple tables of interested for the same type in a
single document or a table of interest can span two pages.</p></li>
</ul>
</div>
<div id="llm-page-identification" class="section level2 hasAnchor" number="8.3">
<h2 class="hasAnchor"><span class="header-section-number">8.3</span> Classification with LLMs<a href="#llm-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>temp_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/page_identification_llm.rds&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>df_binary <span class="ot">&lt;-</span> temp_list<span class="sc">$</span>df_binary</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>df_multi <span class="ot">&lt;-</span> temp_list<span class="sc">$</span>df_multi</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>method_families <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;zero_shot&quot;</span>, <span class="st">&quot;law_context&quot;</span>, <span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>, <span class="st">&#39;n_rag_examples&#39;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>method_familiy_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  <span class="st">&quot;zero_shot&quot;</span> <span class="ot">=</span> <span class="st">&quot;#e41a1c&quot;</span>, </span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="st">&quot;law_context&quot;</span> <span class="ot">=</span> <span class="st">&quot;#377eb8&quot;</span>, </span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="st">&quot;top_n_rag_examples&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4daf4a&quot;</span>, </span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="st">&quot;n_random_examples&quot;</span> <span class="ot">=</span> <span class="st">&quot;#984ea3&quot;</span>, </span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  <span class="st">&#39;n_rag_examples&#39;</span> <span class="ot">=</span> <span class="st">&quot;#ff7f00&quot;</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  )</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>model_by_size_classification <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;google_gemma-3-4b-it-0-9-1&#39;</span>, <span class="st">&#39;google_gemma-3n-E4B-it-0-9-1&#39;</span>, <span class="st">&quot;google_gemma-3-12b-it-0-9-1&quot;</span>,</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>  <span class="st">&quot;google_gemma-3-27b-it-0-9-1&quot;</span>, <span class="st">&quot;meta-llama_Llama-3.1-8B-Instruct&quot;</span>, </span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>  <span class="st">&quot;meta-llama_Llama-3.1-70B-Instruct&quot;</span>, <span class="st">&quot;meta-llama_Llama-3.3-70B-Instruct&quot;</span>,</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>  <span class="st">&quot;meta-llama_Llama-4-Scout-17B-16E-Instruct&quot;</span>, <span class="st">&quot;meta-llama_Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>  <span class="st">&quot;mistralai_Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;mistralai_Mistral-Small-3.1-24B-Instruct-2503&quot;</span>,</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>  <span class="st">&quot;mistralai_Mistral-Large-Instruct-2411&quot;</span>, <span class="st">&quot;Qwen_Qwen2.5-0.5B-Instruct&quot;</span>,</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>  <span class="st">&quot;Qwen_Qwen2.5-1.5B-Instruct&quot;</span>, <span class="st">&quot;Qwen_Qwen2.5-3B-Instruct&quot;</span>, <span class="st">&quot;Qwen_Qwen2.5-7B-Instruct&quot;</span>,</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>  <span class="st">&quot;Qwen_Qwen2.5-14B-Instruct&quot;</span>, <span class="st">&quot;Qwen_Qwen2.5-32B-Instruct&quot;</span>, <span class="st">&quot;Qwen_Qwen2.5-72B-Instruct&quot;</span>,</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>  <span class="st">&quot;Qwen_Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen_Qwen3-30B-A3B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen_Qwen3-32B&quot;</span>, <span class="st">&quot;Qwen_Qwen3-235B-A22B-Instruct-2507&quot;</span>,</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>  <span class="st">&quot;tiiuae_Falcon3-10B-Instruct&quot;</span>, <span class="st">&quot;microsoft_phi-4&quot;</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, .)</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>df_binary <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">as.numeric</span>(n_examples),</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>, <span class="dv">0</span>, n_examples),</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;law_context&quot;</span>, <span class="dv">1</span>, n_examples),</span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>  <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_families)</span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co"># %&gt;% </span></span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>  <span class="co"># mutate(</span></span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>  <span class="co">#   model = str_replace(model, &quot;_vllm&quot;, &quot;&quot;),</span></span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>  <span class="co">#   model_family = sub(&quot;_.*&quot;, &quot;&quot;, model),</span></span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Qwen2&quot;), &quot;Qwen 2.5&quot;, model_family),</span></span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Qwen3&quot;), &quot;Qwen 3&quot;, model_family),</span></span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Llama-3&quot;), &quot;Llama-3&quot;, model_family),</span></span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Llama-4&quot;), &quot;Llama-4&quot;, model_family)</span></span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a></span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a>binary_task <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a>binary_task<span class="sc">$</span>n_models <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a>binary_task<span class="sc">$</span>n_model_families <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>model_family <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a>binary_task<span class="sc">$</span>n_method_families <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>method_family <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a>top_performer_binary <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, classification_type) <span class="sc">%&gt;%</span> </span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1_score) <span class="sc">%&gt;%</span> </span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, classification_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a>  )</span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a></span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a>top_performer_binary_median <span class="ot">&lt;-</span> top_performer_binary <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(classification_type) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(f1_score))</span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a>top_performer_binary_median_guv <span class="ot">&lt;-</span> top_performer_binary_median <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;GuV&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(median)</span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a>top_performer_binary_median_aktiva <span class="ot">&lt;-</span> top_performer_binary_median <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(median)</span>
<span id="cb25-67"><a href="#cb25-67" tabindex="-1"></a>top_performer_binary_median_passiva <span class="ot">&lt;-</span> top_performer_binary_median <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Passiva&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(median)</span>
<span id="cb25-68"><a href="#cb25-68" tabindex="-1"></a></span>
<span id="cb25-69"><a href="#cb25-69" tabindex="-1"></a>df_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb25-70"><a href="#cb25-70" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-71"><a href="#cb25-71" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">as.numeric</span>(n_examples),</span>
<span id="cb25-72"><a href="#cb25-72" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>, <span class="dv">0</span>, n_examples),</span>
<span id="cb25-73"><a href="#cb25-73" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;law_context&quot;</span>, <span class="dv">1</span>, n_examples),</span>
<span id="cb25-74"><a href="#cb25-74" tabindex="-1"></a>  <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_families)</span>
<span id="cb25-75"><a href="#cb25-75" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-76"><a href="#cb25-76" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb25-77"><a href="#cb25-77" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co">#%&gt;%</span></span>
<span id="cb25-78"><a href="#cb25-78" tabindex="-1"></a>  <span class="co"># mutate(</span></span>
<span id="cb25-79"><a href="#cb25-79" tabindex="-1"></a>  <span class="co">#   model = str_replace(model, &quot;_vllm&quot;, &quot;&quot;),</span></span>
<span id="cb25-80"><a href="#cb25-80" tabindex="-1"></a>  <span class="co">#   model_family = sub(&quot;_.*&quot;, &quot;&quot;, model),</span></span>
<span id="cb25-81"><a href="#cb25-81" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Qwen2&quot;), &quot;Qwen 2.5&quot;, model_family),</span></span>
<span id="cb25-82"><a href="#cb25-82" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Qwen3&quot;), &quot;Qwen 3&quot;, model_family),</span></span>
<span id="cb25-83"><a href="#cb25-83" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Llama-3&quot;), &quot;Llama-3&quot;, model_family),</span></span>
<span id="cb25-84"><a href="#cb25-84" tabindex="-1"></a>  <span class="co">#   model_family = if_else(str_detect(model, &quot;Llama-4&quot;), &quot;Llama-4&quot;, model_family)</span></span>
<span id="cb25-85"><a href="#cb25-85" tabindex="-1"></a>  <span class="co"># )</span></span>
<span id="cb25-86"><a href="#cb25-86" tabindex="-1"></a></span>
<span id="cb25-87"><a href="#cb25-87" tabindex="-1"></a>top_performer_multu <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb25-88"><a href="#cb25-88" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb25-89"><a href="#cb25-89" tabindex="-1"></a>  <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-90"><a href="#cb25-90" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-91"><a href="#cb25-91" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb25-92"><a href="#cb25-92" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb25-93"><a href="#cb25-93" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1_score) <span class="sc">%&gt;%</span> </span>
<span id="cb25-94"><a href="#cb25-94" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="co"># head(10) %&gt;% </span></span>
<span id="cb25-95"><a href="#cb25-95" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, metric_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb25-96"><a href="#cb25-96" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-97"><a href="#cb25-97" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb25-98"><a href="#cb25-98" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb25-99"><a href="#cb25-99" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb25-100"><a href="#cb25-100" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb25-101"><a href="#cb25-101" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p>The third approach we present in this section, uses pretrained
<a href="#acronyms_LLM">LLM</a>s to classify, if a given text extract is including any of the
target tables. Two classification approaches are presented.</p>
<p>On the one hand, a binary classification is used three times, to
predict, if the text extract is including an <strong>Aktiva</strong>, <strong>Passiva</strong> or
<strong>GuV</strong> table, once at a time. In this case the <a href="#acronyms_LLM">LLM</a> is forced to
answer with either <em>yes</em> or <em>no</em>. On the other hand, the <a href="#acronyms_LLM">LLM</a>
performed a \acr{mcc]. For the <a href="#acronyms_mcc">mcc (multi-class classification)</a> the <a href="#acronyms_LLM">LLM</a> is forced to
answer <em>Aktiva</em>, <em>Passiva</em>, <em>GuV</em> or <em>other</em>. The prompts can be found
in appendix in section @ref(classification-prompts).</p>
<p>The different classification tasks are combined with different prompting
strategies. A zero shot approach is setting the baseline. In a second
approach the excerpt of the relevant law is provided with the context.
Additionally, three few shot approaches are used.</p>
<p>In the few shot approaches text examples and a correct classification
for the text examples are provided. Figure
@ref(fig:comparing-actual-number-of-in-context-examples-plot) shows how
many examples the <a href="#acronyms_LLM">LLM</a> gets provided, depending on the
classification type and chosen parameter <em>n_example</em><a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>.
For both approaches three example selection strategies are implemented.
First, random examples for each page type get sampled from the truth
dataset. Second, a vector database provides the entries that are closest
to the target text for each page type. Third, the vector database just
provides the texts that are closest to the target text without
considering the page type of the examples returned.</p>
<p>For the binary classification task the <a href="#acronyms_LLM">LLM</a> is provided with more
examples for the target type than for other types. Thus, the number of
examples and tokens is reduced. This should reduce the runtime as well.
On the same time the <a href="#acronyms_LLM">LLM</a> should get enough information about the
structure and contents of the target class and some information how it
differs from other big tables or general text pages.</p>
<p>For the <a href="#acronyms_mcc">mcc</a> the same amount of every possible class is provided.
Thus, the relation between the parameter <em>n_examples</em> and the number of
tokens to process is stronger for the <em>n_random_examples</em> and
<em>n_rag_examples</em> strategies.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>df_classification_n_examples <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_truth/real_example_count.csv&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>df_classification_n_examples <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">strategy =</span> approach) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_example, <span class="at">y =</span> sum, <span class="at">color =</span> strategy), <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(strategy <span class="sc">!=</span> <span class="st">&quot;n_random_examples&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> n_example, <span class="at">y =</span> sum, <span class="at">color =</span> strategy)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(strategy <span class="sc">==</span> <span class="st">&quot;n_random_examples&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> n_example, <span class="at">y =</span> sum, <span class="at">color =</span> strategy), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>classification)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/comparing-actual-number-of-in-context-examples-plot-1.png" alt="Comparing the actual number of provided examples depending on the classification type, example selection strategy and chosen parameter n-examples. The slope for the top-n-rag-examples strategy is the same for both approaches. The line for the strategies n-random-examples and n-rag-examples is equal within each approach." width="100%" />
<p class="caption">
(#fig:comparing-actual-number-of-in-context-examples-plot)Comparing the actual number of provided examples depending on the classification type, example selection strategy and chosen parameter n-examples. The slope for the top-n-rag-examples strategy is the same for both approaches. The line for the strategies n-random-examples and n-rag-examples is equal within each approach.
</p>
</div>
<p>Table @ref(tab:page-identification-llm-overview) shows, which models
have been used in the classification benchmarks. Overall
25 models from 6
model families have been tested. Prerequirement for a model to be tested
is, that it can be used with the <a href="#acronyms_vllm">vLLM</a> library, accessed via
hugging face and fits into the combined VRAM of 8 nvidia B200 graphic
cards (1.536 TB). The models cover a wide range of (active) parameter
sizes. Especially for the Qwen family many models of different parameter
sizes are used in the benchmark, to investigate if there is a clear
minimum amount of parameters needed, to solve the classification task.</p>
<p>The results of the benchmarks have been logged as <a href="#acronyms_json">json</a> files
totaling in 2.1 GB of data for the final results.</p>
<table>
<caption>
(#tab:page-identification-llm-overview)Overview of benchmarked LLMs for the classification tasks.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6c458f2065644906f4cd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6c458f2065644906f4cd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],["Falcon3-10B-Instruct","gemma-3-12b-it-0-9-1","gemma-3-27b-it-0-9-1","gemma-3-4b-it-0-9-1","gemma-3n-E4B-it-0-9-1","Llama-3","Llama-3","Llama-3","Llama-4","Llama-4","Ministral-8B-Instruct-2410","Mistral-Large-Instruct-2411","Mistral-Small-3.1-24B-Instruct-2503","phi-4","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 2.5","Qwen 3","Qwen 3","Qwen 3","Qwen 3"],["Falcon3-10B-Instruct","gemma-3-12b-it-0-9-1","gemma-3-27b-it-0-9-1","gemma-3-4b-it-0-9-1","gemma-3n-E4B-it-0-9-1","Llama-3.1-8B-Instruct","Llama-3.1-70B-Instruct","Llama-3.3-70B-Instruct","Llama-4-Maverick-17B-128E-Instruct-FP8","Llama-4-Scout-17B-16E-Instruct","Ministral-8B-Instruct-2410","Mistral-Large-Instruct-2411","Mistral-Small-3.1-24B-Instruct-2503","phi-4","Qwen2.5-0.5B-Instruct","Qwen2.5-1.5B-Instruct","Qwen2.5-3B-Instruct","Qwen2.5-7B-Instruct","Qwen2.5-14B-Instruct","Qwen2.5-32B-Instruct","Qwen2.5-72B-Instruct","Qwen3-8B","Qwen3-30B-A3B-Instruct-2507","Qwen3-32B","Qwen3-235B-A22B-Instruct-2507"],["10","12","27","4","4","8","70","70","17","17","8","124","24","15","0.5","1.5","3","7","14","32","72","8","30","32","235"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>parameter count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"parameter count","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>To do:</p>
<ul>
<li>compare out of company vs in company rag</li>
</ul>
<div id="binary-classification" class="section level3 hasAnchor" number="8.3.1">
<h3 class="hasAnchor"><span class="header-section-number">8.3.1</span> Binary classification<a href="#binary-classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table @ref(tab:table-metrics-llm-page-identification-binary) shows the
best performing combination of model family and prompting method for
each classification target type. The classification of <strong>GuV</strong> tables
works best and is solved almost perfectly. The F1 score for <strong>Aktiva</strong>
and <strong>Passiva</strong> are 0.07 lower for the top performing model. The median
F1 score of <strong>GuV</strong> is 0.93 0.1 higher
than the median F1 score for <strong>Aktiva</strong>
(0.84) and 0.2 higher than the median
F1 score for <strong>Passiva</strong>
(0.74).</p>
<p>Mistral 8B Instruct 2410 is performing best for the binary
classification task for each target type. Llama-4-Scout-17B-16E-Instruct
is performing second best for <strong>Aktiva</strong> and <strong>GuV</strong> and is close to the
second best for <strong>Passiva</strong> as well. The runtime of Mistral 8B Instruct
2410 is four times lower than the runtime of
Llama-4-Scout-17B-16E-Instruct. In addition, the time to load
Llama-4-Scout-17B-16E-Instruct into the VRAM is much
longer<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>, because it has a total of 109B parameters. It
was surprising that Googles gemma models perform so bad<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>.</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>top_performer_binary <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llllrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Overview of benchmarked LLMs for the binary classification tasks. Limiting the number of examples provided for the few shot approach to 3.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-page-identification-binary)Overview of benchmarked LLMs for the binary classification tasks. Limiting the number of examples provided for the few shot approach to 3.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-cada63cfe136e73ec270" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cada63cfe136e73ec270">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["mistralai","meta-llama","Qwen","mistralai","mistralai","meta-llama","Qwen","Qwen","meta-llama","meta-llama","Qwen","microsoft","microsoft","google","google","google","tiiuae","tiiuae","tiiuae"],["Ministral-8B-Instruct-2410","Llama-4-Scout-17B-16E-Instruct","Qwen2.5-32B-Instruct","Ministral-8B-Instruct-2410","Ministral-8B-Instruct-2410","Llama-4-Scout-17B-16E-Instruct","Qwen2.5-32B-Instruct","Qwen3-235B-A22B-Instruct-2507","Llama-4-Scout-17B-16E-Instruct","Llama-4-Scout-17B-16E-Instruct","Qwen2.5-32B-Instruct","phi-4","phi-4","gemma-3-27b-it-0-9-1","gemma-3-27b-it-0-9-1","gemma-3-27b-it-0-9-1","Falcon3-10B-Instruct","Falcon3-10B-Instruct","Falcon3-10B-Instruct"],["GuV","GuV","GuV","Passiva","Aktiva","Passiva","Aktiva","Aktiva","Aktiva","Aktiva","Passiva","Aktiva","Passiva","Passiva","Aktiva","GuV","Passiva","Aktiva","GuV"],["n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","law_<wbr>context","law_<wbr>context","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["3","3","1","3","3","3","1","3","1","3","1","1","1","1","1","1","1","1","1"],["0.99","0.98","0.93","0.92","0.92","0.86","0.85","0.85","0.84","0.84","0.81","0.7","0.66","0.58","0.54","0.52","0.5","0.45","0.34"],["917","4062","1985","858","878","3037","1806","7442","2318","3052","1967","102","101","1849","2588","1800","469","1065","222"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>classification type<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>f1 score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-left"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"classification type","targets":3},{"name":"method family","targets":4},{"name":"n examples","targets":5},{"name":"f1 score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<p>Figure @ref(fig:binary-classification-result-mistral-plot) shows, the
classification performance for Mistral 8B 2410 in detail. It shows the
F1 score for each target type over the models runtime. It shows the
results for the different prompting strategies (<em>method_families</em>) with
differently colored shapes. The <em>zero_shot</em> strategy performs worst with
a F1 score below 0.6. Next come the <em>law_context</em> and
<em>top_n_rag_examples</em> strategy. Above those the <em>n_random_examples</em> and
finally the <em>n_rag_examples</em> strategy perform best.</p>
<p>The shape is giving information, if the example proveded to the
<a href="#acronyms_LLM">LLM</a> are selected from other companies than the target table comes
from only, or if they can also be selected from documents of the same
company. This is only relevant for strategies that get the examples
picked by the documents vector embedding distances. The <a href="#acronyms_LLM">LLM</a>
performs better<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a>, if examples from documents of the same
company can be used. If this is not permitted, the <em>n_random_example</em>
approach performs better than the <em>n_rag_example</em> for the classification
of <strong>GuV</strong> and <strong>Passiva</strong> tables.</p>
<p>The number inside of the shapes is referring to the <em>n_examples</em>
function parameter. Most models got benchmarked with an <em>n_examples</em>
value of up to three. The actual number of examples provided to the
models is depending on the method family / example selection strategy
and can be looked up in Table
@ref(tab:comparing-actual-number-of-in-context-examples).</p>
<p>The best performing model, Mistral 8B 2410, was provided with mode
examples to investigate the effect of a richer context. The predictions
do not get better by providing more and more examples. Figure
@ref(fig:binary-classification-result-mistral-plot) shows, that the
improvements get smaller naturally going from three to five examples
while approaching an F1 score of 1.0.</p>
<p>But for the <em>n_rag_example</em> strategy we find a significant drop in the
F1 score, if we set the <em>n_examples</em> to five<a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a> and
examples pages come from annual reports of other companies. This is
caused by a sever recall drop. For the <em>n_random_example</em> strategy we
see a small drop with the F1 score for the class <strong>Passiva</strong> as well.
Taking into account that the runtime also almost is twice as high, this
is very inefficient.</p>
<p>Figure @ref(fig:binary-classification-result-mistral-plot) also shows,
that the results are stable<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a>. Running the benchmark three
times shows similar results in the F1 score for each strategy. This is
reflected by closely overlapping shapes of the same color with the same
number within.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, loop <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>),</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/binary-classification-result-mistral-plot-1.png" alt="Showing F1 score performance over normalized runtime for binary classification for Mistral-8B-Instruct-2410." width="100%" />
<p class="caption">
(#fig:binary-classification-result-mistral-plot)Showing F1 score performance over normalized runtime for binary classification for Mistral-8B-Instruct-2410.
</p>
</div>
<p>Figure
@ref(fig:binary-classification-result-mistral-many-random-examples-plot)
shows the experiments for Ministral-8B-Instruct-2410 with <em>n_examples</em>
greater or equal three. This time the actual number of examples provided
to the <a href="#acronyms_LLM">LLM</a> are shown in the shapes to increase the comparability
among the different strategies. Additionally, it shows results for the
<em>top_n_rag_example</em> strategy with <em>n_examples</em> up to 13. The F1 score of
the <em>top_n_rag_example</em> strategy stays lower than the F1 score of the
<em>n_rag_examples</em> strategy, even though there are more examples used.
This is mainly caused by lower precision scores, probably because there
are no contrasting examples provided.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df_classification_n_examples, <span class="at">by =</span> <span class="fu">c</span>(</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="st">&quot;method_family&quot;</span> <span class="ot">=</span> <span class="st">&quot;approach&quot;</span>, </span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="st">&quot;n_examples&quot;</span> <span class="ot">=</span> <span class="st">&quot;n_example&quot;</span>, </span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="st">&quot;classifier_type&quot;</span> <span class="ot">=</span> <span class="st">&quot;classification&quot;</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">sum_examples =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, loop <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> sum_examples)) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>),</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/binary-classification-result-mistral-many-random-examples-plot-1.png" alt="Showing F1 score performance over normalized runtime for binary classification for Mistral-8B-Instruct-2410. Comparing the performance based on the real number of provided examples." width="100%" />
<p class="caption">
(#fig:binary-classification-result-mistral-many-random-examples-plot)Showing F1 score performance over normalized runtime for binary classification for Mistral-8B-Instruct-2410. Comparing the performance based on the real number of provided examples.
</p>
</div>
<p>Figure @ref(fig:binary-classification-performance-over-runtime) and
Figure
@ref(fig:binary-classification-performance-over-runtime-full-time)
shows the F1 performance over normalized rundtime for all benchmarked
models. Comparing Mistral-8B-Instruct-2410 with
Mistral-124B-Instruct-2411 shows that one can spend over tenfold amount
of computation power without getting better results.</p>
<p>It also shows, that with Qwen 2.5 it needs at least the 3B parameter
model to achieve good results. Comparing the 32B and 72B parameter
models shows, that th performance does not increase anymore, but starts
to decrease. For Qwen 3 it shows, that only the newer mix of experts
models give reasonable results.</p>
<p>The mix of expert models show good performance for the Llama 4 family as
well and reduce the compute time compared with the 72B models of LLama
3. But for LLama 4 Maverick the performance drops using the
<em>n_rag_examples</em> strategy with three <em>n_examples</em>. The performance of
Llama 3.1 70B was higher than the performance of Llama 3.3 70B.</p>
<p>Summary:</p>
<p>Neither do newer generations always improve the performance for the
binary classification task, nor do more parameters always improve or at
least show stable performance.</p>
</div>
<div id="multi-class-classification" class="section level3 hasAnchor" number="8.3.2">
<h3 class="hasAnchor"><span class="header-section-number">8.3.2</span> Multi-class classification<a href="#multi-class-classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table @ref(tab:table-metrics-llm-page-identification-multi) shows that
Llama-4-Scout solves the <a href="#acronyms_mcc">mcc</a> task almost perfect for all classes.
Mistral-Large-Instruct-2411 performs second best. In contrast to the
binary classification task no order is visible, what class was easiest
to predict. Googles gemma models perform much better in the <a href="#acronyms_mcc">mcc</a>
task with F1 scores of 0.89 instead of 0.58 for the binary
classification task.</p>
<p>Table
@ref(tab:table-metrics-llm-page-identification-multi-small-models)
shows that the smaller models do perform good, too. Ministral-8B
performs good but is around tenfold faster than Mistral-Large and
Llama-4 Scout. For the larger models the <em>n_rag_examples</em> strategy is
performing best. For the smaller models the <em>top_n_rag_examples</em>
strategy is performing good as well and is faster because of shorter
contexts.</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>top_performer_multu <span class="sc">%&gt;%</span> <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llllrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Overview of benchmarked LLMs for the multi-class classification tasks. Limiting the number of examples provided for the few shot approach to 3.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-page-identification-multi)Overview of benchmarked LLMs for the multi-class classification tasks. Limiting the number of examples provided for the few shot approach to 3.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1789610d8fab7aa1638e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1789610d8fab7aa1638e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["meta-llama","meta-llama","mistralai","meta-llama","mistralai","Qwen","Qwen","Qwen","mistralai","google","google","google","tiiuae","tiiuae","microsoft","microsoft","tiiuae","microsoft"],["Llama-4-Scout-17B-16E-Instruct","Llama-4-Scout-17B-16E-Instruct","Mistral-Large-Instruct-2411","Llama-4-Scout-17B-16E-Instruct","Mistral-Large-Instruct-2411","Qwen2.5-32B-Instruct","Qwen3-235B-A22B-Instruct-2507","Qwen2.5-72B-Instruct","Mistral-Large-Instruct-2411","gemma-3-27b-it-0-9-1","gemma-3-27b-it-0-9-1","gemma-3-27b-it-0-9-1","Falcon3-10B-Instruct","Falcon3-10B-Instruct","phi-4","phi-4","Falcon3-10B-Instruct","phi-4"],["Aktiva","GuV","Passiva","Passiva","Aktiva","Aktiva","GuV","Passiva","GuV","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","Aktiva","Passiva","GuV"],["n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples"],["3","1","1","3","3","3","3","1","1","3","1","1","1","3","2","1","3","1"],["1","1","0.99","0.99","0.98","0.98","0.97","0.97","0.96","0.89","0.82","0.79","0.71","0.71","0.67","0.6","0.59","0.46"],["4451","2541","7061","4451","18744","5664","11164","3908","7061","4297","2606","2606","868","2393","1660","493","494","1725"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>metric type<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>f1 score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-left"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"metric type","targets":3},{"name":"method family","targets":4},{"name":"n examples","targets":5},{"name":"f1 score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="fu">filter</span>(parameter_count<span class="sc">&lt;</span><span class="dv">17</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>  <span class="fu">filter</span>(f1_score <span class="sc">==</span> <span class="fu">max</span>(f1_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="co"># head(10) %&gt;% </span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, metric_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llllrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Overview of benchmarked LLMs for the multi-class classification tasks focussing on models with less than 17B parameters. Limiting the number of examples provided for the few shot approach to 3.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-page-identification-multi-small-models)Overview of benchmarked LLMs for the multi-class classification tasks focussing on models with less than 17B parameters. Limiting the number of examples provided for the few shot approach to 3.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9e34617023c152e836d8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9e34617023c152e836d8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["mistralai","mistralai","mistralai","meta-llama","Qwen","meta-llama","google","Qwen","Qwen","tiiuae","tiiuae","google","microsoft","meta-llama","microsoft","tiiuae","google","microsoft"],["Ministral-8B-Instruct-2410","Ministral-8B-Instruct-2410","Ministral-8B-Instruct-2410","Llama-3.1-8B-Instruct","Qwen2.5-3B-Instruct","Llama-3.1-8B-Instruct","gemma-3-12b-it-0-9-1","Qwen2.5-3B-Instruct","Qwen2.5-3B-Instruct","Falcon3-10B-Instruct","Falcon3-10B-Instruct","gemma-3-12b-it-0-9-1","phi-4","Llama-3.1-8B-Instruct","phi-4","Falcon3-10B-Instruct","gemma-3-12b-it-0-9-1","phi-4"],["Aktiva","Passiva","GuV","Passiva","Aktiva","Aktiva","Aktiva","Passiva","GuV","GuV","Aktiva","Passiva","Passiva","GuV","Aktiva","Passiva","GuV","GuV"],["n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples"],["1","3","3","1","1","3","3","1","1","1","3","3","2","1","1","3","1","1"],["0.98","0.96","0.95","0.95","0.86","0.86","0.85","0.83","0.76","0.71","0.71","0.69","0.67","0.65","0.6","0.59","0.47","0.46"],["686","279","279","593","492","269","2733","187","492","868","2393","2733","1660","205","493","494","232","1725"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>metric type<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>f1 score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-left"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"metric type","targets":3},{"name":"method family","targets":4},{"name":"n examples","targets":5},{"name":"f1 score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<p>Figure
@ref(fig:performance-over-runtime-multi-classification-mistral-vs-llama-scout)
shows, the micro averaged F1 score for the three minority classes over
the normalized runtime for two models. It shows the results for the
different prompting strategies (<em>method_families</em>) with differently
colored shapes.</p>
<p>The shape is giving information, if the examples provided to the
<a href="#acronyms_LLM">LLM</a>, are exclusively selected from other companies than the target
table comes from, or if they can also be selected from documents of the
same company. This is only relevant for strategies that get the examples
picked by the documents vector embedding distances (<em>top_n_rag_examples</em>
and <em>n_rag_examples</em>). The <a href="#acronyms_LLM">LLM</a> performs better, if examples from
documents of the same company can be used.</p>
<p>The number inside of the shapes is referring to the <em>n_examples</em>
function parameter. Most models got benchmarked with an <em>n_examples</em>
value of up to three. The actual number of examples provided to the
models is depending on the method family / example selection strategy
and can be looked up in Table
@ref(tab:comparing-actual-number-of-in-context-examples).</p>
<p><em>n_rag_examples</em> better for Llama 4 Scout than <em>n_random_examples</em> ; For
Ministral it is depending on the <em>out_of_company</em> setting</p>
<p>On can see, that Ministral–8B 2410 reaches a good performance already
with few examples, but only if <em>out_of_company</em> is false. It performs
moderate with the <em>law-context</em> strategy and <em>zero_shot</em>, too. Adding
more examples does not improve the performance. Best with
<em>top_n_rag_examples</em></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>df_selected <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">==</span> <span class="st">&quot;micro_minorities&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>df_selected <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    <span class="co"># &quot;Mistral-Large-Instruct-2411&quot;,</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    <span class="co"># &quot;Mistral-Small-3.1-24B-Instruct-2503&quot;,</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>    <span class="co"># &quot;Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  ),</span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  loop <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  n_examples <span class="sc">&lt;=</span> <span class="dv">9</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>metric_type) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>) <span class="co">#+</span></span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/performance-over-runtime-multi-classification-mistral-vs-llama-scout-1.png" alt="Comparing F1 score micro averaged for the minority classes for two models over their normalized runtime." width="100%" />
<p class="caption">
(#fig:performance-over-runtime-multi-classification-mistral-vs-llama-scout)Comparing F1 score micro averaged for the minority classes for two models over their normalized runtime.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="co"># guides(</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="co">#   color = guide_legend(ncol = 1, title.position = &quot;top&quot;),</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="co">#   shape = guide_legend(ncol = 1, title.position = &quot;top&quot;)</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  <span class="co"># scale_x_discrete(guide = guide_axis(angle = 30))</span></span></code></pre></div>
</details>
</div>
</div>
<div id="tf-classifier" class="section level2 hasAnchor" number="8.4">
<h2 class="hasAnchor"><span class="header-section-number">8.4</span> Term frequency based classifier<a href="#tf-classifier" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The fourth approach uses term frequencies for a key word list and the
number of floats to rank pages. The approach is inspired by
<a href="#acronyms_TF-IDF">TF-IDF</a> - a technique commonly used for information retrieval. It
is similar to the baseline approach, because it uses a key word list and
regular expressions to count terms and floats. But it is more flexible
because the works in the key word list are not mandatory. This makes the
approach robust against issues in the text extracts for single key
words.</p>
<p>The key word list is generated removing the stop words from the law
about <strong>Aktiva</strong>, <strong>Passiva</strong> and <strong>GuV</strong>. The key words from the
<a href="#acronyms_regex">regex</a> approach are added, e.g. <em>GuV</em> and <em>Gewinn- und
Verlustrechnung</em>. Since real life representations of those target types
never contain all entries, it is not possible to include most of those
words in a strict <a href="#acronyms_regex">regex</a> search as presented in the first approach.</p>
<p>This approach sums the counts of each word from the key word list per
page in a first variable. In a second variable it counts the number of
floats on each page. These two variables are then divided by the number
of words found on the page. These densities are used to rank all pages
from a single document. This is done with a unique key word list for
each target type.</p>
<p>A random forest is trained to determine which density should be weighted
to what amount. Because of the imbalanced data set undersampling is used
when the training data set is created<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a>. A single random
forest is trained because the density of floats and specific words is
assumed to be similar. The actual type of the page is not taken into
account. The model just knows if the page is a page of any target type,
based on the term and float density. This trippels the data points of
the target class.</p>
<p>This single random forest performs much better than random forests that
are trained using the dataset for each target type separatly. The
performance is tested on all data points not included in the
undersampled train dataset. Thus the test dataset is again highly
imbalanced.</p>
<p>The random forest performs a binary classification task. But instead of
the actual classifications, the predicted scores are used to rank the
pages. Instead of precision or recall the metric used for the evaluation
is top k recall. It is of interest which value of k is required to get a
recall of 100 %.</p>
<p>The code can be found at:
“benchmark_jobs/page_identification/term_frequency.ipynb”</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a>)</span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb34-32"><a href="#cb34-32" tabindex="-1"></a>clf.fit(X_train, y_train)</span>
<span id="cb34-33"><a href="#cb34-33" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_train, y_train)</span>
<span id="cb34-34"><a href="#cb34-34" tabindex="-1"></a><span class="co"># print(f&quot;Training accuracy: {score:.2%}&quot;)</span></span>
<span id="cb34-35"><a href="#cb34-35" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_test, y_test)</span>
<span id="cb34-36"><a href="#cb34-36" tabindex="-1"></a><span class="co"># print(f&quot;Test accuracy: {score:.2%}&quot;)</span></span>
<span id="cb34-37"><a href="#cb34-37" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb34-39"><a href="#cb34-39" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb34-40"><a href="#cb34-40" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb34-41"><a href="#cb34-41" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb34-43"><a href="#cb34-43" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb34-44"><a href="#cb34-44" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb34-45"><a href="#cb34-45" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values)[:, <span class="dv">1</span>]</span>
<span id="cb34-46"><a href="#cb34-46" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb34-47"><a href="#cb34-47" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb34-49"><a href="#cb34-49" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-50"><a href="#cb34-50" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb34-52"><a href="#cb34-52" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb34-53"><a href="#cb34-53" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<ul>
<li>top 1</li>
<li>top k</li>
</ul>
<p>low precision llm linked to position of correct page? numeric frequency?</p>
<p>Figure @ref(fig:forest-map-tf-2-predictors) shows how the test data
points are distributed in the two dimensional value map for the random
forest with two predictors. The target pages have a <em>float_frequncy</em>
between 0.2 and 0.5 and pages with a <em>term_frequency</em> value over 0.07
get classified as target. One target page shows a lower <em>term_frequency</em>
and thus does not get ranked correct. (recall, precision?)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> DecisionBoundaryDisplay</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>]</span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>clf <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">&#39;data_storage/rf-tf-2preds.sav&#39;</span>, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.read_csv(<span class="st">&quot;data_storage/term_frequency_results_2_predictors_test.csv&quot;</span>)</span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a>X <span class="op">=</span> df_test_split[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>cm <span class="op">=</span> plt.cm.RdBu</span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>cm_bright <span class="op">=</span> ListedColormap([<span class="st">&quot;#FF0000&quot;</span>, <span class="st">&quot;#0000FF&quot;</span>])</span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>x_min, x_max <span class="op">=</span> X[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.05</span>, X[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.05</span></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a>y_min, y_max <span class="op">=</span> X[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.05</span>, X[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.05</span></span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a>catch_this_message <span class="op">=</span>DecisionBoundaryDisplay.from_estimator(</span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>    clf, X, cmap<span class="op">=</span>cm, alpha<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax, eps<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a>)</span>
<span id="cb35-32"><a href="#cb35-32" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" tabindex="-1"></a>df_test_split_sorted <span class="op">=</span> df_test_split.sort_values(<span class="st">&#39;is_truth&#39;</span>)</span>
<span id="cb35-34"><a href="#cb35-34" tabindex="-1"></a>X_test <span class="op">=</span> df_test_split_sorted[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb35-35"><a href="#cb35-35" tabindex="-1"></a>y_test <span class="op">=</span> df_test_split_sorted[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb35-36"><a href="#cb35-36" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_test, y_test)</span>
<span id="cb35-37"><a href="#cb35-37" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" tabindex="-1"></a><span class="co"># ax.scatter(X_train[:, 0], X_train[:, 1], c=y_train, cmap=cm_bright, edgecolors=&quot;k&quot;, label=&quot;Train&quot;)</span></span>
<span id="cb35-39"><a href="#cb35-39" tabindex="-1"></a>ax.scatter(X_test[:, <span class="dv">0</span>], X_test[:, <span class="dv">1</span>], c<span class="op">=</span>y_test, cmap<span class="op">=</span>cm_bright, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">&quot;k&quot;</span>, label<span class="op">=</span><span class="st">&quot;Test&quot;</span>)</span>
<span id="cb35-40"><a href="#cb35-40" tabindex="-1"></a>catch_this_message <span class="op">=</span>ax.set_xlim(x_min, x_max)</span>
<span id="cb35-41"><a href="#cb35-41" tabindex="-1"></a>catch_this_message <span class="op">=</span>ax.set_ylim(y_min, y_max)</span>
<span id="cb35-42"><a href="#cb35-42" tabindex="-1"></a>ax.set_xlabel(<span class="st">&quot;term_frequency&quot;</span>)</span>
<span id="cb35-43"><a href="#cb35-43" tabindex="-1"></a>ax.set_ylabel(<span class="st">&quot;float_frequency&quot;</span>)</span>
<span id="cb35-44"><a href="#cb35-44" tabindex="-1"></a>ax.set_title(<span class="ss">f&quot;RandomForestClassifier (accuracy=</span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb35-45"><a href="#cb35-45" tabindex="-1"></a>plt.legend()</span>
<span id="cb35-46"><a href="#cb35-46" tabindex="-1"></a>plt.show()</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/forest-map-tf-2-predictors-1.png" alt="Classification map showing which score a data point gets based on its term and float frequency and which type the data points in the test dataset actually have." width="768" />
<p class="caption">
(#fig:forest-map-tf-2-predictors)Classification map showing which score a data point gets based on its term and float frequency and which type the data points in the test dataset actually have.
</p>
</div>
<p>A second random forest is trained supplementing the two predictors <em>term
density</em> and <em>float density</em> with two additional predictors: <em>date
count</em> and <em>integer count</em>. Figure
@ref(fig:top-n-recall-term-frequency) shows the top n recall for both
random forests. On the left side the top n recall on the imbalanced test
dataset is shown. On the right side the performance on the train
dataset.</p>
<p>Both random forests perform similar on the train dataset. The random
forest with four predictors reaches perfect recall faster for <strong>Aktiva</strong>
on the test dataset. Thus, with <span class="math inline">\(n = 5\)</span> 100 % recall is reached for the
random forest with four predictors. With the random forest with two
predictors it needs <span class="math inline">\(n = 7\)</span>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>df_2_predictors_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_2_predictors_test.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;test&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">2</span>)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>df_2_predictors_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_2_predictors_train.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;train&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">2</span>)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>df_4_predictors_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_4_predictors_test.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;test&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">4</span>)</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>df_4_predictors_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_4_predictors_train.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;train&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">4</span>)</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>df_rf_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>  df_2_predictors_train, df_2_predictors_test,</span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>  df_4_predictors_train, df_4_predictors_test</span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>  )</span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>max_rank <span class="ot">=</span> df_rf_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(is_truth <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rank) <span class="sc">%&gt;%</span> <span class="fu">max</span>()</span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>max_rank, <span class="cf">function</span>(i_rank) {</span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a>  df_rf_results <span class="sc">%&gt;%</span> </span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a>    <span class="fu">filter</span>(is_truth <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a>    <span class="fu">group_by</span>(type, data_split, n_predictors) <span class="sc">%&gt;%</span> </span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">le =</span> <span class="fu">if_else</span>(rank <span class="sc">&lt;=</span> i_rank, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(le), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-22"><a href="#cb36-22" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">i_rank =</span> i_rank)</span>
<span id="cb36-23"><a href="#cb36-23" tabindex="-1"></a>})</span>
<span id="cb36-24"><a href="#cb36-24" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb36-26"><a href="#cb36-26" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> i_rank, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb36-27"><a href="#cb36-27" tabindex="-1"></a>  <span class="fu">facet_nested</span>(type <span class="sc">~</span> data_split <span class="sc">+</span> n_predictors) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-29"><a href="#cb36-29" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;rank&quot;</span>,</span>
<span id="cb36-30"><a href="#cb36-30" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;top n recall&quot;</span>,</span>
<span id="cb36-31"><a href="#cb36-31" tabindex="-1"></a>    <span class="co"># title = &quot;Top n recall for different ranks, data splits and number of predictors&quot;</span></span>
<span id="cb36-32"><a href="#cb36-32" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/top-n-recall-term-frequency-1.png" alt="Comparing the top n recall on training and test dataset among the random forest with two and four predictors." width="672" />
<p class="caption">
(#fig:top-n-recall-term-frequency)Comparing the top n recall on training and test dataset among the random forest with two and four predictors.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a>]</span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[predictors].values <span class="co"># only better with date and integer counts; otherwise worse</span></span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a>)</span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb37-40"><a href="#cb37-40" tabindex="-1"></a>catch_this_message <span class="op">=</span>clf.fit(X_train, y_train)</span>
<span id="cb37-41"><a href="#cb37-41" tabindex="-1"></a></span>
<span id="cb37-42"><a href="#cb37-42" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb37-43"><a href="#cb37-43" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb37-44"><a href="#cb37-44" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb37-45"><a href="#cb37-45" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb37-47"><a href="#cb37-47" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb37-48"><a href="#cb37-48" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb37-49"><a href="#cb37-49" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[predictors].values)[:, <span class="dv">1</span>]</span>
<span id="cb37-50"><a href="#cb37-50" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb37-51"><a href="#cb37-51" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb37-53"><a href="#cb37-53" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-54"><a href="#cb37-54" tabindex="-1"></a></span>
<span id="cb37-55"><a href="#cb37-55" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb37-56"><a href="#cb37-56" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb37-57"><a href="#cb37-57" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<p>Figure @ref(fig:shap-tf-4-predictors) shows that the two additional
predictors <em>date_count</em> and <em>integer_count</em> have little importance. But
since it is computationally cheap to determine their value and the
effiency of a random forest classifier, there is little reason not to
use them.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>]</span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>clf <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">&#39;data_storage/rf-tf-4preds.sav&#39;</span>, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.read_csv(<span class="st">&quot;data_storage/term_frequency_results_4_predictors_test.csv&quot;</span>)</span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="co"># Use the same predictors and trained RandomForestClassifier (clf) as in cell 20</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(clf)</span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(df_test_split[predictors].values)</span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a><span class="co"># Plot summary for class 1 (is_truth == 1)</span></span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a>shap.summary_plot(shap_values[:,:,<span class="dv">1</span>], df_test_split[predictors].values, feature_names<span class="op">=</span>predictors)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/shap-tf-4-predictors-1.png" alt="Beeswarm plot of SHAP importance values for the four predictors of the second random forest classifier." width="768" />
<p class="caption">
(#fig:shap-tf-4-predictors)Beeswarm plot of SHAP importance values for the four predictors of the second random forest classifier.
</p>
</div>
<p>Fianlly, figure @ref(fig:micro-pr-curve-tf-4-predictors) shows the
precision-recall-curves for the term frequency approach for all three
target types. The <a href="#acronyms_AUC">AUC (area under the curve)</a> for all types is below 0.5. The precision
and F1 score stay below 0.5 as well. A high recall can be maintained for
all types for threshold values up to at least 0.72.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>plot_pr_double_curve_tf <span class="ot">&lt;-</span> <span class="cf">function</span>(df, selected_type, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  df_temp2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    n_predictors <span class="sc">==</span> <span class="dv">4</span>, data_split <span class="sc">==</span> <span class="st">&quot;test&quot;</span>,</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>    type <span class="sc">==</span> selected_type</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>      <span class="at">confidence_score =</span> score</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>      <span class="at">type =</span> <span class="fu">factor</span>(is_truth, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>    )</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>  </span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>  <span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>  </span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>  pr_df <span class="ot">&lt;-</span> df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_curve</span>(type, confidence_score) <span class="sc">%&gt;%</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">threshold =</span> .threshold) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold<span class="sc">&lt;=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>  </span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>  pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_auc</span>(type, confidence_score) <span class="sc">%&gt;%</span> .<span class="sc">$</span>.estimate, <span class="dv">3</span>)</span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>  best_F1_row <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>  best_F1_row_high_recall <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> </span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>    <span class="fu">filter</span>(recall <span class="sc">&gt;</span> <span class="fl">0.999</span>, precision <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>  best_F1 <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>  best_F1_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>  best_threshold <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>  best_threshold_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>  best_precision_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(precision)</span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>  </span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Precision-Recall Curve for &quot;</span>, selected_type, <span class="st">&quot; (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>    )</span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>  </span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb39-46"><a href="#cb39-46" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb39-47"><a href="#cb39-47" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb39-48"><a href="#cb39-48" tabindex="-1"></a>      <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb39-49"><a href="#cb39-49" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb39-50"><a href="#cb39-50" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb39-51"><a href="#cb39-51" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb39-52"><a href="#cb39-52" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb39-53"><a href="#cb39-53" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb39-54"><a href="#cb39-54" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb39-55"><a href="#cb39-55" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb39-56"><a href="#cb39-56" tabindex="-1"></a>    ) </span>
<span id="cb39-57"><a href="#cb39-57" tabindex="-1"></a>  </span>
<span id="cb39-58"><a href="#cb39-58" tabindex="-1"></a>  <span class="cf">if</span> (x_stuff <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb39-59"><a href="#cb39-59" tabindex="-1"></a>    g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb39-60"><a href="#cb39-60" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb39-61"><a href="#cb39-61" tabindex="-1"></a>    </span>
<span id="cb39-62"><a href="#cb39-62" tabindex="-1"></a>    g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb39-63"><a href="#cb39-63" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb39-64"><a href="#cb39-64" tabindex="-1"></a>  }</span>
<span id="cb39-65"><a href="#cb39-65" tabindex="-1"></a>  </span>
<span id="cb39-66"><a href="#cb39-66" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> g1 <span class="sc">+</span> g2</span>
<span id="cb39-67"><a href="#cb39-67" tabindex="-1"></a>  combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb39-68"><a href="#cb39-68" tabindex="-1"></a>    <span class="st">&#39;Best F1 score of &#39;</span>, <span class="fu">round</span>(best_F1,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold,<span class="dv">3</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>,</span>
<span id="cb39-69"><a href="#cb39-69" tabindex="-1"></a>    <span class="st">&#39;Best F1 score with recall &gt; 0.999 of &#39;</span>, <span class="fu">round</span>(best_F1_high_recall,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold_high_recall,<span class="dv">3</span>), <span class="st">&#39; (corresp. precision value: &#39;</span>, <span class="fu">round</span>(best_precision_high_recall,<span class="dv">3</span>) , <span class="st">&#39;)&#39;</span>))</span>
<span id="cb39-70"><a href="#cb39-70" tabindex="-1"></a>}</span>
<span id="cb39-71"><a href="#cb39-71" tabindex="-1"></a></span>
<span id="cb39-72"><a href="#cb39-72" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_rf_results</span>
<span id="cb39-73"><a href="#cb39-73" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_tf</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-75"><a href="#cb39-75" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_tf</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-76"><a href="#cb39-76" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_tf</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-77"><a href="#cb39-77" tabindex="-1"></a><span class="co"># p_other &lt;- df_temp_mistral_multi %&gt;% plot_pr_double_curve_multi(&quot;other&quot;, x_stuff = TRUE)</span></span>
<span id="cb39-78"><a href="#cb39-78" tabindex="-1"></a></span>
<span id="cb39-79"><a href="#cb39-79" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb39-80"><a href="#cb39-80" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb39-81"><a href="#cb39-81" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Random forest with four predictors&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/micro-pr-curve-tf-4-predictors-1.png" alt="Showing the precsion-recall-curve for the random forest with four predictors." width="100%" />
<p class="caption">
(#fig:micro-pr-curve-tf-4-predictors)Showing the precsion-recall-curve for the random forest with four predictors.
</p>
</div>
</div>
<div id="summary-2" class="section level2 hasAnchor" number="8.5">
<h2 class="hasAnchor"><span class="header-section-number">8.5</span> Summary<a href="#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--chapter:end:09_Page_Identification.Rmd-->
</div>
</div>
<div id="appendix-b---information-extraction-report" class="section level1 hasAnchor" number="9">
<h1 class="hasAnchor"><span class="header-section-number">9</span> Appendix B - Information extraction report<a href="#appendix-b---information-extraction-report" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>(ref:information-extraction-intro-text)</p>
<div id="baseline-regex" class="section level2 hasAnchor" number="9.1">
<h2 class="hasAnchor"><span class="header-section-number">9.1</span> Baseline: Regex<a href="#baseline-regex" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The baseline for the table extraction task is set by an approach using
regular expressions on the text extract. Figure
@ref(fig:table-extraction-regex-performance) shows the performance of
this approach. In the first row (A) the percentage of correct predicted
numeric values and the percentage of total correct responses is shown.
The second row (B) shows the precision, recall and F1 score for
identifying a value as missing and thus predicting <em>null</em>. The
percentage of total correct responses is calculated as</p>
<p><span class="math display">\[
percentage\_correct\_total = \frac{n_{correct\_numeric} + n_{missing\_true\_positive}}{n_{total\_entries}}
\]</span></p>
<p>with <span class="math inline">\(n_{total\_entries} = 58\)</span> . This implies that the correct
prediction of missing values has more influence for tables, that have
only a few numeric values in the ground truth. The minimal number of
numeric values in a tables is ten. Figure
@ref(fig:display-extraction-metrics-full-NA) shows, that the percentage
of total correct responses is not a sufficient metric, because responses
that only predicted <em>null</em> can have a high score if there are only a few
numeric values in the ground truth table.</p>
<div id="performance-1" class="section level5 hasAnchor paragraph-start" number="9.1.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">9.1.0.0.1</span> Performance<a href="#performance-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In each frame there are two groups of two box-plots. The left group is
showing the performance on real <strong>Aktiva</strong> tables. The right group shows
the performance on synthetic <strong>Aktiva</strong> tables. Within the group the
green (left) box shows the performance on text extracted with the
<em>pdfium</em> library. The peach colored (right) box shows the performance on
text extracted with the <em>pymupdf</em> library.</p>
</div>
<p>Figure @ref(fig:table-extraction-regex-performance) shows, that the
<a href="#acronyms_regex">regex</a> approach performs better<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a> on the synthetic
tables compared to the real tables. Even though, the performance is not
perfect and more consistent on the text extracted with <em>pymupdf</em>
compared to <em>pdfium</em>. In contrast, the used text extraction library has
no noticeable influence on the real <strong>Aktiva</strong> tables.</p>
<p>The performance for the <a href="#acronyms_regex">regex</a> based table extraction is much
better than the <a href="#acronyms_regex">regex</a> based page identification performance. The
median performance scores of the <a href="#acronyms_regex">regex</a> approaches will be
reflected by a dashed line in the box-plots in subsequent sections. The
scores for the real <strong>Aktiva</strong> table extraction are:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>table_extraction_regex_baseline_medians <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>  <span class="fu">across</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Summarizing the median performance of the regex approaches for the real and synthetic table extracion task.&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-extraction-regex-baseline-medians)Summarizing the median performance of the regex approaches for the real and synthetic table extracion task.
</caption>
<thead>
<tr>
<th style="text-align:left;">
measure
</th>
<th style="text-align:right;">
real_mean
</th>
<th style="text-align:right;">
real_median
</th>
<th style="text-align:right;">
synthetic_mean
</th>
<th style="text-align:right;">
synthetic_median
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
percentage of correct predictions total
</td>
<td style="text-align:right;">
0.686
</td>
<td style="text-align:right;">
0.707
</td>
<td style="text-align:right;">
0.969
</td>
<td style="text-align:right;">
0.966
</td>
</tr>
<tr>
<td style="text-align:left;">
percentage of correct numeric predictions
</td>
<td style="text-align:right;">
0.778
</td>
<td style="text-align:right;">
0.909
</td>
<td style="text-align:right;">
0.973
</td>
<td style="text-align:right;">
0.966
</td>
</tr>
<tr>
<td style="text-align:left;">
F1 score
</td>
<td style="text-align:right;">
0.789
</td>
<td style="text-align:right;">
0.800
</td>
<td style="text-align:right;">
0.979
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df_table_extraction_regex <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(table_type, percentage_correct_numeric, percentage_correct_total, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(table_type, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="co"># geom_point(</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="co">#   data= . %&gt;% filter(table_type == &quot;real_tables&quot;, name == &quot;percentage_correct_numeric&quot;),</span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>  <span class="co">#   aes(x = table_type, y = value, alpha = extraction_backend), color = &quot;#264DEB&quot;,</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  <span class="co">#   shape = 4, position=position_jitterdodge(dodge.width=0.9, jitter.width = 0.2, jitter.height = 0.005)</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> table_type, <span class="at">y =</span> value, <span class="at">fill =</span> extraction_backend), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a>  <span class="co"># geom_jitter(data= . %&gt;% filter(table_type == &quot;real_tables&quot;), aes(x = table_type, y = value, color = T_EUR), alpha = .8, height = 0, shape = 4) +</span></span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, ncol = 1) +</span></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#94EB1F&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>name) <span class="sc">+</span></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a>  )</span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> df_table_extraction_regex <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(table_type, NA_precision, NA_recall, NA_F1, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(table_type, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> table_type, <span class="at">y =</span> value, <span class="at">fill =</span> extraction_backend), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-25"><a href="#cb41-25" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-26"><a href="#cb41-26" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#94EB1F&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb41-27"><a href="#cb41-27" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb41-28"><a href="#cb41-28" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>name)</span>
<span id="cb41-29"><a href="#cb41-29" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="st">&quot;ac </span><span class="sc">\n</span><span class="st"> bb&quot;</span></span>
<span id="cb41-31"><a href="#cb41-31" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">guide_area</span>() <span class="sc">+</span> </span>
<span id="cb41-33"><a href="#cb41-33" tabindex="-1"></a>  <span class="fu">plot_layout</span>(</span>
<span id="cb41-34"><a href="#cb41-34" tabindex="-1"></a>    <span class="at">design =</span> design, </span>
<span id="cb41-35"><a href="#cb41-35" tabindex="-1"></a>    <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>, </span>
<span id="cb41-36"><a href="#cb41-36" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb41-37"><a href="#cb41-37" tabindex="-1"></a>  ) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&#39;A&#39;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-regex-performance-1.png" alt="Performance overall and on numeric value extraction with regular expressions." width="100%" />
<p class="caption">
(#fig:table-extraction-regex-performance)Performance overall and on numeric value extraction with regular expressions.
</p>
</div>
</div>
<div id="extraction-with-llms-real-tables" class="section level2 hasAnchor" number="9.2">
<h2 class="hasAnchor"><span class="header-section-number">9.2</span> Extraction with LLMs<a href="#extraction-with-llms-real-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>df_real_table_extraction <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_extended_llm.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;deepseek-ai_DeepSeek-R1-Distill-Qwen-32B&quot;</span>, <span class="st">&#39;google_gemma-3n-E4B-it&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model),</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>    <span class="at">company =</span> <span class="fu">map_chr</span>(filepath, <span class="sc">~</span><span class="fu">str_split</span>(<span class="fu">str_split</span>(., <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">5</span>], <span class="st">&quot;__&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(company <span class="sc">!=</span> <span class="st">&quot;MEAB GmbH&quot;</span>)</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>df_real_table_extraction_synth <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_extended_synth.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model),</span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>    <span class="at">company =</span> <span class="fu">map_chr</span>(filepath, <span class="sc">~</span><span class="fu">str_split</span>(<span class="fu">str_split</span>(., <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">5</span>], <span class="st">&quot;__&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(company <span class="sc">!=</span> <span class="st">&quot;MEAB GmbH&quot;</span>)</span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>df_real_table_extraction_azure <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_extended_azure.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model),</span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a>    <span class="at">company =</span> <span class="fu">map_chr</span>(filepath, <span class="sc">~</span><span class="fu">str_split</span>(<span class="fu">str_split</span>(., <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">5</span>], <span class="st">&quot;__&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(company <span class="sc">!=</span> <span class="st">&quot;MEAB GmbH&quot;</span>)</span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a>model_by_size <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a>  <span class="st">&#39;gemma-3-4b-it&#39;</span>, <span class="co">#&#39;gemma-3n-E4B-it&#39;, </span></span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a>  <span class="st">&quot;gemma-3-12b-it&quot;</span>, <span class="st">&quot;gemma-3-27b-it&quot;</span>,</span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a>  <span class="st">&quot;gpt-oss-20b&quot;</span>, <span class="st">&quot;gpt-oss-120b&quot;</span>,</span>
<span id="cb42-22"><a href="#cb42-22" tabindex="-1"></a>  <span class="st">&quot;Llama-3.1-8B-Instruct&quot;</span>, <span class="st">&quot;Llama-3.1-70B-Instruct&quot;</span>, <span class="st">&quot;Llama-3.3-70B-Instruct&quot;</span>,</span>
<span id="cb42-23"><a href="#cb42-23" tabindex="-1"></a>  <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span>, <span class="st">&quot;Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,</span>
<span id="cb42-24"><a href="#cb42-24" tabindex="-1"></a>  <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Mistral-Small-3.1-24B-Instruct-2503&quot;</span>,</span>
<span id="cb42-25"><a href="#cb42-25" tabindex="-1"></a>  <span class="st">&quot;Mistral-Large-Instruct-2411&quot;</span>, <span class="st">&quot;Qwen2.5-0.5B-Instruct&quot;</span>,</span>
<span id="cb42-26"><a href="#cb42-26" tabindex="-1"></a>  <span class="st">&quot;Qwen2.5-1.5B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-3B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-7B-Instruct&quot;</span>,</span>
<span id="cb42-27"><a href="#cb42-27" tabindex="-1"></a>  <span class="st">&quot;Qwen2.5-14B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-32B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-72B-Instruct&quot;</span>,</span>
<span id="cb42-28"><a href="#cb42-28" tabindex="-1"></a>  <span class="st">&quot;Qwen3-0.6B&quot;</span>, <span class="st">&quot;Qwen3-1.7B&quot;</span>, <span class="st">&quot;Qwen3-4B&quot;</span>,</span>
<span id="cb42-29"><a href="#cb42-29" tabindex="-1"></a>  <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-14B&quot;</span>, <span class="st">&quot;Qwen3-30B-A3B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen3-32B&quot;</span>,</span>
<span id="cb42-30"><a href="#cb42-30" tabindex="-1"></a>  <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span>,</span>
<span id="cb42-31"><a href="#cb42-31" tabindex="-1"></a>  <span class="co"># &quot;gpt-4.1-nano&quot;, &quot;gpt-4.1-mini&quot;, &quot;gpt-4.1&quot;,</span></span>
<span id="cb42-32"><a href="#cb42-32" tabindex="-1"></a>  <span class="st">&quot;Falcon3-10B-Instruct&quot;</span>, <span class="st">&quot;phi-4&quot;</span></span>
<span id="cb42-33"><a href="#cb42-33" tabindex="-1"></a>)</span>
<span id="cb42-34"><a href="#cb42-34" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" tabindex="-1"></a>method_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>, <span class="st">&quot;top_n_rag_examples_out_of_sample&quot;</span>, <span class="st">&quot;static_example&quot;</span>, <span class="st">&quot;zero_shot&quot;</span> )</span>
<span id="cb42-36"><a href="#cb42-36" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" tabindex="-1"></a>norm_factors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_jobs/page_identification/gpu_benchmark/runtime_factors_real_table_extraction.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-38"><a href="#cb42-38" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-39"><a href="#cb42-39" tabindex="-1"></a>    <span class="at">model_name =</span> model_name <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb42-40"><a href="#cb42-40" tabindex="-1"></a>  )</span>
<span id="cb42-41"><a href="#cb42-41" tabindex="-1"></a>norm_factors_few_examples <span class="ot">&lt;-</span> norm_factors <span class="sc">%&gt;%</span> <span class="fu">filter</span>((<span class="fu">str_ends</span>(filename, <span class="st">&quot;binary.yaml&quot;</span>) <span class="sc">|</span> <span class="fu">str_ends</span>(filename, <span class="st">&quot;multi.yaml&quot;</span>) <span class="sc">|</span> <span class="fu">str_ends</span>(filename, <span class="st">&quot;vllm_batched.yaml&quot;</span>)))</span>
<span id="cb42-42"><a href="#cb42-42" tabindex="-1"></a></span>
<span id="cb42-43"><a href="#cb42-43" tabindex="-1"></a>df_real_table_extraction <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(</span>
<span id="cb42-44"><a href="#cb42-44" tabindex="-1"></a>  norm_factors_few_examples <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model_name =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model_name)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model_name, parameter_count, normalization_factor),</span>
<span id="cb42-45"><a href="#cb42-45" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;model&quot;</span> <span class="ot">=</span> <span class="st">&quot;model_name&quot;</span>)</span>
<span id="cb42-46"><a href="#cb42-46" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">normalized_runtime =</span> <span class="fu">round</span>(runtime<span class="sc">*</span>normalization_factor, <span class="dv">0</span>))</span>
<span id="cb42-47"><a href="#cb42-47" tabindex="-1"></a></span>
<span id="cb42-48"><a href="#cb42-48" tabindex="-1"></a>df_overview <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb42-49"><a href="#cb42-49" tabindex="-1"></a>  <span class="fu">filter</span>(out_of_company <span class="sc">!=</span> <span class="cn">TRUE</span> <span class="sc">|</span> <span class="fu">is.na</span>(out_of_company), n_examples <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-50"><a href="#cb42-50" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size) <span class="sc">%&gt;%</span></span>
<span id="cb42-51"><a href="#cb42-51" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">!=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-52"><a href="#cb42-52" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-53"><a href="#cb42-53" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb42-54"><a href="#cb42-54" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb42-55"><a href="#cb42-55" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb42-56"><a href="#cb42-56" tabindex="-1"></a>    )</span>
<span id="cb42-57"><a href="#cb42-57" tabindex="-1"></a></span>
<span id="cb42-58"><a href="#cb42-58" tabindex="-1"></a>units_real_tables <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_truth/real_tables_extended/table_characteristics_more_examples.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb42-59"><a href="#cb42-59" tabindex="-1"></a>  <span class="at">filepath =</span> <span class="fu">paste0</span>(<span class="st">&#39;/pvc/benchmark_truth/real_tables_extended/&#39;</span>, company, <span class="st">&#39;__&#39;</span>, filename),</span>
<span id="cb42-60"><a href="#cb42-60" tabindex="-1"></a>  <span class="at">T_EUR =</span> (T_in_year <span class="sc">+</span> T_in_previous_year)<span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb42-61"><a href="#cb42-61" tabindex="-1"></a>  <span class="at">T_EUR_both =</span> (T_in_year <span class="sc">+</span> T_in_previous_year)<span class="sc">&gt;</span><span class="dv">1</span></span>
<span id="cb42-62"><a href="#cb42-62" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(filepath, T_EUR, T_EUR_both)</span>
<span id="cb42-63"><a href="#cb42-63" tabindex="-1"></a></span>
<span id="cb42-64"><a href="#cb42-64" tabindex="-1"></a>df_real_table_extraction_synth <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(units_real_tables)</span></code></pre></div>
</details>
<p>where to put?:</p>
<ul>
<li>GESOBAU AG and WBM GmbH bad, text selection with mouse odd</li>
<li>shift median upwards for GESOBAU: Qwen3, mitral, microsoft, Llama</li>
<li>shift median upwards for WBM: Llama 4</li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(model, <span class="st">&quot;oss&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.before =</span> <span class="dv">1</span>, <span class="at">company =</span> <span class="fu">map_chr</span>(filepath, <span class="sc">~</span><span class="fu">str_split</span>(<span class="fu">str_split</span>(., <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">5</span>], <span class="st">&quot;__&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>  <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> percentage_correct_numeric)) <span class="sc">+</span> </span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> percentage_correct_numeric), <span class="at">alpha=</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span> </span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model_family <span class="sc">~</span> .)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(model, <span class="st">&quot;235B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">==</span> <span class="dv">5</span>, method_family <span class="sc">==</span> <span class="st">&quot;top_n_rag_examples&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.before =</span> <span class="dv">1</span>, <span class="at">company =</span> <span class="fu">map_chr</span>(filepath, <span class="sc">~</span><span class="fu">str_split</span>(<span class="fu">str_split</span>(., <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">5</span>], <span class="st">&quot;__&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>  <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> percentage_correct_numeric)) <span class="sc">+</span> </span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> percentage_correct_numeric), <span class="at">alpha=</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span> </span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model_family <span class="sc">~</span> .)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<p>This section presents the results for the table extraction task
performed with <a href="#acronyms_LLM">LLM</a>s on <strong>Aktiva</strong> tables. Subsection
@ref(real-table-extraction-results) compraes the performance of open
source models on real tables. It also compares those results with the
table extraction performance achieved with models by OpenAI.</p>
<p>Subsection @ref(synthetic-table-extraction) presents the results on
synthetic <strong>Aktiva</strong> tables. Subsection
@ref(real-table-extraction-synth-context) shows a hybrid approach,
where synthetic tables are used for the in-context learning, to extract
real <strong>Aktiva</strong> tables. Finally, we summarize the results for all
approaches in subsection @ref(comparing-table-extraction-methods).</p>
<ul>
<li>confidence usable to head for user checks?</li>
<li>not handled new entries</li>
<li>five examples bring not much more, but a little</li>
</ul>
<p>Explain <em>static_example</em> method.</p>
<div id="real-table-extraction-results" class="section level3 hasAnchor" number="9.2.1">
<h3 class="hasAnchor"><span class="header-section-number">9.2.1</span> Real tables<a href="#real-table-extraction-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>df_top_scoring_models_big <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  <span class="co"># filter(parameter_count&gt;20) %&gt;% </span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, mean_total, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, method_family, n_examples, parameter_count, mean_total, median_total, normalized_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total))</span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>top_scoring_model_big_mean <span class="ot">&lt;-</span> df_top_scoring_models_big <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>mean_total <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a>df_top_scoring_models_small <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a>  <span class="fu">filter</span>(parameter_count<span class="sc">&lt;</span><span class="dv">17</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-16"><a href="#cb45-16" tabindex="-1"></a>  <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb45-17"><a href="#cb45-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-18"><a href="#cb45-18" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-19"><a href="#cb45-19" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-20"><a href="#cb45-20" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb45-21"><a href="#cb45-21" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, mean_total, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-22"><a href="#cb45-22" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, method_family, n_examples, parameter_count, mean_total, median_total, normalized_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb45-23"><a href="#cb45-23" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total)) </span>
<span id="cb45-24"><a href="#cb45-24" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" tabindex="-1"></a>top_scoring_model_small_mean <span class="ot">&lt;-</span> df_top_scoring_models_small <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>mean_total <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb45-26"><a href="#cb45-26" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" tabindex="-1"></a>zero_shot_stars <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb45-28"><a href="#cb45-28" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_total<span class="sc">&gt;</span>real_table_extraction_regex_total_performance_median, median_num<span class="sc">&gt;</span>real_table_extraction_regex_num_performance_median, median_F1<span class="sc">&gt;</span>real_table_extraction_regex_NA_F1_median)</span>
<span id="cb45-29"><a href="#cb45-29" tabindex="-1"></a></span>
<span id="cb45-30"><a href="#cb45-30" tabindex="-1"></a>static_example_stars <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;static_example&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb45-31"><a href="#cb45-31" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_total<span class="sc">&gt;</span>real_table_extraction_regex_total_performance_median, median_num<span class="sc">&gt;</span>real_table_extraction_regex_num_performance_median, median_F1<span class="sc">&gt;</span>real_table_extraction_regex_NA_F1_median)</span>
<span id="cb45-32"><a href="#cb45-32" tabindex="-1"></a></span>
<span id="cb45-33"><a href="#cb45-33" tabindex="-1"></a>underperformer <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb45-34"><a href="#cb45-34" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(median_total<span class="sc">&lt;</span>real_table_extraction_regex_total_performance_median, median_num<span class="sc">&lt;</span>real_table_extraction_regex_num_performance_median, median_F1<span class="sc">&lt;</span>real_table_extraction_regex_NA_F1_median)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(median_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb45-35"><a href="#cb45-35" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" tabindex="-1"></a>super_underperformer <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>), n_examples<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method, parameter_count) <span class="sc">%&gt;%</span> </span>
<span id="cb45-37"><a href="#cb45-37" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(median_total<span class="sc">&lt;</span>real_table_extraction_regex_total_performance_median, median_num<span class="sc">&lt;</span>real_table_extraction_regex_num_performance_median, median_F1<span class="sc">&lt;</span>real_table_extraction_regex_NA_F1_median)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(median_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<div id="performance-2" class="section level5 hasAnchor paragraph-start" number="9.2.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">9.2.1.0.1</span> Performance<a href="#performance-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the table extraction task
32 open source models
from 9 model
families have been benchmarked<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>. Table
@ref(tab:table-metrics-llm-real-table-extraction) shows the best
performing combination of <a href="#acronyms_LLM">LLM</a> and prompting strategy for each
model family. The results are sorted by their mean percentage of total
correct predictions. It also shows the normalized runtime in seconds and
the parameter number of the model.</p>
</div>
<p>Qwen3-235B-A22B-Instruct performed best with a mean score of
0.97. This is equal with the performance that
we achieved building the ground truth dataset. There are other models
that perform almost as good with a score of 0.96 and more, but that
don’t match the human performance. These models show a median score of
1.0. Qwen3-235B-A22B-Instruct is the second fastest of those well
performing models and needs less than six minutes. Only Llama 4 Maverick
is faster. It needs half the time to extract the information.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>df_top_scoring_models_big <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">round</span>(median_total, <span class="dv">3</span>),</span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">round</span>(mean_total, <span class="dv">3</span>)</span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing best table extraction performance with real &#39;Aktiva&#39; dataset for each model family&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">alignment =</span> <span class="st">&quot;lllrrrrr&quot;</span>, <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-real-table-extraction)Comparing best table extraction performance with real ‘Aktiva’ dataset for each model family
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-860f615e8294a4db4f2e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-860f615e8294a4db4f2e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["Qwen 3","mistralai","Qwen 2.5","Llama-4","Llama-3","microsoft","openai","tiiuae","google"],["Qwen3-235B-A22B-Instruct-2507-FP8","Mistral-Large-Instruct-2411","Qwen2.5-72B-Instruct","Llama-4-Maverick-17B-128E-Instruct-FP8","Llama-3.1-70B-Instruct","phi-4","gpt-oss-120b","Falcon3-10B-Instruct","gemma-3-27b-it"],["top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["5","5","5","1","5","2","5","3","3"],["235","124","72","17","70","15","120","10","27"],["0.97","0.949","0.941","0.939","0.926","0.909","0.904","0.884","0.86"],["1","1","0.966","0.966","0.966","0.948","0.948","0.931","0.897"],["349","1292","475","158","429","664","657","117","116"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>parameter count<\/th>\n      <th>mean total<\/th>\n      <th>median total<\/th>\n      <th>normalized runtime<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"targets":8,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"method family","targets":3},{"name":"n examples","targets":4},{"name":"parameter count","targets":5},{"name":"mean total","targets":6},{"name":"median total","targets":7},{"name":"normalized runtime","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Table @ref(tab:table-metrics-llm-real-table-extraction-small) shows the
performance of models with less than 17B parameters, that have not been
listed above. Qwen3-14B performs best among the smaller models achieving
a mean of 0.93 and median of 1.0. It takes
1:49 minutes to extract the information from all <strong>Aktiva</strong> tables.
Ministral-8B-Instruct does not perform as good as in the page
identification task.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>df_top_scoring_models_small <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>model <span class="sc">%in%</span> df_top_scoring_models_big<span class="sc">$</span>model) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">round</span>(median_total, <span class="dv">3</span>),</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">round</span>(mean_total, <span class="dv">3</span>)</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing best table extraction performance with real &#39;Aktiva&#39; dataset for each model family for models with less than 17B parameters. Models that have been listes in the previous table are not listed again.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">alignment =</span> <span class="st">&quot;lllrrrrr&quot;</span>, <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-real-table-extraction-small)Comparing best table extraction performance with real ‘Aktiva’ dataset for each model family for models with less than 17B parameters. Models that have been listes in the previous table are not listed again.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5833abb9f79736f1770e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5833abb9f79736f1770e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],["Qwen 3","Qwen 2.5","mistralai","Llama-3","google"],["Qwen3-8B","Qwen2.5-14B-Instruct","Ministral-8B-Instruct-2410","Llama-3.1-8B-Instruct","gemma-3-12b-it"],["top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["5","5","5","5","3"],["8","14","8","8","12"],["0.927","0.925","0.895","0.832","0.811"],["0.966","0.966","0.931","0.879","0.862"],["133","233","220","98","95"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>parameter count<\/th>\n      <th>mean total<\/th>\n      <th>median total<\/th>\n      <th>normalized runtime<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"targets":8,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"method family","targets":3},{"name":"n examples","targets":4},{"name":"parameter count","targets":5},{"name":"mean total","targets":6},{"name":"median total","targets":7},{"name":"normalized runtime","targets":8}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Most models need a context learning approach to beat the performance of
the regular expression approach at total and numeric correctness rate
and F1 score. Table @ref(tab:zero-and-synth-performing-models-tab)
shows, that 3 models perform better without any
guidance<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>. 6 models achieved
an performance better than the <a href="#acronyms_regex">regex</a> baseline using the approach
to learn with a fixed example from the synthetic dataset.</p>
<p>In contrast: most of the models achieved a better performance than the
regex baseline when they were provided with one or more examples from
real <strong>Aktiva</strong> tables. Table
@ref(tab:super-underperforming-models-tab) shows, that
11 don’t consitently achieve a better score,
when provided with three or five real <strong>Aktiva</strong> table examples. Here we
find the smallest models with less than 2B parameters which don’t
achieve a consistence performance no matter how many examples they get.
But we also find models that start to perform bad if they get a too long
context with too many examples like the very recent and large model
Llama 4 Maverick.</p>
<p>The results for all models are presented in Figure
@ref(fig:table-extraction-llm-performance-total-overview),
@ref(fig:table-extraction-llm-performance-numeric-overview) and
@ref(fig:table-extraction-llm-f1-overview). In general the performance
within a model family is positive correlated with the models number of
parameters, if we provide real <strong>Aktiva</strong> examples. Once the 4B
parameters are passed, the improvements get less and less, approaching
the perfect performance. But no model achieves sperfect result on all
documents. The <em>zero_shot</em> and <em>static_example</em> approach show some
unpredicted performance drop, i.e. for Qwen3-14B.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>zero_shot_stars <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(static_example_stars, <span class="fu">join_by</span>(model), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_zero_shot&quot;</span>, <span class="st">&quot;_static_example&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model, <span class="fu">starts_with</span>(<span class="st">&quot;median_total&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="fu">mutate_if</span>(</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a>    )</span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrr&quot;</span>,</span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing table extraction performance with real &#39;Aktiva&#39; dataset for models that perform well without or with little context learning&quot;</span>,</span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:zero-and-synth-performing-models-tab)Comparing table extraction performance with real ‘Aktiva’ dataset for models that perform well without or with little context learning
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3ed447cd0ef4053a5919" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3ed447cd0ef4053a5919">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["Llama-4-Maverick-17B-128E-Instruct-FP8","Qwen3-235B-A22B-Instruct-2507-FP8","gpt-oss-120b","Qwen2.5-32B-Instruct","Qwen2.5-72B-Instruct","Qwen3-30B-A3B-Instruct-2507"],["<b>0.897<\/b>","<b>0.897<\/b>","<b>0.897<\/b>",null,null,null],["0.922","<b>0.931<\/b>","0.897","<b>0.931<\/b>","0.897","0.879"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>median total zero shot<\/th>\n      <th>median total static example<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"median total zero shot","targets":2},{"name":"median total static example","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>super_underperformer <span class="sc">%&gt;%</span> <span class="fu">select</span>(model, method, parameter_count, median_total) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co"># mutate(model = str_replace_all(model, &quot;_&quot;, &quot; &quot;)) %&gt;% </span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">mutate_if</span>(</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>    )</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llrr&quot;</span>,</span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing table extraction performance with real &#39;Aktiva&#39; dataset for models that perform worse than the regex baselin with 3 or 5 examples for in-context learning&quot;</span>,</span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:super-underperforming-models-tab)Comparing table extraction performance with real ‘Aktiva’ dataset for models that perform worse than the regex baselin with 3 or 5 examples for in-context learning
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5c2d7bd7aec7268db4d8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5c2d7bd7aec7268db4d8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],["Llama-3.1-8B-Instruct","Llama-4-Maverick-17B-128E-Instruct-FP8","Qwen2.5-0.5B-Instruct","Qwen2.5-1.5B-Instruct","Qwen2.5-3B-Instruct","Qwen2.5-7B-Instruct","Qwen3-0.6B","Qwen3-1.7B","gemma-3-12b-it","gemma-3-4b-it","gpt-oss-20b"],["3_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples"],["8","17","0.5","1.5","3","7","0.6","1.7","12","4","<b>20<\/b>"],["0.81","0.017","0.586","0.724","0.759","0.862","0.612","0.776","0.793","0.664","<b>0.897<\/b>"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>method<\/th>\n      <th>parameter count<\/th>\n      <th>median total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"method","targets":2},{"name":"parameter count","targets":3},{"name":"median total","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>model_by_size_gpt <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>  <span class="st">&quot;Qwen3-0.6B&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-30B-A3B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>,</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a> <span class="st">&quot;gpt-4.1-nano&quot;</span>, <span class="st">&quot;gpt-5-nano&quot;</span>, <span class="st">&quot;gpt-4.1-mini&quot;</span>, <span class="st">&quot;gpt-5-mini&quot;</span>,</span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a> <span class="st">&quot;gpt-oss-20b&quot;</span>, <span class="st">&quot;gpt-oss-120b&quot;</span>, <span class="st">&quot;gpt-4.1&quot;</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a>)</span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>df_overview_gpt <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a>  <span class="fu">filter</span>(out_of_company <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">|</span> <span class="fu">is.na</span>(out_of_company), n_examples <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_gpt) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_gpt),</span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a>      <span class="at">n_predicted_values =</span> NA_true_positive<span class="sc">+</span>NA_false_positive<span class="sc">+</span>NA_false_negative<span class="sc">+</span>NA_true_negative</span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>    )</span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a>perc_wrong_prediction_count <span class="ot">&lt;-</span> <span class="fu">round</span>((df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(model, <span class="st">&quot;Qwen&quot;</span>), n_predicted_values <span class="sc">!=</span> <span class="dv">58</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()<span class="sc">/</span>df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(model, <span class="st">&quot;Qwen&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span></code></pre></div>
</details>
<div id="openai-models" class="section level5 hasAnchor paragraph-start" number="9.2.1.0.2">
<h5 class="hasAnchor"><span class="header-section-number">9.2.1.0.2</span> OpenAI models<a href="#openai-models" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Even though a lot of documents to process at <a href="#acronyms_RHvB">RHvB</a> will not be
public and thus must not be processed on public cloud infrastructure,
the performance of models like OpenAI’s GPT are interesting benchmark
references within this thesis and for comparing these findings with
other papers results. Therefore for this thesis the public available
versions of annual reports have been used instead of the ones used
internally or for public administration purposes. Those public available
reports often are visually more appealing and more heterogeneous in
their structure.</p>
</div>
<p>Table @ref(tab.table-extraction-llm-performance-total-gpt-ranking)
shows the ranking for the best model-method combinations Qwen3 235B is
performing best. gpt-4.1 and gpt-5-mini perform equally well and are
almost as good as Qwen3 235B. All models but gpt-4.1-nano, gpt-5-nano
and Qwen3-0.6B manage to beat the <a href="#acronyms_regex">regex</a> threshold. Qwen3-0.6B
performs better than the nano models once it gets provided with an
example.</p>
<p>Table @ref(tab:costs-azure) shows the accumulated costs for the table
extraction task for the models provided by Azure. Using gpt-4.1 is most
expensive, followed by gpt-5-mini. Next is gpt-5-nano. This is caused by
an unexpected high cost for output tokens. In general we find, that the
ratio of output costs to input costs is much higher for gpt-5 models.
Since gpt-5-mini gives consistently good results already with one
provided example, this could be the most cost efficient strategy. But it
takes gpt-5-mini more than three times longer to respond than gpt-4.1.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>    <span class="at">median_percentage_correct_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a>    <span class="co"># median_runtime = median(runtime)</span></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, mean_percentage_correct_total, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">round</span>(mean_percentage_correct_total, <span class="dv">2</span>),</span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a>    <span class="at">median_percentage_correct_total =</span> <span class="fu">round</span>(median_percentage_correct_total, <span class="dv">2</span>),</span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a>    <span class="co"># median_runtime = round(median_runtime)</span></span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="st">&quot;median correct total&quot;</span> <span class="ot">=</span> median_percentage_correct_total) <span class="sc">%&gt;%</span> </span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llrr&quot;</span>,</span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing table extraction performance with real &#39;Aktiva&#39; dataset for OPenAIs GPT models with a selection of Qwen3 models.&quot;</span>,</span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-extraction-llm-performance-total-gpt-ranking)Comparing table extraction performance with real ‘Aktiva’ dataset for OPenAIs GPT models with a selection of Qwen3 models.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-95d11c910bced7255b5d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-95d11c910bced7255b5d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],["Qwen3-235B-A22B-Instruct-2507-FP8","gpt-4.1","gpt-5-mini","Qwen3-30B-A3B-Instruct-2507","gpt-4.1-mini","Qwen3-8B","gpt-oss-120b","gpt-oss-20b","Qwen3-0.6B","gpt-5-nano","gpt-4.1-nano"],["5_<wbr>random_<wbr>examples","top_<wbr>5_<wbr>rag_<wbr>examples","top_<wbr>5_<wbr>rag_<wbr>examples","top_<wbr>5_<wbr>rag_<wbr>examples","top_<wbr>3_<wbr>rag_<wbr>examples","top_<wbr>5_<wbr>rag_<wbr>examples","5_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","zero_<wbr>shot"],["0.97","0.95","0.95","0.92","0.91","0.89","0.88","0.84","0.65","0.3","0.21"],["1","0.97","0.97","0.97","0.96","0.93","0.93","0.9","0.65","0.24","0.14"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>method<\/th>\n      <th>mean percentage correct total<\/th>\n      <th>median correct total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"method","targets":2},{"name":"mean percentage correct total","targets":3},{"name":"median correct total","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>costs_azure <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../CostManagement_master-thesis_2025.csv&quot;</span>)</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>costs_azure <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">map_chr</span>(</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>    Model, <span class="sc">~</span>{<span class="fu">paste</span>(<span class="fu">str_split</span>(., <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>)}</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>      <span class="at">Model =</span> <span class="fu">str_replace_all</span>(<span class="fu">tolower</span>(<span class="fu">str_remove</span>(Model, <span class="st">&quot; Inp| Outp| cached&quot;</span>)), <span class="st">&quot; &quot;</span>, <span class="st">&quot;-&quot;</span>),</span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>      <span class="at">Cost =</span> <span class="fu">round</span>(Cost, <span class="dv">2</span>)</span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Model, Meter) <span class="sc">%&gt;%</span> </span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>      <span class="at">Cost =</span> <span class="fu">sum</span>(Cost)</span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Meter, <span class="at">values_from =</span> Cost, <span class="at">names_prefix =</span> <span class="st">&quot;Cost_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>    <span class="at">Cost_total =</span> Cost_Input<span class="sc">+</span>Cost_Output,</span>
<span id="cb52-16"><a href="#cb52-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb52-17"><a href="#cb52-17" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Cost_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-18"><a href="#cb52-18" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">tolower</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb52-19"><a href="#cb52-19" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb52-20"><a href="#cb52-20" tabindex="-1"></a>    df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb52-21"><a href="#cb52-21" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="st">&quot;median runtime in minutes&quot;</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="fu">median</span>(runtime)<span class="sc">/</span><span class="dv">60</span>), <span class="st">&quot;:&quot;</span>, <span class="fu">round</span>(<span class="fu">median</span>(runtime)<span class="sc">%%</span><span class="dv">60</span>)))</span>
<span id="cb52-22"><a href="#cb52-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb52-23"><a href="#cb52-23" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb52-24"><a href="#cb52-24" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrrrr&quot;</span>,</span>
<span id="cb52-25"><a href="#cb52-25" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing the costs for OpenAIs GPT models provided by Azure. Notice the high output cost for GPT 5 Nano.&quot;</span>,</span>
<span id="cb52-26"><a href="#cb52-26" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span></span>
<span id="cb52-27"><a href="#cb52-27" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:costs-azure)Comparing the costs for OpenAIs GPT models provided by Azure. Notice the high output cost for GPT 5 Nano.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1a5bb4bf25dd9c5d166a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1a5bb4bf25dd9c5d166a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],["gpt-4.1","gpt-5-mini","gpt-5-nano","gpt-4.1-mini","gpt-4.1-nano"],["18.07","1.93","0.41","3.76","0.08"],["10.35","10.28","6.99","2.02","0.06"],["28.42","12.21","7.4","5.78","0.14"],["29:53","110:50","135:37","31:48","10:28"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>cost input<\/th>\n      <th>cost output<\/th>\n      <th>cost total<\/th>\n      <th>median runtime in minutes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"cost input","targets":2},{"name":"cost output","targets":3},{"name":"cost total","targets":4},{"name":"median runtime in minutes","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Discussion?:</p>
<p>Since the output token costs are not that different (2 $ for 1M output
tokens with gpt-5-mini vs 1.6 $ with gpt-4.1-mini), the generated
output token number has to be much higher for the gpt-5-mini models. But
since the responses are based on the same schema and required the same
numeric values there shouldn’t be a big difference<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>.</p>
<p>Figure @ref(fig:table-extraction-llm-f1-gpt-slice) shows the
distribution of F1 score for up to three examples. It shows green
crosses at the bottom of the abscissa that indicate prediction, where no
<em>null</em> value is reported. This means, the model hallucinates many
numeric values. This is only the case for OpenAI’s models but not for
Qwen3 models. This behaviour persists up to five examples for the nano
as well the gpt-oss 20b model. For gpt-4.1 and gpt-4.1-mini these cases
vanish when we provide three or more examples and never appeared for
gpt-5-mini.</p>
<p>One can find the full plots in Figures
@ref(fig:table-extraction-llm-performance-total-gpt),
@ref(fig:table-extraction-llm-performance-numeric-gpt) and
@ref(fig:table-extraction-llm-f1-gpt)).</p>
<p>We were not able to get OpenAI’s models to stick to the provided
<a href="#acronyms_json">json</a> schema strictly. Passing the <a href="#acronyms_ebnf">ebnf</a> grammar did not work
at all. This means that with gpt-4.1-nano there have been
88
predictions that have been completely empty. For gpt-5-nano we find
6
such predictions. Figure
@red(fig:table-extraction-llm-prediction-count-gpt) shows the
distribution of responses with a wrong number of predictions (including
<em>null</em> and numeric predictions). Overall there have been
34.3 % of the responses of OpenAI’s models
that were compatible with the schema but had a wrong number of rows
predicted. The maximum number of returned values (by gpt-5-nano) is 714.</p>
<p>Using gpt-5-chat for the table extraction task with structured output is
not working, returning an error informing that a <em>json_schema</em> can’t be
used with this model. Figure @ref(fig:table-extraction-llm-errors-gpt)
shows, where other models produced an answer that could not be parsed as
valid <a href="#acronyms_json">json</a>.Most errors occured for gpt-oss-20B and the
<em>static_example</em> method. Over half of all tables could not be
transcripted in <a href="#acronyms_json">json</a> with in the 40_000 response token
limit<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>. Only with gpt-5-mini we had no <a href="#acronyms_json">json</a> parsing
error.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(<span class="fu">as.character</span>(n_examples), <span class="st">&quot;n = &quot;</span>)) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NA_F1 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(NA_F1), <span class="dv">0</span>, NA_F1)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> NA_F1, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(NA_F1), <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(<span class="fu">as.character</span>(n_examples), <span class="st">&quot;n = &quot;</span>)) <span class="sc">&lt;</span> <span class="dv">5</span>), <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">height =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-f1-gpt-slice-1.png" alt="Comparing the F1 score for predicting the missingness of a value for OpenAi's LLMs with some Qwen 3 models. The green crosses indicate results where a model has predicted only numeric values even though there have been missing values." width="100%" height="90%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-f1-gpt-slice)Comparing the F1 score for predicting the missingness of a value for OpenAi’s LLMs with some Qwen 3 models. The green crosses indicate results where a model has predicted only numeric values even though there have been missing values.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_predicted_values <span class="sc">!=</span> <span class="dv">58</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color_code =</span> <span class="fu">if_else</span>(n_predicted_values<span class="sc">==</span><span class="dv">0</span>, <span class="st">&quot;zero&quot;</span>, <span class="fu">if_else</span>(n_predicted_values <span class="sc">&gt;</span> <span class="dv">58</span>, <span class="st">&quot;too many&quot;</span>, <span class="st">&quot;too little&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_predicted_values, <span class="at">fill =</span> color_code), <span class="at">binwidth =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(model<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">66</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-prediction-count-gpt-1.png" alt="Showing the number of predictions OpenAI's models made." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-prediction-count-gpt)Showing the number of predictions OpenAI’s models made.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n_pred =</span> <span class="fu">map_dbl</span>(predictions, <span class="sc">~</span><span class="fu">nrow</span>(.)), <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_pred <span class="sc">!=</span> <span class="dv">29</span>) <span class="sc">%&gt;%</span> <span class="co"># select(model, method, n_pred, filepath) %&gt;% </span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> method_family, <span class="at">fill =</span> n_examples)) <span class="sc">+</span> </span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>.)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-errors-gpt-1.png" alt="Showing the number of predictions OpenAI's models made." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-errors-gpt)Showing the number of predictions OpenAI’s models made.
</p>
</div>
<div id="out-of-company-performance" class="section level5 hasAnchor paragraph-start" number="9.2.1.0.3">
<h5 class="hasAnchor"><span class="header-section-number">9.2.1.0.3</span> Out of company performance<a href="#out-of-company-performance" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:table-extraction-same-company-improvement-table) shows
the improvement for the percentage of correct predictions total, when
<strong>Aktiva</strong> tables from the same company as the target tables company are
provided for the in-context learning. It shows that this improvement is
biggest for goolge and Qwen and smallest for Llama models.</p>
</div>
<p>Figure
@ref(fig:table-extraction-llm-performance-total-overview-out-of-company)
shows, that using <strong>Aktiva</strong> in-company examples improves the
performance, mainly by reducing the number of bad predictions. The found
improvement is present for all models but Llama 4 Maverick. Here the
number of bad predictions gets larger if we provide three or more
examples. With five examples the performances totally collapses.</p>
<p>The perfromance improvement for GPT-4.1-mini and GTP-4.1 with only one
provided example seems to be big, because the box is getting much more
narrow. But the median shifts not more than for other models.</p>
<p>Check results for openai, when 5 nano finished</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>    <span class="at">examples_from_same_company =</span> <span class="sc">!</span>out_of_company</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a>    <span class="co"># str_detect(filepath, &quot;Statistik&quot;), </span></span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a>    method_family <span class="sc">==</span> <span class="st">&quot;top_n_rag_examples&quot;</span>,</span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a>    n_examples <span class="sc">!=</span> <span class="dv">2</span>,</span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a>    n_examples <span class="sc">&lt;</span> <span class="dv">5</span>,</span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model_family, examples_from_same_company) <span class="sc">%&gt;%</span> </span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a>      <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-12"><a href="#cb56-12" tabindex="-1"></a>      <span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-13"><a href="#cb56-13" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> examples_from_same_company, <span class="at">values_from =</span> <span class="fu">c</span>(mean_total, median_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-14"><a href="#cb56-14" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-15"><a href="#cb56-15" tabindex="-1"></a>      <span class="at">improvement_mean =</span> <span class="fu">round</span>(mean_total_TRUE <span class="sc">-</span> mean_total_FALSE, <span class="dv">2</span>),</span>
<span id="cb56-16"><a href="#cb56-16" tabindex="-1"></a>      <span class="at">improvement_median =</span> <span class="fu">round</span>(median_total_TRUE <span class="sc">-</span> median_total_FALSE, <span class="dv">2</span>)</span>
<span id="cb56-17"><a href="#cb56-17" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model_family, improvement_mean, improvement_median) <span class="sc">%&gt;%</span> </span>
<span id="cb56-18"><a href="#cb56-18" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(improvement_mean)) <span class="sc">%&gt;%</span> <span class="co">#kbl()</span></span>
<span id="cb56-19"><a href="#cb56-19" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb56-20"><a href="#cb56-20" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrr&quot;</span>,</span>
<span id="cb56-21"><a href="#cb56-21" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing the extraction performance when Aktiva tables from the same company can be used for in-context learning or not.&quot;</span>,</span>
<span id="cb56-22"><a href="#cb56-22" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span></span>
<span id="cb56-23"><a href="#cb56-23" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-extraction-same-company-improvement-table)Comparing the extraction performance when Aktiva tables from the same company can be used for in-context learning or not.
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-7cb9153756637de40111" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7cb9153756637de40111">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["google","Qwen 3","chat-gpt","Qwen 2.5","tiiuae","mistralai","Llama-3","microsoft","openai","Llama-4"],["0.13","0.12","0.12","0.1","0.09","0.08","0.07","0.07","0.05","0.03"],["0.14","0.07","0.17","0.12","0.07","0.07","0.05","0.06","0.07","0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>improvement mean<\/th>\n      <th>improvement median<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"improvement mean","targets":2},{"name":"improvement median","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="synthetic-table-extraction" class="section level3 hasAnchor" number="9.2.2">
<h3 class="hasAnchor"><span class="header-section-number">9.2.2</span> Synthetic tables<a href="#synthetic-table-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>df_synth_table_extraction <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/synth_table_extraction_llm.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">if_else</span>(model <span class="sc">==</span> <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>, model)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="at">size =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;deepseek-ai_DeepSeek-R1-Distill-Qwen-32B&quot;</span>, <span class="st">&#39;google_gemma-3n-E4B-it&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model)</span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a>    )</span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a>norm_factors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_jobs/page_identification/gpu_benchmark/runtime_factors_synth_table_extraction.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-11"><a href="#cb57-11" tabindex="-1"></a>    <span class="at">model_name =</span> model_name <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot;_&quot;</span>)</span>
<span id="cb57-12"><a href="#cb57-12" tabindex="-1"></a>  )</span>
<span id="cb57-13"><a href="#cb57-13" tabindex="-1"></a>norm_factors_few_examples <span class="ot">&lt;-</span> norm_factors <span class="sc">%&gt;%</span> <span class="fu">filter</span>((<span class="fu">str_ends</span>(filename, <span class="st">&quot;binary.yaml&quot;</span>) <span class="sc">|</span> <span class="fu">str_ends</span>(filename, <span class="st">&quot;multi.yaml&quot;</span>) <span class="sc">|</span> <span class="fu">str_ends</span>(filename, <span class="st">&quot;vllm_batched.yaml&quot;</span>)))</span>
<span id="cb57-14"><a href="#cb57-14" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" tabindex="-1"></a>df_synth_table_extraction <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(</span>
<span id="cb57-16"><a href="#cb57-16" tabindex="-1"></a>  norm_factors_few_examples <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model_name =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model_name)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model_name, parameter_count, normalization_factor),</span>
<span id="cb57-17"><a href="#cb57-17" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;model&quot;</span> <span class="ot">=</span> <span class="st">&quot;model_name&quot;</span>)</span>
<span id="cb57-18"><a href="#cb57-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb57-19"><a href="#cb57-19" tabindex="-1"></a>    <span class="at">normalized_runtime =</span> normalization_factor <span class="sc">*</span> runtime</span>
<span id="cb57-20"><a href="#cb57-20" tabindex="-1"></a>  )</span>
<span id="cb57-21"><a href="#cb57-21" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" tabindex="-1"></a>df_overview_synth <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb57-23"><a href="#cb57-23" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-24"><a href="#cb57-24" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb57-25"><a href="#cb57-25" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb57-26"><a href="#cb57-26" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb57-27"><a href="#cb57-27" tabindex="-1"></a>  )</span>
<span id="cb57-28"><a href="#cb57-28" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" tabindex="-1"></a><span class="co"># synth</span></span>
<span id="cb57-30"><a href="#cb57-30" tabindex="-1"></a></span>
<span id="cb57-31"><a href="#cb57-31" tabindex="-1"></a>zero_shot_stars_synth <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb57-32"><a href="#cb57-32" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median, median_num<span class="sc">&gt;</span>synth_table_extraction_regex_num_performance_median, median_F1<span class="sc">&gt;</span>synth_table_extraction_regex_NA_F1_median)</span>
<span id="cb57-33"><a href="#cb57-33" tabindex="-1"></a></span>
<span id="cb57-34"><a href="#cb57-34" tabindex="-1"></a>static_example_stars_synth <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;static_example&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb57-35"><a href="#cb57-35" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median, median_num<span class="sc">&gt;</span>synth_table_extraction_regex_num_performance_median, median_F1<span class="sc">&gt;</span>synth_table_extraction_regex_NA_F1_median)</span>
<span id="cb57-36"><a href="#cb57-36" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" tabindex="-1"></a>underperformer_synth <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb57-38"><a href="#cb57-38" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(median_total<span class="sc">&lt;</span>synth_table_extraction_regex_total_performance_median, median_num<span class="sc">&lt;</span>synth_table_extraction_regex_num_performance_median, median_F1<span class="sc">&lt;</span>synth_table_extraction_regex_NA_F1_median)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(median_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb57-39"><a href="#cb57-39" tabindex="-1"></a></span>
<span id="cb57-40"><a href="#cb57-40" tabindex="-1"></a>super_underperformer_synth <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>), n_examples<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> </span>
<span id="cb57-41"><a href="#cb57-41" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">median_F1 =</span> <span class="fu">median</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(median_total<span class="sc">&lt;</span>synth_table_extraction_regex_total_performance_median, median_num<span class="sc">&lt;</span>synth_table_extraction_regex_num_performance_median, median_F1<span class="sc">&lt;</span>synth_table_extraction_regex_NA_F1_median)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(median_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb57-42"><a href="#cb57-42" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" tabindex="-1"></a>df_synth_top_performance <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span></span>
<span id="cb57-44"><a href="#cb57-44" tabindex="-1"></a>  <span class="fu">filter</span>(input_format <span class="sc">==</span> <span class="st">&quot;pdf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-45"><a href="#cb57-45" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-46"><a href="#cb57-46" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-47"><a href="#cb57-47" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-48"><a href="#cb57-48" tabindex="-1"></a>    <span class="at">median_runtime =</span> <span class="fu">median</span>(normalized_runtime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-49"><a href="#cb57-49" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb57-50"><a href="#cb57-50" tabindex="-1"></a>  <span class="co"># arrange(desc(median_total)) %&gt;% </span></span>
<span id="cb57-51"><a href="#cb57-51" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, mean_total, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-52"><a href="#cb57-52" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, method_family, n_examples, mean_total, median_total, median_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb57-53"><a href="#cb57-53" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-54"><a href="#cb57-54" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-55"><a href="#cb57-55" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">round</span>(mean_total, <span class="dv">3</span>),</span>
<span id="cb57-56"><a href="#cb57-56" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">round</span>(median_total, <span class="dv">3</span>)</span>
<span id="cb57-57"><a href="#cb57-57" tabindex="-1"></a>    )</span>
<span id="cb57-58"><a href="#cb57-58" tabindex="-1"></a></span>
<span id="cb57-59"><a href="#cb57-59" tabindex="-1"></a>df_synth_top_performance_small <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb57-60"><a href="#cb57-60" tabindex="-1"></a>  <span class="fu">filter</span>(input_format <span class="sc">==</span> <span class="st">&quot;pdf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-61"><a href="#cb57-61" tabindex="-1"></a>  <span class="fu">filter</span>(parameter_count <span class="sc">&lt;</span> <span class="dv">17</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-62"><a href="#cb57-62" tabindex="-1"></a>  <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span></span>
<span id="cb57-63"><a href="#cb57-63" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-64"><a href="#cb57-64" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-65"><a href="#cb57-65" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-66"><a href="#cb57-66" tabindex="-1"></a>    <span class="at">median_runtime =</span> <span class="fu">median</span>(normalized_runtime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-67"><a href="#cb57-67" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb57-68"><a href="#cb57-68" tabindex="-1"></a>  <span class="co"># arrange(desc(median_total)) %&gt;% </span></span>
<span id="cb57-69"><a href="#cb57-69" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, mean_total, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-70"><a href="#cb57-70" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, method_family, n_examples, mean_total, median_total, median_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb57-71"><a href="#cb57-71" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-72"><a href="#cb57-72" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-73"><a href="#cb57-73" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">round</span>(mean_total, <span class="dv">3</span>),</span>
<span id="cb57-74"><a href="#cb57-74" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">round</span>(median_total, <span class="dv">3</span>)</span>
<span id="cb57-75"><a href="#cb57-75" tabindex="-1"></a>    )</span>
<span id="cb57-76"><a href="#cb57-76" tabindex="-1"></a></span>
<span id="cb57-77"><a href="#cb57-77" tabindex="-1"></a>n_better_as_regex <span class="ot">&lt;-</span> df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span></span>
<span id="cb57-78"><a href="#cb57-78" tabindex="-1"></a>  <span class="fu">filter</span>(input_format <span class="sc">==</span> <span class="st">&quot;pdf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-79"><a href="#cb57-79" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-80"><a href="#cb57-80" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(median_total))  <span class="sc">%&gt;%</span> </span>
<span id="cb57-81"><a href="#cb57-81" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-82"><a href="#cb57-82" tabindex="-1"></a>    <span class="at">better_than_regex =</span>  median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median</span>
<span id="cb57-83"><a href="#cb57-83" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(better_than_regex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">n</span>())</span>
<span id="cb57-84"><a href="#cb57-84" tabindex="-1"></a></span>
<span id="cb57-85"><a href="#cb57-85" tabindex="-1"></a>n_better_as_regex_families <span class="ot">&lt;-</span> df_synth_top_performance <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb57-86"><a href="#cb57-86" tabindex="-1"></a>    <span class="at">better_than_regex =</span>  median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median</span>
<span id="cb57-87"><a href="#cb57-87" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(better_than_regex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">n</span>())</span>
<span id="cb57-88"><a href="#cb57-88" tabindex="-1"></a></span>
<span id="cb57-89"><a href="#cb57-89" tabindex="-1"></a>n_synth_tables <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb57-90"><a href="#cb57-90" tabindex="-1"></a>  <span class="st">&quot;../benchmark_truth/synthetic_tables/separate_files/final/&quot;</span></span>
<span id="cb57-91"><a href="#cb57-91" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb57-92"><a href="#cb57-92" tabindex="-1"></a></span>
<span id="cb57-93"><a href="#cb57-93" tabindex="-1"></a>n_synth_table_extraction <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb57-94"><a href="#cb57-94" tabindex="-1"></a>  <span class="st">&quot;../benchmark_results/table_extraction/llm/final/synth_tables/&quot;</span></span>
<span id="cb57-95"><a href="#cb57-95" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb57-96"><a href="#cb57-96" tabindex="-1"></a></span>
<span id="cb57-97"><a href="#cb57-97" tabindex="-1"></a><span class="co"># confidence_vs_truth_synth &lt;- df_synth_table_extraction %&gt;% </span></span>
<span id="cb57-98"><a href="#cb57-98" tabindex="-1"></a><span class="co">#   # filter(method_family %in% c(&quot;top_n_rag_examples&quot;, &quot;n_random_examples&quot;)) %&gt;% </span></span>
<span id="cb57-99"><a href="#cb57-99" tabindex="-1"></a><span class="co">#   filter(model %in% c(&quot;Ministral-8B-Instruct-2410&quot;, &quot;Qwen3-8B&quot;, &quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;)) %&gt;% </span></span>
<span id="cb57-100"><a href="#cb57-100" tabindex="-1"></a><span class="co">#   group_by(method, model, loop) %&gt;% mutate(</span></span>
<span id="cb57-101"><a href="#cb57-101" tabindex="-1"></a><span class="co">#     mean_percentage_correct_total = mean(percentage_correct_total, na.rm=TRUE), .before = 1,</span></span>
<span id="cb57-102"><a href="#cb57-102" tabindex="-1"></a><span class="co">#     respect_units = !ignore_units</span></span>
<span id="cb57-103"><a href="#cb57-103" tabindex="-1"></a><span class="co">#   ) %&gt;% group_by(respect_units, model, filepath) %&gt;% </span></span>
<span id="cb57-104"><a href="#cb57-104" tabindex="-1"></a><span class="co">#   # arrange(desc(mean_percentage_correct_total)) %&gt;% </span></span>
<span id="cb57-105"><a href="#cb57-105" tabindex="-1"></a><span class="co">#   slice_max(mean_percentage_correct_total, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb57-106"><a href="#cb57-106" tabindex="-1"></a><span class="co">#   mutate(predictions_processed = map(predictions, ~{</span></span>
<span id="cb57-107"><a href="#cb57-107" tabindex="-1"></a><span class="co">#     .x %&gt;% </span></span>
<span id="cb57-108"><a href="#cb57-108" tabindex="-1"></a><span class="co">#       select(-&quot;_merge&quot;) %&gt;% </span></span>
<span id="cb57-109"><a href="#cb57-109" tabindex="-1"></a><span class="co">#       mutate(</span></span>
<span id="cb57-110"><a href="#cb57-110" tabindex="-1"></a><span class="co">#         match = (year_truth == year_result) | (is.na(year_truth) &amp; is.na(year_result)),</span></span>
<span id="cb57-111"><a href="#cb57-111" tabindex="-1"></a><span class="co">#         confidence = confidence_this_year,</span></span>
<span id="cb57-112"><a href="#cb57-112" tabindex="-1"></a><span class="co">#         truth_NA = is.na(year_truth),</span></span>
<span id="cb57-113"><a href="#cb57-113" tabindex="-1"></a><span class="co">#         predicted_NA = is.na(year_result),</span></span>
<span id="cb57-114"><a href="#cb57-114" tabindex="-1"></a><span class="co">#         .before = 4</span></span>
<span id="cb57-115"><a href="#cb57-115" tabindex="-1"></a><span class="co">#       ) %&gt;% nest(</span></span>
<span id="cb57-116"><a href="#cb57-116" tabindex="-1"></a><span class="co">#         tuple_year = c(match, confidence, truth_NA, predicted_NA)</span></span>
<span id="cb57-117"><a href="#cb57-117" tabindex="-1"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb57-118"><a href="#cb57-118" tabindex="-1"></a><span class="co">#       mutate(</span></span>
<span id="cb57-119"><a href="#cb57-119" tabindex="-1"></a><span class="co">#         confidence = confidence_previous_year,</span></span>
<span id="cb57-120"><a href="#cb57-120" tabindex="-1"></a><span class="co">#         match = (previous_year_truth == previous_year_result) | (is.na(previous_year_truth) &amp; is.na(previous_year_result)),</span></span>
<span id="cb57-121"><a href="#cb57-121" tabindex="-1"></a><span class="co">#         truth_NA = is.na(previous_year_truth),</span></span>
<span id="cb57-122"><a href="#cb57-122" tabindex="-1"></a><span class="co">#         predicted_NA = is.na(previous_year_result),</span></span>
<span id="cb57-123"><a href="#cb57-123" tabindex="-1"></a><span class="co">#         .before = 4</span></span>
<span id="cb57-124"><a href="#cb57-124" tabindex="-1"></a><span class="co">#       ) %&gt;% nest(</span></span>
<span id="cb57-125"><a href="#cb57-125" tabindex="-1"></a><span class="co">#         tuple_previous_year = c(match, confidence, truth_NA, predicted_NA)</span></span>
<span id="cb57-126"><a href="#cb57-126" tabindex="-1"></a><span class="co">#       ) %&gt;% select(</span></span>
<span id="cb57-127"><a href="#cb57-127" tabindex="-1"></a><span class="co">#         -c(year_truth, previous_year_truth, year_result, previous_year_result,</span></span>
<span id="cb57-128"><a href="#cb57-128" tabindex="-1"></a><span class="co">#            confidence_this_year, confidence_previous_year)</span></span>
<span id="cb57-129"><a href="#cb57-129" tabindex="-1"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb57-130"><a href="#cb57-130" tabindex="-1"></a><span class="co">#       pivot_longer(-c(&quot;E1&quot;, &quot;E2&quot;, &quot;E3&quot;)) %&gt;% </span></span>
<span id="cb57-131"><a href="#cb57-131" tabindex="-1"></a><span class="co">#       unnest(cols = value) %&gt;% mutate(</span></span>
<span id="cb57-132"><a href="#cb57-132" tabindex="-1"></a><span class="co">#         match = if_else(is.na(match), FALSE, match)</span></span>
<span id="cb57-133"><a href="#cb57-133" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb57-134"><a href="#cb57-134" tabindex="-1"></a><span class="co">#   })) %&gt;% </span></span>
<span id="cb57-135"><a href="#cb57-135" tabindex="-1"></a><span class="co">#   unnest(predictions_processed) %&gt;% mutate(</span></span>
<span id="cb57-136"><a href="#cb57-136" tabindex="-1"></a><span class="co">#     match = factor(match, levels = c(F, T)),</span></span>
<span id="cb57-137"><a href="#cb57-137" tabindex="-1"></a><span class="co">#     truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb57-138"><a href="#cb57-138" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb57-139"><a href="#cb57-139" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb57-140"><a href="#cb57-140" tabindex="-1"></a><span class="co"># confidence_intervals_synth &lt;- confidence_vs_truth_synth %&gt;% #rename(confidence = confidence_score) %&gt;% </span></span>
<span id="cb57-141"><a href="#cb57-141" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb57-142"><a href="#cb57-142" tabindex="-1"></a><span class="co">#     conf_interval = cut(confidence, breaks = seq(0, 1, by = 0.05), include.lowest = TRUE),</span></span>
<span id="cb57-143"><a href="#cb57-143" tabindex="-1"></a><span class="co">#     conf_center = as.numeric(sub(&quot;\\((.+),(.+)\\]&quot;, &quot;\\1&quot;, levels(conf_interval))[conf_interval]) + 0.025</span></span>
<span id="cb57-144"><a href="#cb57-144" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb57-145"><a href="#cb57-145" tabindex="-1"></a><span class="co">#   group_by(conf_center, predicted_NA, model, respect_units) %&gt;%</span></span>
<span id="cb57-146"><a href="#cb57-146" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb57-147"><a href="#cb57-147" tabindex="-1"></a><span class="co">#     n_true = sum(match == TRUE, na.rm = TRUE),</span></span>
<span id="cb57-148"><a href="#cb57-148" tabindex="-1"></a><span class="co">#     n_false = sum(match == FALSE, na.rm = TRUE),</span></span>
<span id="cb57-149"><a href="#cb57-149" tabindex="-1"></a><span class="co">#     total = n_true + n_false,</span></span>
<span id="cb57-150"><a href="#cb57-150" tabindex="-1"></a><span class="co">#     chance_false = if_else(total &gt; 0, n_false / total * 100, NA_real_),</span></span>
<span id="cb57-151"><a href="#cb57-151" tabindex="-1"></a><span class="co">#     chance_zero = chance_false == 0,</span></span>
<span id="cb57-152"><a href="#cb57-152" tabindex="-1"></a><span class="co">#     chance_below_1 = chance_false &lt; 1,</span></span>
<span id="cb57-153"><a href="#cb57-153" tabindex="-1"></a><span class="co">#     chance_low = if_else(chance_zero, 0, if_else(chance_below_1, 1, 2)),</span></span>
<span id="cb57-154"><a href="#cb57-154" tabindex="-1"></a><span class="co">#     chance_low = factor(chance_low, levels = c(0,1,2), labels = c(&quot;equls 0 %&quot;, &quot;below 1 %&quot;, &quot;more&quot;))</span></span>
<span id="cb57-155"><a href="#cb57-155" tabindex="-1"></a><span class="co">#   ) %&gt;% group_by(predicted_NA, model, respect_units) %&gt;% mutate(</span></span>
<span id="cb57-156"><a href="#cb57-156" tabindex="-1"></a><span class="co">#     perc = total/sum(total)*100</span></span>
<span id="cb57-157"><a href="#cb57-157" tabindex="-1"></a><span class="co">#   ) %&gt;% ungroup() %&gt;% </span></span>
<span id="cb57-158"><a href="#cb57-158" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb57-159"><a href="#cb57-159" tabindex="-1"></a><span class="co">#     chance_false_interval = cut(</span></span>
<span id="cb57-160"><a href="#cb57-160" tabindex="-1"></a><span class="co">#       chance_false,</span></span>
<span id="cb57-161"><a href="#cb57-161" tabindex="-1"></a><span class="co">#       breaks = c(0, 1, 2, 4, 8, 16, 32, 64, Inf),</span></span>
<span id="cb57-162"><a href="#cb57-162" tabindex="-1"></a><span class="co">#       labels = c(&quot;[0,1)&quot;, &quot;[1,2)&quot;, &quot;[2,4)&quot;, &quot;[4,8)&quot;, </span></span>
<span id="cb57-163"><a href="#cb57-163" tabindex="-1"></a><span class="co">#                  &quot;[8,16)&quot;, &quot;[16,32)&quot;, &quot;[32,64)&quot;, &quot;[64,Inf)&quot;),</span></span>
<span id="cb57-164"><a href="#cb57-164" tabindex="-1"></a><span class="co">#       right = FALSE,</span></span>
<span id="cb57-165"><a href="#cb57-165" tabindex="-1"></a><span class="co">#       ordered_result = TRUE</span></span>
<span id="cb57-166"><a href="#cb57-166" tabindex="-1"></a><span class="co">#     ),</span></span>
<span id="cb57-167"><a href="#cb57-167" tabindex="-1"></a><span class="co">#   )</span></span></code></pre></div>
</details>
<div id="ground-truth-dataset" class="section level5 hasAnchor paragraph-start" number="9.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">9.2.2.0.1</span> Ground truth dataset<a href="#ground-truth-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For this task we created synthetic <strong>Aktiva</strong> tables that should allow
to investigate the influence certain characteristics of tables on the
extraction task. We systematically created <strong>Aktiva</strong> tables that vary
over the following characteristics:</p>
</div>
<ol style="list-style-type: decimal">
<li>n_columns: Number of columns the numeric values are distributed over
ranging from 2 to 4.</li>
<li>header_span: Span in the header rows.</li>
<li>thin: Including just a subset of all possible entries for a
<strong>Aktiva</strong> table.</li>
<li>unit_in_first_cell: Is the currency unit (e.g. T€) given in the
beginning of the table instead for each column.</li>
<li>enumeration: Are the rows numerated following the schema in the
legal text.</li>
<li>many_line_breaks: Limiting the character length for the row
descriptions to 50 to introduce line breaks.</li>
<li>shuffle_rows: The order of the rows within lower hierarchies can
vary.</li>
<li>text_around: There is some random text before and after the table on
the generated page.</li>
<li>sum_same_line: Summed values are in the same line as single values
if there are more than two columns.</li>
<li>unit: Eight different currency units from. E.g.: €, TEUR, Mio. €</li>
<li>input_format: Table is exported as PDF, HTML or Markdown document.</li>
</ol>
<p>This results in 49152 tables. A sample of 10 % is used for
the extraction task. The <em>header_span</em> and <em>text_around</em> are only varied
for the PDF format.</p>
<div id="extraction-task-overview" class="section level5 hasAnchor paragraph-start" number="9.2.2.0.2">
<h5 class="hasAnchor"><span class="header-section-number">9.2.2.0.2</span> Extraction task overview<a href="#extraction-task-overview" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>For the table extraction task with synthetic <strong>Aktiva</strong> tables
17 open source models
from 6 model
families have been benchmarked. There have been the same seven methods
tested with each <a href="#acronyms_LLM">LLM</a> as described in section
@ref(extraction-with-llms-real-tables). Each method was used twice,
because in one trial the <a href="#acronyms_LLM">LLM</a> is prompted to respect the currency
units and in the other trail it is not.</p>
</div>
<p>This results in 531 files, that hold the
results of 4_915 table extractions each. For the investigation of
potential predictors influences the random forest is generated with a
sample of 50_000 of these 68_810 results and finally, the <a href="#acronyms_SHAP">SHAP</a>
values are calculated with 2_000 rows of data.</p>
<div id="performance-3" class="section level5 hasAnchor paragraph-start" number="9.2.2.0.3">
<h5 class="hasAnchor"><span class="header-section-number">9.2.2.0.3</span> Performance<a href="#performance-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:table-metrics-llm-real-table-extraction-synth-context)
shows the best performing combination of <a href="#acronyms_LLM">LLM</a> and prompting
strategy for each model family. The results are sorted by their mean
percentage of total correct predictions. We only compare results for
table extractions that work with a PDF document based table here.</p>
</div>
<p>For every model family there is at least one model-method combination
that performed better than the <a href="#acronyms_regex">regex</a> baseline. For the synthetic
table extraction task the baseline is
0.966.
67 from 129
model-method combinations perform better than this baseline. There has
been no model that performed better than this baseline with the
<em>zero_shot</em> or <em>static_example</em> method.</p>
<p>Table @ref(tab:table-metrics-llm-real-table-extraction-synth-context)
shows, that Qwen3-235B-A22B-Instruct performs best. Llama 4 Scout also
performs very good but is three times faster. Table
@ref(tab:table-metrics-llm-real-table-extraction-synth-context-small)
shows three small <a href="#acronyms_LLM">LLM</a>s that also beat the median threshold for the
synthetic table extraction task. But we would not prefer the Qwen3-8B
model over the Llama Scout model, because its speed advantage is to
small, compared to the performance decrease. But if there is limited
VRAM available the Qwen3 model is a good choice. It can run well with 40
GB VRAM. The Llama Scout needs 640 GB VRAM to run well<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>.</p>
<p>Detail:</p>
<p>Figure
@ref(fig:synth-table-extraction-llm-performance-numeric-overview)
shows, that Llama 3.3 70B never manages to reduce the spread in the
numeric prediction performance.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>df_synth_top_performance <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>    <span class="st">&quot;median_runtime in minutes&quot;</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">round</span>(median_runtime<span class="sc">/</span><span class="dv">60</span>), <span class="st">&quot;:&quot;</span>, <span class="fu">round</span>(median_runtime<span class="sc">%%</span><span class="dv">60</span>)),</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>      median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median,</span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, median_total, <span class="st">&quot;**&quot;</span>),</span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a>      <span class="fu">as.character</span>(median_total)</span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>      )</span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>median_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb58-10"><a href="#cb58-10" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing best median table extraction performance with synthetic &#39;Aktiva&#39; dataset for each model family&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">alignment =</span> <span class="st">&quot;lllrrrr&quot;</span>, <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-real-table-extraction-synth-context)Comparing best median table extraction performance with synthetic ‘Aktiva’ dataset for each model family
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-58d7175b9e3e8fecc073" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-58d7175b9e3e8fecc073">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["Qwen 3","mistralai","Qwen 2.5","Llama-4","google","Llama-3"],["Qwen3-235B-A22B-Instruct-2507","Mistral-Large-Instruct-2411","Qwen2.5-72B-Instruct","Llama-4-Maverick-17B-128E-Instruct-FP8","gemma-3-27b-it","Llama-3.1-70B-Instruct"],["static_<wbr>example","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["1","3","5","1","5","3"],["0.993","0.987","0.979","0.97","0.917","0.91"],["<b>1<\/b>","<b>1<\/b>","<b>1<\/b>","<b>1<\/b>","0.931","<b>1<\/b>"],["33:6","111:47","96:45","27:27","33:36","60:41"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>mean total<\/th>\n      <th>median total<\/th>\n      <th>median runtime in minutes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"method family","targets":3},{"name":"n examples","targets":4},{"name":"mean total","targets":5},{"name":"median total","targets":6},{"name":"median runtime in minutes","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>df_synth_top_performance_small <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>    <span class="st">&quot;median_runtime in minutes&quot;</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">round</span>(median_runtime<span class="sc">/</span><span class="dv">60</span>), <span class="st">&quot;:&quot;</span>, <span class="fu">round</span>(median_runtime<span class="sc">%%</span><span class="dv">60</span>)),</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>    <span class="at">median_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>      median_total<span class="sc">&gt;</span>synth_table_extraction_regex_total_performance_median,</span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, median_total, <span class="st">&quot;**&quot;</span>),</span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>      <span class="fu">as.character</span>(median_total)</span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a>      )</span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>median_runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing best median table extraction performance with synthetic &#39;Aktiva&#39; dataset for each model family for models with less than 17B parameters&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">alignment =</span> <span class="st">&quot;lllrr&quot;</span>, <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:table-metrics-llm-real-table-extraction-synth-context-small)Comparing best median table extraction performance with synthetic ‘Aktiva’ dataset for each model family for models with less than 17B parameters
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-0df69b2ea2f052406c22" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0df69b2ea2f052406c22">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],["Qwen 3","Qwen 2.5","google","mistralai","Llama-3"],["Qwen3-8B","Qwen2.5-7B-Instruct","gemma-3-12b-it","Ministral-8B-Instruct-2410","Llama-3.1-8B-Instruct"],["top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["3","5","3","3","5"],["0.934","0.928","0.904","0.886","0.835"],["<b>1<\/b>","<b>0.983<\/b>","<b>0.974<\/b>","<b>0.966<\/b>","0.914"],["21:39","16:19","19:55","35:35","21:5"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model family<\/th>\n      <th>model<\/th>\n      <th>method family<\/th>\n      <th>n examples<\/th>\n      <th>mean total<\/th>\n      <th>median total<\/th>\n      <th>median runtime in minutes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model family","targets":1},{"name":"model","targets":2},{"name":"method family","targets":3},{"name":"n examples","targets":4},{"name":"mean total","targets":5},{"name":"median total","targets":6},{"name":"median runtime in minutes","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="hypotheses-1" class="section level5 hasAnchor paragraph-start" number="9.2.2.0.4">
<h5 class="hasAnchor"><span class="header-section-number">9.2.2.0.4</span> Hypotheses<a href="#hypotheses-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table @ref(tab:hypotheses-and-results-synth-table-extraction-llm-table)
shows some unsupported hypotheses for predictors with strong effects.
The observations suggest, that prompting the model to respect the
currency units is decreasing its performance to predict the correct
numeric values. This is understandable, if the task is reflected
properly and we made a mistake there, when we formulated our hypothesis.</p>
</div>
<p>If the model is not prompted to respect the currency units, it is
presented with examples that just copy over the numeric values. And it
gets evaluated if it copied the values correctly. If the model is
prompted to respect the currency units, it is presented with examples,
where the values not only get copied but also transformed. And they get
evaluated if they do the transformation correct as well. Thus the task
is harder, if numeric values should be respected and the effect is
having a negative direction.</p>
<p>Figure
@ref(fig:better-performance-for-value-transformation-with-html-and-md)
shows that the transformation task is handled best, if the examples are
provided with the <em>top_n_rag</em> strategy. It does not work with the
<em>zero_shot</em> strategy. It also shows, that the performance is lower with
the PDF <em>input_format</em> and that the models have difficulties, if the
<em>unit_multiplier</em> is one million. This also shows a strong effect and is
strongest for the PDF <em>input_format</em>. This is a general effect. We see
in @ref(fig:table-extraction-llm-confidence-lm-synth) that it can be
different for single models like Qwen3-235B.</p>
<p>old:</p>
<p>HTML and Markdown better but expected interaction effects mostly not
found - except: - columns help pdf - thinning least bad for pdf - pdf
worst with numbers that have currency units (short numbers, maybe no
1000er delimiter) - enumeration positive for pdf (and interaction with
log10 mult)</p>
<p>line breaks are no problem</p>
<p>zero shot gets confused by text around</p>
<p>Markdown might be even better than HTML</p>
<p>respecting units was bad - except for: Top n rag finds examples with
same currency units (shorter numbers more important than currnency in
header?)</p>
<p>log10 multiplier has many interaction effects</p>
<p>LLama 4 Maverick again problem with five examples</p>
<p>Positive column count effect (different for real data)</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">create_hypotheses_table</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_synth_table_extraction_llm.html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Comparing the formulated hypotheses and the found results for the table extraction on synthetic Aktiva tables with the LLM approach.&quot;</span>, <span class="at">detect =</span> <span class="st">&quot;:&quot;</span>)</span></code></pre></div>
</details>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:hypotheses-and-results-synth-table-extraction-llm-table)Comparing the formulated hypotheses and the found results for the table extraction on synthetic Aktiva tables with the LLM approach.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
F1
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
% correct numeric
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
binomial
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
confidence
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
predictor
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">model_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">google worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Qwen3 &amp; mistral best</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unkown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">google &amp; llama 3 worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral (except for Maverick)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">parameter_count</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">method_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">zero shot worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">top_n_rag best</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">top_n_rag best</span>
</td>
<td style="text-align:left;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_examples</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive (except for Llama 4 Maverick)</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral (Maverick bad with 5 examples)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_columns</span>
</td>
<td style="text-align:left;">
<span style="     ">3 is worse</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">3 is worse</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">3 is worse</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">n_columns:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">less for html and md</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">less for html and md</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">effect only for pdf</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">less for html and md</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">positive for pdf</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">less for html and md</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">less for html and md</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">sum_same_line</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">sum_same_line:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">header_span:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">Can’t be evaluated</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     "></span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">Can’t be evaluated</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     "></span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">Can’t be evaluated</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">Can’t be evaluated</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     "></span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">header_span:respect_units</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">thin</span>
</td>
<td style="text-align:left;">
<span style="     ">Can’t be evaluated</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">Neutral (positive for pdf)</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative (for small log10 mult)</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">respect_units</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">respect_units:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style=" font-weight: bold;    ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">input_format</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">md and html better</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">md and html better</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">md and html better</span>
</td>
<td style="text-align:left;">
<span style="     ">md and html better</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">md and html better</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">md and html better</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">year_as</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">Text positive for zero shot</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">Text positive for zero shot</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">unit_in_first_cell</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Negative for big log10 multiplier</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">unit_in_first_cell:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">log10_unit_multiplier</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">log10_unit_multiplier:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">negative for pdf</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">worst for pdf</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">most for pdf</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     color: darkred !important;">negative for pdf</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">enumeration</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">Positive for big log10 multiplier or pdf</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive for pdf</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">shuffle_rows</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">text_around</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">many_line_breaks</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">many_line_breaks:input_format</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">better for html and md</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label_length</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">missing</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Positive (i.e. for big log10 mult)</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">confidence</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
</tbody>
</table>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>df_synth_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">!=</span> <span class="st">&quot;static_example&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">respect_units =</span> <span class="sc">!</span>ignore_units) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> percentage_correct_numeric, <span class="at">x =</span> <span class="fu">factor</span>(unit_multiplier), <span class="at">fill =</span> input_format), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span> </span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">~</span>method_family)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/better-performance-for-value-transformation-with-html-and-md-1.png" alt="Comparing the percentage of correct extracted numeric values grouped by input format, method family and the fact, if currency should be respected." width="100%" />
<p class="caption">
(#fig:better-performance-for-value-transformation-with-html-and-md)Comparing the percentage of correct extracted numeric values grouped by input format, method family and the fact, if currency should be respected.
</p>
</div>
</div>
<div id="real-table-extraction-synth-context" class="section level3 hasAnchor" number="9.2.3">
<h3 class="hasAnchor"><span class="header-section-number">9.2.3</span> Hybrid approach<a href="#real-table-extraction-synth-context" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>best_models_with_examples <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(method_family, <span class="st">&quot;n_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>    model, method</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a>    <span class="at">median_synth =</span> <span class="fu">median</span>(percentage_correct_total),</span>
<span id="cb62-8"><a href="#cb62-8" tabindex="-1"></a>    <span class="co"># mean_synth = mean(percentage_correct_total)</span></span>
<span id="cb62-9"><a href="#cb62-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-10"><a href="#cb62-10" tabindex="-1"></a>  <span class="co"># arrange(desc(median_synth)) %&gt;% </span></span>
<span id="cb62-11"><a href="#cb62-11" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb62-12"><a href="#cb62-12" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, median_synth, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-13"><a href="#cb62-13" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(median_synth)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-14"><a href="#cb62-14" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb62-15"><a href="#cb62-15" tabindex="-1"></a>    df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb62-16"><a href="#cb62-16" tabindex="-1"></a>      model, method</span>
<span id="cb62-17"><a href="#cb62-17" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">median_real =</span> <span class="fu">median</span>(percentage_correct_total))) <span class="sc">%&gt;%</span> </span>
<span id="cb62-18"><a href="#cb62-18" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb62-19"><a href="#cb62-19" tabindex="-1"></a>    df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb62-20"><a href="#cb62-20" tabindex="-1"></a>      model, method</span>
<span id="cb62-21"><a href="#cb62-21" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-22"><a href="#cb62-22" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">median_zero_shot =</span> <span class="fu">median</span>(percentage_correct_total)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>method)</span>
<span id="cb62-23"><a href="#cb62-23" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-24"><a href="#cb62-24" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))</span>
<span id="cb62-25"><a href="#cb62-25" tabindex="-1"></a></span>
<span id="cb62-26"><a href="#cb62-26" tabindex="-1"></a>median_models_with_examples <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb62-27"><a href="#cb62-27" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(method_family, <span class="st">&quot;n_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-28"><a href="#cb62-28" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb62-29"><a href="#cb62-29" tabindex="-1"></a>    model<span class="co">#, method</span></span>
<span id="cb62-30"><a href="#cb62-30" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-31"><a href="#cb62-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_synth =</span> <span class="fu">median</span>(percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-32"><a href="#cb62-32" tabindex="-1"></a>  <span class="co"># arrange(desc(median_synth)) %&gt;% </span></span>
<span id="cb62-33"><a href="#cb62-33" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, median_synth, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-34"><a href="#cb62-34" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(median_synth)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-35"><a href="#cb62-35" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb62-36"><a href="#cb62-36" tabindex="-1"></a>    df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb62-37"><a href="#cb62-37" tabindex="-1"></a>      model<span class="co">#, method</span></span>
<span id="cb62-38"><a href="#cb62-38" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">median_real =</span> <span class="fu">median</span>(percentage_correct_total))) <span class="sc">%&gt;%</span> </span>
<span id="cb62-39"><a href="#cb62-39" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb62-40"><a href="#cb62-40" tabindex="-1"></a>    df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb62-41"><a href="#cb62-41" tabindex="-1"></a>      model, method</span>
<span id="cb62-42"><a href="#cb62-42" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-43"><a href="#cb62-43" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">median_zero_shot =</span> <span class="fu">median</span>(percentage_correct_total)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>method)</span>
<span id="cb62-44"><a href="#cb62-44" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-45"><a href="#cb62-45" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">3</span>))</span>
<span id="cb62-46"><a href="#cb62-46" tabindex="-1"></a></span>
<span id="cb62-47"><a href="#cb62-47" tabindex="-1"></a>best_mistral <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model_family <span class="sc">==</span> <span class="st">&quot;mistralai&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">median_synth =</span> <span class="fu">median</span>(percentage_correct_total)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(median_synth)) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(median_synth)</span>
<span id="cb62-48"><a href="#cb62-48" tabindex="-1"></a></span>
<span id="cb62-49"><a href="#cb62-49" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb62-50"><a href="#cb62-50" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_col_T_EUR =</span> T_EUR_both <span class="sc">+</span> T_EUR) <span class="sc">%&gt;%</span> </span>
<span id="cb62-51"><a href="#cb62-51" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-52"><a href="#cb62-52" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb62-53"><a href="#cb62-53" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples))),</span>
<span id="cb62-54"><a href="#cb62-54" tabindex="-1"></a>    <span class="at">respect_units =</span> <span class="sc">!</span>ignore_units</span>
<span id="cb62-55"><a href="#cb62-55" tabindex="-1"></a>  )</span>
<span id="cb62-56"><a href="#cb62-56" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" tabindex="-1"></a>n_tables_n_cols <span class="ot">&lt;-</span> df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> <span class="fu">select</span>(filepath, n_col_T_EUR) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(n_col_T_EUR) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">n</span>())</span>
<span id="cb62-58"><a href="#cb62-58" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" tabindex="-1"></a>confidence_vs_truth_hybrid <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb62-60"><a href="#cb62-60" tabindex="-1"></a>  <span class="fu">filter</span>(method_family <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-61"><a href="#cb62-61" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-62"><a href="#cb62-62" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb62-63"><a href="#cb62-63" tabindex="-1"></a>    <span class="at">median_percentage_correct_total =</span> <span class="fu">median</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span>,</span>
<span id="cb62-64"><a href="#cb62-64" tabindex="-1"></a>    <span class="at">respect_units =</span> <span class="sc">!</span>ignore_units</span>
<span id="cb62-65"><a href="#cb62-65" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(respect_units, model, filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb62-66"><a href="#cb62-66" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(median_percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-67"><a href="#cb62-67" tabindex="-1"></a>  <span class="fu">slice_max</span>(median_percentage_correct_total, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-68"><a href="#cb62-68" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_processed =</span> <span class="fu">map</span>(predictions, <span class="sc">~</span>{</span>
<span id="cb62-69"><a href="#cb62-69" tabindex="-1"></a>    .x <span class="sc">%&gt;%</span> </span>
<span id="cb62-70"><a href="#cb62-70" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;_merge&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-71"><a href="#cb62-71" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb62-72"><a href="#cb62-72" tabindex="-1"></a>        <span class="at">match =</span> (year_truth <span class="sc">==</span> year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(year_result)),</span>
<span id="cb62-73"><a href="#cb62-73" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_this_year,</span>
<span id="cb62-74"><a href="#cb62-74" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(year_truth),</span>
<span id="cb62-75"><a href="#cb62-75" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(year_result),</span>
<span id="cb62-76"><a href="#cb62-76" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb62-77"><a href="#cb62-77" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb62-78"><a href="#cb62-78" tabindex="-1"></a>        <span class="at">tuple_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb62-79"><a href="#cb62-79" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-80"><a href="#cb62-80" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb62-81"><a href="#cb62-81" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_previous_year,</span>
<span id="cb62-82"><a href="#cb62-82" tabindex="-1"></a>        <span class="at">match =</span> (previous_year_truth <span class="sc">==</span> previous_year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(previous_year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(previous_year_result)),</span>
<span id="cb62-83"><a href="#cb62-83" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(previous_year_truth),</span>
<span id="cb62-84"><a href="#cb62-84" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(previous_year_result),</span>
<span id="cb62-85"><a href="#cb62-85" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb62-86"><a href="#cb62-86" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb62-87"><a href="#cb62-87" tabindex="-1"></a>        <span class="at">tuple_previous_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb62-88"><a href="#cb62-88" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb62-89"><a href="#cb62-89" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">c</span>(year_truth, previous_year_truth, year_result, previous_year_result,</span>
<span id="cb62-90"><a href="#cb62-90" tabindex="-1"></a>           confidence_this_year, confidence_previous_year)</span>
<span id="cb62-91"><a href="#cb62-91" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb62-92"><a href="#cb62-92" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;E1&quot;</span>, <span class="st">&quot;E2&quot;</span>, <span class="st">&quot;E3&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-93"><a href="#cb62-93" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb62-94"><a href="#cb62-94" tabindex="-1"></a>        <span class="at">match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(match), <span class="cn">FALSE</span>, match)</span>
<span id="cb62-95"><a href="#cb62-95" tabindex="-1"></a>      )</span>
<span id="cb62-96"><a href="#cb62-96" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb62-97"><a href="#cb62-97" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions_processed) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb62-98"><a href="#cb62-98" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb62-99"><a href="#cb62-99" tabindex="-1"></a>    <span class="at">truth_NA =</span> <span class="fu">factor</span>(truth_NA, <span class="at">levels =</span> <span class="fu">c</span>(F, T))</span>
<span id="cb62-100"><a href="#cb62-100" tabindex="-1"></a>  )</span>
<span id="cb62-101"><a href="#cb62-101" tabindex="-1"></a></span>
<span id="cb62-102"><a href="#cb62-102" tabindex="-1"></a>confidence_intervals_hybrid <span class="ot">&lt;-</span> confidence_vs_truth_hybrid <span class="sc">%&gt;%</span> <span class="co">#rename(confidence = confidence_score) %&gt;% </span></span>
<span id="cb62-103"><a href="#cb62-103" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-104"><a href="#cb62-104" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-105"><a href="#cb62-105" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb62-106"><a href="#cb62-106" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-107"><a href="#cb62-107" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, predicted_NA, model, respect_units) <span class="sc">%&gt;%</span></span>
<span id="cb62-108"><a href="#cb62-108" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-109"><a href="#cb62-109" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-110"><a href="#cb62-110" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-111"><a href="#cb62-111" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb62-112"><a href="#cb62-112" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb62-113"><a href="#cb62-113" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb62-114"><a href="#cb62-114" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb62-115"><a href="#cb62-115" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb62-116"><a href="#cb62-116" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb62-117"><a href="#cb62-117" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(predicted_NA, model, respect_units) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb62-118"><a href="#cb62-118" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb62-119"><a href="#cb62-119" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-120"><a href="#cb62-120" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-121"><a href="#cb62-121" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb62-122"><a href="#cb62-122" tabindex="-1"></a>      chance_false,</span>
<span id="cb62-123"><a href="#cb62-123" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb62-124"><a href="#cb62-124" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb62-125"><a href="#cb62-125" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb62-126"><a href="#cb62-126" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb62-127"><a href="#cb62-127" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb62-128"><a href="#cb62-128" tabindex="-1"></a>    ),</span>
<span id="cb62-129"><a href="#cb62-129" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p>In this section we present the results of using synthetic <strong>Aktiva</strong>
tables for the in-context learning to extract information from real
<strong>Aktiva</strong> tables. We show that even such a hybrid approach can be used,
to extend the extraction task by a unit conversation task.</p>
<div id="performance-4" class="section level5 hasAnchor paragraph-start" number="9.2.3.0.1">
<h5 class="hasAnchor"><span class="header-section-number">9.2.3.0.1</span> Performance<a href="#performance-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table
@ref(tab:comparing-extraction-performance-real-and-synth-context-learning)
compares the overall performance for the extraction task of the best
model-method combination in the hybrid approach per model with the
<em>zero_shot</em> and real example training performance. Using real examples
for in-context-learning for those model-method combinations is better
than using the generated synthetic data. Qwen3-8B and gemma3-12b can
improve the most using real examples instead of sythetic examples,
normalized on the possible improvement from the synthetic learning
results using this formula:</p>
</div>
<p><span class="math display">\[
delta\_rate_{synth} = \frac{median \left( real \right)-median \left( synth \right)}{1-median \left( synth \right)}
\]</span></p>
<p>On the same time, gemma3-12b shows the lowest <em>delta_rate</em> with under 10
%, when the improvement of using synthetic examples is compared with the
<em>zero_shot</em> method. For the other models this is more tan 48 % and
highest for Llama Scout 4 with 87.5 % improving from 0.45 to 0.93.
Qwen-235B score as high with both learning approaches, but scored best
with just using a single synthetic example. Table
@ref(tab:comparing-extraction-performance-real-and-synth-context-learning-median)
shows that these observations are valid for the improvement with in the
models independent from the selected method. Figure
@ref(fig:compare-real-table-extraction-by-context-type) shows, that the
improvement for using one or three synthetic examples is biggest for
Qwen3-8B.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>best_models_with_examples <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>    <span class="at">delta_real_synth =</span> median_real<span class="sc">-</span>median_synth,</span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>    <span class="at">delta_rate_real_synth =</span> (delta_real_synth)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>median_synth),</span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a>    <span class="at">delta_synth_zero =</span> median_synth<span class="sc">-</span>median_zero_shot,</span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>    <span class="at">delta_rate_synth_zero =</span> (delta_synth_zero)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>median_zero_shot)</span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb63-9"><a href="#cb63-9" tabindex="-1"></a>    is.numeric, </span>
<span id="cb63-10"><a href="#cb63-10" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb63-11"><a href="#cb63-11" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-12"><a href="#cb63-12" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb63-13"><a href="#cb63-13" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb63-14"><a href="#cb63-14" tabindex="-1"></a>    )</span>
<span id="cb63-15"><a href="#cb63-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb63-16"><a href="#cb63-16" tabindex="-1"></a>    model, method, median_real, median_synth, median_zero_shot, </span>
<span id="cb63-17"><a href="#cb63-17" tabindex="-1"></a>    <span class="co"># delta_real_synth, delta_synth_zero, </span></span>
<span id="cb63-18"><a href="#cb63-18" tabindex="-1"></a>    delta_rate_real_synth, delta_rate_synth_zero</span>
<span id="cb63-19"><a href="#cb63-19" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb63-20"><a href="#cb63-20" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb63-21"><a href="#cb63-21" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llrrrrr&quot;</span>,</span>
<span id="cb63-22"><a href="#cb63-22" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing extraction performance for real Aktiva extraction task with synthetic and real examples for in-context learning with a zero shot approach for the best performing model-method combination in the hybrid&quot;</span>,</span>
<span id="cb63-23"><a href="#cb63-23" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:comparing-extraction-performance-real-and-synth-context-learning)Comparing extraction performance for real Aktiva extraction task with synthetic and real examples for in-context learning with a zero shot approach for the best performing model-method combination in the hybrid
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-be57c74bac22db66d4b9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-be57c74bac22db66d4b9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Qwen3-235B-A22B-Instruct-2507-FP8","Llama-4-Scout-17B-16E-Instruct","Mistral-Large-Instruct-2411","Qwen3-8B","Llama-3.1-8B-Instruct","Ministral-8B-Instruct-2410","gemma-3-27b-it","gemma-3-12b-it"],["1_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","5_<wbr>random_<wbr>examples","3_<wbr>random_<wbr>examples","top_<wbr>1_<wbr>rag_<wbr>examples"],["<b>0.966<\/b>","<b>0.966<\/b>","<b>0.966<\/b>","0.94","0.836","0.897","0.828","0.862"],["<b>0.966<\/b>","0.931","0.922","0.802","0.776","0.767","0.724","0.586"],["<b>0.897<\/b>","0.448","0.776","0.336","0.552","0.552","0.207","0.543"],["0","0.507","0.564","<b>0.697<\/b>","0.268","0.558","0.377","0.667"],["0.67","<b>0.875<\/b>","0.652","0.702","0.5","0.48","0.652","0.094"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>method<\/th>\n      <th>median real<\/th>\n      <th>median synth<\/th>\n      <th>median zero shot<\/th>\n      <th>delta rate real synth<\/th>\n      <th>delta rate synth zero<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"targets":7,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"method","targets":2},{"name":"median real","targets":3},{"name":"median synth","targets":4},{"name":"median zero shot","targets":5},{"name":"delta rate real synth","targets":6},{"name":"delta rate synth zero","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div id="learning-to-respect-currency-units" class="section level5 hasAnchor paragraph-start" number="9.2.3.0.2">
<h5 class="hasAnchor"><span class="header-section-number">9.2.3.0.2</span> Learning to respect currency units<a href="#learning-to-respect-currency-units" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table
@ref(tab:comparing-extraction-performance-synth-context-learning-respecting-units-table)
shows, the difference in the percentage of correct predicted numeric
values, if the <a href="#acronyms_LLM">LLM</a> is prompted to respect currency units and gets
synthetic <strong>Aktiva</strong> tables that show how to cope with different
currency units, separate for the number of columns with currency units.
There are 17 tables that have
<em>T€</em> in the previous year column and
9 tables that have all
columns listed in <em>T€</em>.</p>
</div>
<p>It shows, that Qwen3-235B, Llama 4 Scout, Mistral-Large and Ministral-8B
all can apply the demonstrated numeric transformation for most of the
values, if both columns have the <em>T€</em> unit. Qwen3-235B, Llama 4 Scout
and Mistral-Large also can apply this, if only one columns has a unit
corrency. This works best for Qwen3-235B. The target value to archive
here is 0.5 instead of 1.0. This is worth to mentioning because there
are no synthetic examples that haf different currency units for
different columns. Ministral can not generalize this skill. It seems,
that Qwen3 apllies numeric transformations regardles the fact, if there
are currency units given for a column. Thus, it performs noticeably
worse on the majority of all tables. Figure
@ref(fig:table-extraction-llm-respecting-units-plot) shows, that the
performance of Llama 3.1 8B and gemma3 27B on colums with currency units
does not change.</p>
<p>@ref(fig:compare-effect-of-respecting-units-on-overall-performance),
@ref(fig:compare-effect-of-respecting-units-on-numeric-performance) and
@ref(fig:compare-effect-of-respecting-units-on-NA-F1)</p>
<p>Thus, synthetic data can be used to solve new tasks and substitute
missing data for rare classes.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>  <span class="fu">filter</span>(method_family <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  <span class="fu">group_by</span>(model, method, method_family, respect_units, n_col_T_EUR) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">median_num =</span> <span class="fu">median</span>(percentage_correct_numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> respect_units, <span class="at">values_from =</span> median_num, <span class="at">names_prefix =</span> <span class="st">&quot;units_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta =</span> units_TRUE <span class="sc">-</span> units_FALSE) <span class="sc">%&gt;%</span> </span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(units_FALSE, units_TRUE)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> n_col_T_EUR, <span class="at">values_from =</span> delta, <span class="at">names_prefix =</span> <span class="st">&quot;n_cols_T_EUR_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a>    model<span class="co">#, method_family</span></span>
<span id="cb64-11"><a href="#cb64-11" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb64-12"><a href="#cb64-12" tabindex="-1"></a>  <span class="fu">summarise_if</span>(is.numeric, median) <span class="sc">%&gt;%</span> </span>
<span id="cb64-13"><a href="#cb64-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb64-14"><a href="#cb64-14" tabindex="-1"></a>  <span class="co"># group_by(method_family) %&gt;% </span></span>
<span id="cb64-15"><a href="#cb64-15" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb64-16"><a href="#cb64-16" tabindex="-1"></a>    is.numeric, </span>
<span id="cb64-17"><a href="#cb64-17" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb64-18"><a href="#cb64-18" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb64-19"><a href="#cb64-19" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb64-20"><a href="#cb64-20" tabindex="-1"></a>      .</span>
<span id="cb64-21"><a href="#cb64-21" tabindex="-1"></a>    )</span>
<span id="cb64-22"><a href="#cb64-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb64-23"><a href="#cb64-23" tabindex="-1"></a>  <span class="co"># arrange(method_family) %&gt;% </span></span>
<span id="cb64-24"><a href="#cb64-24" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb64-25"><a href="#cb64-25" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrrr&quot;</span>,</span>
<span id="cb64-26"><a href="#cb64-26" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing extraction performance for real Aktiva extraction task dependent on the promt addition to respect currency units&quot;</span>,</span>
<span id="cb64-27"><a href="#cb64-27" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:comparing-extraction-performance-synth-context-learning-respecting-units-table)Comparing extraction performance for real Aktiva extraction task dependent on the promt addition to respect currency units
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-321e35cf927c47ee14e7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-321e35cf927c47ee14e7">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Llama-3.1-8B-Instruct","Llama-4-Scout-17B-16E-Instruct","Ministral-8B-Instruct-2410","Mistral-Large-Instruct-2411","Qwen3-235B-A22B-Instruct-2507-FP8","Qwen3-8B","gemma-3-12b-it","gemma-3-27b-it"],["-0.03","<b>0<\/b>","-0.08","<b>0<\/b>","<b>0<\/b>","-0.48","-0.03","<b>0<\/b>"],["-0.02","0.28","0","0.39","<b>0.44<\/b>","0","0.17","0.06"],["0.01","0.89","0.79","0.9","<b>0.96<\/b>","0.28","0.48","0.02"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>n cols T EUR 0<\/th>\n      <th>n cols T EUR 1<\/th>\n      <th>n cols T EUR 2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"n cols T EUR 0","targets":2},{"name":"n cols T EUR 1","targets":3},{"name":"n cols T EUR 2","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_numeric)) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>  <span class="fu">facet_nested</span>(respect_units<span class="sc">+</span>n_col_T_EUR<span class="sc">~</span>.)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-respecting-units-plot-1.png" alt="Comparing the numeric prediction performance for the hybrid approach, based on the fact, if the LLM is prompted to respect currency units." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-respecting-units-plot)Comparing the numeric prediction performance for the hybrid approach, based on the fact, if the LLM is prompted to respect currency units.
</p>
</div>
</div>
</div>
<div id="summary-3" class="section level2 hasAnchor" number="9.3">
<h2 class="hasAnchor"><span class="header-section-number">9.3</span> Summary<a href="#summary-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--chapter:end:10_Information_Extraction.Rmd-->
</div>
</div>
<div id="appendix-c---error-rate-guidance-report" class="section level1 hasAnchor" number="10">
<h1 class="hasAnchor"><span class="header-section-number">10</span> Appendix C - Error rate guidance report<a href="#appendix-c---error-rate-guidance-report" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>(ref:error-rate-guidance-intro-text)</p>
<p>The formula for the confidence score is given in Equation @ref(eq:confidence).</p>
<div id="page-identification-4" class="section level2 hasAnchor" number="10.1">
<h2 class="hasAnchor"><span class="header-section-number">10.1</span> Page identification<a href="#page-identification-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="binary-classification-1" class="section level3 hasAnchor" number="10.1.1">
<h3 class="hasAnchor"><span class="header-section-number">10.1.1</span> Binary classification<a href="#binary-classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a>target_type <span class="ot">&lt;-</span> <span class="st">&quot;Aktiva&quot;</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>  classification_type <span class="sc">==</span> target_type, n_examples<span class="sc">&lt;=</span><span class="dv">3</span></span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb66-9"><a href="#cb66-9" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb66-11"><a href="#cb66-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-12"><a href="#cb66-12" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb66-13"><a href="#cb66-13" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, target_type)</span>
<span id="cb66-14"><a href="#cb66-14" tabindex="-1"></a>  )</span>
<span id="cb66-15"><a href="#cb66-15" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb66-17"><a href="#cb66-17" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span></code></pre></div>
</details>
<p>We investigate the relation between the reported confidence for an answer
and its correctness, to check if it is possible to inform humans in the
loop about results they should double check and which results they can
trust. The <a href="#acronyms_LLM">LLM</a> just returns one
prediction and its confidence<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a> for the binary classification task. We calculate its confidence as <span class="math inline">\(confidence = exp(logprob)\)</span>, if the answer is <em>yes</em>. And we calculate its confidence as <span class="math inline">\(confidence = 1-exp(logprob)\)</span>, if the the answer is <em>no</em>,</p>
<p>Figure @ref(fig:confidence-match-plot-mistral-binary) shows the
distribution of reported confidence score for the binary classification
with target type <strong>Aktiva</strong> for all table types grouped by their
correctness for Ministral-8B-Instruct-2410. One can see that the predictions are very accurate making just
13 mistakes for 4981
predictions.</p>
<p>The reported confidence for answer <em>yes</em> is showing a wide
spread from around 0.25 to 1.0. This is true for the answer <em>no</em> as
well. Most wrong decisions are made for responses that have a reported
confidence in the range from 0.25 to 0.75. But there are more correct
answers in this range as well. It never misclassifies <strong>GuV</strong> or
<strong>Passiva</strong><a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a> as <strong>Aktiva</strong>. But it with shows some not
recalled <strong>Aktiva</strong> tables and is predicting some of the pages of
majority class, with not further described content and structure, as
<strong>Aktiva</strong>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/confidence-match-plot-mistral-binary-1.png" alt="Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Mistral-8B-Instruct-2410." width="100%" />
<p class="caption">
(#fig:confidence-match-plot-mistral-binary)Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Mistral-8B-Instruct-2410.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>, model_family<span class="sc">==</span><span class="st">&quot;Qwen&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb68-10"><a href="#cb68-10" tabindex="-1"></a>  )</span>
<span id="cb68-11"><a href="#cb68-11" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb68-13"><a href="#cb68-13" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span></code></pre></div>
</details>
<p>This is different for models of most other model families. Figure
@ref(fig:confidence-match-plot-qwen-binary) shows, that
Qwen2.5-32B-Instruct returns always high confidence scores,
even when it is wrong. The model shows perfect recall but its precision
is worse than the precision of the Mistral model.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/confidence-match-plot-qwen-binary-1.png" alt="Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Qwen-2.5-32B-Instruct." width="100%" />
<p class="caption">
(#fig:confidence-match-plot-qwen-binary)Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Qwen-2.5-32B-Instruct.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a>calc_flipped_conf_all_types <span class="ot">&lt;-</span> <span class="cf">function</span>(df, model_name, method_name) {</span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a>  l_temp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb70-6"><a href="#cb70-6" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="#cb70-7" tabindex="-1"></a>  <span class="cf">for</span> (target <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;Aktiva&#39;</span>, <span class="st">&#39;GuV&#39;</span>, <span class="st">&#39;Passiva&#39;</span>)) {</span>
<span id="cb70-8"><a href="#cb70-8" tabindex="-1"></a>    <span class="co"># t &lt;- &quot;Aktiva&quot;</span></span>
<span id="cb70-9"><a href="#cb70-9" tabindex="-1"></a>    <span class="co"># df_filtered &lt;- df %&gt;% filter(</span></span>
<span id="cb70-10"><a href="#cb70-10" tabindex="-1"></a>    <span class="co">#   classification_type == t,</span></span>
<span id="cb70-11"><a href="#cb70-11" tabindex="-1"></a>    <span class="co">#   n_examples &lt;= 3,</span></span>
<span id="cb70-12"><a href="#cb70-12" tabindex="-1"></a>    <span class="co">#   loop == 0) %&gt;% </span></span>
<span id="cb70-13"><a href="#cb70-13" tabindex="-1"></a>    <span class="co">#   arrange(desc(f1_score))</span></span>
<span id="cb70-14"><a href="#cb70-14" tabindex="-1"></a>    <span class="co"># model_name_best_f1_aktiva &lt;- df_filtered[model_rank, &quot;model&quot;]</span></span>
<span id="cb70-15"><a href="#cb70-15" tabindex="-1"></a>    <span class="co"># method_best_f1_aktiva &lt;- df_filtered[model_rank, &quot;method&quot;]</span></span>
<span id="cb70-16"><a href="#cb70-16" tabindex="-1"></a>    </span>
<span id="cb70-17"><a href="#cb70-17" tabindex="-1"></a>    df_filtered <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb70-18"><a href="#cb70-18" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb70-19"><a href="#cb70-19" tabindex="-1"></a>        classification_type <span class="sc">==</span> target,</span>
<span id="cb70-20"><a href="#cb70-20" tabindex="-1"></a>        model <span class="sc">==</span> model_name,</span>
<span id="cb70-21"><a href="#cb70-21" tabindex="-1"></a>        method <span class="sc">==</span> method_name,</span>
<span id="cb70-22"><a href="#cb70-22" tabindex="-1"></a>        loop <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb70-23"><a href="#cb70-23" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb70-24"><a href="#cb70-24" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb70-25"><a href="#cb70-25" tabindex="-1"></a>    </span>
<span id="cb70-26"><a href="#cb70-26" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb70-27"><a href="#cb70-27" tabindex="-1"></a>    </span>
<span id="cb70-28"><a href="#cb70-28" tabindex="-1"></a>    df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb70-29"><a href="#cb70-29" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb70-30"><a href="#cb70-30" tabindex="-1"></a>        <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb70-31"><a href="#cb70-31" tabindex="-1"></a>        <span class="at">target =</span> target</span>
<span id="cb70-32"><a href="#cb70-32" tabindex="-1"></a>      )</span>
<span id="cb70-33"><a href="#cb70-33" tabindex="-1"></a>    l_temp[target] <span class="ot">&lt;-</span> <span class="fu">list</span>(df_flipped_score)</span>
<span id="cb70-34"><a href="#cb70-34" tabindex="-1"></a>  }</span>
<span id="cb70-35"><a href="#cb70-35" tabindex="-1"></a>  </span>
<span id="cb70-36"><a href="#cb70-36" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">df =</span> <span class="fu">bind_rows</span>(l_temp), <span class="at">model =</span> model_name, <span class="at">method =</span> method_name)</span>
<span id="cb70-37"><a href="#cb70-37" tabindex="-1"></a>}</span>
<span id="cb70-38"><a href="#cb70-38" tabindex="-1"></a></span>
<span id="cb70-39"><a href="#cb70-39" tabindex="-1"></a>plot_pr_double_curve <span class="ot">&lt;-</span> <span class="cf">function</span>(l, selected_type, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb70-40"><a href="#cb70-40" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb70-41"><a href="#cb70-41" tabindex="-1"></a>  df_temp2 <span class="ot">&lt;-</span> l<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(target <span class="sc">==</span> selected_type) <span class="sc">%&gt;%</span> </span>
<span id="cb70-42"><a href="#cb70-42" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> selected_type, type, <span class="st">&quot;no&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-43"><a href="#cb70-43" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(selected_type, <span class="st">&quot;no&quot;</span>)))</span>
<span id="cb70-44"><a href="#cb70-44" tabindex="-1"></a>  <span class="co"># pr_obj &lt;- pr.curve(scores.class0 = df_temp2$confidence_score[df_temp2$match == 1],</span></span>
<span id="cb70-45"><a href="#cb70-45" tabindex="-1"></a>  <span class="co">#                    scores.class1 = df_temp2$confidence_score[df_temp2$match == 0],</span></span>
<span id="cb70-46"><a href="#cb70-46" tabindex="-1"></a>  <span class="co">#                    curve = TRUE)</span></span>
<span id="cb70-47"><a href="#cb70-47" tabindex="-1"></a>  </span>
<span id="cb70-48"><a href="#cb70-48" tabindex="-1"></a>  <span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb70-49"><a href="#cb70-49" tabindex="-1"></a>  </span>
<span id="cb70-50"><a href="#cb70-50" tabindex="-1"></a>  pr_df <span class="ot">&lt;-</span> df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_curve</span>(type, confidence_score) <span class="sc">%&gt;%</span></span>
<span id="cb70-51"><a href="#cb70-51" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">threshold =</span> .threshold) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold<span class="sc">&lt;=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-52"><a href="#cb70-52" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb70-53"><a href="#cb70-53" tabindex="-1"></a>  </span>
<span id="cb70-54"><a href="#cb70-54" tabindex="-1"></a>  pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_auc</span>(type, confidence_score) <span class="sc">%&gt;%</span> .<span class="sc">$</span>.estimate, <span class="dv">3</span>)</span>
<span id="cb70-55"><a href="#cb70-55" tabindex="-1"></a>  best_F1_row <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb70-56"><a href="#cb70-56" tabindex="-1"></a>  best_F1_row_high_recall <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> </span>
<span id="cb70-57"><a href="#cb70-57" tabindex="-1"></a>    <span class="fu">filter</span>(recall <span class="sc">&gt;</span> <span class="fl">0.999</span>, precision <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb70-58"><a href="#cb70-58" tabindex="-1"></a>  best_F1 <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb70-59"><a href="#cb70-59" tabindex="-1"></a>  best_F1_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb70-60"><a href="#cb70-60" tabindex="-1"></a>  best_threshold <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb70-61"><a href="#cb70-61" tabindex="-1"></a>  best_threshold_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb70-62"><a href="#cb70-62" tabindex="-1"></a>  best_precision_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(precision)</span>
<span id="cb70-63"><a href="#cb70-63" tabindex="-1"></a>  </span>
<span id="cb70-64"><a href="#cb70-64" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb70-65"><a href="#cb70-65" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb70-66"><a href="#cb70-66" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb70-67"><a href="#cb70-67" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-68"><a href="#cb70-68" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb70-69"><a href="#cb70-69" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Precision-Recall Curve for &quot;</span>, selected_type, <span class="st">&quot; (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb70-70"><a href="#cb70-70" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb70-71"><a href="#cb70-71" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb70-72"><a href="#cb70-72" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-73"><a href="#cb70-73" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-74"><a href="#cb70-74" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb70-75"><a href="#cb70-75" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb70-76"><a href="#cb70-76" tabindex="-1"></a>    )</span>
<span id="cb70-77"><a href="#cb70-77" tabindex="-1"></a>  </span>
<span id="cb70-78"><a href="#cb70-78" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb70-79"><a href="#cb70-79" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb70-80"><a href="#cb70-80" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb70-81"><a href="#cb70-81" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-82"><a href="#cb70-82" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb70-83"><a href="#cb70-83" tabindex="-1"></a>      <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb70-84"><a href="#cb70-84" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb70-85"><a href="#cb70-85" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb70-86"><a href="#cb70-86" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb70-87"><a href="#cb70-87" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-88"><a href="#cb70-88" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb70-89"><a href="#cb70-89" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb70-90"><a href="#cb70-90" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb70-91"><a href="#cb70-91" tabindex="-1"></a>    ) </span>
<span id="cb70-92"><a href="#cb70-92" tabindex="-1"></a>  </span>
<span id="cb70-93"><a href="#cb70-93" tabindex="-1"></a>  <span class="cf">if</span> (x_stuff <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb70-94"><a href="#cb70-94" tabindex="-1"></a>    g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-95"><a href="#cb70-95" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb70-96"><a href="#cb70-96" tabindex="-1"></a>    </span>
<span id="cb70-97"><a href="#cb70-97" tabindex="-1"></a>    g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-98"><a href="#cb70-98" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb70-99"><a href="#cb70-99" tabindex="-1"></a>  }</span>
<span id="cb70-100"><a href="#cb70-100" tabindex="-1"></a>  </span>
<span id="cb70-101"><a href="#cb70-101" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> g1 <span class="sc">+</span> g2</span>
<span id="cb70-102"><a href="#cb70-102" tabindex="-1"></a>  combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb70-103"><a href="#cb70-103" tabindex="-1"></a>    <span class="st">&#39;Best F1 score of &#39;</span>, <span class="fu">round</span>(best_F1,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold,<span class="dv">3</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>,</span>
<span id="cb70-104"><a href="#cb70-104" tabindex="-1"></a>    <span class="st">&#39;Best F1 score with recall &gt; 0.999 of &#39;</span>, <span class="fu">round</span>(best_F1_high_recall,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold_high_recall,<span class="dv">3</span>), <span class="st">&#39; (corresp. precision value: &#39;</span>, <span class="fu">round</span>(best_precision_high_recall,<span class="dv">3</span>) , <span class="st">&#39;)&#39;</span>))</span>
<span id="cb70-105"><a href="#cb70-105" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Figure @ref(fig:micro-pr-curve-llm-binary-1) shows the
precision-recall-curve for the best performing model twice for each
target type. On the left plots the line color represents the threshold
score one could use to decide when to accept a response as it is. On the
right plots the line color is showing the F1 score that results with a
chosen threshold.</p>
<p>The <a href="#acronyms_AUC">AUC</a> value is lowest for <strong>Aktiva</strong>. Here the F1 score is
highest for a threshold value of 0.73. This prevents to classify the
pages of type <em>other</em> to get classified as <strong>Aktiva</strong>. If it is required
to have a very high recall value a threshold of 0.44 should be chosen.</p>
<p>The precision-recall-curve for <strong>Passiva</strong> is very similar but there is
a step close to the recall value of 1.0. This has the effect that for a
a guaranteed high recall a very low precision (0.24) and F1 (0.38) has
to be accepted<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>.</p>
<p>The shape of the precision-recall-curve for <strong>GuV</strong> almost perfectly
reaches the top right corner. The highest F1 score is found with a
threshold value of .56. With a threshold value of 0.5 a very high recall
is guaranteed and the F1 score is just a little lower.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span></span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a>method_name <span class="ot">&lt;-</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>df_temp_mistral <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">calc_flipped_conf_all_types</span>(model_name, method_name)</span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="fu">str_c</span>(model_name, <span class="st">&quot; with &quot;</span>, method_name))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/micro-pr-curve-llm-binary-1-1.png" alt="Showing the precsion-recall-curve for the best performing model." width="100%" />
<p class="caption">
(#fig:micro-pr-curve-llm-binary-1)Showing the precsion-recall-curve for the best performing model.
</p>
</div>
<p>Figure @ref(fig:table-identification-llm-confidence) summarizes the
relation between reported confidence and correctness of the
classification for all target types and compares it among the best
performing model-strategy combinations for Ministral-8B-Instruct-2410
and Qwen3-8B. One can see, that the reported confidence for correct and
incorrect classifications are separable in most cases for Mistral-8B.
This separation is worse for Qwen3-8B and worst for target type
<strong>Passiva</strong>.</p>
<p>Figure @ref(fig:table-identification-llm-confidence-lm) shows, that for
Ministral-8B values with a confidence of 0.7 and more, a human don’t has
to double check the classification for target type <strong>GuV</strong>. This
interval is smallest for <strong>Passiva</strong> where only confidences above 0.9
can be fully trusted. These empirical intervals might shrink, once more
data is evaluated. If one is less strict and accepts misclassifiaction
rates of 1 % the found interval for <strong>Passiva</strong> starts at 0.8 and is
probably less depended on the sample evaluated. The percentage of
predictions that can be trusted without risk is greater than 93 % even
for target type <strong>Passiva</strong>.</p>
<p>For Qwen3-8B we find almost no range without any wrong classifications.
For <strong>GuV</strong> this range includes 35 % of all predictions. The ranges that
allow for 1 % of wrong classifications cover 57 % of all predictions at
least.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>confidence_vs_truth_binary <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-32B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>    <span class="at">mean_f1 =</span> <span class="fu">mean</span>(f1_score, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, classification_type) <span class="sc">%&gt;%</span> </span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_f1)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_f1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a>    <span class="co"># truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a>  )</span>
<span id="cb72-13"><a href="#cb72-13" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" tabindex="-1"></a>confidence_vs_truth_binary <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb72-15"><a href="#cb72-15" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb72-16"><a href="#cb72-16" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence_score, <span class="at">fill =</span> classification_type), </span>
<span id="cb72-17"><a href="#cb72-17" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb72-18"><a href="#cb72-18" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb72-19"><a href="#cb72-19" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb72-20"><a href="#cb72-20" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="sc">~</span> model <span class="sc">+</span> classification_type)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-identification-llm-confidence-1.png" alt="Comparing the reported confidence scores for the page identification task for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
(#fig:table-identification-llm-confidence)Comparing the reported confidence scores for the page identification task for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>confidence_vs_truth_binary <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">confidence =</span> confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, classification_type, model) <span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb73-12"><a href="#cb73-12" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb73-13"><a href="#cb73-13" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb73-14"><a href="#cb73-14" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb73-15"><a href="#cb73-15" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb73-16"><a href="#cb73-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(classification_type, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb73-17"><a href="#cb73-17" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb73-18"><a href="#cb73-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-19"><a href="#cb73-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-20"><a href="#cb73-20" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb73-21"><a href="#cb73-21" tabindex="-1"></a>      chance_false,</span>
<span id="cb73-22"><a href="#cb73-22" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb73-23"><a href="#cb73-23" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb73-24"><a href="#cb73-24" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb73-25"><a href="#cb73-25" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-26"><a href="#cb73-26" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb73-27"><a href="#cb73-27" tabindex="-1"></a>    ),</span>
<span id="cb73-28"><a href="#cb73-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-29"><a href="#cb73-29" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-30"><a href="#cb73-30" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> perc, <span class="at">color =</span> chance_low, <span class="at">fill =</span> chance_false_interval), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb73-32"><a href="#cb73-32" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb73-33"><a href="#cb73-33" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb73-34"><a href="#cb73-34" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb73-35"><a href="#cb73-35" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb73-36"><a href="#cb73-36" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-37"><a href="#cb73-37" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb73-38"><a href="#cb73-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-39"><a href="#cb73-39" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb73-40"><a href="#cb73-40" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb73-41"><a href="#cb73-41" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-42"><a href="#cb73-42" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb73-43"><a href="#cb73-43" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb73-44"><a href="#cb73-44" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb73-45"><a href="#cb73-45" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-46"><a href="#cb73-46" tabindex="-1"></a>  <span class="fu">facet_grid</span>(classification_type <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-identification-llm-confidence-lm-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals" width="100%" />
<p class="caption">
(#fig:table-identification-llm-confidence-lm)Estimating the relative frequency to find a wrong classification over different confidence intervals
</p>
</div>
<p>Discussion:</p>
<ul>
<li><p>Could be more efficient to predict “is any of interest” and then
which type, because dataset is highly imbalanced.</p></li>
<li><p>Why takes n_rag_examples so much longer?</p></li>
<li><p><strong>Aktiva</strong> and <strong>Passiva</strong> sometimes on the same page and more
similar than <strong>GuV</strong>?</p></li>
<li><p>Recall = 1 for human in the loop (looking at selection of pages that
could be target and none else, if the number of wrong pages are few
=&gt; what says F1 with recall 1?)</p></li>
<li><p>Confidence range to error rate</p></li>
</ul>
</div>
<div id="multi-class-classification-1" class="section level3 hasAnchor" number="10.1.2">
<h3 class="hasAnchor"><span class="header-section-number">10.1.2</span> Multi-class classification<a href="#multi-class-classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence" class="section level5 hasAnchor paragraph-start" number="10.1.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">10.1.2.0.1</span> Confidence<a href="#confidence" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure @ref(fig:confidence-match-plot-llama-multi) shows the reported
confidence scores for the predictions for the best performing
model-strategy combination, Llama 4 Scout with <em>3_rag_examples</em>. It is
confident for most correct predictions and only misclassifies some of
the pages with unknown characteristics. The target types are all
recognized correct. All confidences are greater than 0.5. Probably
because there is no case where the confidences for all possible classes
is below 0.5 and there always is a most probable class. It would have
been interesting to use the classification framework of <a href="#acronyms_vllm">vLLM</a> to
get predictions for all competing classes. But this requires special
trained models with pooling capability<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a>  )</span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-14"><a href="#cb74-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb74-15"><a href="#cb74-15" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb74-16"><a href="#cb74-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb74-17"><a href="#cb74-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb74-18"><a href="#cb74-18" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb74-19"><a href="#cb74-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/confidence-match-plot-llama-multi-1.png" alt="Showing the reported confidence scores for all predictions of Llama 4 Scout grouped by the true target type. Errors have only been made within the majority class." width="100%" />
<p class="caption">
(#fig:confidence-match-plot-llama-multi)Showing the reported confidence scores for all predictions of Llama 4 Scout grouped by the true target type. Errors have only been made within the majority class.
</p>
</div>
<p>Figure @ref(fig:confidence-match-plot-mistral-multi) shows the reported
confidence scores for the predictions for the best performing
model-strategy combination among the small models limited to
<em>n_examples</em> with n smaller five<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>,
Ministral-8B-Instruct-2410 with <em>3_rag_examples</em>. One can see there are
some wrong classifications for the minority classes as well. Especially,
the <strong>Passiva</strong> target type is often classified as <em>other</em>. This is
problematic for a smooth workflow (see discussion chapter?)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>  model <span class="sc">==</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, </span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a>  method <span class="sc">==</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb75-10"><a href="#cb75-10" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb75-11"><a href="#cb75-11" tabindex="-1"></a>  )</span>
<span id="cb75-12"><a href="#cb75-12" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb75-13"><a href="#cb75-13" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb75-14"><a href="#cb75-14" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb75-16"><a href="#cb75-16" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-17"><a href="#cb75-17" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb75-18"><a href="#cb75-18" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb75-19"><a href="#cb75-19" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb75-20"><a href="#cb75-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb75-21"><a href="#cb75-21" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb75-22"><a href="#cb75-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/confidence-match-plot-mistral-multi-1.png" alt="Showing the reported confidence scores for all predictions of Ministral 8B grouped by the true target type. Errors have only been made within the majority class." width="100%" />
<p class="caption">
(#fig:confidence-match-plot-mistral-multi)Showing the reported confidence scores for all predictions of Ministral 8B grouped by the true target type. Errors have only been made within the majority class.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>plot_pr_double_curve_multi <span class="ot">&lt;-</span> <span class="cf">function</span>(df, selected_type, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>  df_temp2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>    <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>    <span class="fu">select</span>(type, predicted_type, confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a>      <span class="at">type =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> selected_type, type, <span class="st">&quot;no&quot;</span>),</span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a>      <span class="at">predicted_type =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> selected_type, predicted_type, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(selected_type, <span class="st">&quot;no&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb76-10"><a href="#cb76-10" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb76-11"><a href="#cb76-11" tabindex="-1"></a>      <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score)</span>
<span id="cb76-12"><a href="#cb76-12" tabindex="-1"></a>    )</span>
<span id="cb76-13"><a href="#cb76-13" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" tabindex="-1"></a>  </span>
<span id="cb76-15"><a href="#cb76-15" tabindex="-1"></a>  <span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb76-16"><a href="#cb76-16" tabindex="-1"></a>  </span>
<span id="cb76-17"><a href="#cb76-17" tabindex="-1"></a>  pr_df <span class="ot">&lt;-</span> df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_curve</span>(type, confidence_score) <span class="sc">%&gt;%</span></span>
<span id="cb76-18"><a href="#cb76-18" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">threshold =</span> .threshold) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold<span class="sc">&lt;=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-19"><a href="#cb76-19" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb76-20"><a href="#cb76-20" tabindex="-1"></a>  </span>
<span id="cb76-21"><a href="#cb76-21" tabindex="-1"></a>  pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_auc</span>(type, confidence_score) <span class="sc">%&gt;%</span> .<span class="sc">$</span>.estimate, <span class="dv">3</span>)</span>
<span id="cb76-22"><a href="#cb76-22" tabindex="-1"></a>  best_F1_row <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb76-23"><a href="#cb76-23" tabindex="-1"></a>  best_F1_row_high_recall <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> </span>
<span id="cb76-24"><a href="#cb76-24" tabindex="-1"></a>    <span class="fu">filter</span>(recall <span class="sc">&gt;</span> <span class="fl">0.999</span>, precision <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb76-25"><a href="#cb76-25" tabindex="-1"></a>  best_F1 <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb76-26"><a href="#cb76-26" tabindex="-1"></a>  best_F1_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb76-27"><a href="#cb76-27" tabindex="-1"></a>  best_threshold <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb76-28"><a href="#cb76-28" tabindex="-1"></a>  best_threshold_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb76-29"><a href="#cb76-29" tabindex="-1"></a>  best_precision_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(precision)</span>
<span id="cb76-30"><a href="#cb76-30" tabindex="-1"></a>  </span>
<span id="cb76-31"><a href="#cb76-31" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb76-32"><a href="#cb76-32" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb76-33"><a href="#cb76-33" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb76-34"><a href="#cb76-34" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-35"><a href="#cb76-35" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb76-36"><a href="#cb76-36" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Precision-Recall Curve for &quot;</span>, selected_type, <span class="st">&quot; (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb76-37"><a href="#cb76-37" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb76-38"><a href="#cb76-38" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb76-39"><a href="#cb76-39" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb76-40"><a href="#cb76-40" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-41"><a href="#cb76-41" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb76-42"><a href="#cb76-42" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb76-43"><a href="#cb76-43" tabindex="-1"></a>    )</span>
<span id="cb76-44"><a href="#cb76-44" tabindex="-1"></a>  </span>
<span id="cb76-45"><a href="#cb76-45" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb76-46"><a href="#cb76-46" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb76-47"><a href="#cb76-47" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb76-48"><a href="#cb76-48" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-49"><a href="#cb76-49" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb76-50"><a href="#cb76-50" tabindex="-1"></a>      <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb76-51"><a href="#cb76-51" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb76-52"><a href="#cb76-52" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb76-53"><a href="#cb76-53" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb76-54"><a href="#cb76-54" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb76-55"><a href="#cb76-55" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb76-56"><a href="#cb76-56" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb76-57"><a href="#cb76-57" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb76-58"><a href="#cb76-58" tabindex="-1"></a>    ) </span>
<span id="cb76-59"><a href="#cb76-59" tabindex="-1"></a>  </span>
<span id="cb76-60"><a href="#cb76-60" tabindex="-1"></a>  <span class="cf">if</span> (x_stuff <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb76-61"><a href="#cb76-61" tabindex="-1"></a>    g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-62"><a href="#cb76-62" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb76-63"><a href="#cb76-63" tabindex="-1"></a>    </span>
<span id="cb76-64"><a href="#cb76-64" tabindex="-1"></a>    g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-65"><a href="#cb76-65" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb76-66"><a href="#cb76-66" tabindex="-1"></a>  }</span>
<span id="cb76-67"><a href="#cb76-67" tabindex="-1"></a>  </span>
<span id="cb76-68"><a href="#cb76-68" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> g1 <span class="sc">+</span> g2</span>
<span id="cb76-69"><a href="#cb76-69" tabindex="-1"></a>  combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb76-70"><a href="#cb76-70" tabindex="-1"></a>    <span class="st">&#39;Best F1 score of &#39;</span>, <span class="fu">round</span>(best_F1,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold,<span class="dv">3</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>,</span>
<span id="cb76-71"><a href="#cb76-71" tabindex="-1"></a>    <span class="st">&#39;Best F1 score with recall &gt; 0.999 of &#39;</span>, <span class="fu">round</span>(best_F1_high_recall,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold_high_recall,<span class="dv">3</span>), <span class="st">&#39; (corresp. precision value: &#39;</span>, <span class="fu">round</span>(best_precision_high_recall,<span class="dv">3</span>) , <span class="st">&#39;)&#39;</span>))</span>
<span id="cb76-72"><a href="#cb76-72" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Figure @ref(fig:micro-pr-curve-llm-multi-ministral) shows the
precision-recall-curve for Ministral-8B-Instruct-2410 with
<em>3_rag_examples</em> twice for each target type. On the left plots the line
color represents the threshold score one could use to decide when to
accept a response as it is. On the right plots the line color is showing
the F1 score that results with a chosen threshold.</p>
<p>The <a href="#acronyms_AUC">AUC</a> is highest for <strong>GuV</strong> again. But for the multi-class
classification <strong>Passiva</strong> shows the lowest <a href="#acronyms_AUC">AUC</a>, not <strong>Aktiva</strong> as
it was in the binary classification task. The precision-recall-curve for
<strong>Aktiva</strong> and **Passiva*+ show a “step” in the area of high recall.
This has a strong effect on the threshold one should choose, if one
wants to guarantee a high recall. The corresponding precision values of
0.2 and 0.13 mean that a human has to check five to eight pages in
average to get a correct classified page of type <strong>Aktiva</strong> and
<strong>Passiva</strong>.</p>
<p>The corresponding plot for the best performing model,
Llama-4-Scout-17B-16E-Instruct, can be found in Figure
@ref(fig:micro-pr-curve-llm-multi-llama-scout). Here the
precision-recall-curve for <strong>Passiva</strong> and <strong>GuV</strong> is almost perfect.
Just the single prediction for <strong>Aktiva</strong> wit a lower confidence shows
an influence on the precision-recall-curve.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>method_name <span class="ot">&lt;-</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>df_temp_mistral_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb77-6"><a href="#cb77-6" tabindex="-1"></a>    model <span class="sc">==</span> model_name,</span>
<span id="cb77-7"><a href="#cb77-7" tabindex="-1"></a>    method <span class="sc">==</span> method_name</span>
<span id="cb77-8"><a href="#cb77-8" tabindex="-1"></a>  ) <span class="co"># %&gt;% unnest(metrics) # %&gt;% calc_micro_f1(model, method)</span></span>
<span id="cb77-9"><a href="#cb77-9" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-10"><a href="#cb77-10" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-11"><a href="#cb77-11" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-12"><a href="#cb77-12" tabindex="-1"></a><span class="co"># p_other &lt;- df_temp_mistral_multi %&gt;% plot_pr_double_curve_multi(&quot;other&quot;, x_stuff = TRUE)</span></span>
<span id="cb77-13"><a href="#cb77-13" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="fu">str_c</span>(model_name, <span class="st">&quot; with &quot;</span>, method_name))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/micro-pr-curve-llm-multi-ministral-1.png" alt="Showing the precsion-recall-curve for Ministral-8B-Instruct-2410." width="100%" />
<p class="caption">
(#fig:micro-pr-curve-llm-multi-ministral)Showing the precsion-recall-curve for Ministral-8B-Instruct-2410.
</p>
</div>
<p>Figure @ref(fig:table-identification-llm-confidence-multi) summarizes
the relation between reported confidence and correctness of the
classification for all target types and compares it among the best
performing model-strategy combinations for
Llama-4-Scout-17B-16E-Instruct, Ministral-8B-Instruct-2410 and Qwen3-8B.
It seems, as the reported confidence for correct and incorrect
classifications are separable in most cases for Mistral-8B. For Llama 4
Scout this seems not true for the target type <strong>GuV</strong>. For Qwen3-8B
there is almost no separation at all.</p>
<p>Figure @ref(fig:table-identification-llm-confidence-lm-multi) shows,
that there is almost no area, where the empirical rate of wrong
classifications is zero<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a>. Only for Ministral-8B we find
intervals, where a human don’t has to double check the classification
for target types <strong>Aktiva</strong> and <strong>GuV</strong>. These intervals include 90 % of
all predictions. If error rates of 1 % are accepted almost all
predictions by Llama Scout 4 and about 96 % of the predictions by
Ministral-8B are included in the corresponding intervals. For Qwen3-8B
we find no interval without an error rate below 1 %.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a>confidence_vs_truth_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model, metric_type) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a>    <span class="at">mean_f1 =</span> <span class="fu">mean</span>(f1_score, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb78-6"><a href="#cb78-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb78-7"><a href="#cb78-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_f1)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-8"><a href="#cb78-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_f1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-9"><a href="#cb78-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb78-10"><a href="#cb78-10" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb78-11"><a href="#cb78-11" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb78-12"><a href="#cb78-12" tabindex="-1"></a>    <span class="co"># truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb78-13"><a href="#cb78-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>))</span>
<span id="cb78-14"><a href="#cb78-14" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" tabindex="-1"></a>confidence_vs_truth_multi <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb78-17"><a href="#cb78-17" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence_score, <span class="at">fill =</span> metric_type), </span>
<span id="cb78-18"><a href="#cb78-18" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb78-20"><a href="#cb78-20" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb78-21"><a href="#cb78-21" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-identification-llm-confidence-multi-1.png" alt="Comparing the reported confidence scores for the multi-class page identification task for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
(#fig:table-identification-llm-confidence-multi)Comparing the reported confidence scores for the multi-class page identification task for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>confidence_vs_truth_multi <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">confidence =</span> confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, metric_type, model) <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb79-12"><a href="#cb79-12" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb79-13"><a href="#cb79-13" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb79-14"><a href="#cb79-14" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb79-15"><a href="#cb79-15" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb79-16"><a href="#cb79-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(metric_type, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb79-17"><a href="#cb79-17" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb79-18"><a href="#cb79-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-19"><a href="#cb79-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-20"><a href="#cb79-20" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb79-21"><a href="#cb79-21" tabindex="-1"></a>      chance_false,</span>
<span id="cb79-22"><a href="#cb79-22" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb79-23"><a href="#cb79-23" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb79-24"><a href="#cb79-24" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb79-25"><a href="#cb79-25" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb79-26"><a href="#cb79-26" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb79-27"><a href="#cb79-27" tabindex="-1"></a>    ),</span>
<span id="cb79-28"><a href="#cb79-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb79-29"><a href="#cb79-29" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-30"><a href="#cb79-30" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> perc, <span class="at">color =</span> chance_low, <span class="at">fill =</span> chance_false_interval), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb79-31"><a href="#cb79-31" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb79-32"><a href="#cb79-32" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb79-33"><a href="#cb79-33" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb79-34"><a href="#cb79-34" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb79-35"><a href="#cb79-35" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb79-36"><a href="#cb79-36" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb79-37"><a href="#cb79-37" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb79-38"><a href="#cb79-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb79-39"><a href="#cb79-39" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb79-40"><a href="#cb79-40" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb79-41"><a href="#cb79-41" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-42"><a href="#cb79-42" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb79-43"><a href="#cb79-43" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb79-44"><a href="#cb79-44" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb79-45"><a href="#cb79-45" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb79-46"><a href="#cb79-46" tabindex="-1"></a>  <span class="fu">facet_grid</span>(metric_type <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-identification-llm-confidence-lm-multi-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals for the multi-class classification task." width="100%" />
<p class="caption">
(#fig:table-identification-llm-confidence-lm-multi)Estimating the relative frequency to find a wrong classification over different confidence intervals for the multi-class classification task.
</p>
</div>
</div>
</div>
<div id="extraction-with-llms" class="section level2 hasAnchor" number="10.2">
<h2 class="hasAnchor"><span class="header-section-number">10.2</span> Extraction with LLMs<a href="#extraction-with-llms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="real-tables-1" class="section level3 hasAnchor" number="10.2.1">
<h3 class="hasAnchor"><span class="header-section-number">10.2.1</span> Real tables<a href="#real-tables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a>confidence_vs_truth_real <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>  <span class="co"># filter(loop == 0) %&gt;% </span></span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="#cb80-4" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model, loop) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-5"><a href="#cb80-5" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb80-6"><a href="#cb80-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="#cb80-7" tabindex="-1"></a>  <span class="co"># arrange(desc(mean_percentage_correct_total)) %&gt;% </span></span>
<span id="cb80-8"><a href="#cb80-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_percentage_correct_total, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-9"><a href="#cb80-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_processed =</span> <span class="fu">map</span>(predictions, <span class="sc">~</span>{</span>
<span id="cb80-10"><a href="#cb80-10" tabindex="-1"></a>    .x <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="#cb80-11" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;_merge&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-12"><a href="#cb80-12" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb80-13"><a href="#cb80-13" tabindex="-1"></a>        <span class="at">match =</span> (year_truth <span class="sc">==</span> year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(year_result)),</span>
<span id="cb80-14"><a href="#cb80-14" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_this_year,</span>
<span id="cb80-15"><a href="#cb80-15" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(year_truth),</span>
<span id="cb80-16"><a href="#cb80-16" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(year_result),</span>
<span id="cb80-17"><a href="#cb80-17" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb80-18"><a href="#cb80-18" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb80-19"><a href="#cb80-19" tabindex="-1"></a>        <span class="at">tuple_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb80-20"><a href="#cb80-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb80-21"><a href="#cb80-21" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb80-22"><a href="#cb80-22" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_previous_year,</span>
<span id="cb80-23"><a href="#cb80-23" tabindex="-1"></a>        <span class="at">match =</span> (previous_year_truth <span class="sc">==</span> previous_year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(previous_year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(previous_year_result)),</span>
<span id="cb80-24"><a href="#cb80-24" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(previous_year_truth),</span>
<span id="cb80-25"><a href="#cb80-25" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(previous_year_result),</span>
<span id="cb80-26"><a href="#cb80-26" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb80-27"><a href="#cb80-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb80-28"><a href="#cb80-28" tabindex="-1"></a>        <span class="at">tuple_previous_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb80-29"><a href="#cb80-29" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb80-30"><a href="#cb80-30" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">c</span>(year_truth, previous_year_truth, year_result, previous_year_result,</span>
<span id="cb80-31"><a href="#cb80-31" tabindex="-1"></a>           confidence_this_year, confidence_previous_year)</span>
<span id="cb80-32"><a href="#cb80-32" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb80-33"><a href="#cb80-33" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;E1&quot;</span>, <span class="st">&quot;E2&quot;</span>, <span class="st">&quot;E3&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-34"><a href="#cb80-34" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-35"><a href="#cb80-35" tabindex="-1"></a>        <span class="at">match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(match), <span class="cn">FALSE</span>, match)</span>
<span id="cb80-36"><a href="#cb80-36" tabindex="-1"></a>      )</span>
<span id="cb80-37"><a href="#cb80-37" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb80-38"><a href="#cb80-38" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions_processed) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-39"><a href="#cb80-39" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb80-40"><a href="#cb80-40" tabindex="-1"></a>    <span class="at">truth_NA =</span> <span class="fu">factor</span>(truth_NA, <span class="at">levels =</span> <span class="fu">c</span>(F, T))</span>
<span id="cb80-41"><a href="#cb80-41" tabindex="-1"></a>  )</span>
<span id="cb80-42"><a href="#cb80-42" tabindex="-1"></a></span>
<span id="cb80-43"><a href="#cb80-43" tabindex="-1"></a>confidence_intervals_real <span class="ot">&lt;-</span> confidence_vs_truth_real <span class="sc">%&gt;%</span> <span class="co">#rename(confidence = confidence_score) %&gt;% </span></span>
<span id="cb80-44"><a href="#cb80-44" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-45"><a href="#cb80-45" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-46"><a href="#cb80-46" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb80-47"><a href="#cb80-47" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-48"><a href="#cb80-48" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, predicted_NA, model) <span class="sc">%&gt;%</span></span>
<span id="cb80-49"><a href="#cb80-49" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-50"><a href="#cb80-50" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-51"><a href="#cb80-51" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-52"><a href="#cb80-52" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb80-53"><a href="#cb80-53" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb80-54"><a href="#cb80-54" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb80-55"><a href="#cb80-55" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb80-56"><a href="#cb80-56" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb80-57"><a href="#cb80-57" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb80-58"><a href="#cb80-58" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(predicted_NA, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-59"><a href="#cb80-59" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb80-60"><a href="#cb80-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-61"><a href="#cb80-61" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-62"><a href="#cb80-62" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb80-63"><a href="#cb80-63" tabindex="-1"></a>      chance_false,</span>
<span id="cb80-64"><a href="#cb80-64" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb80-65"><a href="#cb80-65" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb80-66"><a href="#cb80-66" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb80-67"><a href="#cb80-67" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb80-68"><a href="#cb80-68" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb80-69"><a href="#cb80-69" tabindex="-1"></a>    ),</span>
<span id="cb80-70"><a href="#cb80-70" tabindex="-1"></a>  )</span>
<span id="cb80-71"><a href="#cb80-71" tabindex="-1"></a></span>
<span id="cb80-72"><a href="#cb80-72" tabindex="-1"></a>conf_scores_top_real <span class="ot">&lt;-</span> confidence_intervals_real <span class="sc">%&gt;%</span> </span>
<span id="cb80-73"><a href="#cb80-73" tabindex="-1"></a>  <span class="fu">filter</span>(conf_center <span class="sc">==</span> <span class="fl">0.975</span>, model <span class="sc">==</span> <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-74"><a href="#cb80-74" tabindex="-1"></a>  <span class="fu">select</span>(predicted_NA, chance_false) <span class="sc">%&gt;%</span> <span class="fu">deframe</span>()</span></code></pre></div>
</details>
<div id="confidence-1" class="section level5 hasAnchor paragraph-start" number="10.2.1.0.1">
<h5 class="hasAnchor"><span class="header-section-number">10.2.1.0.1</span> Confidence<a href="#confidence-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure @ref(fig:table-extraction-llm-confidence) shows, that the
distrubution of the models reported confidence is heterogeneous. Again,
Qwen3-8B reports very high confidence values no matter if the results
are correct or not. Qwen3-235B-A22B-Instruct (and Qwen3-14B) report some
lower confidence scores for predictions, where they are wrong. The
Mistral model again reports a wider range of confidences and for wrong
results the reporetd confidence is lower. But no real separation can be
observed for any of the models.</p>
</div>
<p>Figure @ref(fig:table-extraction-llm-confidence-lm) helps answering the
question, if the reported confidence score of the responses can be used,
to alert a human that certain predictions might be wrong. In contrast to
the page identification task, we find no confidence intervals where the
mistake rate is equal 0 or less than 1 %. The majority of the
predictions has a very high reported confidence. For the best performing
model Qwen3-235B-A22B-Instruct we find error rates of
3.2631144 % for numeric predictions and
1.32515 % for predicting a missing value.</p>
<p>Thus, we can inform the human about the empirical found error rates but
do not flag some values to be realy trustworthy. In defense for the
model: with manual transcription the error rate is not lower. But we can
inform the human about values that have shown a higher rate of mistakes,
especially for the Ministral model.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>confidence_vs_truth_real <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence, <span class="at">fill =</span> truth_NA), </span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-confidence-1.png" alt="Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-confidence)Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>confidence_intervals_real <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb82-9"><a href="#cb82-9" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb82-10"><a href="#cb82-10" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb82-11"><a href="#cb82-11" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb82-12"><a href="#cb82-12" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb82-13"><a href="#cb82-13" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb82-14"><a href="#cb82-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb82-15"><a href="#cb82-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-16"><a href="#cb82-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb82-17"><a href="#cb82-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb82-18"><a href="#cb82-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-19"><a href="#cb82-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb82-20"><a href="#cb82-20" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb82-21"><a href="#cb82-21" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb82-22"><a href="#cb82-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-23"><a href="#cb82-23" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-confidence-lm)Estimating the relative frequency to find a wrong classification over different confidence intervals.
</p>
</div>
</div>
<div id="synthetic-tables-1" class="section level3 hasAnchor" number="10.2.2">
<h3 class="hasAnchor"><span class="header-section-number">10.2.2</span> Synthetic tables<a href="#synthetic-tables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence-2" class="section level5 hasAnchor paragraph-start" number="10.2.2.0.1">
<h5 class="hasAnchor"><span class="header-section-number">10.2.2.0.1</span> Confidence<a href="#confidence-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure @ref(fig:table-extraction-llm-confidence-lm-synth) shows, that
we do not find a high confidence interval containing a majority of the
predictions with 0 % error rate. But for Qwen3-235B we find, that the
error rate is below 1 %, except for predicting numeric values, while
ignoring their currency units.</p>
</div>
<p>Figure
@ref(fig:table-extraction-llm-confidence-lm-synth-grouped-by-input-format)
groups the responses additonally by the <em>input_format</em> of the documents.
It shows, that with HTML documents Qwen3-235B achieves 0 % error rate
for the prediction of missing values and predicting numeric values, if
currency units get respected.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>confidence_intervals_synth  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/confidence_intervals_synth.rds&quot;</span>)</span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>confidence_intervals_synth <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb83-11"><a href="#cb83-11" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb83-12"><a href="#cb83-12" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb83-13"><a href="#cb83-13" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb83-14"><a href="#cb83-14" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb83-15"><a href="#cb83-15" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb83-16"><a href="#cb83-16" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-17"><a href="#cb83-17" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-18"><a href="#cb83-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb83-19"><a href="#cb83-19" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb83-20"><a href="#cb83-20" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-21"><a href="#cb83-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb83-22"><a href="#cb83-22" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb83-23"><a href="#cb83-23" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb83-24"><a href="#cb83-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb83-25"><a href="#cb83-25" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">+</span><span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-synth-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-confidence-lm-synth)Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task.
</p>
</div>
</div>
<div id="hybrid-aproach" class="section level3 hasAnchor" number="10.2.3">
<h3 class="hasAnchor"><span class="header-section-number">10.2.3</span> Hybrid aproach<a href="#hybrid-aproach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence-3" class="section level5 hasAnchor paragraph-start" number="10.2.3.0.1">
<h5 class="hasAnchor"><span class="header-section-number">10.2.3.0.1</span> Confidence<a href="#confidence-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure @ref(fig:table-extraction-llm-confidence-lm-synth-context) shows
the rate of wrong predictions for given confidence intervals. Again, the
confidence for predicting a missing value is higher than for predicting
a numeric value. One can’t see much difference, but for the best
performing model Qwen3-235B the error rate for numeric values is lower,
when currency units are respected (20 % vs 26 %). But the error rate is
still to high to mark any numeric value as trustful.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>confidence_intervals_hybrid <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb84-6"><a href="#cb84-6" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb84-7"><a href="#cb84-7" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb84-9"><a href="#cb84-9" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb84-10"><a href="#cb84-10" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb84-11"><a href="#cb84-11" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb84-12"><a href="#cb84-12" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb84-13"><a href="#cb84-13" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-16"><a href="#cb84-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb84-17"><a href="#cb84-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb84-18"><a href="#cb84-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-19"><a href="#cb84-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb84-20"><a href="#cb84-20" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb84-21"><a href="#cb84-21" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb84-22"><a href="#cb84-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-23"><a href="#cb84-23" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">+</span><span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-synth-context-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-confidence-lm-synth-context)Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning.
</p>
</div>
<!--chapter:end:11_Error_Rate_Guidance.Rmd-->
</div>
</div>
</div>
<div id="appendix-d---feature-effect-analysis" class="section level1 hasAnchor" number="11">
<h1 class="hasAnchor"><span class="header-section-number">11</span> Appendix D - Feature effect analysis<a href="#appendix-d---feature-effect-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="regular-expressions-3" class="section level2 hasAnchor" number="11.1">
<h2 class="hasAnchor"><span class="header-section-number">11.1</span> Regular expressions<a href="#regular-expressions-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hypotheses-2" class="section level5 hasAnchor paragraph-start" number="11.1.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">11.1.0.0.1</span> Hypotheses<a href="#hypotheses-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The formulated hypotheses have been evaluated visually using the
dependence and beeswarm plots from the <em>shapviz</em> library based on the
<a href="#acronyms_SHAP">SHAP</a> values calculated for a random forest.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/real_table_extraction_regex_h2o_results_sample_50000_shap_2000.rds&quot;</span>)</span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb85-14"><a href="#cb85-14" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb85-16"><a href="#cb85-16" tabindex="-1"></a>shap_f1_sum_same_line <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;sum_same_line&quot;</span>, <span class="st">&quot;T_in_previous_year&quot;</span>)</span>
<span id="cb85-17"><a href="#cb85-17" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb85-19"><a href="#cb85-19" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb85-20"><a href="#cb85-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-21"><a href="#cb85-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb85-22"><a href="#cb85-22" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-23"><a href="#cb85-23" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb85-24"><a href="#cb85-24" tabindex="-1"></a></span>
<span id="cb85-25"><a href="#cb85-25" tabindex="-1"></a>real_table_extraction_regex_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb85-26"><a href="#cb85-26" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb85-27"><a href="#cb85-27" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b)</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/synth_table_extraction_regex_h2o_results_sample_50000_shap_2000.rds&quot;</span>)</span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb86-7"><a href="#cb86-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb86-9"><a href="#cb86-9" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" tabindex="-1"></a>p1c <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;extraction_backend&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;dependence plot for extraction_backend&quot;</span>)</span>
<span id="cb86-12"><a href="#cb86-12" tabindex="-1"></a>p1d <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;header_span&quot;</span>, <span class="at">color_var =</span> <span class="st">&quot;extraction_backend&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;dependence plot for header_span&quot;</span>)</span>
<span id="cb86-14"><a href="#cb86-14" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb86-16"><a href="#cb86-16" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb86-17"><a href="#cb86-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-18"><a href="#cb86-18" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb86-19"><a href="#cb86-19" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-20"><a href="#cb86-20" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb86-21"><a href="#cb86-21" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" tabindex="-1"></a>shap_f1_extraction_backend <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="fu">colnames</span>(.<span class="sc">$</span>X), <span class="st">&quot;extraction_backend&quot;</span>)</span>
<span id="cb86-23"><a href="#cb86-23" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb86-25"><a href="#cb86-25" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb86-26"><a href="#cb86-26" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-27"><a href="#cb86-27" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb86-28"><a href="#cb86-28" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb86-29"><a href="#cb86-29" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb86-30"><a href="#cb86-30" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" tabindex="-1"></a>synth_table_extraction_regex_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb86-32"><a href="#cb86-32" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb86-33"><a href="#cb86-33" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b)</span>
<span id="cb86-34"><a href="#cb86-34" tabindex="-1"></a></span>
<span id="cb86-35"><a href="#cb86-35" tabindex="-1"></a>synth_table_extraction_regex_shap_num_details_plot <span class="ot">&lt;-</span> p1d <span class="sc">|</span> p1c</span></code></pre></div>
</details>
<div id="real-dataset" class="section level6 hasAnchor paragraph-start" number="11.1.0.0.1.1">
<h6 class="hasAnchor"><span class="header-section-number">11.1.0.0.1.1</span> Real dataset<a href="#real-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>The formulated hypotheses have been evaluated visually using the
dependence and beeswarm plots from the shapviz library based on the
<a href="#acronyms_SHAP">SHAP</a> values calculated with a random forest.</p>
</div>
<p>Table
@ref(tab:hypotheses-and-results-real-table-extraction-regex-table)
shows in the first column the predictors included in the random forests.
Subsequent groups of two columns show the hypotheses and the found
effects of those predictors for two aggregated measures (F1 score and
percentage of correct numeric predictions) and one value based measure
(binomial correctness rating).</p>
<p>Predictors that are marked with an asterisk only have five or less
representatives. Thus, those results are not reliable. Bold set
hypotheses show the predictors, that showed the highest mean <a href="#acronyms_SHAP">SHAP</a>
values. For all measures but the binomial this means the effect is at
least 0.025. For the binomial measure the effect of a predictor with
bold hypothesis is at least 0.05. Results with red text highlight
hypotheses that are not supported by the visual evaluation.</p>
<p>Table
@ref(tab:hypotheses-and-results-real-table-extraction-regex-table)
shows many red results, meaning the corresponding hypothesis is getting
no support. Since most of these findings show only minor effect strength
we don’t interpret them as strongly challenging those hypotheses. Only
three findings regarding the F1 score show a strong effect and findings
that do not align with our hypotheses. First, it seems, that finding a
sum in the same row, has a negative effect of finding any valid number
there. Second, it has negative effect, if the previous year column is
given as <em>T€</em>. Third, it has negative effect, if the columns are
visually separated.</p>
<p>see Figure @ref(fig:real-table-extraction-regex-shap-plot)</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="fu">create_hypotheses_table</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_real_table_extraction_regex.html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables with the regular expression approach.&quot;</span>)</span></code></pre></div>
</details>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:hypotheses-and-results-real-table-extraction-regex-table)Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables with the regular expression approach.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
F1
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
% correct numeric
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
binomial
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
predictor
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">extraction_backend</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">pymupdf better</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_columns</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">2 is better</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">2 is better</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">sum_same_line</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style=" font-weight: bold;    color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">sum_in_header*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     "></span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">unit_first_cell*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     "></span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">T_in_previous_year</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style=" font-weight: bold;    color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">T_in_year*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">passiva_same_page</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vorjahr</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_cols</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style=" font-weight: bold;    color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_rows</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label_length</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">missing</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="synthetic-dataset" class="section level6 hasAnchor paragraph-start" number="11.1.0.0.1.2">
<h6 class="hasAnchor"><span class="header-section-number">11.1.0.0.1.2</span> Synthetic dataset<a href="#synthetic-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Table
@ref(tab:hypotheses-and-results-synth-table-extraction-regex-table)
shows, many red results as well, meaning the corresponding hypothesis is
getting no support. We find more predictors with a strong effect
compared to the real <strong>Aktiva</strong> table extraction task. The results are
based on 24_576 extracted tables and the <a href="#acronyms_SHAP">SHAP</a> values have been
calculated on 2_000 examples each.</p>
</div>
<p>Contrary to our assumption, does the <em>extraction_backend</em> have a strong
effect on all measures. We find, that <em>pdfium</em> is struggling with some
of the table characteristics while <em>pymupdf</em> is not influenced by them.
Figure @ref(fig:synth-table-extraction-regex-shap-num-details-plot) A
shows this exemplary for the characteristic <em>header_span</em>. An example
for a erroneous text extraction with <em>pdfium</em> can be found in section
@ref(#regex-extraction-mistakes). Actually, all results that are marked
with an asterisk are showing this effect if <em>pdfium</em> is used as
extraction backend. This can be inspected in Figure
@ref(fig:synth-table-extraction-regex-dependence-plot-backend).</p>
<p>Furthermore, does the number of columns is have a positive effect
overall. Figure
@ref(fig:synth-table-extraction-regex-shap-num-details-plot) B shows,
that this effect has inverse direction for the two libraries.</p>
<p>It might be worth noting, that the row for <em>Anteile an verbundenen
Unternehmen</em> was rated to have a clear negative effect on the chance to
extract the correct value.</p>
<p>The question, if visual separation of columns is having an effect, as
found for the real data, is not studied here, because in the synthetic
tables all columns are visually separated. But this could be
investigated in future work. It is possible, that the visual separation
is causing the faulty text extractions of <em>pdfium</em>.</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="fu">create_hypotheses_table</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_synth_table_extraction_regex.html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Comparing the formulated hypotheses and the found results for the table extraction on synthetic Aktiva tables with the regular expression approach.&quot;</span>)</span></code></pre></div>
</details>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:hypotheses-and-results-synth-table-extraction-regex-table)Comparing the formulated hypotheses and the found results for the table extraction on synthetic Aktiva tables with the regular expression approach.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
F1
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
% correct numeric
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
binomial
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
predictor
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">extraction_backend</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">pymupdf better</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">pymupdf better</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">pymupdf better</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_columns</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style=" font-weight: bold;    color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style=" font-weight: bold;    color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    color: darkred !important;">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">sum_same_line</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative*</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">thin</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive*</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">year_as</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive*</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive*</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">positive*</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">unit_in_first_cell</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative*</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">log10_unit_multiplier</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative*</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative*</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative*</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">enumeration</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive*</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive*</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">positive*</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">shuffle_rows</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">text_around</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">many_line_breaks</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label_length</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">missing</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
</tbody>
</table>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a>synth_table_extraction_regex_shap_num_details_plot <span class="sc">+</span> </span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&#39;A&#39;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-regex-shap-num-details-plot-1.png" alt="Showing the influence of the extraxtion library on the numeric text extraction task with synthetic data for the percentage of correct numeric predictions." width="100%" />
<p class="caption">
(#fig:synth-table-extraction-regex-shap-num-details-plot)Showing the influence of the extraxtion library on the numeric text extraction task with synthetic data for the percentage of correct numeric predictions.
</p>
</div>
</div>
<div id="real-tables-2" class="section level2 hasAnchor" number="11.2">
<h2 class="hasAnchor"><span class="header-section-number">11.2</span> Real tables<a href="#real-tables-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hypotheses-3" class="section level5 hasAnchor paragraph-start" number="11.2.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">11.2.0.0.1</span> Hypotheses<a href="#hypotheses-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The formulated hypotheses have been evaluated visually using the
dependence and beeswarm plots from the shapviz library based on the
<a href="#acronyms_SHAP">SHAP</a> values calculated with a random forest.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/real_table_extraction_h2o_results_sample_50000_shap_2000_NA_recoded_extended.rds&quot;</span>)</span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb90-4"><a href="#cb90-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb90-7"><a href="#cb90-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb90-9"><a href="#cb90-9" tabindex="-1"></a>p1c <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;T_in_year&quot;</span>, <span class="st">&quot;vis_seperated_rows&quot;</span>)</span>
<span id="cb90-10"><a href="#cb90-10" tabindex="-1"></a>p1d <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;vis_seperated_rows&quot;</span>, <span class="st">&quot;T_in_year&quot;</span>)</span>
<span id="cb90-11"><a href="#cb90-11" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb90-13"><a href="#cb90-13" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb90-16"><a href="#cb90-16" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-17"><a href="#cb90-17" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb90-18"><a href="#cb90-18" tabindex="-1"></a></span>
<span id="cb90-19"><a href="#cb90-19" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb90-20"><a href="#cb90-20" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-21"><a href="#cb90-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-22"><a href="#cb90-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb90-23"><a href="#cb90-23" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-24"><a href="#cb90-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb90-25"><a href="#cb90-25" tabindex="-1"></a></span>
<span id="cb90-26"><a href="#cb90-26" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>confidence<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb90-27"><a href="#cb90-27" tabindex="-1"></a>p4a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-28"><a href="#cb90-28" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-29"><a href="#cb90-29" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb90-30"><a href="#cb90-30" tabindex="-1"></a>p4b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb90-31"><a href="#cb90-31" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb90-32"><a href="#cb90-32" tabindex="-1"></a></span>
<span id="cb90-33"><a href="#cb90-33" tabindex="-1"></a>real_table_extraction_llm_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb90-34"><a href="#cb90-34" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb90-35"><a href="#cb90-35" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b) <span class="sc">/</span></span>
<span id="cb90-36"><a href="#cb90-36" tabindex="-1"></a>  (p4a <span class="sc">|</span> p4b)</span>
<span id="cb90-37"><a href="#cb90-37" tabindex="-1"></a></span>
<span id="cb90-38"><a href="#cb90-38" tabindex="-1"></a>real_table_extraction_llm_shap_num_details_plot <span class="ot">&lt;-</span> p1c <span class="sc">|</span> p1d</span></code></pre></div>
</details>
<p>Table @ref(tab:hypotheses-and-results-real-table-extraction-llm-table)
shows in the first column the predictors included in the random forests.
Subsequent groups of two columns show the hypotheses and the found
effects of those predictors for two aggregated measures (F1 score and
percentage of correct numeric predictions) and two value based measures
(binomial correctness rating and reported confidence for the
prediction).</p>
<p>Predictors that are marked with an asterix only have five or less
representatives. Thus, those results are not reliable. Bold set
hypotheses show the predictors, that showed the highest mean <a href="#acronyms_SHAP">SHAP</a>
values. For all measures but the binomial this means the effect is at
least 0.025. For the binomial measure the effect of a predictor with
bold hypothesis is at least 0.05. Results with red text highlight
hypotheses that are not supported by the visual evaluation.</p>
<p>For most measures the model and method related predictors
(<em>model_family</em>, <em>parameter_count</em>, <em>method_family</em> and <em>n_examples</em>)
show the strongest effects. Worth mentioning is, that <em>method_family</em>
and <em>n_examples</em> show no strong effect on the reported confidence score.
From the table related characteristics most strong effects show the
hypothesized direction. Not predicted was the negative effect of label
length on the reported confidence score. The visual separation of
columns and rows shows small effects. We find no support for a negative
effect of the fact that the <strong>Passiva</strong> table is on the same page as the
<strong>Aktiva</strong> table.</p>
<p>see Figure @ref(fig:real-table-extraction-llm-shap-plot)</p>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="fu">create_hypotheses_table</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_real_table_extraction_llm.html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables the LLM approach.&quot;</span>)</span></code></pre></div>
</details>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:hypotheses-and-results-real-table-extraction-llm-table)Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables the LLM approach.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
F1
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
% correct numeric
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
binomial
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
confidence
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
predictor
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">model_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">google worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">google worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">google worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral (Llama 4 Maverick low)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">parameter_count</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">method_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">zero shot worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_examples</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">1 and 3 best (five bad for Llama4)</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">1 and 3 best (five bad for Llama4)</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral (Llama 4 Maverick low)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_columns</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">3 worst</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">sum_same_lin</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative (i.e. if prev year not T€)</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral (inverted for T in prev year)</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">sum_in_header*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral (inverse for vis_separated_cols)</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     color: darkred !important;">Negative (inverse for vis separated cols)</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral (inverse for vis_separated_cols)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Neutral (inverse for vis seperated cols)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">unit_first_cell*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">T_in_previous_year</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative (esp. if cols not vis separated)</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">T_in_year*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">passiva_same_page</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vorjahr</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_cols</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative (interaction with T in prev year)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_rows</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label_length</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">missing</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">confidence</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="hybrid-approach-1" class="section level2 hasAnchor" number="11.3">
<h2 class="hasAnchor"><span class="header-section-number">11.3</span> Hybrid approach<a href="#hybrid-approach-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hypotheses-4" class="section level5 hasAnchor paragraph-start" number="11.3.0.0.1">
<h5 class="hasAnchor"><span class="header-section-number">11.3.0.0.1</span> Hypotheses<a href="#hypotheses-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Table
@ref(tab:hypotheses-and-results-real-table-extraction-llm-synth-context-table)
shows only one unsupported hypothesis for a predictor with a strong
effect: <em>method_family</em>. Figure
@ref(fig:static-example-best-dependence-plot) shows the dependence plot
for the this predictor. The prompting strategy <em>static_example</em> shows
the highest <a href="#acronyms_SHAP">SHAP</a> values. This is surprising, because the the
<em>static example</em> is equivalent to providing a single random example.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/real_table_extraction_synth_context_h2o_results_sample_50000_shap_2000_NA_recoded_extended.rds&quot;</span>)</span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb92-7"><a href="#cb92-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb92-9"><a href="#cb92-9" tabindex="-1"></a>p1c <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;method_family&quot;</span>)</span>
<span id="cb92-10"><a href="#cb92-10" tabindex="-1"></a><span class="co"># p1d &lt;- shap_num %&gt;% sv_dependence(&quot;vis_seperated_rows&quot;, &quot;T_in_year&quot;)</span></span>
<span id="cb92-11"><a href="#cb92-11" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb92-13"><a href="#cb92-13" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-14"><a href="#cb92-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb92-16"><a href="#cb92-16" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-17"><a href="#cb92-17" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb92-18"><a href="#cb92-18" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb92-20"><a href="#cb92-20" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-21"><a href="#cb92-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-22"><a href="#cb92-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb92-23"><a href="#cb92-23" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-24"><a href="#cb92-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb92-25"><a href="#cb92-25" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>confidence<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb92-27"><a href="#cb92-27" tabindex="-1"></a>p4a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-28"><a href="#cb92-28" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-29"><a href="#cb92-29" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb92-30"><a href="#cb92-30" tabindex="-1"></a>p4b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb92-31"><a href="#cb92-31" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb92-32"><a href="#cb92-32" tabindex="-1"></a></span>
<span id="cb92-33"><a href="#cb92-33" tabindex="-1"></a>real_table_extraction_llm_synth_context_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb92-34"><a href="#cb92-34" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb92-35"><a href="#cb92-35" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b) <span class="sc">/</span></span>
<span id="cb92-36"><a href="#cb92-36" tabindex="-1"></a>  (p4a <span class="sc">|</span> p4b)</span>
<span id="cb92-37"><a href="#cb92-37" tabindex="-1"></a></span>
<span id="cb92-38"><a href="#cb92-38" tabindex="-1"></a>real_table_extraction_llm_synth_context_shap_num_details_plot <span class="ot">&lt;-</span> p1c <span class="co"># | p1d</span></span></code></pre></div>
</details>
<div class="big-table">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="fu">create_hypotheses_table</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_real_table_extraction_synth_context_llm.html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables with the hybrid LLM approach.&quot;</span>)</span></code></pre></div>
</details>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
(#tab:hypotheses-and-results-real-table-extraction-llm-synth-context-table)Comparing the formulated hypotheses and the found results for the table extraction on real Aktiva tables with the hybrid LLM approach.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
F1
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
% correct numeric
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
binomial
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #00000020; padding-bottom: 5px; ">
confidence
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
predictor
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
<th style="text-align:left;">
Hypothesis
</th>
<th style="text-align:left;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">model_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Google &amp; Qwen3 worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Llama 4 best</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">Google &amp; Qwen3 worst</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">Llama 3 &amp; mistral worst</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">parameter_count</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">123B peak</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">method_family</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">static_example best</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">static example best</span>
</td>
<td style="text-align:left;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">static example best</span>
</td>
<td style="text-align:left;">
<span style="     ">top_n_rag &amp; n_random best</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_examples</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">at least one needed</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">n_columns</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">interaction with passiva_same_page</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral (helps if T in prev year)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">sum_same_lin</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative if header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">sum_in_header*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">header_span</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral (neg for vis separated cols)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">unit_first_cell*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">T_in_previous_year</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">T_in_year*</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style=" font-weight: bold;    ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;color: gray !important;">
<span style="     color: darkred !important;">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">passiva_same_page</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vorjahr</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_cols</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative (if T_in_prev year)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">negative</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">vis_separated_rows</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive (if header_span)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     color: darkred !important;">positive</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">respect_units</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive if T in year</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive (if T in prev)</span>
</td>
<td style="text-align:left;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style="     color: darkred !important;">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label_length</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">negative</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">negative</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">label</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     ">unknown</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">neutral</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">one never used</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">missing</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">unknown</span>
</td>
<td style="text-align:left;">
<span style="     ">positive</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">confidence</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style=" font-weight: bold;    ">positive</span>
</td>
<td style="text-align:left;border-right:1px solid;">
<span style="     ">positive</span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
<td style="text-align:left;">
<span style="     "></span>
</td>
</tr>
</tbody>
</table>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a>real_table_extraction_llm_synth_context_shap_num_details_plot</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/static-example-best-dependence-plot-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning." width="100%" />
<p class="caption">
(#fig:static-example-best-dependence-plot)Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning.
</p>
</div>
<!--chapter:end:12_Feature_Effects.Rmd-->
</div>
</div>
<div id="appendix-e---miscellaneous" class="section level1 hasAnchor" number="12">
<h1 class="hasAnchor"><span class="header-section-number">12</span> Appendix E - Miscellaneous<a href="#appendix-e---miscellaneous" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="hitl" class="section level2 hasAnchor" number="12.1">
<h2 class="hasAnchor"><span class="header-section-number">12.1</span> Human in the loop application<a href="#hitl" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using <a href="#acronyms_LLM">LLM</a>s has become a lot easier in the past years. <em>Python</em>
frameworks as <a href="#acronyms_vllm">vLLM</a> make it easy to deploy open-source models for
developers. <em>Open WebUI</em> allows us to set up a sophisticated chat bot UI
with ease. <em>Dify</em> promises to create no-code <a href="#acronyms_AI">AI</a> agents via a
graphical flowchart. But the regular employee at <a href="#acronyms_RHvB">RHvB</a> will just
use a provided application. And to solve the task, to extract (tabular)
information for loading it into a relational database, a chat UI seems
not the perfect match.</p>
<p>For the planned application we have two requirements: First, it should
be able to accurately extract information. Second, it has to provide a
good user experience.</p>
<p>Extracting the information of the assets table accurately means:</p>
<ul>
<li><p>Numeric values have to be extracted and transformed according to
potentially given currency units, e.g. <em>T€.</em></p></li>
<li><p>The row labels should be matched with a limited set of labels in the
target database.</p></li>
<li><p>Unknown row labels and their values have to treated in a appropriate
way.</p></li>
</ul>
<p>To ensure, that there are no mistakes, a <a href="#acronyms_HITL">HITL</a> approach should be
implemented. Figure @ref(fig:hitl-workflow) shows that the employee
should initiate the extraction, by providing the document to extract
information from and potentially choose, what to extract. The employee
should also double check the results, before they are saved for future
usage in down stream tasks.</p>
<div class="figure">
<img src="images/HITL_flowchart.png" alt="Showing the information extraction process in a HITL application. The fed in document and results are saved in a database, that is used for the in-context learning RAG approaches for future extractions. The results are saved in the relational company database as well, e.g. as information to present in dashboards." width="100%" />
<p class="caption">
(#fig:hitl-workflow)Showing the information extraction process in a HITL application. The fed in document and results are saved in a database, that is used for the in-context learning RAG approaches for future extractions. The results are saved in the relational company database as well, e.g. as information to present in dashboards.
</p>
</div>
<p>Why do we aim to build an application that assists the process instead
of fully automating it? On one hand, building a system that makes no
mistakes might be impossible. And it would be more efficient, to ensure
machine-readable data provision in the first place.</p>
<p>On the other hand, building a <a href="#acronyms_HITL">HITL</a> application, could increase the
employees acceptance for the product and trust in the results. An
assisting application is not as threatening as an application, that
fully automates a process, making the human redundant and potentially
leading to job cuts. Programms building on the machine learning paradigm
are rarely making decisions that are not seen as correct by a human. And
humans make errors as well. Teaming up with an <a href="#acronyms_AI">AI</a> to reduce the
error rate, should increase the trust in the results, if this story is
sold right. (change management)</p>
<p>We believe, that the <a href="#acronyms_UX">UX</a> would improve, if we can guide the user,
which values to check and which he can trust. This would reduce the work
load and might increase the feeling to spend the time meaningful, by
finding the same amount of mistakes, while checking less values. Thus,
we formulate our side research question:</p>
<ol class="rs-questions" style="--counter: 3;">
<li>
Can we use additional information from the extraction process, to guide the user which values need to be checked and which can be trusted as they are?
</li>
</ol>
<p>Of course, mistakes not only happen by extracting a wrong value, but by
matching the values row with the wrong row labels from the predefined
set. This can happen, because they are similar but not equal or because
the row label at hand is not present in the predefined set yet. Having a
human in the loop, seems to be a good way to handle such unknown row
labels as well.</p>
<p>The <a href="#acronyms_UI">UI (user interface)</a> should assist in all cases. Comparing numeric values,
checking the row label matching and showing, which rows have not been
handled yet and need human decisions. Figure @ref(fig:compare-results)
shows a first mockup, about what has to be compared focussing on a
single years numeric values and the row lable matching. A <a href="#acronyms_UX">UX</a> study
should answer questions, how exactly the <a href="#acronyms_UI">UI</a> should look like and
if the employee prefers to check the identified page, before the
extraction begins (see the human shape with question marks in Figure
@ref(fig:hitl-workflow)).</p>
<div class="figure">
<img src="images/compare_results.png" alt="Showing the information that need to be compared by the user after the information extraction. Unmatched rows could be highlighted in another color." width="100%" />
<p class="caption">
(#fig:compare-results)Showing the information that need to be compared by the user after the information extraction. Unmatched rows could be highlighted in another color.
</p>
</div>
<p>human in the loop <span class="citation">(<a href="#ref-mosqueira-reyHumanintheloopMachineLearning2023">Mosqueira-Rey et al., 2023</a>; <a href="#ref-natarajanHumanintheloopAIintheloopAutomate2024">Natarajan et al., 2024</a>; <a href="#ref-wuSurveyHumanintheloopMachine2022">Wu et al., 2022</a>)</span></p>
<ul>
<li>allowing in place adjustments to the extracted data.</li>
</ul>
</div>
<div id="local-machine" class="section level2 hasAnchor" number="12.2">
<h2 class="hasAnchor"><span class="header-section-number">12.2</span> Local machine<a href="#local-machine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One can find the specifications of the local machine used to run the tasks that do not require a <a href="#acronyms_GPU">GPU</a> below. It is a lightweight laptop device. Its performance cores support hyper-threading and have a clock range between 2.1 and 4.7 GHz. Due to its slim design, there is little active cooling. Thus, thermal throttling starts quickly. It is a reasonable assumption that most local benchmarks are running at 2.1 GHz. Despite this handicap, it has a sufficiently large RAM of 32 GB and 3 TB of NVMe disk space.</p>
<div id="system-details-report" class="section level3 unlisted unnumbered hasAnchor">
<h3 class="unlisted unnumbered hasAnchor">System Details Report<a href="#system-details-report" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="report-details" class="section level4 unlisted unnumbered hasAnchor">
<h4 class="unlisted unnumbered hasAnchor">Report details<a href="#report-details" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Date generated:</strong> 2025-07-19 13:56:16</li>
</ul>
</div>
<div id="hardware-information" class="section level4 unlisted unnumbered hasAnchor">
<h4 class="unlisted unnumbered hasAnchor">Hardware Information:<a href="#hardware-information" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Hardware Model:</strong> LG Electronics 17ZB90Q-G.AD79G</li>
<li><strong>Memory:</strong> 32.0 GiB</li>
<li><strong>Processor:</strong> 12th Gen Intel® Core™ i7-1260P × 16</li>
<li><strong>Graphics:</strong> Intel® Graphics (ADL GT2)</li>
<li><strong>Disk Capacity:</strong> 3.0 TB</li>
</ul>
</div>
<div id="software-information" class="section level4 unlisted unnumbered hasAnchor">
<h4 class="unlisted unnumbered hasAnchor">Software Information:<a href="#software-information" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><strong>Firmware Version:</strong> A2ZG0150 X64</li>
<li><strong>OS Name:</strong> Ubuntu 24.04.2 LTS</li>
<li><strong>OS Build:</strong> (null)</li>
<li><strong>OS Type:</strong> 64-bit</li>
<li><strong>GNOME Version:</strong> 46</li>
<li><strong>Windowing System:</strong> Wayland</li>
<li><strong>Kernel Version:</strong> Linux 6.11.0-29-generic</li>
</ul>
</div>
</div>
</div>
<div id="benchmarks" class="section level2 hasAnchor" number="12.3">
<h2 class="hasAnchor"><span class="header-section-number">12.3</span> Benchmarks<a href="#benchmarks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="text-extraction-benchmark" class="section level3 hasAnchor" number="12.3.1">
<h3 class="hasAnchor"><span class="header-section-number">12.3.1</span> Text extraction<a href="#text-extraction-benchmark" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a>data_text_extraction <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;../benchmark_results/text_extraction_benchmark_results.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>  <span class="fu">arrange</span>(runtime) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;package&quot;</span> <span class="ot">=</span> <span class="st">&quot;pdfbackend&quot;</span>, <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> <span class="st">&quot;runtime&quot;</span>)</span>
<span id="cb95-4"><a href="#cb95-4" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" tabindex="-1"></a><span class="co"># Find the lowest value in the &quot;runtime in s&quot; column and make it bold</span></span>
<span id="cb95-6"><a href="#cb95-6" tabindex="-1"></a>data_text_extraction <span class="ot">&lt;-</span> data_text_extraction <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-8"><a href="#cb95-8" tabindex="-1"></a>    <span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span>, <span class="dv">0</span>), <span class="co"># Ensure the column is numeric</span></span>
<span id="cb95-9"><a href="#cb95-9" tabindex="-1"></a>    <span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb95-10"><a href="#cb95-10" tabindex="-1"></a>      <span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span> <span class="sc">==</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb95-11"><a href="#cb95-11" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span>, <span class="st">&quot;**&quot;</span>),</span>
<span id="cb95-12"><a href="#cb95-12" tabindex="-1"></a>      <span class="st">`</span><span class="at">runtime in s</span><span class="st">`</span></span>
<span id="cb95-13"><a href="#cb95-13" tabindex="-1"></a>    )</span>
<span id="cb95-14"><a href="#cb95-14" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p>All our experiments use the text extracted from PDF files. The available open-source libraries differ in their speed, quality of results and restrictiveness of licensing <span class="citation">(<a href="#ref-auerDoclingTechnicalReport2024">Auer et al., 2024</a>)</span>. We have tested multiple libraries in this thesis, because <span class="citation">Auer et al. (<a href="#ref-auerDoclingTechnicalReport2024">2024</a>)</span> published no quantitative results. The benchmark runs on the local machine described in section @ref(local-machine). There are 5256 pages to extract the text from.</p>
<p>Table @ref(tab:display-data-text-extraction) shows, that <em>pdfium</em> and <em>pymupdf</em> extract the text fastest. For implementation in a system where the text has to get extracted live or frequently the speed of the library might be paramount. Since the AGPL license of <em>pymupdf</em> might not be met with the application, that will be created for <a href="#acronyms_RHvB">RHvB</a>, <em>pdfium</em> is an interesting candidate for the PDF parsing library to use.</p>
<p><span class="citation">Auer et al. (<a href="#ref-auerDoclingTechnicalReport2024">2024</a>)</span> reports, that <em>pdfium</em> occasionally merges text cells that are not close o each other, resulting in unrecoverable quality issues. Thus we checked some of the extracted texts manually and include the PDF extraction backend as a variable in our experiments. The page identification experiment, using the <a href="#acronyms_regex">regex</a> approach, shows no effect of the text extraction library. In contrast, we find an effect in the later performed information extraction experiment on synthetic <strong>Aktiva</strong> tables with the <a href="#acronyms_regex">regex</a> approach.</p>
<p>Some examples for errorneous extracted texts with <em>pdfium</em> and <em>pdfminer</em> can be found in section @ref(regex-extraction-mistakes).</p>
<p>time to ocr 107 images with pdf2image and pytesseract: 1:28+11:41</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="fu">render_table</span>(data_text_extraction, <span class="at">alignment=</span><span class="st">&quot;lr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing extraction time (in seconds) for different Python package&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:display-data-text-extraction)Comparing extraction time (in seconds) for different Python package
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-822e6cdc274752df0af2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-822e6cdc274752df0af2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["pdfium","pymupdf","pypdf","pdfplumber","pdfminer","docling-parse"],["<b>14<\/b>","22","218","675","752","1621"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>package<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"package","targets":1},{"name":"runtime in s","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="table-detection-benchmark" class="section level3 hasAnchor" number="12.3.2">
<h3 class="hasAnchor"><span class="header-section-number">12.3.2</span> Table detection<a href="#table-detection-benchmark" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="co"># Get a list of all .json files in the folder</span></span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a>json_files_table_detection <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;../benchmark_results/table_detection/&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.json$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a>meta_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb97-5"><a href="#cb97-5" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" tabindex="-1"></a><span class="co"># Loop through each .json file</span></span>
<span id="cb97-7"><a href="#cb97-7" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> json_files_table_detection) {</span>
<span id="cb97-8"><a href="#cb97-8" tabindex="-1"></a>  <span class="co"># Read the JSON file</span></span>
<span id="cb97-9"><a href="#cb97-9" tabindex="-1"></a>  json_data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(file)</span>
<span id="cb97-10"><a href="#cb97-10" tabindex="-1"></a>  </span>
<span id="cb97-11"><a href="#cb97-11" tabindex="-1"></a>  <span class="co"># Extract the threshold and metrics from the &quot;metrics&quot; key</span></span>
<span id="cb97-12"><a href="#cb97-12" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fromJSON</span>(json_data<span class="sc">$</span>metrics))</span>
<span id="cb97-13"><a href="#cb97-13" tabindex="-1"></a>  </span>
<span id="cb97-14"><a href="#cb97-14" tabindex="-1"></a>  lst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb97-15"><a href="#cb97-15" tabindex="-1"></a>    <span class="at">metrics =</span> metrics,</span>
<span id="cb97-16"><a href="#cb97-16" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">basename</span>(file),</span>
<span id="cb97-17"><a href="#cb97-17" tabindex="-1"></a>    <span class="at">runtime =</span> json_data<span class="sc">$</span>runtime</span>
<span id="cb97-18"><a href="#cb97-18" tabindex="-1"></a>  )</span>
<span id="cb97-19"><a href="#cb97-19" tabindex="-1"></a>  meta_list[[<span class="fu">length</span>(meta_list) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> lst</span>
<span id="cb97-20"><a href="#cb97-20" tabindex="-1"></a>}</span>
<span id="cb97-21"><a href="#cb97-21" tabindex="-1"></a></span>
<span id="cb97-22"><a href="#cb97-22" tabindex="-1"></a><span class="co"># Plot the metrics over threshold</span></span>
<span id="cb97-23"><a href="#cb97-23" tabindex="-1"></a>metric_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb97-24"><a href="#cb97-24" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" tabindex="-1"></a><span class="cf">for</span> (result <span class="cf">in</span> meta_list) {</span>
<span id="cb97-26"><a href="#cb97-26" tabindex="-1"></a>  table_detection_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(result<span class="sc">$</span>metrics, <span class="fu">aes</span>(<span class="at">x =</span> threshold)) <span class="sc">+</span></span>
<span id="cb97-27"><a href="#cb97-27" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> precision, <span class="at">color =</span> <span class="st">&quot;Precision&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-28"><a href="#cb97-28" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> recall, <span class="at">color =</span> <span class="st">&quot;Recall&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-29"><a href="#cb97-29" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> recall_target, <span class="at">color =</span> <span class="st">&quot;Recall for tables of interest&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-30"><a href="#cb97-30" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> F1, <span class="at">color =</span> <span class="st">&quot;F1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb97-31"><a href="#cb97-31" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb97-32"><a href="#cb97-32" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">str_replace</span>(result<span class="sc">$</span>model, <span class="st">&quot;.json&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb97-33"><a href="#cb97-33" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Runtime:&quot;</span>, <span class="fu">round</span>(result<span class="sc">$</span>runtime, <span class="dv">0</span>) , <span class="st">&quot;s&quot;</span>),</span>
<span id="cb97-34"><a href="#cb97-34" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Threshold&quot;</span>,</span>
<span id="cb97-35"><a href="#cb97-35" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Metric Value&quot;</span>,</span>
<span id="cb97-36"><a href="#cb97-36" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;Metric&quot;</span></span>
<span id="cb97-37"><a href="#cb97-37" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb97-38"><a href="#cb97-38" tabindex="-1"></a>    <span class="co"># theme_minimal() +</span></span>
<span id="cb97-39"><a href="#cb97-39" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb97-40"><a href="#cb97-40" tabindex="-1"></a>  </span>
<span id="cb97-41"><a href="#cb97-41" tabindex="-1"></a>  metric_plots[[<span class="fu">length</span>(metric_plots) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">image =</span> table_detection_plot, <span class="at">title =</span> <span class="fu">str_replace</span>(result<span class="sc">$</span>model, <span class="st">&quot;.json&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb97-42"><a href="#cb97-42" tabindex="-1"></a>}</span>
<span id="cb97-43"><a href="#cb97-43" tabindex="-1"></a></span>
<span id="cb97-44"><a href="#cb97-44" tabindex="-1"></a>json_files_table_detection_llm <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;../benchmark_results/table_detection/llm/&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.json$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-45"><a href="#cb97-45" tabindex="-1"></a></span>
<span id="cb97-46"><a href="#cb97-46" tabindex="-1"></a>meta_list_llm <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb97-47"><a href="#cb97-47" tabindex="-1"></a></span>
<span id="cb97-48"><a href="#cb97-48" tabindex="-1"></a><span class="co"># Loop through each .json file</span></span>
<span id="cb97-49"><a href="#cb97-49" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> json_files_table_detection_llm) {</span>
<span id="cb97-50"><a href="#cb97-50" tabindex="-1"></a>  <span class="co"># Read the JSON file</span></span>
<span id="cb97-51"><a href="#cb97-51" tabindex="-1"></a>  json_data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(file)</span>
<span id="cb97-52"><a href="#cb97-52" tabindex="-1"></a>  </span>
<span id="cb97-53"><a href="#cb97-53" tabindex="-1"></a>  <span class="co"># Extract the threshold and metrics from the &quot;metrics&quot; key</span></span>
<span id="cb97-54"><a href="#cb97-54" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(json_data<span class="sc">$</span>metrics)</span>
<span id="cb97-55"><a href="#cb97-55" tabindex="-1"></a>  </span>
<span id="cb97-56"><a href="#cb97-56" tabindex="-1"></a>  lst <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb97-57"><a href="#cb97-57" tabindex="-1"></a>    <span class="at">metrics =</span> metrics,</span>
<span id="cb97-58"><a href="#cb97-58" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">basename</span>(file),</span>
<span id="cb97-59"><a href="#cb97-59" tabindex="-1"></a>    <span class="at">runtime =</span> json_data<span class="sc">$</span>runtime</span>
<span id="cb97-60"><a href="#cb97-60" tabindex="-1"></a>  )</span>
<span id="cb97-61"><a href="#cb97-61" tabindex="-1"></a>  meta_list_llm[[<span class="fu">length</span>(meta_list_llm) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> lst</span>
<span id="cb97-62"><a href="#cb97-62" tabindex="-1"></a>}</span>
<span id="cb97-63"><a href="#cb97-63" tabindex="-1"></a></span>
<span id="cb97-64"><a href="#cb97-64" tabindex="-1"></a>results_df_llm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb97-65"><a href="#cb97-65" tabindex="-1"></a>  <span class="at">llm =</span> <span class="fu">character</span>(),</span>
<span id="cb97-66"><a href="#cb97-66" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">character</span>(),</span>
<span id="cb97-67"><a href="#cb97-67" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">character</span>(),</span>
<span id="cb97-68"><a href="#cb97-68" tabindex="-1"></a>  <span class="at">loop =</span> <span class="fu">numeric</span>(),</span>
<span id="cb97-69"><a href="#cb97-69" tabindex="-1"></a>  <span class="co"># acc = numeric(),</span></span>
<span id="cb97-70"><a href="#cb97-70" tabindex="-1"></a>  <span class="co"># precision = numeric(),</span></span>
<span id="cb97-71"><a href="#cb97-71" tabindex="-1"></a>  <span class="co"># recall = numeric(),</span></span>
<span id="cb97-72"><a href="#cb97-72" tabindex="-1"></a>  <span class="at">F1_Aktiva =</span> <span class="fu">numeric</span>(),</span>
<span id="cb97-73"><a href="#cb97-73" tabindex="-1"></a>  <span class="at">runtime_in_s =</span> <span class="fu">numeric</span>(),</span>
<span id="cb97-74"><a href="#cb97-74" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb97-75"><a href="#cb97-75" tabindex="-1"></a>)</span>
<span id="cb97-76"><a href="#cb97-76" tabindex="-1"></a></span>
<span id="cb97-77"><a href="#cb97-77" tabindex="-1"></a><span class="cf">for</span> (result <span class="cf">in</span> meta_list_llm) {</span>
<span id="cb97-78"><a href="#cb97-78" tabindex="-1"></a>  </span>
<span id="cb97-79"><a href="#cb97-79" tabindex="-1"></a>  name_split <span class="ot">=</span> result<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">str_split</span>(<span class="st">&quot;__&quot;</span>)</span>
<span id="cb97-80"><a href="#cb97-80" tabindex="-1"></a>  name_split <span class="ot">=</span> name_split[[<span class="dv">1</span>]]</span>
<span id="cb97-81"><a href="#cb97-81" tabindex="-1"></a>  </span>
<span id="cb97-82"><a href="#cb97-82" tabindex="-1"></a>  llm <span class="ot">=</span> name_split[<span class="dv">1</span>]</span>
<span id="cb97-83"><a href="#cb97-83" tabindex="-1"></a>  parameters <span class="ot">=</span> <span class="fu">str_extract</span>(llm, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d*</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d+B&quot;</span>)</span>
<span id="cb97-84"><a href="#cb97-84" tabindex="-1"></a>  method <span class="ot">=</span> name_split[<span class="fu">length</span>(name_split)<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb97-85"><a href="#cb97-85" tabindex="-1"></a>  loop <span class="ot">=</span> name_split[<span class="fu">length</span>(name_split)] <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;.json&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;loop_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()</span>
<span id="cb97-86"><a href="#cb97-86" tabindex="-1"></a>  F1_Aktiva <span class="ot">=</span> result<span class="sc">$</span>metrics<span class="sc">$</span>Aktiva.f1_score</span>
<span id="cb97-87"><a href="#cb97-87" tabindex="-1"></a>  runtime <span class="ot">=</span> result<span class="sc">$</span>runtime</span>
<span id="cb97-88"><a href="#cb97-88" tabindex="-1"></a>  </span>
<span id="cb97-89"><a href="#cb97-89" tabindex="-1"></a>  results_df_llm <span class="ot">&lt;-</span> results_df_llm <span class="sc">%&gt;%</span></span>
<span id="cb97-90"><a href="#cb97-90" tabindex="-1"></a>    <span class="fu">add_row</span>(</span>
<span id="cb97-91"><a href="#cb97-91" tabindex="-1"></a>      <span class="at">llm =</span> llm,</span>
<span id="cb97-92"><a href="#cb97-92" tabindex="-1"></a>      <span class="at">parameters =</span> parameters,</span>
<span id="cb97-93"><a href="#cb97-93" tabindex="-1"></a>      <span class="at">method =</span> method,</span>
<span id="cb97-94"><a href="#cb97-94" tabindex="-1"></a>      <span class="at">loop =</span> loop,</span>
<span id="cb97-95"><a href="#cb97-95" tabindex="-1"></a>      <span class="co"># acc = acc,</span></span>
<span id="cb97-96"><a href="#cb97-96" tabindex="-1"></a>      <span class="co"># precision = precision,</span></span>
<span id="cb97-97"><a href="#cb97-97" tabindex="-1"></a>      <span class="co"># recall = recall,</span></span>
<span id="cb97-98"><a href="#cb97-98" tabindex="-1"></a>      <span class="at">F1_Aktiva =</span> F1_Aktiva, <span class="co">#round(F1_Aktiva, 2),</span></span>
<span id="cb97-99"><a href="#cb97-99" tabindex="-1"></a>      <span class="at">runtime_in_s =</span> <span class="fu">round</span>(runtime, <span class="dv">2</span>)</span>
<span id="cb97-100"><a href="#cb97-100" tabindex="-1"></a>    )</span>
<span id="cb97-101"><a href="#cb97-101" tabindex="-1"></a>}</span></code></pre></div>
</details>
<div id="yolo-benchmark-and-table-transformer" class="section level4 hasAnchor" number="12.3.2.1">
<h4 class="hasAnchor"><span class="header-section-number">12.3.2.1</span> yolo benchmark and table transformer<a href="#yolo-benchmark-and-table-transformer" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>not so important anymore</p>
</div>
<div id="old-classification-with-llm" class="section level4 hasAnchor" number="12.3.2.2">
<h4 class="hasAnchor"><span class="header-section-number">12.3.2.2</span> old classification with llm<a href="#old-classification-with-llm" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>took wrong identified pages as base for a table detection benchmark and n-shot base for llm classification (contrasts)</p>
<div class="image-slider">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a><span class="cf">for</span> (entry <span class="cf">in</span> metric_plots) {</span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>  <span class="fu">print</span>(entry<span class="sc">$</span>image)</span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;&lt;span class=&#39;image-caption&#39;&gt;You see the plot for: &quot;</span>,entry<span class="sc">$</span>title,<span class="st">&quot;. </span><span class="sc">\n</span><span class="st">(Click to stop automatic rotation.)&lt;/span&gt;&quot;</span>))</span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/metric-plots-slider-1.png" width="100%" /><span class="image-caption">You see the plot for: microsoft-table-transformer-detection.
(Click to stop automatic rotation.)</span><img src="_main_files/figure-html/metric-plots-slider-2.png" width="100%" /><span class="image-caption">You see the plot for: yolo12l-doclaynet.
(Click to stop automatic rotation.)</span><img src="_main_files/figure-html/metric-plots-slider-3.png" width="100%" /><span class="image-caption">You see the plot for: yolo12n-doclaynet.
(Click to stop automatic rotation.)</span></p>
</div>
<div class="image-selector">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a><span class="cf">for</span> (entry <span class="cf">in</span> metric_plots) {</span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a>  <span class="fu">print</span>(entry<span class="sc">$</span>image)</span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;&lt;span class=&#39;image-caption&#39;&gt;&quot;</span>,entry<span class="sc">$</span>title,<span class="st">&quot;&lt;/span&gt;&quot;</span>))</span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/metric-plots-selector-1.png" width="100%" /><span class="image-caption">microsoft-table-transformer-detection</span><img src="_main_files/figure-html/metric-plots-selector-2.png" width="100%" /><span class="image-caption">yolo12l-doclaynet</span><img src="_main_files/figure-html/metric-plots-selector-3.png" width="100%" /><span class="image-caption">yolo12n-doclaynet</span></p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a>results_df_llm <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a>    <span class="at">F1_Aktiva =</span> <span class="fu">round</span>(F1_Aktiva, <span class="dv">2</span>),</span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lllrr&quot;</span>,</span>
<span id="cb100-7"><a href="#cb100-7" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Results of the table detection benchmark with LLMs&quot;</span>,</span>
<span id="cb100-8"><a href="#cb100-8" tabindex="-1"></a>    <span class="at">ref =</span> <span class="st">&quot;display-results-df-llm&quot;</span></span>
<span id="cb100-9"><a href="#cb100-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<table>
<caption>
(#tab:display-results-df-llm)Results of the table detection benchmark with LLMs
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-8e4759b4a3a4a985dfda" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8e4759b4a3a4a985dfda">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783"],["deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","deepseek-ai_<wbr>DeepSeek-R1-Distill-Qwen-32B","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-27b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","google_<wbr>gemma-3-4b-it","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-70B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.1-8B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.2-3B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-3.3-70B-Instruct","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","meta-llama_<wbr>Llama-4-Scout-17B-16E","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","microsoft_<wbr>phi-4","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","mistralai_<wbr>Mistral-7B-Instruct-v0.3","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-0.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-1.5B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-14B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-32B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-3B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-72B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen2.5-7B-Instruct_<wbr>alt_<wbr>prompts","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-32B-no-think","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","Qwen_<wbr>Qwen3-8B-no-think","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct","tiiuae_<wbr>Falcon3-10B-Instruct"],["32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","70B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B","17B",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","0.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","1.5B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","14B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","3B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","72B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","7B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","32B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","8B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B","10B"],["law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","random_<wbr>examples","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","law_<wbr>context","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","rag_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","random_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot","zero_<wbr>shot"],["0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","0","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","0","1","0","1","2","0","1","0","1","2","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","0","1","0","1","2","0","1","0","1","2","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","0","0","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4","0","1","2","3","4"],["0.22","0.21","0.21","0.21","0.21","0.22","0.22","0.2","0.2","0.21","0.21","0.21","0.22","0.22","0.22","0.22","0.22","0.22","0.22","0.21","0.22","0.21","0.22","0.22","0.22","0.74","0.74","0.75","0.75","0.74","0.8","0.8","0.8","0.8","0.79","0.85","0.84","0.84","0.84","0.81","0.79","0.8","0.79","0.79","0.79","0.7","0.7","0.7","0.7","0.7","0.62","0.63","0.61","0.61","0.61","0.59","0.58","0.58","0.59","0.58","0.73","0.69","0.63","0.7","0.68","0.47","0.45","0.48","0.49","0.48","0.46","0.47","0.46","0.46","0.46","0.67","0.68","0.7","0.71","0.75","0.18","0.22","0.18","0.2","0.17","0.34","0.53","0.43","0.6","0.6","0.82","0.82","0.82","0.82","0.79","0.78","0.76","0.78","0.8","0.78","0.23","0.23","0.23","0.23","0.23","0.24","0.23","0.26","0.25","0.25","0.4","0.42","0.41","0.42","0.4","0.27","0.27","0.28","0.28","0.28","0.26","0.26","0.26","0.26","0.26","0.22","0.22","0.21","0.22","0.22","0.24","0.25","0.25","0.25","0.24","0.24","0.25","0.24","0.24","0.24","0.21","0.21","0.21","0.21","0.21","0.29","0.28","0.25","0.28","0.31","0.02","0.02","0.02","0.04","0","0.49","0.5","0.5","0.46","0.47","0.62","0.53","0.54","0.58","0.6","0.76","0.78","0.76","0.78","0.77","0.8","0.8","0.79","0.8","0.82","0.22","0.22","0.22","0.22","0.22","0.22","0.22","0.22","0.21","0.21","0.22","0.22","0.22","0.22","0.22","0.26","0.26","0.27","0.25","0.26","0.23","0.23","0.22","0.23","0.23","0.22","0.22","0.22","0.22","0.22","0.21","0.21","0.21","0.21","0.21","0.21","0.21","0.21","0.21","0.21","0.22","0.22","0.22","0.22","0.22","0.39","0.39","0.39","0.39","0.39",null,null,"0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"0","0","0",null,"0","0","0","0",null,"0","0","0","0",null,"0","0","0","0",null,null,"0","0","0","0.29","0.28","0.29","0.28","0.28","0.24","0.24","0.22","0.23","0.24","0.25","0.23","0.24","0.25","0.24","0.28","0.27","0.27","0.28","0.27","0.33","0.37","0.37","0.41","0.44","0.22","0.29","0.25","0.25","0.33","0.2","0.18","0.22","0.2","0.2","0.18","0.25","0.22","0.22","0.18","0.22","0.2","0.25","0.25","0.25","0","0","1","0","0","0.29","0.31","0.3","0.28","0.3","0.27","0.28","0.27","0.28","0.28","0.4","0.37","0.37","0.4","0.41","0.38","0.35","0.35","0.35","0.36","0.37","0.38","0.32","0.42","0.39","1","0","0","0.67","0.67","0.29","0.25","0.22","0.22","0.2","0","0.4","0.29","0","0","0.5","0.33","0.33","0.33","0.33","0.5","0.67","1","1","1","0.33","0.32","0.35","0.23","0.29","0.3","0.31","0.31","0.31","0.31","0.39","0.42","0.4","0.4","0.42","0.39","0.37","0.37","0.35","0.36","0.39","0.48","0.41","0.44","0.39","0.67","1","0.67","1","1","0.25","0.25","0.22","0.22","0.25","0.67","0","0.5","0.33","0","0.5","0.33","0.5","0.4","0.67","1","1","1","1","1","0.81","0.82","0.81","0.82","0.8","0.85","0.84","0.82","0.84","0.83","0.79","0.82","0.78","0.75","0.79","0.8","0.81","0.81","0.81","0.81","0.73","0.74","0.73","0.73","0.74","1","1","1","1","1","1","1","1","1","1","1","0.5","1","1","1","1","1","1","1","1","0.67","0.67","0.67","0.67","0.67","0.79","0.79","0.79","0.8","0.78","0.87","0.88","0.87","0.88","0.86","0.83","0.85","0.82","0.84","0.86","0.83","0.82","0.83","0.82","0.83","0.72","0.71","0.72","0.71","0.71","0.72","0.73","0.73","0.72","0.73","0.24","0.24","0.23","0.24","0.24","0.3","0.29","0.29","0.29","0.29","0.34","0.36","0.36","0.36","0.35","0.79","0.8","0.8","0.8","0.79","0.83","0.84","0.84","0.83","0.85","0.85","0.86","0.86","0.87","0.86","0.84","0.83","0.83","0.88","0.85","0.86","0.86","0.86","0.86","0.86","0.74","0.75","0.76","0.75","0.76",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"0.65","0.65","0.66","0.66","0.64","0.64","0.64","0.66","0.62","0.64","0.58","0.6","0.6","0.62","0.59","0.69","0.69","0.69","0.69","0.7","0.61","0.61","0.61","0.6","0.62","0.65","0.65","0.65","0.67","0.65","0.7","0.69","0.7","0.67","0.69","0.64","0.65","0.67","0.67","0.65","0.72","0.71","0.72","0.72","0.71","0.63","0.63","0.63","0.63","0.64","0.3","0.28","0.28","0.27","0.31","0.26","0.24","0.24","0.24","0.26","0.32","0.35","0.3","0.33","0.34","0.35","0.32","0.33","0.33","0.34","0.24","0.26","0.29","0.27","0.31","0.3","0.29","0.33","0.3","0.31","0.35","0.3","0.33","0.4","0.4","0.11","0.16","0.03","0.17","0.19","0.16","0.11","0.11","0.11","0.09","0.12","0.15","0.13","0.04","0.06","0.07","0.04","0.15","0.09","0.08","0.11","0.06","0.13","0.08","0.11","0.11","0.03","0.05","0","0","0","0","0","0","0","0","0","0","0","0.02","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],["238.3","238.17","238.66","238.52","238.47","289.46","280.12","285.8","343.86","321.34","211.59","211","220.06","214.12","216.64","226.02","224.53","225.72","271.77","235.59","122.94","123.13","123","123.2","123.08","455.92","625.8","626.03","625.9","626.01","3827.93","3908.06","3896.02","3895.44","3880.57","2653.36","2921.28","2920.58","2933.6","2930.62","1436.34","1443.84","1435.03","1434.89","1434.64","134.25","206.05","206.14","206.08","206.11","317.37","421.29","421.03","421.67","421.01","2445.47","2546.31","2537.95","2548.47","2529.68","1705.17","1863.38","1883.24","1863.75","1846.62","929.15","940.92","931.21","932.55","937.16","98.71","142.28","142.26","142.33","142.29","818.65","818.42","818.77","818.61","818.73","4365.45","4361.61","4366.94","4348.61","4325.54","3307.63","3302.51","3355.82","3321.07","3292.59","1740.03","1733.36","1727.42","1726.43","1725.78","237.25","237.1","237.06","237.04","237.03","449.39","450.12","447.76","449.38","448.99","1970.39","1962.29","1967.06","1972.81","1967.3","1523.19","1508.49","1470.37","1526.47","1518.13","842.57","838.55","843.24","842.4","840.84","140.66","139.73","139.33","139.94","139.58","228.26","229.24","228.9","227.92","228.59","1088.99","1086.67","1088.11","1085.29","1093.38","805.06","810.35","808.58","797.79","806.02","445.85","445.95","443.17","446.19","445.72","69.51","69.02","68.96","68.7","68.95","815.59","815.75","815.83","816.05","815.92","4304.01","4299.07","4306.56","4292.25","4276.04","3252.27","3236.52","3235.47","3252.76","3275.8","1717.19","1701.66","1707.11","1703.24","1697.19","237.18","236.94","236.95","236.97","236.83","955.76","956.12","956.09","956.03","955.58","3576.79","3534.73","3532.61","3532.3","3526.85","2794.02","2830.76","2795.35","2826.53","2804.32","1718.24","1722.57","1718.56","1721.71","1712.57","353.81","353.2","353.21","353.15","353.11","789.77","790.53","790.21","790.13","793.92","3451.58","3449.79","3440.45","3457.14","3471.3","2666.24","2721.08","2714.43","2687.37","2712","1499.04","1495.09","1500.2","1502.01","1498.26","250.22","248.89","247.88","248.81","249.63","43.54","31.9","534.91","532.87","532.81","534.06","534.05","2735.12","2735.08","2734.15","2736.43","2736.34","2122.86","2145.18","2106.63","2105.69","2104.13","1098.51","1098.48","1099.54","1099.5","1099.88","163.01","162.71","162.75","162.86","162.67","33.93","36.33","36.73","36.82","36.72","36.78","290.75","288.14","289.4","290.34","289.59","181.62","180.1","177.64","181.47","180.85","161.04","160.7","160.71","160.95","161","21.35","20.87","20.98","20.99","21.01","0.97","0.97","0.97","0.97","0.97","10.84","5.98","5.94","5.96","5.96","4.48","3.9","4.78","4.34","3.89","4.48","4.03","4.02","4.03","4.03","1.01","0.44","0.44","0.44","0.44","71.31","72.64","72.36","72.68","72.58","518.24","510.82","484.76","484.04","487.78","331.12","327.31","333.26","332.88","333.54","174.59","174.52","174.63","174.54","174.76","24.56","24.43","24.48","24.37","24.51","1.88","1.88","1.87","1.86","1.86","9.14","9.29","9.29","9.28","9.27","7.49","6.51","6.9","7.59","6.67","4.27","4.29","4.26","4.26","4.27","1.08","0.55","0.56","0.56","0.56","148.24","149.34","149.35","149.21","149.25","846.2","950.77","859.78","846.3","861.53","624.42","621.33","612.83","613.76","620.18","340.11","333","328.75","328.7","328.72","47.76","48.34","48.26","48.31","48.31","5.54","5.53","5.53","5.53","5.53","36.01","24.86","23.61","23.55","23.57","20.29","18.85","20.74","18.65","19.8","13.23","11.85","11.86","11.86","11.88","2.16","1.58","1.59","1.59","1.58","147.07","148.06","148.18","148.09","147.99","836.12","866.65","871.81","864.28","837.81","615.35","608.01","615.99","610.97","607.43","348.76","345.34","324.43","324.33","324.74","46.86","47.41","47.4","47.46","47.43","5.47","5.45","5.46","5.45","5.45","26.21","23.31","23.32","23.38","23.38","19.15","18.69","19.3","18.8","18.62","11.61","11.6","11.61","11.61","11.62","2.13","1.56","1.56","1.55","1.55","840.87","841.52","841.5","841.4","841.65","4596.76","4591.57","4519.45","4516.86","4519.08","3522.07","3513.06","3486.9","3518.15","3516.75","1858.95","1862.82","1850.4","1850.58","1847.89","274.69","273.96","273.86","273.84","273.99","51.31","51.25","51.37","51.5","51.3","202.06","201.2","201.33","202.48","200.79","164.71","167.22","168.3","169.68","162.16","106.68","105.86","105.88","105.86","105.94","14.89","14.13","14.16","14.15","14.16","1869.77","1869.81","1870.79","1870.48","1872.31","8090.95","8087.63","8086.44","8085.66","8211.02","6461.77","6404.29","6355.14","6433.77","6409.08","3625.38","3626.45","3625.48","3625.47","3648.08","568.2","567.75","568.19","567.98","567.8","271.58","271.74","271.65","271.69","271.68","1541.78","1506.27","1504.16","1535.28","1532.85","1110.62","1122.3","1107.1","1108.95","1119.56","596.44","585.58","609.48","619.41","585.55","86.31","86.45","86.24","86.38","86.35","851.58","853.13","852.77","853.23","853.06","5432.88","5429.58","5428.74","5431.77","5429.22","4151.39","4093.74","4126.23","4055.41","4076.81","2041.63","2048.16","2039.7","2040.1","2038.94","256.92","257.05","258.21","257.1","257.15","277.41","276.69","276.93","276.73","277.39","1576.94","1572.25","1575","1571.22","1573","1158.42","1179.28","1154.25","1161.76","1163.06","1001.32","1001.8","1002.04","1003.87","1001.31","136.92","137.37","137.49","137.31","137.53","13.18","13.21","13.18","65.6","65.3","50.59","56.01","52.06","48.96","48.9","6.01","5.48","5.48","507.47","507.39","507.8","508.04","507.82","2501.73","2502.14","2503.26","2500.64","2503.06","1934.94","1948.85","1951.53","1924.87","1949.67","1052.09","1051.55","1052.43","1051.73","1051.82","164.98","165.85","165.84","165.94","165.8","411","411.5","411.53","411.36","411.42","2033.17","2032.81","2031","2031.72","2022.73","1568.94","1574.75","1568.8","1567.27","1563.29","847.93","847.63","847.69","847.66","843.91","133.59","133.59","133.58","133.72","133.51","500.15","501.09","500.94","501.36","501.14","3744.93","3583.26","3570.08","3576.62","3576.39","2560.05","2642.27","2630.07","2537.71","2580.16","1234.04","1236.56","1234","1234.49","1231.01","147.6","148.15","148.27","148.18","148.17","2071.44","2074.15","2074.46","9931.22","9943.3","7718.55","7769.86","7816.26","4190.94","4193.15","616.72","618.02","618.84","489.94","490.3","490.38","490.57","490.43","2610.59","2661.01","2645.28","2625.79","2663","1953.37","1989.4","1986.96","2000.48","2006.98","1045.56","1061.11","1047.21","1045.01","1054.01","157.02","156.91","156.96","156.93","157.15","26.83","86.98","8.18","489.34","489.96","491.04","490.79","490.4","2625.21","2640.41","2640.85","2639.35","2639.24","1981.16","1992.3","1980.4","1965.75","1992.99","1138.18","1048.76","1046.34","1046.12","1046.24","157.42","157.25","157.52","157.44","157.56","8.16","753.83","754.23","754.27","754.2","754.25","4062.83","3902.78","3895.43","3933.96","3883.17","2983.92","2996.12","2968.76","3032.53","3001.73","1557.06","1555.83","1562.08","1556.13","1555.88","228.12","227.93","227.78","227.89","227.95"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>llm<\/th>\n      <th>parameters<\/th>\n      <th>method<\/th>\n      <th>loop<\/th>\n      <th>F1 Aktiva<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"llm","targets":1},{"name":"parameters","targets":2},{"name":"method","targets":3},{"name":"loop","targets":4},{"name":"F1 Aktiva","targets":5},{"name":"runtime in s","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="vllm-batch-speed" class="section level3 hasAnchor" number="12.3.3">
<h3 class="hasAnchor"><span class="header-section-number">12.3.3</span> Large language model process speed<a href="#vllm-batch-speed" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In April 2025 there have been issues with running <a href="#acronyms_vllm">vLLM</a> within the Python framework. Thus, the first experiments are conducted, using the <em>transformers</em> library. When we managed to build a working <a href="#acronyms_vllm">vLLM</a> based docker image for the experiments, we measured, how long the same task takes with the <em>transformers</em> and the <a href="#acronyms_vllm">vLLM</a> library and how the batched processing competes versus a loop approach. The model family used is Qwen2.5-Instruct. The task is to extract the information from ten real <strong>Aktiva</strong> tables.</p>
<p>Table @ref(tab:llm-spped-mini-benchmark-table) shows that the experiments with <a href="#acronyms_vllm">vLLM</a> run around four to five times faster. Processing the messages in a batched mode is six to seven times faster than using a looped approach. Thus, the change of the experimental setup from a <em>transformers</em> powered loop-based approach to a <a href="#acronyms_vllm">vLLM</a> powered batched processing approach, increased the speed by 2500 %.</p>
<p>This allows us to run the page identification benchmark on whole an nual reports, giving a sound estimate of the false positive rate (see section @ref(llm-page-identification)). Previous experiments were only conducted on a subset of pages, that were selected based on the results of the <em>simple regex</em> approach (see section @ref(regex-page-identification)).</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a>data_llm_speed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>  <span class="co"># model = c(&quot;Qwen 2.5 Instruct&quot;),</span></span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">3</span>, <span class="dv">7</span>),</span>
<span id="cb101-4"><a href="#cb101-4" tabindex="-1"></a>  <span class="at">transformers =</span> <span class="fu">c</span>(<span class="dv">330</span>, <span class="dv">628</span>, <span class="dv">940</span>),</span>
<span id="cb101-5"><a href="#cb101-5" tabindex="-1"></a>  <span class="at">vllm =</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">130</span>, <span class="dv">217</span>),</span>
<span id="cb101-6"><a href="#cb101-6" tabindex="-1"></a>  <span class="at">vllm_batched =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb101-7"><a href="#cb101-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;Model parameters (in B)&quot;</span>, <span class="st">&quot;Transformers&quot;</span>, <span class="st">&quot;vLLM&quot;</span>, <span class="st">&quot;vLLM batched&quot;</span>))</span>
<span id="cb101-8"><a href="#cb101-8" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(data_llm_speed, <span class="at">caption =</span> <span class="st">&quot;Comparing time (in seconds) for extract the information from ten Aktiva tables using different libraries and approaches.&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>(#tab:llm-spped-mini-benchmark-table)Comparing time (in seconds) for extract the information from ten Aktiva tables using different libraries and approaches.</caption>
<thead>
<tr class="header">
<th align="right">Model parameters (in B)</th>
<th align="right">Transformers</th>
<th align="right">vLLM</th>
<th align="right">vLLM batched</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.5</td>
<td align="right">330</td>
<td align="right">65</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">3.0</td>
<td align="right">628</td>
<td align="right">130</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="right">7.0</td>
<td align="right">940</td>
<td align="right">217</td>
<td align="right">30</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="prompts" class="section level2 hasAnchor" number="12.4">
<h2 class="hasAnchor"><span class="header-section-number">12.4</span> Prompts<a href="#prompts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="toc-understanding-promts" class="section level3 hasAnchor" number="12.4.1">
<h3 class="hasAnchor"><span class="header-section-number">12.4.1</span> TOC understanding<a href="#toc-understanding-promts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Base prompt:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;You are a helpful assistant that can determine the page range information in a German financial report can be found at based on the documents table of contents.&quot;</span>},</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;This is the table of contents:</span><span class="ch">\n\n</span><span class="sc">{</span>toc_string<span class="sc">}</span><span class="ss">&quot;</span>},</span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;On which pages might the win and loss statement (in German: Gewinn- und Verlustrechnung; GuV) and the balance sheets (German: Bilanz) be located? Give seperate answers for:</span><span class="ch">\n\n</span><span class="ss">1) the assets (German: Aktiva) table.</span><span class="ch">\n</span><span class="ss">2) the liabilities (German: Passiva) table.</span><span class="ch">\n</span><span class="ss">3) the win and loss statement.&quot;</span>},</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a>        specific_prompt,</span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;Answer in JSON format with keys &#39;GuV&#39;, &#39;Aktiva&#39;, and &#39;Passiva&#39; and the page range as values.&quot;</span>},</span>
<span id="cb102-7"><a href="#cb102-7" tabindex="-1"></a>    ]</span></code></pre></div>
</details>
<p>First attempt:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>specific_prompt <span class="op">=</span> {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;The assets and liabilities tables often are on separate pages. They are often located directly before the win and loss statement. Rarely the tables for any of the three can span multiple pages.&quot;</span>}</span></code></pre></div>
</details>
<p>Given hint that assets and liabilities are part of the balance sheet:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>specific_prompt <span class="op">=</span> {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;The assets and liabilities are part of the balance sheet (in German: Bilanz). The assets and liabilities tables often are on separate pages. They are often located directly before the win and loss statement. Rarely the tables for any of the three can span multiple pages.&quot;</span>}</span></code></pre></div>
</details>
<p>Stating, that liabilities are on next page:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a>specific_prompt <span class="op">=</span> {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;The assets and liabilities are part of the balance sheet (in German: Bilanz). The liabilities table is often on the page after the assets table. They are often located directly before the win and loss statement. Rarely the tables for any of the three can span multiple pages.&quot;</span>}</span></code></pre></div>
</details>
<p><a href="#acronyms_TOC">TOC</a> extraction from text prompt:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;[Role] You are a helpful assistant that can identify table of contents in a German financial report.&quot;</span>},</span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;[Context] These are the text lines of the first </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> pages:</span><span class="ch">\n\n</span><span class="sc">{</span>start_pages<span class="sc">}</span><span class="ss">&quot;</span>},</span>
<span id="cb106-4"><a href="#cb106-4" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;[Tasks] 1. Please identify if there is a table of contents in the text.&quot;</span>},</span>
<span id="cb106-5"><a href="#cb106-5" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;2. If there is a table of contents, please extract its text.&quot;</span>},</span>
<span id="cb106-6"><a href="#cb106-6" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;3. Answer as JSON with the table of contents text as string in the key &#39;toc&#39;.&quot;</span>},</span>
<span id="cb106-7"><a href="#cb106-7" tabindex="-1"></a>        {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;If there is no table of contents, return an empty string.&quot;</span>},</span>
<span id="cb106-8"><a href="#cb106-8" tabindex="-1"></a>    ]</span></code></pre></div>
</details>
</div>
<div id="classification-prompts" class="section level3 hasAnchor" number="12.4.2">
<h3 class="hasAnchor"><span class="header-section-number">12.4.2</span> Classification<a href="#classification-prompts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>binary classification prompt factory</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>messages <span class="op">=</span> [{<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;[Role and Context]: You are a helpful assistant that can classify texts extracted from PDFs.&quot;</span>}]</span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a><span class="cf">if</span> law_context:</span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>    <span class="cf">if</span> classification_type <span class="op">==</span> <span class="st">&quot;GuV&quot;</span>:</span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;You know the laws about how to structure the &#39;Gewinn- und Verlustrechnung&#39; (profit and loss statement) table:&#39; </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>hgb_guv<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;.&quot;</span>})</span>
<span id="cb107-6"><a href="#cb107-6" tabindex="-1"></a>    <span class="cf">elif</span> classification_type <span class="op">==</span> <span class="st">&quot;Aktiva&quot;</span>:</span>
<span id="cb107-7"><a href="#cb107-7" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;You know the laws about how to structure the &#39;Aktiva&#39; (assets) table for a &#39;Bilanz&#39; (balance sheet):&#39; </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>hgb_aktiva<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;.&quot;</span>})</span>
<span id="cb107-8"><a href="#cb107-8" tabindex="-1"></a>    <span class="cf">elif</span> classification_type <span class="op">==</span> <span class="st">&quot;Passiva&quot;</span>:</span>
<span id="cb107-9"><a href="#cb107-9" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;You know the laws about how to structure the &#39;Passiva&#39; (liabilities) table for a &#39;Bilanz&#39; (balance sheet):&#39; </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>hgb_passiva<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;.&quot;</span>})</span>
<span id="cb107-10"><a href="#cb107-10" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb107-11"><a href="#cb107-11" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Unknown classification type: </span><span class="sc">{</span>classification_type<span class="sc">}</span><span class="ss">. Expected &#39;GuV&#39;, &#39;Aktiva&#39;, or &#39;Passiva&#39;.&quot;</span>)</span>
<span id="cb107-12"><a href="#cb107-12" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" tabindex="-1"></a><span class="cf">if</span> random_examples:</span>
<span id="cb107-14"><a href="#cb107-14" tabindex="-1"></a>    system_messages <span class="op">=</span> <span class="va">self</span>.__get_random_example_message(classification_type, <span class="op">**</span>kwargs)</span>
<span id="cb107-15"><a href="#cb107-15" tabindex="-1"></a>    <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb107-16"><a href="#cb107-16" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb107-17"><a href="#cb107-17" tabindex="-1"></a></span>
<span id="cb107-18"><a href="#cb107-18" tabindex="-1"></a><span class="cf">if</span> rag_examples:</span>
<span id="cb107-19"><a href="#cb107-19" tabindex="-1"></a>    system_messages <span class="op">=</span> <span class="va">self</span>.__get_rag_example_message(text, classification_type, <span class="op">**</span>kwargs)</span>
<span id="cb107-20"><a href="#cb107-20" tabindex="-1"></a>    <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb107-21"><a href="#cb107-21" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb107-22"><a href="#cb107-22" tabindex="-1"></a></span>
<span id="cb107-23"><a href="#cb107-23" tabindex="-1"></a><span class="cf">if</span> top_n_rag_examples:</span>
<span id="cb107-24"><a href="#cb107-24" tabindex="-1"></a>    system_messages <span class="op">=</span> <span class="va">self</span>.__get_top_n_rag_example_message(text, classification_type, <span class="op">**</span>kwargs)</span>
<span id="cb107-25"><a href="#cb107-25" tabindex="-1"></a>    <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb107-26"><a href="#cb107-26" tabindex="-1"></a>        messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb107-27"><a href="#cb107-27" tabindex="-1"></a></span>
<span id="cb107-28"><a href="#cb107-28" tabindex="-1"></a>messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;[Task]: Decide if the given text contains </span><span class="sc">{</span>phrase_dict[classification_type]<span class="sc">}</span><span class="ss">.</span><span class="ch">\n\n</span><span class="ss">[Rule]: Answer with &#39;yes&#39; if it does. Otherwise answer with &#39;no&#39;.</span><span class="ch">\n\n</span><span class="ss">[Text]: Here is the text to classify: </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>text<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;&quot;</span>})</span>
<span id="cb107-29"><a href="#cb107-29" tabindex="-1"></a><span class="cf">return</span> messages</span></code></pre></div>
</details>
<p>example for binary classification with 1 random example with Qwen 3</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb108-2"><a href="#cb108-2" tabindex="-1"></a>/no_think [Role and Context]: You are a helpful assistant that can classify texts extracted from PDFs.&lt;|im_end|&gt;</span>
<span id="cb108-3"><a href="#cb108-3" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb108-4"><a href="#cb108-4" tabindex="-1"></a>You know this example for a \&#39;Gewinn- und Verlustrechnung\&#39; (profit and loss statement) table and for this example you should answer with &quot;no&quot;:</span>
<span id="cb108-5"><a href="#cb108-5" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb108-7"><a href="#cb108-7" tabindex="-1"></a>28</span>
<span id="cb108-8"><a href="#cb108-8" tabindex="-1"></a>2023</span>
<span id="cb108-9"><a href="#cb108-9" tabindex="-1"></a>EUR</span>
<span id="cb108-10"><a href="#cb108-10" tabindex="-1"></a>2022</span>
<span id="cb108-11"><a href="#cb108-11" tabindex="-1"></a>EUR</span>
<span id="cb108-12"><a href="#cb108-12" tabindex="-1"></a>EUR EUR</span>
<span id="cb108-13"><a href="#cb108-13" tabindex="-1"></a>1. Umsatzerlöse 1.315.073,26 1.507.621,05</span>
<span id="cb108-14"><a href="#cb108-14" tabindex="-1"></a>2. Sonstige betriebliche Erträge 562.644,72 631.803,96</span>
<span id="cb108-15"><a href="#cb108-15" tabindex="-1"></a>3. Materialaufwand -388.989,26 -98.471,89</span>
<span id="cb108-16"><a href="#cb108-16" tabindex="-1"></a>4. Abschreibungen -447.356,00 -460.923,00</span>
<span id="cb108-17"><a href="#cb108-17" tabindex="-1"></a>5. Sonstige betriebliche Aufwendungen -907.414,53 -2.304.390,53</span>
<span id="cb108-18"><a href="#cb108-18" tabindex="-1"></a>6. Sonstige Zinsen und ähnliche Erträge 95.260,94 -2.533,45</span>
<span id="cb108-19"><a href="#cb108-19" tabindex="-1"></a>7. Ergebnis nach Steuern 229.219,13 -726.893,86</span>
<span id="cb108-20"><a href="#cb108-20" tabindex="-1"></a>8. Sonstige Steuern -857.535,62 -879.289,10</span>
<span id="cb108-21"><a href="#cb108-21" tabindex="-1"></a>9. Jahresfehlbetrag -628.316,49 -1.606.182,96</span>
<span id="cb108-22"><a href="#cb108-22" tabindex="-1"></a>Gewinn- und Verlustrechnung</span>
<span id="cb108-23"><a href="#cb108-23" tabindex="-1"></a>für die Zeit vom 01. Januar bis 31. Dezember 2023</span>
<span id="cb108-24"><a href="#cb108-24" tabindex="-1"></a>\&#39;\&#39;\&#39;.&lt;|im_end|&gt;</span>
<span id="cb108-25"><a href="#cb108-25" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb108-26"><a href="#cb108-26" tabindex="-1"></a>You know this example for a \&#39;Aktiva\&#39; (assets) table and for this example you should answer with &quot;yes&quot;:</span>
<span id="cb108-27"><a href="#cb108-27" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb108-29"><a href="#cb108-29" tabindex="-1"></a>BEN Berlin Energie und Netzholding GmbH (vormals: Berlin Energie Rekom 2 GmbH)</span>
<span id="cb108-30"><a href="#cb108-30" tabindex="-1"></a>Berlin</span>
<span id="cb108-31"><a href="#cb108-31" tabindex="-1"></a>Bilanz zum 31.12.2021</span>
<span id="cb108-32"><a href="#cb108-32" tabindex="-1"></a>Aktivseite 31.12.2021 31.12.2020 31.12.2021 31.12.2020</span>
<span id="cb108-33"><a href="#cb108-33" tabindex="-1"></a>T€ T€ T€ T€</span>
<span id="cb108-34"><a href="#cb108-34" tabindex="-1"></a>A. Anlagevermögen A. Eigenkapital</span>
<span id="cb108-35"><a href="#cb108-35" tabindex="-1"></a>imv I. Immaterielle Vermögensgegenstände 0,8 - ek I. Gezeichnetes Kapital 25,0 25,0</span>
<span id="cb108-36"><a href="#cb108-36" tabindex="-1"></a>bga II. Sachanlagen 73,1 - kr II. Kapitalrücklage 6,9 6,9</span>
<span id="cb108-37"><a href="#cb108-37" tabindex="-1"></a>III. Finanzanlagen 2.094.146,0 - vv III. Verlustvortrag - 6,9 - 6,9</span>
<span id="cb108-38"><a href="#cb108-38" tabindex="-1"></a>IV. Jahresüberschuss 1.326,7 -</span>
<span id="cb108-39"><a href="#cb108-39" tabindex="-1"></a> 2.094.219,9 -</span>
<span id="cb108-40"><a href="#cb108-40" tabindex="-1"></a> 1.351,7 25,0</span>
<span id="cb108-41"><a href="#cb108-41" tabindex="-1"></a>B. Umlaufvermögen sor</span>
<span id="cb108-42"><a href="#cb108-42" tabindex="-1"></a>unf I. Forderungen und sonstige B. Rückstellungen</span>
<span id="cb108-43"><a href="#cb108-43" tabindex="-1"></a> Vermögensgegenstände Sonstige Rückstellungen 265,1 6,7</span>
<span id="cb108-44"><a href="#cb108-44" tabindex="-1"></a>Forderungen gegen verbundene</span>
<span id="cb108-45"><a href="#cb108-45" tabindex="-1"></a>Unternehmen 423,1 - anzC. Verbindlichkeiten</span>
<span id="cb108-46"><a href="#cb108-46" tabindex="-1"></a>1. Verbindlichkeiten gegenüber</span>
<span id="cb108-47"><a href="#cb108-47" tabindex="-1"></a>fll II. Guthaben bei Kreditinstituten 166.662,0 39,2 vll Kreditinstituten 2.180.051,3 -</span>
<span id="cb108-48"><a href="#cb108-48" tabindex="-1"></a>2. Verbindlichkeiten aus</span>
<span id="cb108-49"><a href="#cb108-49" tabindex="-1"></a> 167.085,1 39,2 Lieferungen und Leistungen 91,9 1,9</span>
<span id="cb108-50"><a href="#cb108-50" tabindex="-1"></a>3. Verbindlichkeiten gegenüber</span>
<span id="cb108-51"><a href="#cb108-51" tabindex="-1"></a> verbundenen Unternehmen 81.286,7 -</span>
<span id="cb108-52"><a href="#cb108-52" tabindex="-1"></a>C. Rechnungsabgrenzungsposten 2.471,2 - vvu 4. Verbindlichkeiten gegenüber</span>
<span id="cb108-53"><a href="#cb108-53" tabindex="-1"></a> Gesellschaftern 713,9 5,6</span>
<span id="cb108-54"><a href="#cb108-54" tabindex="-1"></a>5. Sonstige Verbindlichkeiten 15,6 -</span>
<span id="cb108-55"><a href="#cb108-55" tabindex="-1"></a> 2.262.159,4 7,5</span>
<span id="cb108-56"><a href="#cb108-56" tabindex="-1"></a> 2.263.776,2 39,2 2.263.776,2 39,2</span>
<span id="cb108-57"><a href="#cb108-57" tabindex="-1"></a>Passivseite</span>
<span id="cb108-58"><a href="#cb108-58" tabindex="-1"></a> 21-006917</span>
<span id="cb108-59"><a href="#cb108-59" tabindex="-1"></a>\&#39;\&#39;\&#39;.&lt;|im_end|&gt;</span>
<span id="cb108-60"><a href="#cb108-60" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb108-61"><a href="#cb108-61" tabindex="-1"></a>You know this example for a \&#39;Passiva\&#39; (liabilities) table and for this example you should answer with &quot;no&quot;:</span>
<span id="cb108-62"><a href="#cb108-62" tabindex="-1"></a></span>
<span id="cb108-63"><a href="#cb108-63" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb108-64"><a href="#cb108-64" tabindex="-1"></a>4 </span>
<span id="cb108-65"><a href="#cb108-65" tabindex="-1"></a> Bilanz Elektrizitätsverteilung </span>
<span id="cb108-66"><a href="#cb108-66" tabindex="-1"></a>Aktiva 31.12.2022</span>
<span id="cb108-67"><a href="#cb108-67" tabindex="-1"></a>T€</span>
<span id="cb108-68"><a href="#cb108-68" tabindex="-1"></a>Anlagevermögen</span>
<span id="cb108-69"><a href="#cb108-69" tabindex="-1"></a>imv Immaterielle Vermögensgegenstände -</span>
<span id="cb108-70"><a href="#cb108-70" tabindex="-1"></a>bga Sachanlagen -</span>
<span id="cb108-71"><a href="#cb108-71" tabindex="-1"></a>Finanzanlagen -</span>
<span id="cb108-72"><a href="#cb108-72" tabindex="-1"></a> -</span>
<span id="cb108-73"><a href="#cb108-73" tabindex="-1"></a>Umlaufvermögen</span>
<span id="cb108-74"><a href="#cb108-74" tabindex="-1"></a>unf Forderungen und sonstige Vermögensgegenstände 329,6</span>
<span id="cb108-75"><a href="#cb108-75" tabindex="-1"></a>davon Verrechnungsposten gegenüber anderen Aktivitäten 289,9</span>
<span id="cb108-76"><a href="#cb108-76" tabindex="-1"></a>fll Guthaben bei Kreditinstituten -</span>
<span id="cb108-77"><a href="#cb108-77" tabindex="-1"></a> 329,6</span>
<span id="cb108-78"><a href="#cb108-78" tabindex="-1"></a>Rechnungsabgrenzungsposten 17,9</span>
<span id="cb108-79"><a href="#cb108-79" tabindex="-1"></a> 347,6</span>
<span id="cb108-80"><a href="#cb108-80" tabindex="-1"></a>Passiva 31.12.2022</span>
<span id="cb108-81"><a href="#cb108-81" tabindex="-1"></a>T€</span>
<span id="cb108-82"><a href="#cb108-82" tabindex="-1"></a>Eigenkapital</span>
<span id="cb108-83"><a href="#cb108-83" tabindex="-1"></a>ek Gezeichnetes Kapital -</span>
<span id="cb108-84"><a href="#cb108-84" tabindex="-1"></a>kr Kapitalrücklage -</span>
<span id="cb108-85"><a href="#cb108-85" tabindex="-1"></a>vv Gewinnrücklage/Verlustvortrag -</span>
<span id="cb108-86"><a href="#cb108-86" tabindex="-1"></a>Jahresüberschuss 0,1</span>
<span id="cb108-87"><a href="#cb108-87" tabindex="-1"></a> 0,1</span>
<span id="cb108-88"><a href="#cb108-88" tabindex="-1"></a>Rückstellungen</span>
<span id="cb108-89"><a href="#cb108-89" tabindex="-1"></a>Sonstige Rückstellungen 258,4</span>
<span id="cb108-90"><a href="#cb108-90" tabindex="-1"></a>Verbindlichkeiten</span>
<span id="cb108-91"><a href="#cb108-91" tabindex="-1"></a>anz Verbindlichkeiten gegenüber Kreditinstituten -</span>
<span id="cb108-92"><a href="#cb108-92" tabindex="-1"></a>vll Verbindlichkeiten aus Lieferungen und Leistungen 89,0</span>
<span id="cb108-93"><a href="#cb108-93" tabindex="-1"></a>Verbindlichkeiten gegenüber Gesellschaftern -</span>
<span id="cb108-94"><a href="#cb108-94" tabindex="-1"></a>Sonstige Verbindlichkeiten -</span>
<span id="cb108-95"><a href="#cb108-95" tabindex="-1"></a> 89,0</span>
<span id="cb108-96"><a href="#cb108-96" tabindex="-1"></a> 347,6</span>
<span id="cb108-97"><a href="#cb108-97" tabindex="-1"></a>\&#39;\&#39;\&#39;.&lt;|im_end|&gt;</span>
<span id="cb108-98"><a href="#cb108-98" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb108-99"><a href="#cb108-99" tabindex="-1"></a>You know this example for a text that does not suit the categories of interest and for this example you should answer with &quot;no&quot;:</span>
<span id="cb108-100"><a href="#cb108-100" tabindex="-1"></a></span>
<span id="cb108-101"><a href="#cb108-101" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb108-102"><a href="#cb108-102" tabindex="-1"></a>Bericht des </span>
<span id="cb108-103"><a href="#cb108-103" tabindex="-1"></a>Aufsichtsrates</span>
<span id="cb108-104"><a href="#cb108-104" tabindex="-1"></a>Sehr geehrte Damen, </span>
<span id="cb108-105"><a href="#cb108-105" tabindex="-1"></a>sehr geehrte Herren,</span>
<span id="cb108-106"><a href="#cb108-106" tabindex="-1"></a>mit diesem Bericht informieren wir über unsere Tätigkeit im Geschäftsjahr 2016 </span>
<span id="cb108-107"><a href="#cb108-107" tabindex="-1"></a>und das Ergebnis der Prüfung des Jahresabschlusses. Die uns nach Gesetz, Satzung </span>
<span id="cb108-108"><a href="#cb108-108" tabindex="-1"></a>und Geschäftsordnung obliegenden Kontroll- und Beratungsaufgaben haben </span>
<span id="cb108-109"><a href="#cb108-109" tabindex="-1"></a>wir verantwortungsvoll und mit der gebührenden Sorgfalt wahrgenommen. Dabei </span>
<span id="cb108-110"><a href="#cb108-110" tabindex="-1"></a>haben wir den Vorstand bei der Leitung der GESOBAU beratend begleitet, seine </span>
<span id="cb108-111"><a href="#cb108-111" tabindex="-1"></a>Tätigkeit überwacht und waren in alle für die Gesellschaft grundlegend bedeutenden </span>
<span id="cb108-112"><a href="#cb108-112" tabindex="-1"></a>Entscheidungen unmittelbar eingebunden. Der Vorstand ist seinen Informations\x02pflichten uneingeschränkt nachgekommen und hat uns regelmäßig sowohl schrift\x02lich als auch mündlich informiert. Dies geschah zeitnah und umfassend zu allen </span>
<span id="cb108-113"><a href="#cb108-113" tabindex="-1"></a>Aspekten der Unternehmensplanung, dem Verlauf der Geschäfte, der strategischen </span>
<span id="cb108-114"><a href="#cb108-114" tabindex="-1"></a>Weiterentwicklung sowie der aktuellen Lage des Unternehmens. Planabweichungen </span>
<span id="cb108-115"><a href="#cb108-115" tabindex="-1"></a>beim Geschäftsverlauf wurden uns im Einzelnen erläutert und mit schlüssigen </span>
<span id="cb108-116"><a href="#cb108-116" tabindex="-1"></a>Argumenten begründet. Der Vorstand stimmte die strategische Ausrichtung des </span>
<span id="cb108-117"><a href="#cb108-117" tabindex="-1"></a>Unternehmens vertrauensvoll mit uns ab. Die für das Unternehmen bedeutenden </span>
<span id="cb108-118"><a href="#cb108-118" tabindex="-1"></a>Geschäftsvorgänge haben wir auf der Basis der Berichte des Vorstandes ausführlich </span>
<span id="cb108-119"><a href="#cb108-119" tabindex="-1"></a>erörtert und seinen Beschlussvorschlägen nach gründlicher Prüfung und Beratung </span>
<span id="cb108-120"><a href="#cb108-120" tabindex="-1"></a>zugestimmt.</span>
<span id="cb108-121"><a href="#cb108-121" tabindex="-1"></a>Sitzungen</span>
<span id="cb108-122"><a href="#cb108-122" tabindex="-1"></a>Im Berichtsjahr fanden vier turnusgemäße und eine außerordentliche Sitzung statt. </span>
<span id="cb108-123"><a href="#cb108-123" tabindex="-1"></a>Die Sitzungen des Aufsichtsrates sind von einem intensiven und offenen Austausch </span>
<span id="cb108-124"><a href="#cb108-124" tabindex="-1"></a>geprägt. Ein Mitglied des Aufsichtsrates hat im abgelaufenen Geschäftsjahr an </span>
<span id="cb108-125"><a href="#cb108-125" tabindex="-1"></a>weniger als der Hälfte der Sitzungen teilgenommen. Aufgrund besonderer Eilbe\x02dürftigkeit erfolgten in Abstimmung mit der Vorsitzenden des Aufsichtsrates vier </span>
<span id="cb108-126"><a href="#cb108-126" tabindex="-1"></a>Beschlussfassungen im Umlaufverfahren.</span>
<span id="cb108-127"><a href="#cb108-127" tabindex="-1"></a>Die Mitglieder des Aufsichtsrates bereiten sich auf anstehende Beschlüsse regelmäßig </span>
<span id="cb108-128"><a href="#cb108-128" tabindex="-1"></a>auch anhand von Unterlagen vor, die der Vorstand vorab zur Verfügung stellt. Dabei </span>
<span id="cb108-129"><a href="#cb108-129" tabindex="-1"></a>wurden sie von den jeweils zuständigen Ausschüssen unterstützt. Die Aufsichtsrats\x02sitzungen werden zudem von den Arbeitnehmervertretern in Gesprächen mit dem </span>
<span id="cb108-130"><a href="#cb108-130" tabindex="-1"></a>Vorstand vorbereitet.</span>
<span id="cb108-131"><a href="#cb108-131" tabindex="-1"></a>Information durch den Vorstand</span>
<span id="cb108-132"><a href="#cb108-132" tabindex="-1"></a>Über die wichtigsten Indikatoren der Geschäftsentwicklung und bestehende Risiken </span>
<span id="cb108-133"><a href="#cb108-133" tabindex="-1"></a>unterrichtet der Vorstand den Aufsichtsrat anhand schriftlicher Quartalsberichte. </span>
<span id="cb108-134"><a href="#cb108-134" tabindex="-1"></a>Zwischen den Sitzungsterminen des Aufsichtsrates und seiner Ausschüsse wurde </span>
<span id="cb108-135"><a href="#cb108-135" tabindex="-1"></a>die Aufsichtsratsvorsitzende ausführlich unterrichtet. Hierbei wurde die Strategie </span>
<span id="cb108-136"><a href="#cb108-136" tabindex="-1"></a>des Unternehmens besprochen, wie auch die aktuelle Geschäftsentwicklung und </span>
<span id="cb108-137"><a href="#cb108-137" tabindex="-1"></a>-lage, das Risikomanagement, Fragen der Compliance sowie wesentliche Einzel\x02themen und bevorstehende bedeutsame Entscheidungen erörtert.</span>
<span id="cb108-138"><a href="#cb108-138" tabindex="-1"></a>16 Perspektiven Bericht des Aufsichtsrates</span>
<span id="cb108-139"><a href="#cb108-139" tabindex="-1"></a>\&#39;\&#39;\&#39;.&lt;|im_end|&gt;</span>
<span id="cb108-140"><a href="#cb108-140" tabindex="-1"></a>&lt;|im_start|&gt;user</span>
<span id="cb108-141"><a href="#cb108-141" tabindex="-1"></a>[Task]: Decide if the given text contains a \&#39;Aktiva\&#39; (assets) table.</span>
<span id="cb108-142"><a href="#cb108-142" tabindex="-1"></a></span>
<span id="cb108-143"><a href="#cb108-143" tabindex="-1"></a>[Rule]: Answer with \&#39;yes\&#39; if it does. Otherwise answer with \&#39;no\&#39;.</span>
<span id="cb108-144"><a href="#cb108-144" tabindex="-1"></a></span>
<span id="cb108-145"><a href="#cb108-145" tabindex="-1"></a>[Text]: Here is the text to classify: </span>
<span id="cb108-146"><a href="#cb108-146" tabindex="-1"></a></span>
<span id="cb108-147"><a href="#cb108-147" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb108-148"><a href="#cb108-148" tabindex="-1"></a>22 Amt für Statistik Berlin-Brandenburg | Geschäftsbericht 2014</span>
<span id="cb108-149"><a href="#cb108-149" tabindex="-1"></a>Amt für Statistik Berlin-Brandenburg Anstalt des öffentlichen Rechts, Potsdam</span>
<span id="cb108-150"><a href="#cb108-150" tabindex="-1"></a>Bilanz zum 31. Dezember 2014</span>
<span id="cb108-151"><a href="#cb108-151" tabindex="-1"></a>A K T I V S E I T E 31.12.2014 Vorjahr </span>
<span id="cb108-152"><a href="#cb108-152" tabindex="-1"></a>EUR EUR TEUR </span>
<span id="cb108-153"><a href="#cb108-153" tabindex="-1"></a>A. ANLAGEVERMÖGEN </span>
<span id="cb108-154"><a href="#cb108-154" tabindex="-1"></a>I. Immaterielle Vermögensgegenstände </span>
<span id="cb108-155"><a href="#cb108-155" tabindex="-1"></a>1. Entgeltlich erworbene Konzessionen, gewerbliche </span>
<span id="cb108-156"><a href="#cb108-156" tabindex="-1"></a>Schutzrechte und ähnliche Rechte und Werte </span>
<span id="cb108-157"><a href="#cb108-157" tabindex="-1"></a>sowie Lizenzen an solchen Rechten und Werten 81.480,00 146</span>
<span id="cb108-158"><a href="#cb108-158" tabindex="-1"></a>II. Sachanlagen</span>
<span id="cb108-159"><a href="#cb108-159" tabindex="-1"></a>1. Grundstücke, grundstücksgleiche Rechte und Bauten </span>
<span id="cb108-160"><a href="#cb108-160" tabindex="-1"></a>einschließlich der Bauten auf fremden Grundstücken 68.386,00 93</span>
<span id="cb108-161"><a href="#cb108-161" tabindex="-1"></a>2. Andere Anlagen, Betriebs- und Geschäftsausstattung 140.186,00 174 </span>
<span id="cb108-162"><a href="#cb108-162" tabindex="-1"></a>208.572,00 267</span>
<span id="cb108-163"><a href="#cb108-163" tabindex="-1"></a>III. Finanzanlagen </span>
<span id="cb108-164"><a href="#cb108-164" tabindex="-1"></a>1. Wertpapiere des Anlagevermögens 2.000.000,00 2.000 </span>
<span id="cb108-165"><a href="#cb108-165" tabindex="-1"></a>2.000.000,00 2.000 </span>
<span id="cb108-166"><a href="#cb108-166" tabindex="-1"></a>2.290.052,00 2.413</span>
<span id="cb108-167"><a href="#cb108-167" tabindex="-1"></a>B. UMLAUFVERMÖGEN </span>
<span id="cb108-168"><a href="#cb108-168" tabindex="-1"></a>I. Forderungen und sonstige Vermögensgegenstände </span>
<span id="cb108-169"><a href="#cb108-169" tabindex="-1"></a>1. Forderungen aus Lieferungen und Leistungen 36.617,86 14 </span>
<span id="cb108-170"><a href="#cb108-170" tabindex="-1"></a>2. Sonstige Vermögensgegenstände 297.982,42 267 </span>
<span id="cb108-171"><a href="#cb108-171" tabindex="-1"></a>334.600,28 281 </span>
<span id="cb108-172"><a href="#cb108-172" tabindex="-1"></a>II. Kassenbestand, Bundesbankguthaben, Guthaben bei </span>
<span id="cb108-173"><a href="#cb108-173" tabindex="-1"></a>Kreditinstituten und Schecks 5.560.638,85 7.783</span>
<span id="cb108-174"><a href="#cb108-174" tabindex="-1"></a>5.895.239,13 8.064</span>
<span id="cb108-175"><a href="#cb108-175" tabindex="-1"></a>C. RECHNUNGSABGRENZUNGSPOSTEN 216.321,49 213</span>
<span id="cb108-176"><a href="#cb108-176" tabindex="-1"></a>8.401.612,62 10.690 </span>
<span id="cb108-177"><a href="#cb108-177" tabindex="-1"></a>Bestätigungsvermerk </span>
<span id="cb108-178"><a href="#cb108-178" tabindex="-1"></a>des Abschlussprüfers</span>
<span id="cb108-179"><a href="#cb108-179" tabindex="-1"></a>Anhang</span>
<span id="cb108-180"><a href="#cb108-180" tabindex="-1"></a>\&#39;\&#39;\&#39;&lt;|im_end|&gt;</span>
<span id="cb108-181"><a href="#cb108-181" tabindex="-1"></a>&lt;|im_start|&gt;assistant</span></code></pre></div>
<p>multi-class classification prompt factory</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>  {<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="st">&quot;[Role and Context]: You are a helpful assistant that can classify texts extracted from PDFs.&quot;</span>},</span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a>]</span>
<span id="cb109-4"><a href="#cb109-4" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" tabindex="-1"></a><span class="cf">if</span> law_context:</span>
<span id="cb109-6"><a href="#cb109-6" tabindex="-1"></a>  messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;You know the laws about how to structure the &#39;Gewinn- und Verlustrechnung&#39; (profit and loss statement) table:&#39; </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>hgb_guv<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;.&quot;</span>})</span>
<span id="cb109-7"><a href="#cb109-7" tabindex="-1"></a>  messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;You also know the laws about how to structure the &#39;Aktiva&#39; (assets) and &#39;Passiva&#39; (liabilities) table for a &#39;Bilanz&#39; (balance sheet):&#39; </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>hgb_bilanz<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;.&quot;</span>})</span>
<span id="cb109-8"><a href="#cb109-8" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" tabindex="-1"></a><span class="cf">if</span> random_examples:</span>
<span id="cb109-10"><a href="#cb109-10" tabindex="-1"></a>  system_messages <span class="op">=</span> <span class="va">self</span>.__get_random_example_message(<span class="op">**</span>kwargs)</span>
<span id="cb109-11"><a href="#cb109-11" tabindex="-1"></a>  <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb109-12"><a href="#cb109-12" tabindex="-1"></a>      messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb109-13"><a href="#cb109-13" tabindex="-1"></a></span>
<span id="cb109-14"><a href="#cb109-14" tabindex="-1"></a><span class="cf">if</span> rag_examples:</span>
<span id="cb109-15"><a href="#cb109-15" tabindex="-1"></a>  system_messages <span class="op">=</span> <span class="va">self</span>.__get_rag_example_message(text, <span class="op">**</span>kwargs)</span>
<span id="cb109-16"><a href="#cb109-16" tabindex="-1"></a>  <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb109-17"><a href="#cb109-17" tabindex="-1"></a>      messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb109-18"><a href="#cb109-18" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" tabindex="-1"></a><span class="cf">if</span> top_n_rag_examples:</span>
<span id="cb109-20"><a href="#cb109-20" tabindex="-1"></a>  system_messages <span class="op">=</span> <span class="va">self</span>.__get_top_n_rag_example_message(text, <span class="op">**</span>kwargs)</span>
<span id="cb109-21"><a href="#cb109-21" tabindex="-1"></a>  <span class="cf">for</span> msg <span class="kw">in</span> system_messages:</span>
<span id="cb109-22"><a href="#cb109-22" tabindex="-1"></a>      messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;system&quot;</span>, <span class="st">&quot;content&quot;</span>: msg})</span>
<span id="cb109-23"><a href="#cb109-23" tabindex="-1"></a></span>
<span id="cb109-24"><a href="#cb109-24" tabindex="-1"></a>messages.append({<span class="st">&quot;role&quot;</span>: <span class="st">&quot;user&quot;</span>, <span class="st">&quot;content&quot;</span>: <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb109-25"><a href="#cb109-25" tabindex="-1"></a><span class="ss">[Task]: Decide of what type the given text is. You can differentiate between four types of pages: &#39;Aktiva&#39;, &#39;GuV&#39;, &#39;Passiva&#39; and &#39;other&#39;.</span><span class="ch">\n\n</span></span>
<span id="cb109-26"><a href="#cb109-26" tabindex="-1"></a><span class="ss">[Rules]:</span><span class="ch">\n</span></span>
<span id="cb109-27"><a href="#cb109-27" tabindex="-1"></a><span class="ss">  1) If the text contains a &#39;Gewinn- und Verlustrechnung&#39; (profit and loss statement) table, answer with &#39;GuV&#39;.</span><span class="ch">\n\n</span></span>
<span id="cb109-28"><a href="#cb109-28" tabindex="-1"></a><span class="ss">  2) If the text contains an &#39;Aktiva&#39; (assets) table, answer with &#39;Aktiva&#39;.</span><span class="ch">\n\n</span></span>
<span id="cb109-29"><a href="#cb109-29" tabindex="-1"></a><span class="ss">  3) If the text contains a &#39;Passiva&#39; (liabilities) table, answer with &#39;Passiva&#39;.</span><span class="ch">\n\n</span></span>
<span id="cb109-30"><a href="#cb109-30" tabindex="-1"></a><span class="ss">  4) If the text contains something else, answer with &#39;other&#39;.</span><span class="ch">\n\n</span></span>
<span id="cb109-31"><a href="#cb109-31" tabindex="-1"></a><span class="ss">[Text]: Here is the text to classify: </span><span class="ch">\n\n</span><span class="ss">&#39;&#39;&#39;</span><span class="ch">\n</span><span class="sc">{</span>text<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;&#39;&#39;</span></span>
<span id="cb109-32"><a href="#cb109-32" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span>})</span></code></pre></div>
</details>
<p>example for multi-class classification with 1 rag example with Qwen 3</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a>/no_think [Role and Context]: You are a helpful assistant that can classify texts extracted from PDFs.&lt;|im_end|&gt;</span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a>You know this example for a \&#39;Gewinn- und Verlustrechnung\&#39; (profit and loss statement) table and for this example you should answer with &quot;GuV&quot;:</span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" tabindex="-1"></a>&quot;&quot;&quot;</span>
<span id="cb110-7"><a href="#cb110-7" tabindex="-1"></a>74</span>
<span id="cb110-8"><a href="#cb110-8" tabindex="-1"></a>Gewinn- und Verlustrechnung für die Zeit vom 01.01.2014 bis 31.12.2014</span>
<span id="cb110-9"><a href="#cb110-9" tabindex="-1"></a>Aufwendungen in TEUR Vorjahr</span>
<span id="cb110-10"><a href="#cb110-10" tabindex="-1"></a>1. Zinsaufwendungen 302.081 314.077</span>
<span id="cb110-11"><a href="#cb110-11" tabindex="-1"></a>2. Provisionsaufwendungen 714 656</span>
<span id="cb110-12"><a href="#cb110-12" tabindex="-1"></a>4. Allgemeine Verwaltungsaufwendungen</span>
<span id="cb110-13"><a href="#cb110-13" tabindex="-1"></a>a) Personalaufwand</span>
<span id="cb110-14"><a href="#cb110-14" tabindex="-1"></a> aa) Löhne und Gehälter</span>
<span id="cb110-15"><a href="#cb110-15" tabindex="-1"></a> ab) Soziale Abgaben und Aufwendungen</span>
<span id="cb110-16"><a href="#cb110-16" tabindex="-1"></a> für Altersversorgung und für Unterstützung</span>
<span id="cb110-17"><a href="#cb110-17" tabindex="-1"></a> darunter: für Altersversorgung</span>
<span id="cb110-18"><a href="#cb110-18" tabindex="-1"></a>b) andere Verwaltungsaufwendungen</span>
<span id="cb110-19"><a href="#cb110-19" tabindex="-1"></a> </span>
<span id="cb110-20"><a href="#cb110-20" tabindex="-1"></a>39.535</span>
<span id="cb110-21"><a href="#cb110-21" tabindex="-1"></a>9.009</span>
<span id="cb110-22"><a href="#cb110-22" tabindex="-1"></a>2.417</span>
<span id="cb110-23"><a href="#cb110-23" tabindex="-1"></a>48.544</span>
<span id="cb110-24"><a href="#cb110-24" tabindex="-1"></a>31.161</span>
<span id="cb110-25"><a href="#cb110-25" tabindex="-1"></a>79.705</span>
<span id="cb110-26"><a href="#cb110-26" tabindex="-1"></a>39.310</span>
<span id="cb110-27"><a href="#cb110-27" tabindex="-1"></a>11.020</span>
<span id="cb110-28"><a href="#cb110-28" tabindex="-1"></a>4.651</span>
<span id="cb110-29"><a href="#cb110-29" tabindex="-1"></a>50.330</span>
<span id="cb110-30"><a href="#cb110-30" tabindex="-1"></a>24.983</span>
<span id="cb110-31"><a href="#cb110-31" tabindex="-1"></a>75.313</span>
<span id="cb110-32"><a href="#cb110-32" tabindex="-1"></a>5. Abschreibungen und Wertberichtigungen auf immaterielle</span>
<span id="cb110-33"><a href="#cb110-33" tabindex="-1"></a>Anlagewerte und Sachanlagen 3.647 3.707</span>
<span id="cb110-34"><a href="#cb110-34" tabindex="-1"></a>6. Sonstige betriebliche Aufwendungen 25.803 26.412</span>
<span id="cb110-35"><a href="#cb110-35" tabindex="-1"></a>7. Abschreibungen und Wertberichtigungen auf Forderungen und </span>
<span id="cb110-36"><a href="#cb110-36" tabindex="-1"></a>bestimmte Wertpapiere sowie Zuführungen zu </span>
<span id="cb110-37"><a href="#cb110-37" tabindex="-1"></a>Rückstellungen im Kreditgeschäft 25.366 14.666</span>
<span id="cb110-38"><a href="#cb110-38" tabindex="-1"></a>8. Abschreibungen und Wertberichtigungen auf Beteiligungen,</span>
<span id="cb110-39"><a href="#cb110-39" tabindex="-1"></a>Anteile an verbundenen Unternehmen</span>
<span id="cb110-40"><a href="#cb110-40" tabindex="-1"></a>und wie Anlagevermögen behandelte Wertpapiere 421 0</span>
<span id="cb110-41"><a href="#cb110-41" tabindex="-1"></a>9. Aufwendungen aus Verlustübernahme 1.268 0</span>
<span id="cb110-42"><a href="#cb110-42" tabindex="-1"></a>13. Sonstige Steuern, soweit nicht unter Posten 6 ausgewiesen 65 80</span>
<span id="cb110-43"><a href="#cb110-43" tabindex="-1"></a>15. Jahresüberschuss 25.863 36.897</span>
<span id="cb110-44"><a href="#cb110-44" tabindex="-1"></a>Summe der Aufwendungen 464.933 471.808</span>
<span id="cb110-45"><a href="#cb110-45" tabindex="-1"></a>Jahresüberschuss 25.863 36.897</span>
<span id="cb110-46"><a href="#cb110-46" tabindex="-1"></a>Gewinnvortrag aus dem Vorjahr 0 0</span>
<span id="cb110-47"><a href="#cb110-47" tabindex="-1"></a>Bilanzgewinn 25.863 36.897</span>
<span id="cb110-48"><a href="#cb110-48" tabindex="-1"></a>An unsere Geschäftspartner | Grußwort der Vorsitzenden des Verwaltungsrats | Bericht des Verwaltungsrats</span>
<span id="cb110-49"><a href="#cb110-49" tabindex="-1"></a>Wohnungsbauförderung | Wirtschaftsförderung | Beteiligungen | Immobilien- und Stadtentwicklung | Personalbericht | Nachhaltigkeit </span>
<span id="cb110-50"><a href="#cb110-50" tabindex="-1"></a>Lagebericht | Jahresabschluss | Anhang | Bestätigungsvermerk | Corporate-Governance-Bericht | Organigramm</span>
<span id="cb110-51"><a href="#cb110-51" tabindex="-1"></a>&quot;&quot;&quot;. (The L2 distance of this example text is: 0.562)&lt;|im_end|&gt;</span>
<span id="cb110-52"><a href="#cb110-52" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb110-53"><a href="#cb110-53" tabindex="-1"></a>You know this example for a \&#39;Aktiva\&#39; (assets) table and for this example you should answer with &quot;Aktiva&quot;:</span>
<span id="cb110-54"><a href="#cb110-54" tabindex="-1"></a></span>
<span id="cb110-55"><a href="#cb110-55" tabindex="-1"></a>&quot;&quot;&quot;</span>
<span id="cb110-56"><a href="#cb110-56" tabindex="-1"></a>52 Gruppenbilanz</span>
<span id="cb110-57"><a href="#cb110-57" tabindex="-1"></a>Gruppenbilanz zum 31. Dezember 2016</span>
<span id="cb110-58"><a href="#cb110-58" tabindex="-1"></a>A K T I V A 31. 12. 2016 31. 12. 2015</span>
<span id="cb110-59"><a href="#cb110-59" tabindex="-1"></a>€ € €</span>
<span id="cb110-60"><a href="#cb110-60" tabindex="-1"></a>A. ANLAGEVERMÖGEN</span>
<span id="cb110-61"><a href="#cb110-61" tabindex="-1"></a>I. Immaterielle Vermögensgegenstände</span>
<span id="cb110-62"><a href="#cb110-62" tabindex="-1"></a>Entgeltlich erworbene Konzessionen, gewerbliche </span>
<span id="cb110-63"><a href="#cb110-63" tabindex="-1"></a>Schutzrechte und ähnliche Rechte 122.148,00 185.602,00</span>
<span id="cb110-64"><a href="#cb110-64" tabindex="-1"></a>II. Sachanlagen</span>
<span id="cb110-65"><a href="#cb110-65" tabindex="-1"></a>1. Anlageimmobilien 3.423.064.255,69 3.338.758.481,04</span>
<span id="cb110-66"><a href="#cb110-66" tabindex="-1"></a>2. übrige Grundstücke und Bauten 4.143.376,87 1.087.406,00</span>
<span id="cb110-67"><a href="#cb110-67" tabindex="-1"></a>3. technische Anlagen und Maschinen 120.700,00 149.667,00</span>
<span id="cb110-68"><a href="#cb110-68" tabindex="-1"></a>4. andere Anlagen, Betriebs- und Geschäftsausstattung 5.143.477,51 4.555.161,48</span>
<span id="cb110-69"><a href="#cb110-69" tabindex="-1"></a>5. geleistete Anzahlungen und Anlagen im Bau 1.007.468,36 180.543,58</span>
<span id="cb110-70"><a href="#cb110-70" tabindex="-1"></a>3.433.479.278,43 3.344.731.259,10</span>
<span id="cb110-71"><a href="#cb110-71" tabindex="-1"></a>III. Finanzanlagen</span>
<span id="cb110-72"><a href="#cb110-72" tabindex="-1"></a>1. Anteile an verbundenen Unternehmen 1.026.647,27 1.027.646,27</span>
<span id="cb110-73"><a href="#cb110-73" tabindex="-1"></a>2. Ausleihungen an verbundene Unternehmen 157.645,00 214.395,00</span>
<span id="cb110-74"><a href="#cb110-74" tabindex="-1"></a>3. Beteiligungen 284.138,88 40.073,02</span>
<span id="cb110-75"><a href="#cb110-75" tabindex="-1"></a>4. sonstige Ausleihungen 120.966,91 120.966,91</span>
<span id="cb110-76"><a href="#cb110-76" tabindex="-1"></a>1.589.398,06 1.403.081,20</span>
<span id="cb110-77"><a href="#cb110-77" tabindex="-1"></a>3.435.190.824,49 3.346.319.942,30</span>
<span id="cb110-78"><a href="#cb110-78" tabindex="-1"></a>B. UMLAUFVERMÖGEN</span>
<span id="cb110-79"><a href="#cb110-79" tabindex="-1"></a>I. Vorräte</span>
<span id="cb110-80"><a href="#cb110-80" tabindex="-1"></a>1. unfertige Leistungen 48.642.315,18 52.057.422,25</span>
<span id="cb110-81"><a href="#cb110-81" tabindex="-1"></a>2. andere Vorräte 13.053,63 21.315,99</span>
<span id="cb110-82"><a href="#cb110-82" tabindex="-1"></a>48.655.368,81 52.078.738,24</span>
<span id="cb110-83"><a href="#cb110-83" tabindex="-1"></a>II. Forderungen und sonstige Vermögensgegenstände</span>
<span id="cb110-84"><a href="#cb110-84" tabindex="-1"></a>1. Forderungen aus Lieferungen und Leistungen 32.107.301,91 35.679.035,16</span>
<span id="cb110-85"><a href="#cb110-85" tabindex="-1"></a>2. Forderungen gegen verbundene Unternehmen 74.457,55 554.130,28</span>
<span id="cb110-86"><a href="#cb110-86" tabindex="-1"></a>3. Forderungen gegen Unternehmen, </span>
<span id="cb110-87"><a href="#cb110-87" tabindex="-1"></a>mit denen ein Beteiligungsverhältnis besteht 108.647,73 23.698,71</span>
<span id="cb110-88"><a href="#cb110-88" tabindex="-1"></a>4. sonstige Vermögensgegenstände 100.560.866,41 100.896.144,88</span>
<span id="cb110-89"><a href="#cb110-89" tabindex="-1"></a>132.851.273,60 137.153.009,03</span>
<span id="cb110-90"><a href="#cb110-90" tabindex="-1"></a>III. Wertpapiere</span>
<span id="cb110-91"><a href="#cb110-91" tabindex="-1"></a>sonstige Wertpapiere 1.700,00 1.700,00</span>
<span id="cb110-92"><a href="#cb110-92" tabindex="-1"></a>IV. Kassenbestand, Guthaben bei Kreditinstituten 893.140.123,18 689.887.519,98</span>
<span id="cb110-93"><a href="#cb110-93" tabindex="-1"></a>1.074.648.465,59 879.120.967,25</span>
<span id="cb110-94"><a href="#cb110-94" tabindex="-1"></a>C. RECHNUNGSABGRENZUNGSPOSTEN 9.245.284,80 9.917.197,12</span>
<span id="cb110-95"><a href="#cb110-95" tabindex="-1"></a>D. AKTIVER UNTERSCHIEDSBETRAG AUS DER </span>
<span id="cb110-96"><a href="#cb110-96" tabindex="-1"></a>VERMÖGENSVERRECHNUNG 68.523,69 0,00</span>
<span id="cb110-97"><a href="#cb110-97" tabindex="-1"></a>4.519.153.098,57 4.235.358.106,67</span>
<span id="cb110-98"><a href="#cb110-98" tabindex="-1"></a> </span>
<span id="cb110-99"><a href="#cb110-99" tabindex="-1"></a>&quot;&quot;&quot;. (The L2 distance of this example text is: 0.421)&lt;|im_end|&gt;</span>
<span id="cb110-100"><a href="#cb110-100" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb110-101"><a href="#cb110-101" tabindex="-1"></a>You know this example for a \&#39;Passiva\&#39; (liabilities) table and for this example you should answer with &quot;Passiva&quot;:</span>
<span id="cb110-102"><a href="#cb110-102" tabindex="-1"></a></span>
<span id="cb110-103"><a href="#cb110-103" tabindex="-1"></a>&quot;&quot;&quot;</span>
<span id="cb110-104"><a href="#cb110-104" tabindex="-1"></a>Anlage 1</span>
<span id="cb110-105"><a href="#cb110-105" tabindex="-1"></a>BEN Berlin Energie und Netzholding GmbH</span>
<span id="cb110-106"><a href="#cb110-106" tabindex="-1"></a>Berlin</span>
<span id="cb110-107"><a href="#cb110-107" tabindex="-1"></a>Bilanz zum 31.12.2023</span>
<span id="cb110-108"><a href="#cb110-108" tabindex="-1"></a>Aktivseite 31.12.2023 31.12.2022 31.12.2023 31.12.2022</span>
<span id="cb110-109"><a href="#cb110-109" tabindex="-1"></a>T€ T€ T€ T€</span>
<span id="cb110-110"><a href="#cb110-110" tabindex="-1"></a>A. Anlagevermögen A. Eigenkapital</span>
<span id="cb110-111"><a href="#cb110-111" tabindex="-1"></a>imv I. Immaterielle Vermögensgegenstände 58,0 20,2 ek I. Gezeichnetes Kapital 25,0 25,0bga II. Sachanlagen 106,7 70,7 kr II. Kapitalrücklage 6,9 6,9</span>
<span id="cb110-112"><a href="#cb110-112" tabindex="-1"></a>III. Finanzanlagen 2.194.146,0 2.094.146,0 vv III. Gewinnrücklage/Verlustvortrag 41.023,4 1.319,8</span>
<span id="cb110-113"><a href="#cb110-113" tabindex="-1"></a>IV. Jahresüberschuss 51.158,5 39.703,6</span>
<span id="cb110-114"><a href="#cb110-114" tabindex="-1"></a> 2.194.310,6 2.094.236,9</span>
<span id="cb110-115"><a href="#cb110-115" tabindex="-1"></a> 92.213,8 41.055,3</span>
<span id="cb110-116"><a href="#cb110-116" tabindex="-1"></a>B. Umlaufvermögen sor</span>
<span id="cb110-117"><a href="#cb110-117" tabindex="-1"></a>unf I. Forderungen und sonstige B. Rückstellungen</span>
<span id="cb110-118"><a href="#cb110-118" tabindex="-1"></a> Vermögensgegenstände Sonstige Rückstellungen 4.759,3 460,0</span>
<span id="cb110-119"><a href="#cb110-119" tabindex="-1"></a>1. Forderungen aus Lieferungen und Leistungen 73,1 70,72. Forderungen gegen verbundene C. Verbindlichkeiten Unternehmen 96.998,2 60.960,4 anz 1. Verbindlichkeiten gegenüber 3. Sonstige Vermögensgegenstände 988,6 923,3 Kreditinstituten 2.317.498,9 2.148.050,6</span>
<span id="cb110-120"><a href="#cb110-120" tabindex="-1"></a>fll II. Guthaben bei Kreditinstituten 226.047,2 160.535,8 vll 2. Verbindlichkeiten aus</span>
<span id="cb110-121"><a href="#cb110-121" tabindex="-1"></a> Lieferungen und Leistungen 272,0 158,4</span>
<span id="cb110-122"><a href="#cb110-122" tabindex="-1"></a> 324.107,1 222.490,2 3. Verbindlichkeiten gegenüber </span>
<span id="cb110-123"><a href="#cb110-123" tabindex="-1"></a> verbundenen Unternehmen 104.704,9 128.407,54. Verbindlichkeiten gegenüber </span>
<span id="cb110-124"><a href="#cb110-124" tabindex="-1"></a>C. Rechnungsabgrenzungsposten 1.969,9 2.207,9 vvu Gesellschaftern 695,8 706,1</span>
<span id="cb110-125"><a href="#cb110-125" tabindex="-1"></a>5. Sonstige Verbindlichkeiten 242,9 97,1</span>
<span id="cb110-126"><a href="#cb110-126" tabindex="-1"></a> 2.423.414,4 2.277.419,7</span>
<span id="cb110-127"><a href="#cb110-127" tabindex="-1"></a> 2.520.387,6 2.318.935,0 2.520.387,6 2.318.935,0</span>
<span id="cb110-128"><a href="#cb110-128" tabindex="-1"></a>Passivseite</span>
<span id="cb110-129"><a href="#cb110-129" tabindex="-1"></a>3</span>
<span id="cb110-130"><a href="#cb110-130" tabindex="-1"></a>&quot;&quot;&quot;. (The L2 distance of this example text is: 0.481)&lt;|im_end|&gt;</span>
<span id="cb110-131"><a href="#cb110-131" tabindex="-1"></a>&lt;|im_start|&gt;system</span>
<span id="cb110-132"><a href="#cb110-132" tabindex="-1"></a>You know this example for a text that does not suit the categories of interest and for this example you should answer with &quot;other&quot;:</span>
<span id="cb110-133"><a href="#cb110-133" tabindex="-1"></a></span>
<span id="cb110-134"><a href="#cb110-134" tabindex="-1"></a>&quot;&quot;&quot;</span>
<span id="cb110-135"><a href="#cb110-135" tabindex="-1"></a>46 Konzernbilanz</span>
<span id="cb110-136"><a href="#cb110-136" tabindex="-1"></a>Konzernbilanz zum 31. Dezember 2013</span>
<span id="cb110-137"><a href="#cb110-137" tabindex="-1"></a>A K T I V A 31. 12. 2013 31. 12. 2012</span>
<span id="cb110-138"><a href="#cb110-138" tabindex="-1"></a>€ € €</span>
<span id="cb110-139"><a href="#cb110-139" tabindex="-1"></a>A. ANLAGEVERMÖGEN</span>
<span id="cb110-140"><a href="#cb110-140" tabindex="-1"></a>I. Immaterielle Vermögensgegenstände</span>
<span id="cb110-141"><a href="#cb110-141" tabindex="-1"></a>Konzessionen, gewerbliche Schutzrechte und ähnliche </span>
<span id="cb110-142"><a href="#cb110-142" tabindex="-1"></a>Rechte</span>
<span id="cb110-143"><a href="#cb110-143" tabindex="-1"></a>344.384,00 461.417,00</span>
<span id="cb110-144"><a href="#cb110-144" tabindex="-1"></a>II. Sachanlagen</span>
<span id="cb110-145"><a href="#cb110-145" tabindex="-1"></a>1. Grundstücke und Bauten 1.242.921,00 1.272.566,00</span>
<span id="cb110-146"><a href="#cb110-146" tabindex="-1"></a>2. Technische Anlagen und Maschinen 122.769,00 62.405,00</span>
<span id="cb110-147"><a href="#cb110-147" tabindex="-1"></a>3. Andere Anlagen, Betriebs- und Geschäftsausstattung 2.339.362,51 1.562.893,45</span>
<span id="cb110-148"><a href="#cb110-148" tabindex="-1"></a>4. Geleistete Anzahlungen 704,76 33.483,89</span>
<span id="cb110-149"><a href="#cb110-149" tabindex="-1"></a>3.705.757,27 2.931.348,34</span>
<span id="cb110-150"><a href="#cb110-150" tabindex="-1"></a>III. Finanzanlagen</span>
<span id="cb110-151"><a href="#cb110-151" tabindex="-1"></a>1. Anteile an verbundenen Unternehmen 3.201.349,87 3.201.436,42</span>
<span id="cb110-152"><a href="#cb110-152" tabindex="-1"></a>2. Ausleihungen an verbundene Unternehmen 217.680,00 223.395,00</span>
<span id="cb110-153"><a href="#cb110-153" tabindex="-1"></a>3. Beteiligungen 42.171.545,24 54.585.174,81</span>
<span id="cb110-154"><a href="#cb110-154" tabindex="-1"></a>4. Sonstige Ausleihungen 76.015.926,17 99.994.824,65</span>
<span id="cb110-155"><a href="#cb110-155" tabindex="-1"></a>121.606.501,28 158.004.830,88</span>
<span id="cb110-156"><a href="#cb110-156" tabindex="-1"></a>125.656.642,55 161.397.596,22</span>
<span id="cb110-157"><a href="#cb110-157" tabindex="-1"></a>B. UMLAUFVERMÖGEN</span>
<span id="cb110-158"><a href="#cb110-158" tabindex="-1"></a>I. Vorräte</span>
<span id="cb110-159"><a href="#cb110-159" tabindex="-1"></a>1. Unfertige Leistungen 12.885.172,94 8.843.369,97</span>
<span id="cb110-160"><a href="#cb110-160" tabindex="-1"></a>2. Zum Verkauf bestimmte Grundstücke und Gebäude 139.000,00 139.002,00</span>
<span id="cb110-161"><a href="#cb110-161" tabindex="-1"></a>3. Andere Vorräte 61.319,05 93.039,06</span>
<span id="cb110-162"><a href="#cb110-162" tabindex="-1"></a>13.085.491,99 9.075.411,03</span>
<span id="cb110-163"><a href="#cb110-163" tabindex="-1"></a>II. Forderungen und sonstige Vermögensgegenstände</span>
<span id="cb110-164"><a href="#cb110-164" tabindex="-1"></a>1. Forderungen aus Lieferungen und Leistungen 8.666.340,95 12.099.596,63</span>
<span id="cb110-165"><a href="#cb110-165" tabindex="-1"></a>2. Forderungen gegen verbundene Unternehmen 1.409.363,51 7.573.168,86</span>
<span id="cb110-166"><a href="#cb110-166" tabindex="-1"></a>3. Forderungen gegen Unternehmen, </span>
<span id="cb110-167"><a href="#cb110-167" tabindex="-1"></a>mit denen ein Beteiligungsverhältnis besteht</span>
<span id="cb110-168"><a href="#cb110-168" tabindex="-1"></a>555.093,06 1.651.573,06</span>
<span id="cb110-169"><a href="#cb110-169" tabindex="-1"></a>4. Sonstige Vermögensgegenstände 345.991.815,13 163.003.969,98</span>
<span id="cb110-170"><a href="#cb110-170" tabindex="-1"></a>356.622.612,65 184.328.308,53</span>
<span id="cb110-171"><a href="#cb110-171" tabindex="-1"></a>III. Wertpapiere</span>
<span id="cb110-172"><a href="#cb110-172" tabindex="-1"></a>Sonstige Wertpapiere 52.252.850,00 59.329.212,00</span>
<span id="cb110-173"><a href="#cb110-173" tabindex="-1"></a>IV. Kassenbestand, Guthaben bei Kreditinstituten 152.594.976,48 248.363.122,67</span>
<span id="cb110-174"><a href="#cb110-174" tabindex="-1"></a>574.555.931,12 501.096.054,23</span>
<span id="cb110-175"><a href="#cb110-175" tabindex="-1"></a>C. RECHNUNGSABGRENZUNGSPOSTEN 7.545.702,82 7.957.871,65</span>
<span id="cb110-176"><a href="#cb110-176" tabindex="-1"></a>707.758.276,49 670.451.522,10</span>
<span id="cb110-177"><a href="#cb110-177" tabindex="-1"></a>Treuhandvermögen 1.943.915.141,66 1.953.309.522,69</span>
<span id="cb110-178"><a href="#cb110-178" tabindex="-1"></a>&quot;&quot;&quot;. (The L2 distance of this example text is: 0.434)&lt;|im_end|&gt;</span>
<span id="cb110-179"><a href="#cb110-179" tabindex="-1"></a>&lt;|im_start|&gt;user</span>
<span id="cb110-180"><a href="#cb110-180" tabindex="-1"></a></span>
<span id="cb110-181"><a href="#cb110-181" tabindex="-1"></a>[Task]: Decide of what type the given text is. You can differentiate between four types of pages: \&#39;Aktiva\&#39;, \&#39;GuV\&#39;, \&#39;Passiva\&#39; and \&#39;other\&#39;.</span>
<span id="cb110-182"><a href="#cb110-182" tabindex="-1"></a></span>
<span id="cb110-183"><a href="#cb110-183" tabindex="-1"></a></span>
<span id="cb110-184"><a href="#cb110-184" tabindex="-1"></a>[Rules]:</span>
<span id="cb110-185"><a href="#cb110-185" tabindex="-1"></a></span>
<span id="cb110-186"><a href="#cb110-186" tabindex="-1"></a>1) If the text contains a \&#39;Gewinn- und Verlustrechnung\&#39; (profit and loss statement) table, answer with \&#39;GuV\&#39;.</span>
<span id="cb110-187"><a href="#cb110-187" tabindex="-1"></a></span>
<span id="cb110-188"><a href="#cb110-188" tabindex="-1"></a></span>
<span id="cb110-189"><a href="#cb110-189" tabindex="-1"></a>2) If the text contains an \&#39;Aktiva\&#39; (assets) table, answer with \&#39;Aktiva\&#39;.</span>
<span id="cb110-190"><a href="#cb110-190" tabindex="-1"></a></span>
<span id="cb110-191"><a href="#cb110-191" tabindex="-1"></a></span>
<span id="cb110-192"><a href="#cb110-192" tabindex="-1"></a>3) If the text contains a \&#39;Passiva\&#39; (liabilities) table, answer with \&#39;Passiva\&#39;.</span>
<span id="cb110-193"><a href="#cb110-193" tabindex="-1"></a></span>
<span id="cb110-194"><a href="#cb110-194" tabindex="-1"></a></span>
<span id="cb110-195"><a href="#cb110-195" tabindex="-1"></a>4) If the text contains something else, answer with \&#39;other\&#39;.</span>
<span id="cb110-196"><a href="#cb110-196" tabindex="-1"></a></span>
<span id="cb110-197"><a href="#cb110-197" tabindex="-1"></a></span>
<span id="cb110-198"><a href="#cb110-198" tabindex="-1"></a>[Text]: Here is the text to classify: </span>
<span id="cb110-199"><a href="#cb110-199" tabindex="-1"></a></span>
<span id="cb110-200"><a href="#cb110-200" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb110-201"><a href="#cb110-201" tabindex="-1"></a>22 Amt für Statistik Berlin-Brandenburg | Geschäftsbericht 2014</span>
<span id="cb110-202"><a href="#cb110-202" tabindex="-1"></a>Amt für Statistik Berlin-Brandenburg Anstalt des öffentlichen Rechts, Potsdam</span>
<span id="cb110-203"><a href="#cb110-203" tabindex="-1"></a>Bilanz zum 31. Dezember 2014</span>
<span id="cb110-204"><a href="#cb110-204" tabindex="-1"></a>A K T I V S E I T E 31.12.2014 Vorjahr </span>
<span id="cb110-205"><a href="#cb110-205" tabindex="-1"></a>EUR EUR TEUR </span>
<span id="cb110-206"><a href="#cb110-206" tabindex="-1"></a>A. ANLAGEVERMÖGEN </span>
<span id="cb110-207"><a href="#cb110-207" tabindex="-1"></a>I. Immaterielle Vermögensgegenstände </span>
<span id="cb110-208"><a href="#cb110-208" tabindex="-1"></a>1. Entgeltlich erworbene Konzessionen, gewerbliche </span>
<span id="cb110-209"><a href="#cb110-209" tabindex="-1"></a>Schutzrechte und ähnliche Rechte und Werte </span>
<span id="cb110-210"><a href="#cb110-210" tabindex="-1"></a>sowie Lizenzen an solchen Rechten und Werten 81.480,00 146</span>
<span id="cb110-211"><a href="#cb110-211" tabindex="-1"></a>II. Sachanlagen</span>
<span id="cb110-212"><a href="#cb110-212" tabindex="-1"></a>1. Grundstücke, grundstücksgleiche Rechte und Bauten </span>
<span id="cb110-213"><a href="#cb110-213" tabindex="-1"></a>einschließlich der Bauten auf fremden Grundstücken 68.386,00 93</span>
<span id="cb110-214"><a href="#cb110-214" tabindex="-1"></a>2. Andere Anlagen, Betriebs- und Geschäftsausstattung 140.186,00 174 </span>
<span id="cb110-215"><a href="#cb110-215" tabindex="-1"></a>208.572,00 267</span>
<span id="cb110-216"><a href="#cb110-216" tabindex="-1"></a>III. Finanzanlagen </span>
<span id="cb110-217"><a href="#cb110-217" tabindex="-1"></a>1. Wertpapiere des Anlagevermögens 2.000.000,00 2.000 </span>
<span id="cb110-218"><a href="#cb110-218" tabindex="-1"></a>2.000.000,00 2.000 </span>
<span id="cb110-219"><a href="#cb110-219" tabindex="-1"></a>2.290.052,00 2.413</span>
<span id="cb110-220"><a href="#cb110-220" tabindex="-1"></a>B. UMLAUFVERMÖGEN </span>
<span id="cb110-221"><a href="#cb110-221" tabindex="-1"></a>I. Forderungen und sonstige Vermögensgegenstände </span>
<span id="cb110-222"><a href="#cb110-222" tabindex="-1"></a>1. Forderungen aus Lieferungen und Leistungen 36.617,86 14 </span>
<span id="cb110-223"><a href="#cb110-223" tabindex="-1"></a>2. Sonstige Vermögensgegenstände 297.982,42 267 </span>
<span id="cb110-224"><a href="#cb110-224" tabindex="-1"></a>334.600,28 281 </span>
<span id="cb110-225"><a href="#cb110-225" tabindex="-1"></a>II. Kassenbestand, Bundesbankguthaben, Guthaben bei </span>
<span id="cb110-226"><a href="#cb110-226" tabindex="-1"></a>Kreditinstituten und Schecks 5.560.638,85 7.783</span>
<span id="cb110-227"><a href="#cb110-227" tabindex="-1"></a>5.895.239,13 8.064</span>
<span id="cb110-228"><a href="#cb110-228" tabindex="-1"></a>C. RECHNUNGSABGRENZUNGSPOSTEN 216.321,49 213</span>
<span id="cb110-229"><a href="#cb110-229" tabindex="-1"></a>8.401.612,62 10.690 </span>
<span id="cb110-230"><a href="#cb110-230" tabindex="-1"></a>Bestätigungsvermerk </span>
<span id="cb110-231"><a href="#cb110-231" tabindex="-1"></a>des Abschlussprüfers</span>
<span id="cb110-232"><a href="#cb110-232" tabindex="-1"></a>Anhang</span>
<span id="cb110-233"><a href="#cb110-233" tabindex="-1"></a>\&#39;\&#39;\&#39;</span>
<span id="cb110-234"><a href="#cb110-234" tabindex="-1"></a>        &lt;|im_end|&gt;</span>
<span id="cb110-235"><a href="#cb110-235" tabindex="-1"></a>&lt;|im_start|&gt;assistant</span></code></pre></div>
</div>
</div>
<div id="regex-page-identification-code" class="section level2 hasAnchor" number="12.5">
<h2 class="hasAnchor"><span class="header-section-number">12.5</span> Regular expressions<a href="#regex-page-identification-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here one can find the three regular expressions used for the benchmarks presented in section @ref(regex-page-identification).</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb111"><pre class="sourceCode python fold-show"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a>simple_regex_patterns <span class="op">=</span> {</span>
<span id="cb111-2"><a href="#cb111-2" tabindex="-1"></a>    <span class="st">&quot;Aktiva&quot;</span>: [</span>
<span id="cb111-3"><a href="#cb111-3" tabindex="-1"></a>        <span class="vs">r&quot;aktiva&quot;</span>,</span>
<span id="cb111-4"><a href="#cb111-4" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))&quot;</span></span>
<span id="cb111-5"><a href="#cb111-5" tabindex="-1"></a>    ],</span>
<span id="cb111-6"><a href="#cb111-6" tabindex="-1"></a>    <span class="st">&quot;Passiva&quot;</span>: [</span>
<span id="cb111-7"><a href="#cb111-7" tabindex="-1"></a>        <span class="vs">r&quot;passiva&quot;</span>,</span>
<span id="cb111-8"><a href="#cb111-8" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))&quot;</span></span>
<span id="cb111-9"><a href="#cb111-9" tabindex="-1"></a>    ],</span>
<span id="cb111-10"><a href="#cb111-10" tabindex="-1"></a>    <span class="st">&quot;GuV&quot;</span>: [</span>
<span id="cb111-11"><a href="#cb111-11" tabindex="-1"></a>        <span class="vs">r&quot;gewinn&quot;</span>,</span>
<span id="cb111-12"><a href="#cb111-12" tabindex="-1"></a>        <span class="vs">r&quot;verlust&quot;</span>,</span>
<span id="cb111-13"><a href="#cb111-13" tabindex="-1"></a>        <span class="vs">r&quot;rechnung&quot;</span>,</span>
<span id="cb111-14"><a href="#cb111-14" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))&quot;</span></span>
<span id="cb111-15"><a href="#cb111-15" tabindex="-1"></a>    ]</span>
<span id="cb111-16"><a href="#cb111-16" tabindex="-1"></a>}</span></code></pre></div>
</details>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb112"><pre class="sourceCode python fold-show"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a>regex_patterns_5 <span class="op">=</span> {</span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a>    <span class="st">&quot;Aktiva&quot;</span>: [</span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>        <span class="vs">r&quot;a\s*k\s*t\s*i\s*v\s*a|a\s*k\s*t\s*i\s*v\s*s\s*e\s*i\s*t\s*e|anlageverm.{1,2}gen&quot;</span>,</span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|((20\d</span><span class="sc">{2}</span><span class="vs">).*vorjahr)|vorjahr&quot;</span>,</span>
<span id="cb112-5"><a href="#cb112-5" tabindex="-1"></a>        <span class="vs">r&quot;Umlaufverm.{1,2}gen|Anlageverm.{1,2}gen|Rechnungsabgrenzungsposten|Forderungen&quot;</span>,</span>
<span id="cb112-6"><a href="#cb112-6" tabindex="-1"></a>        <span class="vs">r&quot;\s([a-zA-Z]|[0-9]{1,2}|[iI]+)[\.\)]\s&quot;</span></span>
<span id="cb112-7"><a href="#cb112-7" tabindex="-1"></a>    ],</span>
<span id="cb112-8"><a href="#cb112-8" tabindex="-1"></a>    <span class="st">&quot;Passiva&quot;</span>: [</span>
<span id="cb112-9"><a href="#cb112-9" tabindex="-1"></a>        <span class="vs">r&quot;p\s*a\s*s\s*s\s*i\s*v\s*a|p\s*a\s*s\s*s\s*i\s*v\s*s\s*e\s*i\s*t\s*e|eigenkapital&quot;</span>,</span>
<span id="cb112-10"><a href="#cb112-10" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|((20\d</span><span class="sc">{2}</span><span class="vs">).*vorjahr)|vorjahr&quot;</span>,</span>
<span id="cb112-11"><a href="#cb112-11" tabindex="-1"></a>        <span class="vs">r&quot;Eigenkapital|R.{1,2}ckstellungen|Verbindlichkeiten|Rechnungsabgrenzungsposten&quot;</span>,</span>
<span id="cb112-12"><a href="#cb112-12" tabindex="-1"></a>        <span class="vs">r&quot;\s([a-zA-Z]|[0-9]{1,2}|[iI]+)[\.\)]\s&quot;</span></span>
<span id="cb112-13"><a href="#cb112-13" tabindex="-1"></a>    ],</span>
<span id="cb112-14"><a href="#cb112-14" tabindex="-1"></a>    <span class="st">&quot;GuV&quot;</span>: [</span>
<span id="cb112-15"><a href="#cb112-15" tabindex="-1"></a>        <span class="vs">r&quot;gewinn|guv&quot;</span>,</span>
<span id="cb112-16"><a href="#cb112-16" tabindex="-1"></a>        <span class="vs">r&quot;verlust|guv&quot;</span>,</span>
<span id="cb112-17"><a href="#cb112-17" tabindex="-1"></a>        <span class="vs">r&quot;rechnung|guv&quot;</span>,</span>
<span id="cb112-18"><a href="#cb112-18" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|vorjahr&quot;</span></span>
<span id="cb112-19"><a href="#cb112-19" tabindex="-1"></a>        <span class="vs">r&quot;Umsatzerl.{1,2}se|Materialaufwand|Personalaufwand|Abschreibungen|Jahres.{1,2}berschuss|Jahresfehlbetrag|Steuern|Vertriebskosten|Verwaltungskosten|Aufwendungen|Ertr.{1,2}ge&quot;</span>,</span>
<span id="cb112-20"><a href="#cb112-20" tabindex="-1"></a>        <span class="vs">r&quot;\s([a-zA-Z]|[0-9]{1,2}|[iI]+)[\.\)]\s&quot;</span></span>
<span id="cb112-21"><a href="#cb112-21" tabindex="-1"></a>    ]</span>
<span id="cb112-22"><a href="#cb112-22" tabindex="-1"></a>}</span></code></pre></div>
</details>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb113"><pre class="sourceCode python fold-show"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a>regex_patterns_3 <span class="op">=</span> {</span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a>    <span class="st">&quot;Aktiva&quot;</span>: [</span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a>        <span class="vs">r&quot;a\s*k\s*t\s*i\s*v\s*a|a\s*k\s*t\s*i\s*v\s*s\s*e\s*i\s*t\s*e|anlageverm.{1,2}gen&quot;</span>,</span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|((20\d</span><span class="sc">{2}</span><span class="vs">).*vorjahr)|vorjahr&quot;</span></span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>    ],</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a>    <span class="st">&quot;Passiva&quot;</span>: [</span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a>        <span class="vs">r&quot;p\s*a\s*s\s*s\s*i\s*v\s*a|p\s*a\s*s\s*s\s*i\s*v\s*s\s*e\s*i\s*t\s*e|eigenkapital&quot;</span>,</span>
<span id="cb113-8"><a href="#cb113-8" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|((20\d</span><span class="sc">{2}</span><span class="vs">).*vorjahr)|vorjahr&quot;</span></span>
<span id="cb113-9"><a href="#cb113-9" tabindex="-1"></a>    ],</span>
<span id="cb113-10"><a href="#cb113-10" tabindex="-1"></a>    <span class="st">&quot;GuV&quot;</span>: [</span>
<span id="cb113-11"><a href="#cb113-11" tabindex="-1"></a>        <span class="vs">r&quot;gewinn|guv&quot;</span>,</span>
<span id="cb113-12"><a href="#cb113-12" tabindex="-1"></a>        <span class="vs">r&quot;verlust|guv&quot;</span>,</span>
<span id="cb113-13"><a href="#cb113-13" tabindex="-1"></a>        <span class="vs">r&quot;rechnung|guv&quot;</span>,</span>
<span id="cb113-14"><a href="#cb113-14" tabindex="-1"></a>        <span class="vs">r&quot;((20\d</span><span class="sc">{2}</span><span class="vs">).*(20\d</span><span class="sc">{2}</span><span class="vs">))|vorjahr&quot;</span></span>
<span id="cb113-15"><a href="#cb113-15" tabindex="-1"></a>    ]</span>
<span id="cb113-16"><a href="#cb113-16" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="annual-comprehensive-financial-report-balance-sheet" class="section level2 hasAnchor" number="12.6">
<h2 class="hasAnchor"><span class="header-section-number">12.6</span> Annual Comprehensive Financial Report Balance Sheet<a href="#annual-comprehensive-financial-report-balance-sheet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="pdf-embed">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;./images/acfr23_balance.pdf&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<embed src="./images/acfr23_balance.pdf" title="Example balance sheet pagefom Californias Annual Comprehensive Financial Report 2023" width="100%" height="95%" keepaspectratio type="application/pdf" />
<p class="caption">
(#fig:acfr23-balance-sheet)Example balance sheet pagefom Californias Annual Comprehensive Financial Report 2023
</p>
</div>
</div>
</div>
<div id="extraction-framework-flow-chart" class="section level2 hasAnchor" number="12.7">
<h2 class="hasAnchor"><span class="header-section-number">12.7</span> Extraction framework flow chart<a href="#extraction-framework-flow-chart" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(ref:flow-chart-caption) Flowchart of the extraction framework of <span class="citation">Auer et al. (<a href="#ref-auerDoclingTechnicalReport2024">2024</a>)</span></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;./images/extraction_framework_flow_chart.png&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="images/extraction_framework_flow_chart.png" alt="(ref:flow-chart-caption)" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:extraction-framework-flow-chart)(ref:flow-chart-caption)
</p>
</div>
</div>
<div id="regex-extraction-mistakes" class="section level2 hasAnchor" number="12.8">
<h2 class="hasAnchor"><span class="header-section-number">12.8</span> Table extraction with regular expressions<a href="#regex-extraction-mistakes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Extract by pdfium for ‘../../benchmark_truth/synthetic_tables/separate_files/final/aktiva_table__3_columns__span_False__thin_False__year_as_text__unit_in_first_cell_True__Mio. €__enumeration_False__shuffle_True__text_around_True__max_length_50__sum_in_same_row_False__0.pdf’:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a>A</span>
<span id="cb116-2"><a href="#cb116-2" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" tabindex="-1"></a>ktiva(inMio. €)GeschäftsjahrVorjahr</span>
<span id="cb116-4"><a href="#cb116-4" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" tabindex="-1"></a>Anlagevermögen Immaterielle Verm</span>
<span id="cb116-6"><a href="#cb116-6" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" tabindex="-1"></a>ögensgegenstände</span>
<span id="cb116-8"><a href="#cb116-8" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" tabindex="-1"></a>SelbstgeschaffenegewerblicheSchutzrechteund</span>
<span id="cb116-10"><a href="#cb116-10" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" tabindex="-1"></a>ähnlicheRechteundWerte</span>
<span id="cb116-12"><a href="#cb116-12" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" tabindex="-1"></a>0,184,77</span>
<span id="cb116-14"><a href="#cb116-14" tabindex="-1"></a></span>
<span id="cb116-15"><a href="#cb116-15" tabindex="-1"></a>Geschäfts-oderFirmenwert4,426,78</span>
<span id="cb116-16"><a href="#cb116-16" tabindex="-1"></a></span>
<span id="cb116-17"><a href="#cb116-17" tabindex="-1"></a>geleisteteAnzahlungen1,780,65</span>
<span id="cb116-18"><a href="#cb116-18" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" tabindex="-1"></a>entgeltlicherworbeneKonzessionen, gewerbliche</span>
<span id="cb116-20"><a href="#cb116-20" tabindex="-1"></a></span>
<span id="cb116-21"><a href="#cb116-21" tabindex="-1"></a>SchutzrechteundähnlicheRechteundWertesowie</span>
<span id="cb116-22"><a href="#cb116-22" tabindex="-1"></a></span>
<span id="cb116-23"><a href="#cb116-23" tabindex="-1"></a>LizenzenansolchenRechtenundWerten</span>
<span id="cb116-24"><a href="#cb116-24" tabindex="-1"></a></span>
<span id="cb116-25"><a href="#cb116-25" tabindex="-1"></a>4,646,71</span>
<span id="cb116-26"><a href="#cb116-26" tabindex="-1"></a></span>
<span id="cb116-27"><a href="#cb116-27" tabindex="-1"></a>11,0218,91</span>
<span id="cb116-28"><a href="#cb116-28" tabindex="-1"></a></span>
<span id="cb116-29"><a href="#cb116-29" tabindex="-1"></a>Sachanlagen</span>
<span id="cb116-30"><a href="#cb116-30" tabindex="-1"></a></span>
<span id="cb116-31"><a href="#cb116-31" tabindex="-1"></a>Grundstücke, grundstücksgleicheRechteundBauten</span>
<span id="cb116-32"><a href="#cb116-32" tabindex="-1"></a></span>
<span id="cb116-33"><a href="#cb116-33" tabindex="-1"></a>einschließlichderBautenauffremdenGrundstücken</span>
<span id="cb116-34"><a href="#cb116-34" tabindex="-1"></a></span>
<span id="cb116-35"><a href="#cb116-35" tabindex="-1"></a>2,802,55</span>
<span id="cb116-36"><a href="#cb116-36" tabindex="-1"></a></span>
<span id="cb116-37"><a href="#cb116-37" tabindex="-1"></a>TechnischeAnlagenundMaschinen5,205,53</span>
<span id="cb116-38"><a href="#cb116-38" tabindex="-1"></a></span>
<span id="cb116-39"><a href="#cb116-39" tabindex="-1"></a>AndereAnlagen, Betriebs-undGeschäftsausstattung1,601,93</span>
<span id="cb116-40"><a href="#cb116-40" tabindex="-1"></a></span>
<span id="cb116-41"><a href="#cb116-41" tabindex="-1"></a>geleisteteAnzahlungenundAnlagen imBau3,255,81</span>
<span id="cb116-42"><a href="#cb116-42" tabindex="-1"></a></span>
<span id="cb116-43"><a href="#cb116-43" tabindex="-1"></a>12,8615,83</span>
<span id="cb116-44"><a href="#cb116-44" tabindex="-1"></a></span>
<span id="cb116-45"><a href="#cb116-45" tabindex="-1"></a>Finanzanlagen</span>
<span id="cb116-46"><a href="#cb116-46" tabindex="-1"></a></span>
<span id="cb116-47"><a href="#cb116-47" tabindex="-1"></a>SonstigeFinanzanlagen7,446,51</span>
<span id="cb116-48"><a href="#cb116-48" tabindex="-1"></a></span>
<span id="cb116-49"><a href="#cb116-49" tabindex="-1"></a>AnteileanverbundenenUnternehmen0,499,83</span>
<span id="cb116-50"><a href="#cb116-50" tabindex="-1"></a></span>
<span id="cb116-51"><a href="#cb116-51" tabindex="-1"></a>AusleihungenanverbundeneUnternehmen0,573,49</span>
<span id="cb116-52"><a href="#cb116-52" tabindex="-1"></a></span>
<span id="cb116-53"><a href="#cb116-53" tabindex="-1"></a>Beteiligungen1,059,43</span>
<span id="cb116-54"><a href="#cb116-54" tabindex="-1"></a></span>
<span id="cb116-55"><a href="#cb116-55" tabindex="-1"></a>AusleihungenanUnternehmen, mitdenenein</span>
<span id="cb116-56"><a href="#cb116-56" tabindex="-1"></a></span>
<span id="cb116-57"><a href="#cb116-57" tabindex="-1"></a>Beteiligungsverhältnisbesteht</span>
<span id="cb116-58"><a href="#cb116-58" tabindex="-1"></a></span>
<span id="cb116-59"><a href="#cb116-59" tabindex="-1"></a>6,957,65</span>
<span id="cb116-60"><a href="#cb116-60" tabindex="-1"></a></span>
<span id="cb116-61"><a href="#cb116-61" tabindex="-1"></a>WertpapieredesAnlagevermögens2,002,71</span>
<span id="cb116-62"><a href="#cb116-62" tabindex="-1"></a></span>
<span id="cb116-63"><a href="#cb116-63" tabindex="-1"></a>SonstigeAusleihungen9,091,52</span>
<span id="cb116-64"><a href="#cb116-64" tabindex="-1"></a></span>
<span id="cb116-65"><a href="#cb116-65" tabindex="-1"></a>27,5841,13</span>
<span id="cb116-66"><a href="#cb116-66" tabindex="-1"></a></span>
<span id="cb116-67"><a href="#cb116-67" tabindex="-1"></a>51,4675,87</span>
<span id="cb116-68"><a href="#cb116-68" tabindex="-1"></a></span>
<span id="cb116-69"><a href="#cb116-69" tabindex="-1"></a>Umlaufvermögen</span>
<span id="cb116-70"><a href="#cb116-70" tabindex="-1"></a></span>
<span id="cb116-71"><a href="#cb116-71" tabindex="-1"></a>Vorräte</span>
<span id="cb116-72"><a href="#cb116-72" tabindex="-1"></a></span>
<span id="cb116-73"><a href="#cb116-73" tabindex="-1"></a>Roh-, Hilfs-undBetriebsstoffe0,382,98</span>
<span id="cb116-74"><a href="#cb116-74" tabindex="-1"></a></span>
<span id="cb116-75"><a href="#cb116-75" tabindex="-1"></a>UnfertigeErzeugnisse, unfertigeLeistungen3,236,19</span>
<span id="cb116-76"><a href="#cb116-76" tabindex="-1"></a></span>
<span id="cb116-77"><a href="#cb116-77" tabindex="-1"></a>FertigeErzeugnisseundWaren6,724,98</span>
<span id="cb116-78"><a href="#cb116-78" tabindex="-1"></a></span>
<span id="cb116-79"><a href="#cb116-79" tabindex="-1"></a>GeleisteteAnzahlungen4,024,83</span>
<span id="cb116-80"><a href="#cb116-80" tabindex="-1"></a></span>
<span id="cb116-81"><a href="#cb116-81" tabindex="-1"></a>14,3418,98</span>
<span id="cb116-82"><a href="#cb116-82" tabindex="-1"></a></span>
<span id="cb116-83"><a href="#cb116-83" tabindex="-1"></a>ForderungenundsonstigeVermögensgegenstände</span>
<span id="cb116-84"><a href="#cb116-84" tabindex="-1"></a></span>
<span id="cb116-85"><a href="#cb116-85" tabindex="-1"></a>ForderungenausLieferungenundLeistungen4,328,36</span>
<span id="cb116-86"><a href="#cb116-86" tabindex="-1"></a></span>
<span id="cb116-87"><a href="#cb116-87" tabindex="-1"></a>ForderungengegenverbundeneUnternehmen6,082,38</span>
<span id="cb116-88"><a href="#cb116-88" tabindex="-1"></a></span>
<span id="cb116-89"><a href="#cb116-89" tabindex="-1"></a>ForderungengegenUnternehmen, mitdenenein</span>
<span id="cb116-90"><a href="#cb116-90" tabindex="-1"></a></span>
<span id="cb116-91"><a href="#cb116-91" tabindex="-1"></a>Beteiligungsverhältnisbesteht</span>
<span id="cb116-92"><a href="#cb116-92" tabindex="-1"></a></span>
<span id="cb116-93"><a href="#cb116-93" tabindex="-1"></a>7,878,11</span>
<span id="cb116-94"><a href="#cb116-94" tabindex="-1"></a></span>
<span id="cb116-95"><a href="#cb116-95" tabindex="-1"></a>SonstigeVermögensgegenstände1,968,30</span>
<span id="cb116-96"><a href="#cb116-96" tabindex="-1"></a></span>
<span id="cb116-97"><a href="#cb116-97" tabindex="-1"></a>20,2227,15</span>
<span id="cb116-98"><a href="#cb116-98" tabindex="-1"></a></span>
<span id="cb116-99"><a href="#cb116-99" tabindex="-1"></a>Wertpapiere</span>
<span id="cb116-100"><a href="#cb116-100" tabindex="-1"></a></span>
<span id="cb116-101"><a href="#cb116-101" tabindex="-1"></a>AnteileanverbundenenUnternehmen2,383,24</span>
<span id="cb116-102"><a href="#cb116-102" tabindex="-1"></a></span>
<span id="cb116-103"><a href="#cb116-103" tabindex="-1"></a>SonstigeWertpapiere0,077,65</span>
<span id="cb116-104"><a href="#cb116-104" tabindex="-1"></a></span>
<span id="cb116-105"><a href="#cb116-105" tabindex="-1"></a>2,4410,88</span>
<span id="cb116-106"><a href="#cb116-106" tabindex="-1"></a></span>
<span id="cb116-107"><a href="#cb116-107" tabindex="-1"></a>Kassenbestand, Bundesbankguthaben, Guthabenbei Kreditinstituten und Schecks</span>
<span id="cb116-108"><a href="#cb116-108" tabindex="-1"></a></span>
<span id="cb116-109"><a href="#cb116-109" tabindex="-1"></a>4,144,00</span>
<span id="cb116-110"><a href="#cb116-110" tabindex="-1"></a></span>
<span id="cb116-111"><a href="#cb116-111" tabindex="-1"></a>41,1561,01</span>
<span id="cb116-112"><a href="#cb116-112" tabindex="-1"></a></span>
<span id="cb116-113"><a href="#cb116-113" tabindex="-1"></a>Rechnungsabgrenzungsposten2,746,78</span>
<span id="cb116-114"><a href="#cb116-114" tabindex="-1"></a></span>
<span id="cb116-115"><a href="#cb116-115" tabindex="-1"></a>Aktive latenteSteuern8,464,60</span>
<span id="cb116-116"><a href="#cb116-116" tabindex="-1"></a></span>
<span id="cb116-117"><a href="#cb116-117" tabindex="-1"></a>AktiverUnterschiedsbetragausder</span>
<span id="cb116-118"><a href="#cb116-118" tabindex="-1"></a></span>
<span id="cb116-119"><a href="#cb116-119" tabindex="-1"></a>Vermögensverrechnung</span>
<span id="cb116-120"><a href="#cb116-120" tabindex="-1"></a></span>
<span id="cb116-121"><a href="#cb116-121" tabindex="-1"></a>2,863,35</span>
<span id="cb116-122"><a href="#cb116-122" tabindex="-1"></a></span>
<span id="cb116-123"><a href="#cb116-123" tabindex="-1"></a>106,67151,61</span></code></pre></div>
<p>Extract by pdfminer for ‘../../benchmark_truth/synthetic_tables/separate_files/final/aktiva_table__3_columns__span_False__thin_False__year_as_text__unit_in_first_cell_True__Mio. €__enumeration_False__shuffle_True__text_around_True__max_length_50__sum_in_same_row_False__0.pdf’:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>Aktiva (in Mio. €)</span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" tabindex="-1"></a>Anlagevermögen</span>
<span id="cb117-4"><a href="#cb117-4" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" tabindex="-1"></a>Immaterielle Vermögensgegenstände</span>
<span id="cb117-6"><a href="#cb117-6" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" tabindex="-1"></a>Selbst geschaffene gewerbliche Schutzrechte und</span>
<span id="cb117-8"><a href="#cb117-8" tabindex="-1"></a>ähnliche Rechte und Werte</span>
<span id="cb117-9"><a href="#cb117-9" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" tabindex="-1"></a>Geschäfts- oder Firmenwert</span>
<span id="cb117-11"><a href="#cb117-11" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" tabindex="-1"></a>geleistete Anzahlungen</span>
<span id="cb117-13"><a href="#cb117-13" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" tabindex="-1"></a>entgeltlich erworbene Konzessionen, gewerbliche</span>
<span id="cb117-15"><a href="#cb117-15" tabindex="-1"></a>Schutzrechte und ähnliche Rechte und Werte sowie</span>
<span id="cb117-16"><a href="#cb117-16" tabindex="-1"></a>Lizenzen an solchen Rechten und Werten</span>
<span id="cb117-17"><a href="#cb117-17" tabindex="-1"></a></span>
<span id="cb117-18"><a href="#cb117-18" tabindex="-1"></a>Sachanlagen</span>
<span id="cb117-19"><a href="#cb117-19" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" tabindex="-1"></a>Grundstücke, grundstücksgleiche Rechte und Bauten</span>
<span id="cb117-21"><a href="#cb117-21" tabindex="-1"></a>einschließlich der Bauten auf fremden Grundstücken</span>
<span id="cb117-22"><a href="#cb117-22" tabindex="-1"></a></span>
<span id="cb117-23"><a href="#cb117-23" tabindex="-1"></a>Technische Anlagen und Maschinen</span>
<span id="cb117-24"><a href="#cb117-24" tabindex="-1"></a></span>
<span id="cb117-25"><a href="#cb117-25" tabindex="-1"></a>Andere Anlagen, Betriebs- und Geschäftsausstattung</span>
<span id="cb117-26"><a href="#cb117-26" tabindex="-1"></a></span>
<span id="cb117-27"><a href="#cb117-27" tabindex="-1"></a>geleistete Anzahlungen und Anlagen im Bau</span>
<span id="cb117-28"><a href="#cb117-28" tabindex="-1"></a></span>
<span id="cb117-29"><a href="#cb117-29" tabindex="-1"></a>Finanzanlagen</span>
<span id="cb117-30"><a href="#cb117-30" tabindex="-1"></a></span>
<span id="cb117-31"><a href="#cb117-31" tabindex="-1"></a>Sonstige Finanzanlagen</span>
<span id="cb117-32"><a href="#cb117-32" tabindex="-1"></a></span>
<span id="cb117-33"><a href="#cb117-33" tabindex="-1"></a>Anteile an verbundenen Unternehmen</span>
<span id="cb117-34"><a href="#cb117-34" tabindex="-1"></a></span>
<span id="cb117-35"><a href="#cb117-35" tabindex="-1"></a>Ausleihungen an verbundene Unternehmen</span>
<span id="cb117-36"><a href="#cb117-36" tabindex="-1"></a></span>
<span id="cb117-37"><a href="#cb117-37" tabindex="-1"></a>Beteiligungen</span>
<span id="cb117-38"><a href="#cb117-38" tabindex="-1"></a></span>
<span id="cb117-39"><a href="#cb117-39" tabindex="-1"></a>Ausleihungen an Unternehmen, mit denen ein</span>
<span id="cb117-40"><a href="#cb117-40" tabindex="-1"></a>Beteiligungsverhältnis besteht</span>
<span id="cb117-41"><a href="#cb117-41" tabindex="-1"></a></span>
<span id="cb117-42"><a href="#cb117-42" tabindex="-1"></a>Wertpapiere des Anlagevermögens</span>
<span id="cb117-43"><a href="#cb117-43" tabindex="-1"></a></span>
<span id="cb117-44"><a href="#cb117-44" tabindex="-1"></a>Sonstige Ausleihungen</span>
<span id="cb117-45"><a href="#cb117-45" tabindex="-1"></a></span>
<span id="cb117-46"><a href="#cb117-46" tabindex="-1"></a>Umlaufvermögen</span>
<span id="cb117-47"><a href="#cb117-47" tabindex="-1"></a></span>
<span id="cb117-48"><a href="#cb117-48" tabindex="-1"></a>Vorräte</span>
<span id="cb117-49"><a href="#cb117-49" tabindex="-1"></a></span>
<span id="cb117-50"><a href="#cb117-50" tabindex="-1"></a>Roh-, Hilfs- und Betriebsstoffe</span>
<span id="cb117-51"><a href="#cb117-51" tabindex="-1"></a></span>
<span id="cb117-52"><a href="#cb117-52" tabindex="-1"></a>Unfertige Erzeugnisse, unfertige Leistungen</span>
<span id="cb117-53"><a href="#cb117-53" tabindex="-1"></a></span>
<span id="cb117-54"><a href="#cb117-54" tabindex="-1"></a>Fertige Erzeugnisse und Waren</span>
<span id="cb117-55"><a href="#cb117-55" tabindex="-1"></a></span>
<span id="cb117-56"><a href="#cb117-56" tabindex="-1"></a>Geleistete Anzahlungen</span>
<span id="cb117-57"><a href="#cb117-57" tabindex="-1"></a></span>
<span id="cb117-58"><a href="#cb117-58" tabindex="-1"></a>Forderungen und sonstige Vermögensgegenstände</span>
<span id="cb117-59"><a href="#cb117-59" tabindex="-1"></a></span>
<span id="cb117-60"><a href="#cb117-60" tabindex="-1"></a>Forderungen aus Lieferungen und Leistungen</span>
<span id="cb117-61"><a href="#cb117-61" tabindex="-1"></a></span>
<span id="cb117-62"><a href="#cb117-62" tabindex="-1"></a>Forderungen gegen verbundene Unternehmen</span>
<span id="cb117-63"><a href="#cb117-63" tabindex="-1"></a></span>
<span id="cb117-64"><a href="#cb117-64" tabindex="-1"></a>Forderungen gegen Unternehmen, mit denen ein</span>
<span id="cb117-65"><a href="#cb117-65" tabindex="-1"></a>Beteiligungsverhältnis besteht</span>
<span id="cb117-66"><a href="#cb117-66" tabindex="-1"></a></span>
<span id="cb117-67"><a href="#cb117-67" tabindex="-1"></a>Sonstige Vermögensgegenstände</span>
<span id="cb117-68"><a href="#cb117-68" tabindex="-1"></a></span>
<span id="cb117-69"><a href="#cb117-69" tabindex="-1"></a>Wertpapiere</span>
<span id="cb117-70"><a href="#cb117-70" tabindex="-1"></a></span>
<span id="cb117-71"><a href="#cb117-71" tabindex="-1"></a>Anteile an verbundenen Unternehmen</span>
<span id="cb117-72"><a href="#cb117-72" tabindex="-1"></a></span>
<span id="cb117-73"><a href="#cb117-73" tabindex="-1"></a>Sonstige Wertpapiere</span>
<span id="cb117-74"><a href="#cb117-74" tabindex="-1"></a></span>
<span id="cb117-75"><a href="#cb117-75" tabindex="-1"></a>Kassenbestand, Bundesbankguthaben, Guthaben bei</span>
<span id="cb117-76"><a href="#cb117-76" tabindex="-1"></a>Kreditinstituten und Schecks</span>
<span id="cb117-77"><a href="#cb117-77" tabindex="-1"></a></span>
<span id="cb117-78"><a href="#cb117-78" tabindex="-1"></a>Rechnungsabgrenzungsposten</span>
<span id="cb117-79"><a href="#cb117-79" tabindex="-1"></a></span>
<span id="cb117-80"><a href="#cb117-80" tabindex="-1"></a>Aktive latente Steuern</span>
<span id="cb117-81"><a href="#cb117-81" tabindex="-1"></a></span>
<span id="cb117-82"><a href="#cb117-82" tabindex="-1"></a>Aktiver Unterschiedsbetrag aus der</span>
<span id="cb117-83"><a href="#cb117-83" tabindex="-1"></a>Vermögensverrechnung</span>
<span id="cb117-84"><a href="#cb117-84" tabindex="-1"></a></span>
<span id="cb117-85"><a href="#cb117-85" tabindex="-1"></a>Geschäftsjahr</span>
<span id="cb117-86"><a href="#cb117-86" tabindex="-1"></a></span>
<span id="cb117-87"><a href="#cb117-87" tabindex="-1"></a>Vorjahr</span>
<span id="cb117-88"><a href="#cb117-88" tabindex="-1"></a></span>
<span id="cb117-89"><a href="#cb117-89" tabindex="-1"></a>0,18</span>
<span id="cb117-90"><a href="#cb117-90" tabindex="-1"></a></span>
<span id="cb117-91"><a href="#cb117-91" tabindex="-1"></a>4,42</span>
<span id="cb117-92"><a href="#cb117-92" tabindex="-1"></a></span>
<span id="cb117-93"><a href="#cb117-93" tabindex="-1"></a>1,78</span>
<span id="cb117-94"><a href="#cb117-94" tabindex="-1"></a></span>
<span id="cb117-95"><a href="#cb117-95" tabindex="-1"></a>4,64</span>
<span id="cb117-96"><a href="#cb117-96" tabindex="-1"></a></span>
<span id="cb117-97"><a href="#cb117-97" tabindex="-1"></a>11,02</span>
<span id="cb117-98"><a href="#cb117-98" tabindex="-1"></a></span>
<span id="cb117-99"><a href="#cb117-99" tabindex="-1"></a>2,80</span>
<span id="cb117-100"><a href="#cb117-100" tabindex="-1"></a></span>
<span id="cb117-101"><a href="#cb117-101" tabindex="-1"></a>5,20</span>
<span id="cb117-102"><a href="#cb117-102" tabindex="-1"></a></span>
<span id="cb117-103"><a href="#cb117-103" tabindex="-1"></a>1,60</span>
<span id="cb117-104"><a href="#cb117-104" tabindex="-1"></a></span>
<span id="cb117-105"><a href="#cb117-105" tabindex="-1"></a>3,25</span>
<span id="cb117-106"><a href="#cb117-106" tabindex="-1"></a></span>
<span id="cb117-107"><a href="#cb117-107" tabindex="-1"></a>12,86</span>
<span id="cb117-108"><a href="#cb117-108" tabindex="-1"></a></span>
<span id="cb117-109"><a href="#cb117-109" tabindex="-1"></a>7,44</span>
<span id="cb117-110"><a href="#cb117-110" tabindex="-1"></a></span>
<span id="cb117-111"><a href="#cb117-111" tabindex="-1"></a>0,49</span>
<span id="cb117-112"><a href="#cb117-112" tabindex="-1"></a></span>
<span id="cb117-113"><a href="#cb117-113" tabindex="-1"></a>0,57</span>
<span id="cb117-114"><a href="#cb117-114" tabindex="-1"></a></span>
<span id="cb117-115"><a href="#cb117-115" tabindex="-1"></a>1,05</span>
<span id="cb117-116"><a href="#cb117-116" tabindex="-1"></a></span>
<span id="cb117-117"><a href="#cb117-117" tabindex="-1"></a>6,95</span>
<span id="cb117-118"><a href="#cb117-118" tabindex="-1"></a></span>
<span id="cb117-119"><a href="#cb117-119" tabindex="-1"></a>2,00</span>
<span id="cb117-120"><a href="#cb117-120" tabindex="-1"></a></span>
<span id="cb117-121"><a href="#cb117-121" tabindex="-1"></a>9,09</span>
<span id="cb117-122"><a href="#cb117-122" tabindex="-1"></a></span>
<span id="cb117-123"><a href="#cb117-123" tabindex="-1"></a>27,58</span>
<span id="cb117-124"><a href="#cb117-124" tabindex="-1"></a></span>
<span id="cb117-125"><a href="#cb117-125" tabindex="-1"></a>51,46</span>
<span id="cb117-126"><a href="#cb117-126" tabindex="-1"></a></span>
<span id="cb117-127"><a href="#cb117-127" tabindex="-1"></a>0,38</span>
<span id="cb117-128"><a href="#cb117-128" tabindex="-1"></a></span>
<span id="cb117-129"><a href="#cb117-129" tabindex="-1"></a>3,23</span>
<span id="cb117-130"><a href="#cb117-130" tabindex="-1"></a></span>
<span id="cb117-131"><a href="#cb117-131" tabindex="-1"></a>6,72</span>
<span id="cb117-132"><a href="#cb117-132" tabindex="-1"></a></span>
<span id="cb117-133"><a href="#cb117-133" tabindex="-1"></a>4,02</span>
<span id="cb117-134"><a href="#cb117-134" tabindex="-1"></a></span>
<span id="cb117-135"><a href="#cb117-135" tabindex="-1"></a>14,34</span>
<span id="cb117-136"><a href="#cb117-136" tabindex="-1"></a></span>
<span id="cb117-137"><a href="#cb117-137" tabindex="-1"></a>4,32</span>
<span id="cb117-138"><a href="#cb117-138" tabindex="-1"></a></span>
<span id="cb117-139"><a href="#cb117-139" tabindex="-1"></a>6,08</span>
<span id="cb117-140"><a href="#cb117-140" tabindex="-1"></a></span>
<span id="cb117-141"><a href="#cb117-141" tabindex="-1"></a>7,87</span>
<span id="cb117-142"><a href="#cb117-142" tabindex="-1"></a></span>
<span id="cb117-143"><a href="#cb117-143" tabindex="-1"></a>1,96</span>
<span id="cb117-144"><a href="#cb117-144" tabindex="-1"></a></span>
<span id="cb117-145"><a href="#cb117-145" tabindex="-1"></a>20,22</span>
<span id="cb117-146"><a href="#cb117-146" tabindex="-1"></a></span>
<span id="cb117-147"><a href="#cb117-147" tabindex="-1"></a>2,38</span>
<span id="cb117-148"><a href="#cb117-148" tabindex="-1"></a></span>
<span id="cb117-149"><a href="#cb117-149" tabindex="-1"></a>0,07</span>
<span id="cb117-150"><a href="#cb117-150" tabindex="-1"></a></span>
<span id="cb117-151"><a href="#cb117-151" tabindex="-1"></a>2,44</span>
<span id="cb117-152"><a href="#cb117-152" tabindex="-1"></a></span>
<span id="cb117-153"><a href="#cb117-153" tabindex="-1"></a>4,14</span>
<span id="cb117-154"><a href="#cb117-154" tabindex="-1"></a></span>
<span id="cb117-155"><a href="#cb117-155" tabindex="-1"></a>41,15</span>
<span id="cb117-156"><a href="#cb117-156" tabindex="-1"></a></span>
<span id="cb117-157"><a href="#cb117-157" tabindex="-1"></a>2,74</span>
<span id="cb117-158"><a href="#cb117-158" tabindex="-1"></a></span>
<span id="cb117-159"><a href="#cb117-159" tabindex="-1"></a>8,46</span>
<span id="cb117-160"><a href="#cb117-160" tabindex="-1"></a></span>
<span id="cb117-161"><a href="#cb117-161" tabindex="-1"></a>2,86</span>
<span id="cb117-162"><a href="#cb117-162" tabindex="-1"></a></span>
<span id="cb117-163"><a href="#cb117-163" tabindex="-1"></a>4,77</span>
<span id="cb117-164"><a href="#cb117-164" tabindex="-1"></a></span>
<span id="cb117-165"><a href="#cb117-165" tabindex="-1"></a>6,78</span>
<span id="cb117-166"><a href="#cb117-166" tabindex="-1"></a></span>
<span id="cb117-167"><a href="#cb117-167" tabindex="-1"></a>0,65</span>
<span id="cb117-168"><a href="#cb117-168" tabindex="-1"></a></span>
<span id="cb117-169"><a href="#cb117-169" tabindex="-1"></a>6,71</span>
<span id="cb117-170"><a href="#cb117-170" tabindex="-1"></a></span>
<span id="cb117-171"><a href="#cb117-171" tabindex="-1"></a>18,91</span>
<span id="cb117-172"><a href="#cb117-172" tabindex="-1"></a></span>
<span id="cb117-173"><a href="#cb117-173" tabindex="-1"></a>2,55</span>
<span id="cb117-174"><a href="#cb117-174" tabindex="-1"></a></span>
<span id="cb117-175"><a href="#cb117-175" tabindex="-1"></a>5,53</span>
<span id="cb117-176"><a href="#cb117-176" tabindex="-1"></a></span>
<span id="cb117-177"><a href="#cb117-177" tabindex="-1"></a>1,93</span>
<span id="cb117-178"><a href="#cb117-178" tabindex="-1"></a></span>
<span id="cb117-179"><a href="#cb117-179" tabindex="-1"></a>5,81</span>
<span id="cb117-180"><a href="#cb117-180" tabindex="-1"></a></span>
<span id="cb117-181"><a href="#cb117-181" tabindex="-1"></a>15,83</span>
<span id="cb117-182"><a href="#cb117-182" tabindex="-1"></a></span>
<span id="cb117-183"><a href="#cb117-183" tabindex="-1"></a>6,51</span>
<span id="cb117-184"><a href="#cb117-184" tabindex="-1"></a></span>
<span id="cb117-185"><a href="#cb117-185" tabindex="-1"></a>9,83</span>
<span id="cb117-186"><a href="#cb117-186" tabindex="-1"></a></span>
<span id="cb117-187"><a href="#cb117-187" tabindex="-1"></a>3,49</span>
<span id="cb117-188"><a href="#cb117-188" tabindex="-1"></a></span>
<span id="cb117-189"><a href="#cb117-189" tabindex="-1"></a>9,43</span>
<span id="cb117-190"><a href="#cb117-190" tabindex="-1"></a></span>
<span id="cb117-191"><a href="#cb117-191" tabindex="-1"></a>7,65</span>
<span id="cb117-192"><a href="#cb117-192" tabindex="-1"></a></span>
<span id="cb117-193"><a href="#cb117-193" tabindex="-1"></a>2,71</span>
<span id="cb117-194"><a href="#cb117-194" tabindex="-1"></a></span>
<span id="cb117-195"><a href="#cb117-195" tabindex="-1"></a>1,52</span>
<span id="cb117-196"><a href="#cb117-196" tabindex="-1"></a></span>
<span id="cb117-197"><a href="#cb117-197" tabindex="-1"></a>41,13</span>
<span id="cb117-198"><a href="#cb117-198" tabindex="-1"></a></span>
<span id="cb117-199"><a href="#cb117-199" tabindex="-1"></a>75,87</span>
<span id="cb117-200"><a href="#cb117-200" tabindex="-1"></a></span>
<span id="cb117-201"><a href="#cb117-201" tabindex="-1"></a>2,98</span>
<span id="cb117-202"><a href="#cb117-202" tabindex="-1"></a></span>
<span id="cb117-203"><a href="#cb117-203" tabindex="-1"></a>6,19</span>
<span id="cb117-204"><a href="#cb117-204" tabindex="-1"></a></span>
<span id="cb117-205"><a href="#cb117-205" tabindex="-1"></a>4,98</span>
<span id="cb117-206"><a href="#cb117-206" tabindex="-1"></a></span>
<span id="cb117-207"><a href="#cb117-207" tabindex="-1"></a>4,83</span>
<span id="cb117-208"><a href="#cb117-208" tabindex="-1"></a></span>
<span id="cb117-209"><a href="#cb117-209" tabindex="-1"></a>18,98</span>
<span id="cb117-210"><a href="#cb117-210" tabindex="-1"></a></span>
<span id="cb117-211"><a href="#cb117-211" tabindex="-1"></a>8,36</span>
<span id="cb117-212"><a href="#cb117-212" tabindex="-1"></a></span>
<span id="cb117-213"><a href="#cb117-213" tabindex="-1"></a>2,38</span>
<span id="cb117-214"><a href="#cb117-214" tabindex="-1"></a></span>
<span id="cb117-215"><a href="#cb117-215" tabindex="-1"></a>8,11</span>
<span id="cb117-216"><a href="#cb117-216" tabindex="-1"></a></span>
<span id="cb117-217"><a href="#cb117-217" tabindex="-1"></a>8,30</span>
<span id="cb117-218"><a href="#cb117-218" tabindex="-1"></a></span>
<span id="cb117-219"><a href="#cb117-219" tabindex="-1"></a>27,15</span>
<span id="cb117-220"><a href="#cb117-220" tabindex="-1"></a></span>
<span id="cb117-221"><a href="#cb117-221" tabindex="-1"></a>3,24</span>
<span id="cb117-222"><a href="#cb117-222" tabindex="-1"></a></span>
<span id="cb117-223"><a href="#cb117-223" tabindex="-1"></a>7,65</span>
<span id="cb117-224"><a href="#cb117-224" tabindex="-1"></a></span>
<span id="cb117-225"><a href="#cb117-225" tabindex="-1"></a>10,88</span>
<span id="cb117-226"><a href="#cb117-226" tabindex="-1"></a></span>
<span id="cb117-227"><a href="#cb117-227" tabindex="-1"></a>4,00</span>
<span id="cb117-228"><a href="#cb117-228" tabindex="-1"></a></span>
<span id="cb117-229"><a href="#cb117-229" tabindex="-1"></a>61,01</span>
<span id="cb117-230"><a href="#cb117-230" tabindex="-1"></a></span>
<span id="cb117-231"><a href="#cb117-231" tabindex="-1"></a>6,78</span>
<span id="cb117-232"><a href="#cb117-232" tabindex="-1"></a></span>
<span id="cb117-233"><a href="#cb117-233" tabindex="-1"></a>4,60</span>
<span id="cb117-234"><a href="#cb117-234" tabindex="-1"></a></span>
<span id="cb117-235"><a href="#cb117-235" tabindex="-1"></a>3,35</span>
<span id="cb117-236"><a href="#cb117-236" tabindex="-1"></a></span>
<span id="cb117-237"><a href="#cb117-237" tabindex="-1"></a>106,67</span>
<span id="cb117-238"><a href="#cb117-238" tabindex="-1"></a></span>
<span id="cb117-239"><a href="#cb117-239" tabindex="-1"></a>151,61</span></code></pre></div>
<p>Extract by PdfReader for ‘../Geschaeftsberichte/IBB/ibb_geschaeftsbericht_2006.pdf’, p. 67:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a>&#39;\x18\x18</span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a>Jahresbilanz zum 31. Dezember 2006</span>
<span id="cb118-3"><a href="#cb118-3" tabindex="-1"></a>a ktivseite in te U r</span>
<span id="cb118-4"><a href="#cb118-4" tabindex="-1"></a>31.12.2006 31.12.2005</span>
<span id="cb118-5"><a href="#cb118-5" tabindex="-1"></a>1. Barreserve</span>
<span id="cb118-6"><a href="#cb118-6" tabindex="-1"></a>    </span>
<span id="cb118-7"><a href="#cb118-7" tabindex="-1"></a>    </span>
<span id="cb118-8"><a href="#cb118-8" tabindex="-1"></a>b)  </span>
<span id="cb118-9"><a href="#cb118-9" tabindex="-1"></a>    </span>
<span id="cb118-10"><a href="#cb118-10" tabindex="-1"></a>Guthaben</span>
<span id="cb118-11"><a href="#cb118-11" tabindex="-1"></a>    </span>
<span id="cb118-12"><a href="#cb118-12" tabindex="-1"></a>bei</span>
<span id="cb118-13"><a href="#cb118-13" tabindex="-1"></a>    </span>
<span id="cb118-14"><a href="#cb118-14" tabindex="-1"></a>Zentralnotenbanken  </span>
<span id="cb118-15"><a href="#cb118-15" tabindex="-1"></a>darunter:</span>
<span id="cb118-16"><a href="#cb118-16" tabindex="-1"></a>    </span>
<span id="cb118-17"><a href="#cb118-17" tabindex="-1"></a>bei</span>
<span id="cb118-18"><a href="#cb118-18" tabindex="-1"></a>    </span>
<span id="cb118-19"><a href="#cb118-19" tabindex="-1"></a>der</span>
<span id="cb118-20"><a href="#cb118-20" tabindex="-1"></a>    </span>
<span id="cb118-21"><a href="#cb118-21" tabindex="-1"></a>Deutschen</span>
<span id="cb118-22"><a href="#cb118-22" tabindex="-1"></a>    </span>
<span id="cb118-23"><a href="#cb118-23" tabindex="-1"></a>Bundesbank: </span>
<span id="cb118-24"><a href="#cb118-24" tabindex="-1"></a>TEUR</span>
<span id="cb118-25"><a href="#cb118-25" tabindex="-1"></a>    </span>
<span id="cb118-26"><a href="#cb118-26" tabindex="-1"></a>19.823</span>
<span id="cb118-27"><a href="#cb118-27" tabindex="-1"></a>    </span>
<span id="cb118-28"><a href="#cb118-28" tabindex="-1"></a>(31.12.2005</span>
<span id="cb118-29"><a href="#cb118-29" tabindex="-1"></a>    </span>
<span id="cb118-30"><a href="#cb118-30" tabindex="-1"></a>:</span>
<span id="cb118-31"><a href="#cb118-31" tabindex="-1"></a>    </span>
<span id="cb118-32"><a href="#cb118-32" tabindex="-1"></a>TEUR</span>
<span id="cb118-33"><a href="#cb118-33" tabindex="-1"></a>    </span>
<span id="cb118-34"><a href="#cb118-34" tabindex="-1"></a>28.873)</span>
<span id="cb118-35"><a href="#cb118-35" tabindex="-1"></a>3. Forderungen an </span>
<span id="cb118-36"><a href="#cb118-36" tabindex="-1"></a>k</span>
<span id="cb118-37"><a href="#cb118-37" tabindex="-1"></a>reditinstitute</span>
<span id="cb118-38"><a href="#cb118-38" tabindex="-1"></a>     a)</span>
<span id="cb118-39"><a href="#cb118-39" tabindex="-1"></a>    </span>
<span id="cb118-40"><a href="#cb118-40" tabindex="-1"></a>täglich</span>
<span id="cb118-41"><a href="#cb118-41" tabindex="-1"></a>    </span>
<span id="cb118-42"><a href="#cb118-42" tabindex="-1"></a>fällig</span>
<span id="cb118-43"><a href="#cb118-43" tabindex="-1"></a>     b)</span>
<span id="cb118-44"><a href="#cb118-44" tabindex="-1"></a>    </span>
<span id="cb118-45"><a href="#cb118-45" tabindex="-1"></a>andere</span>
<span id="cb118-46"><a href="#cb118-46" tabindex="-1"></a>    </span>
<span id="cb118-47"><a href="#cb118-47" tabindex="-1"></a>Forderungen</span>
<span id="cb118-48"><a href="#cb118-48" tabindex="-1"></a>4. Forderungen an </span>
<span id="cb118-49"><a href="#cb118-49" tabindex="-1"></a>k</span>
<span id="cb118-50"><a href="#cb118-50" tabindex="-1"></a>unden</span>
<span id="cb118-51"><a href="#cb118-51" tabindex="-1"></a>    </span>
<span id="cb118-52"><a href="#cb118-52" tabindex="-1"></a>    </span>
<span id="cb118-53"><a href="#cb118-53" tabindex="-1"></a>darunter:</span>
<span id="cb118-54"><a href="#cb118-54" tabindex="-1"></a>        </span>
<span id="cb118-55"><a href="#cb118-55" tabindex="-1"></a>durch</span>
<span id="cb118-56"><a href="#cb118-56" tabindex="-1"></a>    </span>
<span id="cb118-57"><a href="#cb118-57" tabindex="-1"></a>Grundpfandrechte</span>
<span id="cb118-58"><a href="#cb118-58" tabindex="-1"></a>    </span>
<span id="cb118-59"><a href="#cb118-59" tabindex="-1"></a>gesichert:  </span>
<span id="cb118-60"><a href="#cb118-60" tabindex="-1"></a>TEUR</span>
<span id="cb118-61"><a href="#cb118-61" tabindex="-1"></a>    </span>
<span id="cb118-62"><a href="#cb118-62" tabindex="-1"></a>9.496.661</span>
<span id="cb118-63"><a href="#cb118-63" tabindex="-1"></a>    </span>
<span id="cb118-64"><a href="#cb118-64" tabindex="-1"></a>(31.12.2005</span>
<span id="cb118-65"><a href="#cb118-65" tabindex="-1"></a>    </span>
<span id="cb118-66"><a href="#cb118-66" tabindex="-1"></a>:</span>
<span id="cb118-67"><a href="#cb118-67" tabindex="-1"></a>    </span>
<span id="cb118-68"><a href="#cb118-68" tabindex="-1"></a>TEUR</span>
<span id="cb118-69"><a href="#cb118-69" tabindex="-1"></a>    </span>
<span id="cb118-70"><a href="#cb118-70" tabindex="-1"></a>10.660.277) </span>
<span id="cb118-71"><a href="#cb118-71" tabindex="-1"></a>Kommunalkredite:</span>
<span id="cb118-72"><a href="#cb118-72" tabindex="-1"></a>    </span>
<span id="cb118-73"><a href="#cb118-73" tabindex="-1"></a>TEUR</span>
<span id="cb118-74"><a href="#cb118-74" tabindex="-1"></a>    </span>
<span id="cb118-75"><a href="#cb118-75" tabindex="-1"></a>3.532.796</span>
<span id="cb118-76"><a href="#cb118-76" tabindex="-1"></a>    </span>
<span id="cb118-77"><a href="#cb118-77" tabindex="-1"></a>(31.12.2005</span>
<span id="cb118-78"><a href="#cb118-78" tabindex="-1"></a>    </span>
<span id="cb118-79"><a href="#cb118-79" tabindex="-1"></a>:</span>
<span id="cb118-80"><a href="#cb118-80" tabindex="-1"></a>    </span>
<span id="cb118-81"><a href="#cb118-81" tabindex="-1"></a>TEUR</span>
<span id="cb118-82"><a href="#cb118-82" tabindex="-1"></a>    </span>
<span id="cb118-83"><a href="#cb118-83" tabindex="-1"></a>2.338.961)</span>
<span id="cb118-84"><a href="#cb118-84" tabindex="-1"></a>5. Schuldverschreibungen und andere festverzinsliche Wertpapiere</span>
<span id="cb118-85"><a href="#cb118-85" tabindex="-1"></a>     a)</span>
<span id="cb118-86"><a href="#cb118-86" tabindex="-1"></a>    </span>
<span id="cb118-87"><a href="#cb118-87" tabindex="-1"></a>    Geldmarktpapiere</span>
<span id="cb118-88"><a href="#cb118-88" tabindex="-1"></a>    </span>
<span id="cb118-89"><a href="#cb118-89" tabindex="-1"></a>         ab)</span>
<span id="cb118-90"><a href="#cb118-90" tabindex="-1"></a>    </span>
<span id="cb118-91"><a href="#cb118-91" tabindex="-1"></a>von</span>
<span id="cb118-92"><a href="#cb118-92" tabindex="-1"></a>    </span>
<span id="cb118-93"><a href="#cb118-93" tabindex="-1"></a>anderen</span>
<span id="cb118-94"><a href="#cb118-94" tabindex="-1"></a>    </span>
<span id="cb118-95"><a href="#cb118-95" tabindex="-1"></a>Emittenten  </span>
<span id="cb118-96"><a href="#cb118-96" tabindex="-1"></a>     b)</span>
<span id="cb118-97"><a href="#cb118-97" tabindex="-1"></a>    </span>
<span id="cb118-98"><a href="#cb118-98" tabindex="-1"></a>    Anleihen</span>
<span id="cb118-99"><a href="#cb118-99" tabindex="-1"></a>    </span>
<span id="cb118-100"><a href="#cb118-100" tabindex="-1"></a>und</span>
<span id="cb118-101"><a href="#cb118-101" tabindex="-1"></a>    </span>
<span id="cb118-102"><a href="#cb118-102" tabindex="-1"></a>Schuldverschreibungen</span>
<span id="cb118-103"><a href="#cb118-103" tabindex="-1"></a>    </span>
<span id="cb118-104"><a href="#cb118-104" tabindex="-1"></a>         ba)</span>
<span id="cb118-105"><a href="#cb118-105" tabindex="-1"></a>    </span>
<span id="cb118-106"><a href="#cb118-106" tabindex="-1"></a>von</span>
<span id="cb118-107"><a href="#cb118-107" tabindex="-1"></a>    </span>
<span id="cb118-108"><a href="#cb118-108" tabindex="-1"></a>öffentlichen</span>
<span id="cb118-109"><a href="#cb118-109" tabindex="-1"></a>    </span>
<span id="cb118-110"><a href="#cb118-110" tabindex="-1"></a>Emittenten</span>
<span id="cb118-111"><a href="#cb118-111" tabindex="-1"></a>    </span>
<span id="cb118-112"><a href="#cb118-112" tabindex="-1"></a>         darunter:</span>
<span id="cb118-113"><a href="#cb118-113" tabindex="-1"></a>    </span>
<span id="cb118-114"><a href="#cb118-114" tabindex="-1"></a>beleihbar</span>
<span id="cb118-115"><a href="#cb118-115" tabindex="-1"></a>    </span>
<span id="cb118-116"><a href="#cb118-116" tabindex="-1"></a>bei</span>
<span id="cb118-117"><a href="#cb118-117" tabindex="-1"></a>    </span>
<span id="cb118-118"><a href="#cb118-118" tabindex="-1"></a>der</span>
<span id="cb118-119"><a href="#cb118-119" tabindex="-1"></a>    </span>
<span id="cb118-120"><a href="#cb118-120" tabindex="-1"></a>Deutschen</span>
<span id="cb118-121"><a href="#cb118-121" tabindex="-1"></a>    </span>
<span id="cb118-122"><a href="#cb118-122" tabindex="-1"></a>Bundesbank</span>
<span id="cb118-123"><a href="#cb118-123" tabindex="-1"></a>    </span>
<span id="cb118-124"><a href="#cb118-124" tabindex="-1"></a>         bb)</span>
<span id="cb118-125"><a href="#cb118-125" tabindex="-1"></a>    </span>
<span id="cb118-126"><a href="#cb118-126" tabindex="-1"></a>von</span>
<span id="cb118-127"><a href="#cb118-127" tabindex="-1"></a>    </span>
<span id="cb118-128"><a href="#cb118-128" tabindex="-1"></a>anderen</span>
<span id="cb118-129"><a href="#cb118-129" tabindex="-1"></a>    </span>
<span id="cb118-130"><a href="#cb118-130" tabindex="-1"></a>Emittenten</span>
<span id="cb118-131"><a href="#cb118-131" tabindex="-1"></a>    </span>
<span id="cb118-132"><a href="#cb118-132" tabindex="-1"></a>         darunter:</span>
<span id="cb118-133"><a href="#cb118-133" tabindex="-1"></a>    </span>
<span id="cb118-134"><a href="#cb118-134" tabindex="-1"></a>beleihbar</span>
<span id="cb118-135"><a href="#cb118-135" tabindex="-1"></a>    </span>
<span id="cb118-136"><a href="#cb118-136" tabindex="-1"></a>bei</span>
<span id="cb118-137"><a href="#cb118-137" tabindex="-1"></a>    </span>
<span id="cb118-138"><a href="#cb118-138" tabindex="-1"></a>der</span>
<span id="cb118-139"><a href="#cb118-139" tabindex="-1"></a>    </span>
<span id="cb118-140"><a href="#cb118-140" tabindex="-1"></a>Deutschen</span>
<span id="cb118-141"><a href="#cb118-141" tabindex="-1"></a>    </span>
<span id="cb118-142"><a href="#cb118-142" tabindex="-1"></a>Bundesbank</span>
<span id="cb118-143"><a href="#cb118-143" tabindex="-1"></a>     c)</span>
<span id="cb118-144"><a href="#cb118-144" tabindex="-1"></a>    </span>
<span id="cb118-145"><a href="#cb118-145" tabindex="-1"></a>    eigene</span>
<span id="cb118-146"><a href="#cb118-146" tabindex="-1"></a>    </span>
<span id="cb118-147"><a href="#cb118-147" tabindex="-1"></a>Schuldverschreibungen</span>
<span id="cb118-148"><a href="#cb118-148" tabindex="-1"></a>         Nennbetrag</span>
<span id="cb118-149"><a href="#cb118-149" tabindex="-1"></a>7. Beteiligungen    </span>
<span id="cb118-150"><a href="#cb118-150" tabindex="-1"></a>    </span>
<span id="cb118-151"><a href="#cb118-151" tabindex="-1"></a>    </span>
<span id="cb118-152"><a href="#cb118-152" tabindex="-1"></a>darunter:</span>
<span id="cb118-153"><a href="#cb118-153" tabindex="-1"></a>        </span>
<span id="cb118-154"><a href="#cb118-154" tabindex="-1"></a>an</span>
<span id="cb118-155"><a href="#cb118-155" tabindex="-1"></a>    </span>
<span id="cb118-156"><a href="#cb118-156" tabindex="-1"></a>Kreditinstituten</span>
<span id="cb118-157"><a href="#cb118-157" tabindex="-1"></a>    </span>
<span id="cb118-158"><a href="#cb118-158" tabindex="-1"></a>TEUR</span>
<span id="cb118-159"><a href="#cb118-159" tabindex="-1"></a>    </span>
<span id="cb118-160"><a href="#cb118-160" tabindex="-1"></a>0</span>
<span id="cb118-161"><a href="#cb118-161" tabindex="-1"></a>    </span>
<span id="cb118-162"><a href="#cb118-162" tabindex="-1"></a>(31.12.2005</span>
<span id="cb118-163"><a href="#cb118-163" tabindex="-1"></a>    </span>
<span id="cb118-164"><a href="#cb118-164" tabindex="-1"></a>:</span>
<span id="cb118-165"><a href="#cb118-165" tabindex="-1"></a>    </span>
<span id="cb118-166"><a href="#cb118-166" tabindex="-1"></a>TEUR</span>
<span id="cb118-167"><a href="#cb118-167" tabindex="-1"></a>    </span>
<span id="cb118-168"><a href="#cb118-168" tabindex="-1"></a>0)</span>
<span id="cb118-169"><a href="#cb118-169" tabindex="-1"></a>8. </span>
<span id="cb118-170"><a href="#cb118-170" tabindex="-1"></a>a</span>
<span id="cb118-171"><a href="#cb118-171" tabindex="-1"></a>nteile an verbundenen Unternehmen</span>
<span id="cb118-172"><a href="#cb118-172" tabindex="-1"></a>    </span>
<span id="cb118-173"><a href="#cb118-173" tabindex="-1"></a>    </span>
<span id="cb118-174"><a href="#cb118-174" tabindex="-1"></a>darunter:</span>
<span id="cb118-175"><a href="#cb118-175" tabindex="-1"></a>        </span>
<span id="cb118-176"><a href="#cb118-176" tabindex="-1"></a>an</span>
<span id="cb118-177"><a href="#cb118-177" tabindex="-1"></a>    </span>
<span id="cb118-178"><a href="#cb118-178" tabindex="-1"></a>Kreditinstituten</span>
<span id="cb118-179"><a href="#cb118-179" tabindex="-1"></a>    </span>
<span id="cb118-180"><a href="#cb118-180" tabindex="-1"></a>TEUR</span>
<span id="cb118-181"><a href="#cb118-181" tabindex="-1"></a>    </span>
<span id="cb118-182"><a href="#cb118-182" tabindex="-1"></a>0</span>
<span id="cb118-183"><a href="#cb118-183" tabindex="-1"></a>    </span>
<span id="cb118-184"><a href="#cb118-184" tabindex="-1"></a>(31.12.2005</span>
<span id="cb118-185"><a href="#cb118-185" tabindex="-1"></a>    </span>
<span id="cb118-186"><a href="#cb118-186" tabindex="-1"></a>:</span>
<span id="cb118-187"><a href="#cb118-187" tabindex="-1"></a>    </span>
<span id="cb118-188"><a href="#cb118-188" tabindex="-1"></a>TEUR</span>
<span id="cb118-189"><a href="#cb118-189" tabindex="-1"></a>    </span>
<span id="cb118-190"><a href="#cb118-190" tabindex="-1"></a>0)</span>
<span id="cb118-191"><a href="#cb118-191" tabindex="-1"></a>9. </span>
<span id="cb118-192"><a href="#cb118-192" tabindex="-1"></a>t</span>
<span id="cb118-193"><a href="#cb118-193" tabindex="-1"></a>reuhandvermögen</span>
<span id="cb118-194"><a href="#cb118-194" tabindex="-1"></a>    </span>
<span id="cb118-195"><a href="#cb118-195" tabindex="-1"></a>    darunter:</span>
<span id="cb118-196"><a href="#cb118-196" tabindex="-1"></a>    </span>
<span id="cb118-197"><a href="#cb118-197" tabindex="-1"></a>Treuhandkredite</span>
<span id="cb118-198"><a href="#cb118-198" tabindex="-1"></a>11. Immaterielle </span>
<span id="cb118-199"><a href="#cb118-199" tabindex="-1"></a>a</span>
<span id="cb118-200"><a href="#cb118-200" tabindex="-1"></a>nlagewerte</span>
<span id="cb118-201"><a href="#cb118-201" tabindex="-1"></a>12. Sachanlagen</span>
<span id="cb118-202"><a href="#cb118-202" tabindex="-1"></a>15. Sonstige </span>
<span id="cb118-203"><a href="#cb118-203" tabindex="-1"></a>v</span>
<span id="cb118-204"><a href="#cb118-204" tabindex="-1"></a>ermögensgegenstände</span>
<span id="cb118-205"><a href="#cb118-205" tabindex="-1"></a>16. </span>
<span id="cb118-206"><a href="#cb118-206" tabindex="-1"></a>r</span>
<span id="cb118-207"><a href="#cb118-207" tabindex="-1"></a>echnungsabgrenzungsposten</span>
<span id="cb118-208"><a href="#cb118-208" tabindex="-1"></a>Summe der </span>
<span id="cb118-209"><a href="#cb118-209" tabindex="-1"></a>a</span>
<span id="cb118-210"><a href="#cb118-210" tabindex="-1"></a>ktiva</span>
<span id="cb118-211"><a href="#cb118-211" tabindex="-1"></a>19.823</span>
<span id="cb118-212"><a href="#cb118-212" tabindex="-1"></a> </span>
<span id="cb118-213"><a href="#cb118-213" tabindex="-1"></a> </span>
<span id="cb118-214"><a href="#cb118-214" tabindex="-1"></a>132.272</span>
<span id="cb118-215"><a href="#cb118-215" tabindex="-1"></a>1.562.290</span>
<span id="cb118-216"><a href="#cb118-216" tabindex="-1"></a>24.138</span>
<span id="cb118-217"><a href="#cb118-217" tabindex="-1"></a>126.223</span>
<span id="cb118-218"><a href="#cb118-218" tabindex="-1"></a>126.223 </span>
<span id="cb118-219"><a href="#cb118-219" tabindex="-1"></a>3.115.852</span>
<span id="cb118-220"><a href="#cb118-220" tabindex="-1"></a>2.976.213</span>
<span id="cb118-221"><a href="#cb118-221" tabindex="-1"></a>718</span>
<span id="cb118-222"><a href="#cb118-222" tabindex="-1"></a>718</span>
<span id="cb118-223"><a href="#cb118-223" tabindex="-1"></a>101.246</span>
<span id="cb118-224"><a href="#cb118-224" tabindex="-1"></a>19.823</span>
<span id="cb118-225"><a href="#cb118-225" tabindex="-1"></a>1.694.562</span>
<span id="cb118-226"><a href="#cb118-226" tabindex="-1"></a>14.758.008</span>
<span id="cb118-227"><a href="#cb118-227" tabindex="-1"></a>3.266.931</span>
<span id="cb118-228"><a href="#cb118-228" tabindex="-1"></a>11.440</span>
<span id="cb118-229"><a href="#cb118-229" tabindex="-1"></a>178.004</span>
<span id="cb118-230"><a href="#cb118-230" tabindex="-1"></a>101.246</span>
<span id="cb118-231"><a href="#cb118-231" tabindex="-1"></a>10.038</span>
<span id="cb118-232"><a href="#cb118-232" tabindex="-1"></a>46.863</span>
<span id="cb118-233"><a href="#cb118-233" tabindex="-1"></a>141.626</span>
<span id="cb118-234"><a href="#cb118-234" tabindex="-1"></a>17.804</span>
<span id="cb118-235"><a href="#cb118-235" tabindex="-1"></a>20.246.345</span>
<span id="cb118-236"><a href="#cb118-236" tabindex="-1"></a>28.873</span>
<span id="cb118-237"><a href="#cb118-237" tabindex="-1"></a>2.195.434</span>
<span id="cb118-238"><a href="#cb118-238" tabindex="-1"></a>205.129</span>
<span id="cb118-239"><a href="#cb118-239" tabindex="-1"></a>1.990.305</span>
<span id="cb118-240"><a href="#cb118-240" tabindex="-1"></a>14.728.310</span>
<span id="cb118-241"><a href="#cb118-241" tabindex="-1"></a>1.682.660</span>
<span id="cb118-242"><a href="#cb118-242" tabindex="-1"></a>0</span>
<span id="cb118-243"><a href="#cb118-243" tabindex="-1"></a>49.152</span>
<span id="cb118-244"><a href="#cb118-244" tabindex="-1"></a>49.152</span>
<span id="cb118-245"><a href="#cb118-245" tabindex="-1"></a>1.585.752</span>
<span id="cb118-246"><a href="#cb118-246" tabindex="-1"></a>1.585.752</span>
<span id="cb118-247"><a href="#cb118-247" tabindex="-1"></a>47.756</span>
<span id="cb118-248"><a href="#cb118-248" tabindex="-1"></a>47.722</span>
<span id="cb118-249"><a href="#cb118-249" tabindex="-1"></a>11.440</span>
<span id="cb118-250"><a href="#cb118-250" tabindex="-1"></a>178.004</span>
<span id="cb118-251"><a href="#cb118-251" tabindex="-1"></a>103.297</span>
<span id="cb118-252"><a href="#cb118-252" tabindex="-1"></a>103.297</span>
<span id="cb118-253"><a href="#cb118-253" tabindex="-1"></a>17.705</span>
<span id="cb118-254"><a href="#cb118-254" tabindex="-1"></a>50.334</span>
<span id="cb118-255"><a href="#cb118-255" tabindex="-1"></a>141.791</span>
<span id="cb118-256"><a href="#cb118-256" tabindex="-1"></a>11.957</span>
<span id="cb118-257"><a href="#cb118-257" tabindex="-1"></a>19.149.805</span>
<span id="cb118-258"><a href="#cb118-258" tabindex="-1"></a>Jahresabschluss  | Jahresbilanz&#39;</span></code></pre></div>
<!--chapter:end:13_Appendix.Rmd-->
</div>
</div>
<div id="tables" class="section level1 hasAnchor" number="13">
<h1 class="hasAnchor"><span class="header-section-number">13</span> Tables<a href="#tables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="classification-1" class="section level2 hasAnchor" number="13.1">
<h2 class="hasAnchor"><span class="header-section-number">13.1</span> Classification<a href="#classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>df_classification_n_examples <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llrrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing the actual number of provided examples depending on the classification type, example selection strategy and chosen parameter n_examples.&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>))</span></code></pre></div>
</details>
<pre><code>## &lt;table&gt;
## &lt;caption&gt;(#tab:comparing-actual-number-of-in-context-examples)Comparing the actual number of provided examples depending on the classification type, example selection strategy and chosen parameter n_examples.&lt;/caption&gt;
## &lt;/table&gt;</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-97362b8615fe2b7c24b3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-97362b8615fe2b7c24b3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26"],["n_<wbr>random_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>random_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples","top_<wbr>n_<wbr>rag_<wbr>examples"],["binary","binary","binary","multi","multi","multi","binary","binary","binary","multi","multi","multi","binary","binary","binary","binary","binary","binary","binary","multi","multi","multi","multi","multi","multi","multi"],["1","3","5","1","3","5","1","3","5","1","3","5","1","3","5","7","9","11","13","1","3","5","7","9","11","13"],["1","3","5","1","3","5","1","3","5","1","3","5",null,null,null,null,null,null,null,null,null,null,null,null,null,null],["1","1","2","1","3","5","1","1","2","1","3","5",null,null,null,null,null,null,null,null,null,null,null,null,null,null],["4","6","11","4","12","20","4","6","11","4","12","20","1","3","5","7","9","11","13","1","3","5","7","9","11","13"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>approach<\/th>\n      <th>classification<\/th>\n      <th>n example<\/th>\n      <th>target<\/th>\n      <th>other<\/th>\n      <th>sum<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"approach","targets":1},{"name":"classification","targets":2},{"name":"n example","targets":3},{"name":"target","targets":4},{"name":"other","targets":5},{"name":"sum","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="table-extraction-3" class="section level2 hasAnchor" number="13.2">
<h2 class="hasAnchor"><span class="header-section-number">13.2</span> Table extraction<a href="#table-extraction-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hybrid-approach-2" class="section level3 hasAnchor" number="13.2.1">
<h3 class="hasAnchor"><span class="header-section-number">13.2.1</span> Hybrid approach<a href="#hybrid-approach-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a>median_models_with_examples <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a>    <span class="at">delta_real_synth =</span> median_real<span class="sc">-</span>median_synth,</span>
<span id="cb121-4"><a href="#cb121-4" tabindex="-1"></a>    <span class="at">delta_rate_real_synth =</span> (delta_real_synth)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>median_synth),</span>
<span id="cb121-5"><a href="#cb121-5" tabindex="-1"></a>    <span class="at">delta_synth_zero =</span> median_synth<span class="sc">-</span>median_zero_shot,</span>
<span id="cb121-6"><a href="#cb121-6" tabindex="-1"></a>    <span class="at">delta_rate_synth_zero =</span> (delta_synth_zero)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>median_zero_shot)</span>
<span id="cb121-7"><a href="#cb121-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb121-8"><a href="#cb121-8" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb121-9"><a href="#cb121-9" tabindex="-1"></a>    is.numeric, </span>
<span id="cb121-10"><a href="#cb121-10" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb121-11"><a href="#cb121-11" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb121-12"><a href="#cb121-12" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb121-13"><a href="#cb121-13" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb121-14"><a href="#cb121-14" tabindex="-1"></a>    )</span>
<span id="cb121-15"><a href="#cb121-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb121-16"><a href="#cb121-16" tabindex="-1"></a>    model, <span class="co"># method, </span></span>
<span id="cb121-17"><a href="#cb121-17" tabindex="-1"></a>    median_real, median_synth, median_zero_shot, </span>
<span id="cb121-18"><a href="#cb121-18" tabindex="-1"></a>    <span class="co"># delta_real_synth, delta_synth_zero, </span></span>
<span id="cb121-19"><a href="#cb121-19" tabindex="-1"></a>    delta_rate_real_synth, delta_rate_synth_zero</span>
<span id="cb121-20"><a href="#cb121-20" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb121-21"><a href="#cb121-21" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb121-22"><a href="#cb121-22" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrrrrr&quot;</span>,</span>
<span id="cb121-23"><a href="#cb121-23" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing extraction performance for real Aktiva extraction task with synthetic and real examples for in-context learning with a zero shot approach averaged over all methods&quot;</span>,</span>
<span id="cb121-24"><a href="#cb121-24" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
(#tab:comparing-extraction-performance-real-and-synth-context-learning-median)Comparing extraction performance for real Aktiva extraction task with synthetic and real examples for in-context learning with a zero shot approach averaged over all methods
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c9a5d1155f214ca3b9b6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c9a5d1155f214ca3b9b6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Qwen3-235B-A22B-Instruct-2507-FP8","Llama-4-Scout-17B-16E-Instruct","Mistral-Large-Instruct-2411","Llama-3.1-8B-Instruct","Qwen3-8B","Ministral-8B-Instruct-2410","gemma-3-27b-it","gemma-3-12b-it"],["<b>0.983<\/b>","0.931","0.966","0.828","0.931","0.862","0.862","0.793"],["<b>0.966<\/b>","0.897","0.897","0.759","0.759","0.741","0.672","0.5"],["<b>0.897<\/b>","0.448","0.776","0.552","0.336","0.552","0.207","0.543"],["0.5","0.33","0.67","0.286","<b>0.714<\/b>","0.467","0.579","0.586"],["0.67","<b>0.813<\/b>","0.54","0.462","0.637","0.422","0.586","-0.094"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>median real<\/th>\n      <th>median synth<\/th>\n      <th>median zero shot<\/th>\n      <th>delta rate real synth<\/th>\n      <th>delta rate synth zero<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"t","columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"targets":6,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"median real","targets":2},{"name":"median synth","targets":3},{"name":"median zero shot","targets":4},{"name":"delta rate real synth","targets":5},{"name":"delta rate synth zero","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<!--chapter:end:14_Tables.Rmd-->
</div>
</div>
</div>
<div id="figures" class="section level1 hasAnchor" number="14">
<h1 class="hasAnchor"><span class="header-section-number">14</span> Figures<a href="#figures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>NA predicting</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb122-2"><a href="#cb122-2" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">29</span>) {</span>
<span id="cb122-4"><a href="#cb122-4" tabindex="-1"></a>  <span class="co"># print(i)</span></span>
<span id="cb122-5"><a href="#cb122-5" tabindex="-1"></a>  precision <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">29</span><span class="sc">-</span>i)<span class="sc">/</span><span class="dv">58</span></span>
<span id="cb122-6"><a href="#cb122-6" tabindex="-1"></a>  recall <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb122-7"><a href="#cb122-7" tabindex="-1"></a>  F1 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall<span class="sc">/</span>(precision<span class="sc">+</span>recall)</span>
<span id="cb122-8"><a href="#cb122-8" tabindex="-1"></a>  metrics[[i]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">i =</span> i, <span class="at">perc_correct_num =</span> <span class="dv">0</span>, <span class="at">F1 =</span> F1, <span class="at">perc_correct_total =</span> (<span class="dv">58-2</span><span class="sc">*</span>i)<span class="sc">/</span><span class="dv">58</span>)</span>
<span id="cb122-9"><a href="#cb122-9" tabindex="-1"></a>}</span>
<span id="cb122-10"><a href="#cb122-10" tabindex="-1"></a></span>
<span id="cb122-11"><a href="#cb122-11" tabindex="-1"></a>metrics <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> <span class="fu">unnest_wider</span>(<span class="st">&quot;.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-12"><a href="#cb122-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>i, <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-13"><a href="#cb122-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb122-14"><a href="#cb122-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">2</span><span class="sc">*</span>i, <span class="at">y =</span> value, <span class="at">color =</span> metric)) <span class="sc">+</span></span>
<span id="cb122-15"><a href="#cb122-15" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">10</span>, <span class="at">linetype =</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb122-16"><a href="#cb122-16" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">40</span>, <span class="at">linetype =</span><span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb122-17"><a href="#cb122-17" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb122-18"><a href="#cb122-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;number of numeric values in ground truth&quot;</span>,</span>
<span id="cb122-19"><a href="#cb122-19" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;metric score&quot;</span></span>
<span id="cb122-20"><a href="#cb122-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/display-extraction-metrics-full-NA-1.png" alt="Displaying the performance metrics a LLMs response would have, if all predictions are 'null'. The area between the two dashed lines shows the number of numeric values found in the real Aktiva tables." width="100%" />
<p class="caption">
(#fig:display-extraction-metrics-full-NA)Displaying the performance metrics a LLMs response would have, if all predictions are ‘null’. The area between the two dashed lines shows the number of numeric values found in the real Aktiva tables.
</p>
</div>
<div id="page-identification-5" class="section level2 hasAnchor" number="14.1">
<h2 class="hasAnchor"><span class="header-section-number">14.1</span> Page identification<a href="#page-identification-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="regex-baseline-1" class="section level3 hasAnchor" number="14.1.1">
<h3 class="hasAnchor"><span class="header-section-number">14.1.1</span> Regex baseline<a href="#regex-baseline-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a>metrics_plot_regex_page_identification</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-1.png" alt="Comparing page identification metrics for different regular expressions for each classification task by type of the target table." width="100%" />
<p class="caption">
(#fig:display-metrics-plot-regex-page-identification)Comparing page identification metrics for different regular expressions for each classification task by type of the target table.
</p>
</div>
</div>
<div id="toc-understanding-1" class="section level3 hasAnchor" number="14.1.2">
<h3 class="hasAnchor"><span class="header-section-number">14.1.2</span> TOC understanding<a href="#toc-understanding-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a>balanced_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range, <span class="at">colour =</span> min_distance <span class="sc">&lt;=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb124-4"><a href="#cb124-4" tabindex="-1"></a>    <span class="at">data =</span> balanced_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb124-5"><a href="#cb124-5" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb124-6"><a href="#cb124-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb124-7"><a href="#cb124-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb124-8"><a href="#cb124-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb124-9"><a href="#cb124-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb124-10"><a href="#cb124-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb124-11"><a href="#cb124-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb124-12"><a href="#cb124-12" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb124-13"><a href="#cb124-13" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb124-14"><a href="#cb124-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb124-15"><a href="#cb124-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb124-16"><a href="#cb124-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="co"># +</span></span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/page-identification-toc-analysis-balanced-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
(#fig:page-identification-toc-analysis-balanced)Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a>  <span class="co">#   legend.position = &quot;bottom&quot;</span></span>
<span id="cb125-3"><a href="#cb125-3" tabindex="-1"></a>  <span class="co"># )</span></span></code></pre></div>
</details>
</div>
<div id="classification-2" class="section level3 hasAnchor" number="14.1.3">
<h3 class="hasAnchor"><span class="header-section-number">14.1.3</span> Classification<a href="#classification-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="binary" class="section level4 hasAnchor" number="14.1.3.1">
<h4 class="hasAnchor"><span class="header-section-number">14.1.3.1</span> Binary<a href="#binary" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Binary classification F1 score over runtime limited to 60 minutes</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a>design <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb126-2"><a href="#cb126-2" tabindex="-1"></a><span class="st">ABCD##X</span></span>
<span id="cb126-3"><a href="#cb126-3" tabindex="-1"></a><span class="st">EFGHI#Y</span></span>
<span id="cb126-4"><a href="#cb126-4" tabindex="-1"></a><span class="st">JKL####</span></span>
<span id="cb126-5"><a href="#cb126-5" tabindex="-1"></a><span class="st">MNOPQRS</span></span>
<span id="cb126-6"><a href="#cb126-6" tabindex="-1"></a><span class="st">TUVW###</span></span>
<span id="cb126-7"><a href="#cb126-7" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb126-8"><a href="#cb126-8" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-10"><a href="#cb126-10" tabindex="-1"></a>  <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb126-11"><a href="#cb126-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm_runtime =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-12"><a href="#cb126-12" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb126-13"><a href="#cb126-13" tabindex="-1"></a>  <span class="co"># left_join(model_letters, by = &quot;model&quot;) %&gt;%</span></span>
<span id="cb126-14"><a href="#cb126-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb126-15"><a href="#cb126-15" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb126-16"><a href="#cb126-16" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb126-17"><a href="#cb126-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb126-18"><a href="#cb126-18" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-19"><a href="#cb126-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb126-20"><a href="#cb126-20" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb126-21"><a href="#cb126-21" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_classification), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb126-22"><a href="#cb126-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-23"><a href="#cb126-23" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb126-24"><a href="#cb126-24" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb126-25"><a href="#cb126-25" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb126-26"><a href="#cb126-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb126-27"><a href="#cb126-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-28"><a href="#cb126-28" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/binary-classification-performance-over-runtime-1.png" alt="Comparing F1 score over normalized runtime for binary classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 60 minutes of runtime." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:binary-classification-performance-over-runtime)Comparing F1 score over normalized runtime for binary classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 60 minutes of runtime.
</p>
</div>
<p>Binary classification F1 score over runtime unlimited</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" tabindex="-1"></a>  <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb127-3"><a href="#cb127-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm_runtime =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="#cb127-4" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb127-5"><a href="#cb127-5" tabindex="-1"></a>  <span class="co"># left_join(model_letters, by = &quot;model&quot;) %&gt;%</span></span>
<span id="cb127-6"><a href="#cb127-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb127-7"><a href="#cb127-7" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb127-8"><a href="#cb127-8" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb127-9"><a href="#cb127-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb127-10"><a href="#cb127-10" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-11"><a href="#cb127-11" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb127-12"><a href="#cb127-12" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb127-13"><a href="#cb127-13" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_classification), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb127-14"><a href="#cb127-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-15"><a href="#cb127-15" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb127-16"><a href="#cb127-16" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb127-17"><a href="#cb127-17" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb127-18"><a href="#cb127-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-19"><a href="#cb127-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/binary-classification-performance-over-runtime-full-time-1.png" alt="Comparing F1 score over normalized runtime for binary classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:binary-classification-performance-over-runtime-full-time)Comparing F1 score over normalized runtime for binary classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded.
</p>
</div>
</div>
<div id="multi-class-classification-2" class="section level4 hasAnchor" number="14.1.3.2">
<h4 class="hasAnchor"><span class="header-section-number">14.1.3.2</span> Multi-class classification<a href="#multi-class-classification-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Multi-class classification micro minorites F1 score over runtime limited to 60 minutes</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a>design <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb128-2"><a href="#cb128-2" tabindex="-1"></a><span class="st">ABCD##X</span></span>
<span id="cb128-3"><a href="#cb128-3" tabindex="-1"></a><span class="st">EFGHI#Y</span></span>
<span id="cb128-4"><a href="#cb128-4" tabindex="-1"></a><span class="st">JKL####</span></span>
<span id="cb128-5"><a href="#cb128-5" tabindex="-1"></a><span class="st">MNOPQRS</span></span>
<span id="cb128-6"><a href="#cb128-6" tabindex="-1"></a><span class="st">TUVW###</span></span>
<span id="cb128-7"><a href="#cb128-7" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb128-8"><a href="#cb128-8" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" tabindex="-1"></a>df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">==</span> <span class="st">&quot;micro_minorities&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-10"><a href="#cb128-10" tabindex="-1"></a>  <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb128-11"><a href="#cb128-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm_runtime =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-12"><a href="#cb128-12" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-13"><a href="#cb128-13" tabindex="-1"></a>  <span class="co"># left_join(model_letters, by = &quot;model&quot;) %&gt;%</span></span>
<span id="cb128-14"><a href="#cb128-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb128-15"><a href="#cb128-15" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb128-16"><a href="#cb128-16" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb128-17"><a href="#cb128-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb128-18"><a href="#cb128-18" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-19"><a href="#cb128-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb128-20"><a href="#cb128-20" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb128-21"><a href="#cb128-21" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_classification), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb128-22"><a href="#cb128-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-23"><a href="#cb128-23" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb128-24"><a href="#cb128-24" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb128-25"><a href="#cb128-25" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb128-26"><a href="#cb128-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb128-27"><a href="#cb128-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-28"><a href="#cb128-28" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/multi-classification-performance-over-runtime-1.png" alt="Comparing F1 score over normalized runtime for multi-class classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 60 minutes of runtime." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:multi-classification-performance-over-runtime)Comparing F1 score over normalized runtime for multi-class classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 60 minutes of runtime.
</p>
</div>
<p>Multi-class classification micro minorites F1 score over runtime</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a>design <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb129-2"><a href="#cb129-2" tabindex="-1"></a><span class="st">ABCD##X</span></span>
<span id="cb129-3"><a href="#cb129-3" tabindex="-1"></a><span class="st">EFGHI#Y</span></span>
<span id="cb129-4"><a href="#cb129-4" tabindex="-1"></a><span class="st">JKL####</span></span>
<span id="cb129-5"><a href="#cb129-5" tabindex="-1"></a><span class="st">MNOPQRS</span></span>
<span id="cb129-6"><a href="#cb129-6" tabindex="-1"></a><span class="st">TUVW###</span></span>
<span id="cb129-7"><a href="#cb129-7" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb129-8"><a href="#cb129-8" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" tabindex="-1"></a>df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">==</span> <span class="st">&quot;micro_minorities&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-10"><a href="#cb129-10" tabindex="-1"></a>  <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_classification) <span class="sc">%&gt;%</span> </span>
<span id="cb129-11"><a href="#cb129-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm_runtime =</span> norm_runtime<span class="sc">/</span><span class="dv">60</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-12"><a href="#cb129-12" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-13"><a href="#cb129-13" tabindex="-1"></a>  <span class="co"># left_join(model_letters, by = &quot;model&quot;) %&gt;%</span></span>
<span id="cb129-14"><a href="#cb129-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb129-15"><a href="#cb129-15" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb129-16"><a href="#cb129-16" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb129-17"><a href="#cb129-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb129-18"><a href="#cb129-18" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-19"><a href="#cb129-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb129-20"><a href="#cb129-20" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb129-21"><a href="#cb129-21" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_classification), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb129-22"><a href="#cb129-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb129-23"><a href="#cb129-23" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb129-24"><a href="#cb129-24" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb129-25"><a href="#cb129-25" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb129-26"><a href="#cb129-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb129-27"><a href="#cb129-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/multi-classification-performance-over-runtime-full-time-1.png" alt="Comparing F1 score over normalized runtime for multi-class classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:multi-classification-performance-over-runtime-full-time)Comparing F1 score over normalized runtime for multi-class classification task. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span></span>
<span id="cb130-2"><a href="#cb130-2" tabindex="-1"></a>method_name <span class="ot">&lt;-</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb130-3"><a href="#cb130-3" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" tabindex="-1"></a>df_temp_llama_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="#cb130-5" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb130-6"><a href="#cb130-6" tabindex="-1"></a>    model <span class="sc">==</span> model_name,</span>
<span id="cb130-7"><a href="#cb130-7" tabindex="-1"></a>    method <span class="sc">==</span> method_name</span>
<span id="cb130-8"><a href="#cb130-8" tabindex="-1"></a>  ) <span class="co"># %&gt;% unnest(metrics) # %&gt;% calc_micro_f1(model, method)</span></span>
<span id="cb130-9"><a href="#cb130-9" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp_llama_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-10"><a href="#cb130-10" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp_llama_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-11"><a href="#cb130-11" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp_llama_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-12"><a href="#cb130-12" tabindex="-1"></a></span>
<span id="cb130-13"><a href="#cb130-13" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb130-14"><a href="#cb130-14" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb130-15"><a href="#cb130-15" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="fu">str_c</span>(model_name, <span class="st">&quot; with &quot;</span>, method_name))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/micro-pr-curve-llm-multi-llama-scout-1.png" alt="Showing the precsion-recall-curve for Llama-4-Scout-17B-16E-Instruct." width="100%" />
<p class="caption">
(#fig:micro-pr-curve-llm-multi-llama-scout)Showing the precsion-recall-curve for Llama-4-Scout-17B-16E-Instruct.
</p>
</div>
</div>
</div>
</div>
<div id="table-extraction-4" class="section level2 hasAnchor" number="14.2">
<h2 class="hasAnchor"><span class="header-section-number">14.2</span> Table extraction<a href="#table-extraction-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a>df_overview_synth <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">target_data =</span> <span class="st">&quot;synth&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="#cb131-2" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb131-3"><a href="#cb131-3" tabindex="-1"></a>    df_overview <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">%in%</span> df_overview_synth<span class="sc">$</span>model) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb131-5"><a href="#cb131-5" tabindex="-1"></a>        <span class="at">target_data =</span> <span class="st">&quot;real&quot;</span>, </span>
<span id="cb131-6"><a href="#cb131-6" tabindex="-1"></a>        <span class="at">n_examples =</span> <span class="fu">factor</span>(</span>
<span id="cb131-7"><a href="#cb131-7" tabindex="-1"></a>          n_examples, </span>
<span id="cb131-8"><a href="#cb131-8" tabindex="-1"></a>          <span class="at">levels =</span> <span class="fu">levels</span>(df_overview_synth<span class="sc">$</span>n_examples), </span>
<span id="cb131-9"><a href="#cb131-9" tabindex="-1"></a>          <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb131-10"><a href="#cb131-10" tabindex="-1"></a>          )</span>
<span id="cb131-11"><a href="#cb131-11" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>request_tokens)</span>
<span id="cb131-12"><a href="#cb131-12" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">as.numeric</span>(n_examples) <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-13"><a href="#cb131-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb131-14"><a href="#cb131-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> synth_table_extraction_regex_total_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb131-15"><a href="#cb131-15" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> target_data, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb131-16"><a href="#cb131-16" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb131-17"><a href="#cb131-17" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> model_family<span class="sc">+</span>model) <span class="sc">+</span></span>
<span id="cb131-18"><a href="#cb131-18" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb131-19"><a href="#cb131-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb131-20"><a href="#cb131-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/comparing-table-extraction-performance-among-real-and-synth-aktiva-data-1.png" alt="Comparing the table extraction performance among real and synthetic Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:comparing-table-extraction-performance-among-real-and-synth-aktiva-data)Comparing the table extraction performance among real and synthetic Aktiva tables
</p>
</div>
<div id="regex-approach" class="section level3 hasAnchor" number="14.2.1">
<h3 class="hasAnchor"><span class="header-section-number">14.2.1</span> Regex approach<a href="#regex-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="real-tables-3" class="section level4 hasAnchor" number="14.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">14.2.1.1</span> Real tables<a href="#real-tables-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a>real_table_extraction_regex_shap_plot</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/real-table-extraction-regex-shap-plot-1.png" alt="Mean absolute SHAP values and beeswarm plots for real table extraction with regular expression approach" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:real-table-extraction-regex-shap-plot)Mean absolute SHAP values and beeswarm plots for real table extraction with regular expression approach
</p>
</div>
</div>
<div id="synthetic-tables-2" class="section level4 hasAnchor" number="14.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">14.2.1.2</span> Synthetic tables<a href="#synthetic-tables-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a>synth_table_extraction_regex_shap_plot</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-regex-shap-plot-1.png" alt="Mean absolute SHAP values and beeswarm plots for synth table extraction with regular expression approach" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:synth-table-extraction-regex-shap-plot)Mean absolute SHAP values and beeswarm plots for synth table extraction with regular expression approach
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a>shap_f1_extraction_backend</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-regex-dependence-plot-backend-1.png" alt="Showing the interactions of the extraction backend pdfium with the table characteristics for F1 score." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:synth-table-extraction-regex-dependence-plot-backend)Showing the interactions of the extraction backend pdfium with the table characteristics for F1 score.
</p>
</div>
</div>
</div>
<div id="real-tables-4" class="section level3 hasAnchor" number="14.2.2">
<h3 class="hasAnchor"><span class="header-section-number">14.2.2</span> Real tables<a href="#real-tables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a>design <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a>   <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">29</span>,<span class="dv">30</span>,  </span>
<span id="cb135-3"><a href="#cb135-3" tabindex="-1"></a>   <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,<span class="dv">10</span>,<span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb135-4"><a href="#cb135-4" tabindex="-1"></a>  <span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,</span>
<span id="cb135-5"><a href="#cb135-5" tabindex="-1"></a>  <span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="cn">NA</span>,</span>
<span id="cb135-6"><a href="#cb135-6" tabindex="-1"></a>  <span class="dv">21</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">28</span></span>
<span id="cb135-7"><a href="#cb135-7" tabindex="-1"></a>  ), <span class="dv">5</span>, <span class="dv">8</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb135-8"><a href="#cb135-8" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" tabindex="-1"></a>df_overview <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb135-10"><a href="#cb135-10" tabindex="-1"></a>  model, method, method_family, out_of_company, n_examples</span>
<span id="cb135-11"><a href="#cb135-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-12"><a href="#cb135-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_examples =</span> <span class="fu">str_remove</span>(<span class="fu">as.character</span>(n_examples), <span class="st">&quot;n = &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb135-13"><a href="#cb135-13" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb135-14"><a href="#cb135-14" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb135-15"><a href="#cb135-15" tabindex="-1"></a>    <span class="at">mean_runtime =</span> <span class="fu">mean</span>(normalized_runtime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb135-16"><a href="#cb135-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb135-17"><a href="#cb135-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_runtime, <span class="at">y =</span> mean_total)) <span class="sc">+</span></span>
<span id="cb135-18"><a href="#cb135-18" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb135-19"><a href="#cb135-19" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb135-20"><a href="#cb135-20" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb135-21"><a href="#cb135-21" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb135-22"><a href="#cb135-22" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb135-23"><a href="#cb135-23" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb135-24"><a href="#cb135-24" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb135-25"><a href="#cb135-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb135-26"><a href="#cb135-26" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb135-27"><a href="#cb135-27" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb135-28"><a href="#cb135-28" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb135-29"><a href="#cb135-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb135-30"><a href="#cb135-30" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>) <span class="sc">+</span></span>
<span id="cb135-31"><a href="#cb135-31" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/real-table-extraction-performance-over-runtime-1.png" alt="Comparing percentage of correct predictions total over the normalized runtime. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 5 minutes of runtime." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:real-table-extraction-performance-over-runtime)Comparing percentage of correct predictions total over the normalized runtime. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Focussing on small models showing only 5 minutes of runtime.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a>design <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a>   <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="dv">29</span>,<span class="dv">30</span>,  </span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a>   <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,<span class="dv">10</span>,<span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb136-4"><a href="#cb136-4" tabindex="-1"></a>  <span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,</span>
<span id="cb136-5"><a href="#cb136-5" tabindex="-1"></a>  <span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="cn">NA</span>,</span>
<span id="cb136-6"><a href="#cb136-6" tabindex="-1"></a>  <span class="dv">21</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">27</span>,<span class="dv">28</span></span>
<span id="cb136-7"><a href="#cb136-7" tabindex="-1"></a>  ), <span class="dv">5</span>, <span class="dv">8</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-8"><a href="#cb136-8" tabindex="-1"></a></span>
<span id="cb136-9"><a href="#cb136-9" tabindex="-1"></a>df_overview <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(</span>
<span id="cb136-10"><a href="#cb136-10" tabindex="-1"></a>  model, method, method_family, out_of_company, n_examples</span>
<span id="cb136-11"><a href="#cb136-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-12"><a href="#cb136-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_examples =</span> <span class="fu">str_remove</span>(<span class="fu">as.character</span>(n_examples), <span class="st">&quot;n = &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-13"><a href="#cb136-13" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb136-14"><a href="#cb136-14" tabindex="-1"></a>    <span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb136-15"><a href="#cb136-15" tabindex="-1"></a>    <span class="at">mean_runtime =</span> <span class="fu">mean</span>(normalized_runtime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb136-16"><a href="#cb136-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-17"><a href="#cb136-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_runtime, <span class="at">y =</span> mean_total)) <span class="sc">+</span></span>
<span id="cb136-18"><a href="#cb136-18" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = recall)) +</span></span>
<span id="cb136-19"><a href="#cb136-19" tabindex="-1"></a>  <span class="co"># ggplot(aes(x = norm_runtime, y = precision)) +</span></span>
<span id="cb136-20"><a href="#cb136-20" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb136-21"><a href="#cb136-21" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb136-22"><a href="#cb136-22" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb136-23"><a href="#cb136-23" tabindex="-1"></a>  <span class="co"># facet_grid(classification_type~model) +</span></span>
<span id="cb136-24"><a href="#cb136-24" tabindex="-1"></a>  ggh4x<span class="sc">::</span><span class="fu">facet_manual</span>(<span class="sc">~</span><span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size), <span class="at">design =</span> design) <span class="sc">+</span></span>
<span id="cb136-25"><a href="#cb136-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb136-26"><a href="#cb136-26" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb136-27"><a href="#cb136-27" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>),</span>
<span id="cb136-28"><a href="#cb136-28" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb136-29"><a href="#cb136-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb136-30"><a href="#cb136-30" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;normalized runtime in minutes&quot;</span>)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/real-table-extraction-performance-over-runtime-full-1.png" alt="Comparing percentage of correct predictions total over the normalized runtime. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Showing the full runtime range." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:real-table-extraction-performance-over-runtime-full)Comparing percentage of correct predictions total over the normalized runtime. The normalized runtime is given in minutes of processing on a single B200. The time to load the model into the VRAM is excluded. Showing the full runtime range.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" tabindex="-1"></a>df_overview <span class="sc">%&gt;%</span> </span>
<span id="cb137-2"><a href="#cb137-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb137-3"><a href="#cb137-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_total_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb137-4"><a href="#cb137-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb137-5"><a href="#cb137-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb137-6"><a href="#cb137-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb137-7"><a href="#cb137-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb137-8"><a href="#cb137-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb137-9"><a href="#cb137-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-performance-total-overview-1.png" alt="Percentage of correct extracted or as missing categorized values for table extraction task on real Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-performance-total-overview)Percentage of correct extracted or as missing categorized values for table extraction task on real Aktiva tables
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a>df_overview <span class="sc">%&gt;%</span> </span>
<span id="cb138-2"><a href="#cb138-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_num_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_numeric, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb138-6"><a href="#cb138-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb138-8"><a href="#cb138-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb138-9"><a href="#cb138-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-performance-numeric-overview-1.png" alt="Percentage of correct extracted numeric values for table extraction task on real Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-performance-numeric-overview)Percentage of correct extracted numeric values for table extraction task on real Aktiva tables
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" tabindex="-1"></a>df_overview <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> NA_F1, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb139-6"><a href="#cb139-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb139-7"><a href="#cb139-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb139-8"><a href="#cb139-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb139-9"><a href="#cb139-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-f1-overview-1.png" alt="F1 score for the missing classification if a value is missing for table extraction task on real Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-f1-overview)F1 score for the missing classification if a value is missing for table extraction task on real Aktiva tables
</p>
</div>
<div id="examples-from-same-company" class="section level4 hasAnchor" number="14.2.2.1">
<h4 class="hasAnchor"><span class="header-section-number">14.2.2.1</span> Examples from same company<a href="#examples-from-same-company" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a>model_selection <span class="ot">&lt;-</span> <span class="fu">c</span>(model_by_size, <span class="st">&quot;gpt-4.1-nano&quot;</span>, <span class="st">&quot;gpt-5-nano&quot;</span>, <span class="st">&quot;gpt-4.1-mini&quot;</span>, <span class="st">&quot;gpt-5-mini&quot;</span>, <span class="st">&quot;gpt-4.1&quot;</span>)</span>
<span id="cb140-2"><a href="#cb140-2" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb140-4"><a href="#cb140-4" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb140-5"><a href="#cb140-5" tabindex="-1"></a>    <span class="co"># str_detect(filepath, &quot;Statistik&quot;), </span></span>
<span id="cb140-6"><a href="#cb140-6" tabindex="-1"></a>    method_family <span class="sc">==</span> <span class="st">&quot;top_n_rag_examples&quot;</span>,</span>
<span id="cb140-7"><a href="#cb140-7" tabindex="-1"></a>    n_examples <span class="sc">!=</span> <span class="dv">2</span>,</span>
<span id="cb140-8"><a href="#cb140-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="#cb140-9" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_selection) <span class="sc">%&gt;%</span></span>
<span id="cb140-10"><a href="#cb140-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb140-11"><a href="#cb140-11" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_selection),</span>
<span id="cb140-12"><a href="#cb140-12" tabindex="-1"></a>    <span class="at">model_family =</span> <span class="fu">factor</span>(model_family),</span>
<span id="cb140-13"><a href="#cb140-13" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb140-14"><a href="#cb140-14" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples))),</span>
<span id="cb140-15"><a href="#cb140-15" tabindex="-1"></a>    <span class="at">examples_from_same_company =</span> <span class="sc">!</span>out_of_company</span>
<span id="cb140-16"><a href="#cb140-16" tabindex="-1"></a>  )</span>
<span id="cb140-17"><a href="#cb140-17" tabindex="-1"></a></span>
<span id="cb140-18"><a href="#cb140-18" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(model_family, <span class="st">&quot;Qwen&quot;</span>), model_family <span class="sc">!=</span> <span class="st">&quot;microsoft&quot;</span>, model_family <span class="sc">!=</span> <span class="st">&quot;tiiuae&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb140-19"><a href="#cb140-19" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> examples_from_same_company, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb140-20"><a href="#cb140-20" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-21"><a href="#cb140-21" tabindex="-1"></a>  <span class="co"># geom_jitter(</span></span>
<span id="cb140-22"><a href="#cb140-22" tabindex="-1"></a>  <span class="co">#   aes(x = examples_from_same_company, y = percentage_correct_total),</span></span>
<span id="cb140-23"><a href="#cb140-23" tabindex="-1"></a>  <span class="co">#   shape = 4, height = 0.005, alpha = .5</span></span>
<span id="cb140-24"><a href="#cb140-24" tabindex="-1"></a>  <span class="co">#   ) +</span></span>
<span id="cb140-25"><a href="#cb140-25" tabindex="-1"></a>  <span class="co"># scale_x_discrete(guide = guide_axis(angle = 30)) +</span></span>
<span id="cb140-26"><a href="#cb140-26" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb140-27"><a href="#cb140-27" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> model_family <span class="sc">+</span> model) <span class="sc">+</span></span>
<span id="cb140-28"><a href="#cb140-28" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb140-29"><a href="#cb140-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb140-30"><a href="#cb140-30" tabindex="-1"></a>    <span class="co"># axis.title.x = element_blank()</span></span>
<span id="cb140-31"><a href="#cb140-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb140-32"><a href="#cb140-32" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb140-33"><a href="#cb140-33" tabindex="-1"></a></span>
<span id="cb140-34"><a href="#cb140-34" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb140-35"><a href="#cb140-35" tabindex="-1"></a>  <span class="fu">str_detect</span>(model_family, <span class="st">&quot;Qwen&quot;</span>) <span class="sc">|</span> model_family <span class="sc">==</span> <span class="st">&quot;microsoft&quot;</span> <span class="sc">|</span> model_family <span class="sc">==</span> <span class="st">&quot;tiiuae&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb140-36"><a href="#cb140-36" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> examples_from_same_company, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family), <span class="at">show.legend =</span> T) <span class="sc">+</span></span>
<span id="cb140-37"><a href="#cb140-37" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-38"><a href="#cb140-38" tabindex="-1"></a>  <span class="co"># geom_jitter(</span></span>
<span id="cb140-39"><a href="#cb140-39" tabindex="-1"></a>  <span class="co">#   aes(x = examples_from_same_company, y = percentage_correct_total),</span></span>
<span id="cb140-40"><a href="#cb140-40" tabindex="-1"></a>  <span class="co">#   shape = 4, height = 0.005, alpha = .5</span></span>
<span id="cb140-41"><a href="#cb140-41" tabindex="-1"></a>  <span class="co">#   ) +</span></span>
<span id="cb140-42"><a href="#cb140-42" tabindex="-1"></a>  <span class="co"># scale_x_discrete(guide = guide_axis(angle = 30)) +</span></span>
<span id="cb140-43"><a href="#cb140-43" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb140-44"><a href="#cb140-44" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> model_family <span class="sc">+</span> model) <span class="sc">+</span></span>
<span id="cb140-45"><a href="#cb140-45" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb140-46"><a href="#cb140-46" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb140-47"><a href="#cb140-47" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb140-48"><a href="#cb140-48" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb140-49"><a href="#cb140-49" tabindex="-1"></a></span>
<span id="cb140-50"><a href="#cb140-50" tabindex="-1"></a>p1 <span class="sc">/</span></span>
<span id="cb140-51"><a href="#cb140-51" tabindex="-1"></a>  p2</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-performance-total-overview-out-of-company-1.png" alt="Comparing the overall extraction performance depending on the condition if examples from the same company can be used." width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-performance-total-overview-out-of-company)Comparing the overall extraction performance depending on the condition if examples from the same company can be used.
</p>
</div>
</div>
<div id="openai-models-1" class="section level4 hasAnchor" number="14.2.2.2">
<h4 class="hasAnchor"><span class="header-section-number">14.2.2.2</span> OpenAI models<a href="#openai-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb141-2"><a href="#cb141-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb141-3"><a href="#cb141-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_total_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-4"><a href="#cb141-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb141-5"><a href="#cb141-5" tabindex="-1"></a>  <span class="co"># geom_jitter(aes(x = model, y = percentage_correct_total)) +</span></span>
<span id="cb141-6"><a href="#cb141-6" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb141-7"><a href="#cb141-7" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb141-8"><a href="#cb141-8" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb141-9"><a href="#cb141-9" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb141-10"><a href="#cb141-10" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-performance-total-gpt-1.png" alt="Comparing the percentage of correct predictions overall for OpenAi's LLMs with some Qwen 3 models" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-performance-total-gpt)Comparing the percentage of correct predictions overall for OpenAi’s LLMs with some Qwen 3 models
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="#cb142-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_num_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_numeric, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb142-6"><a href="#cb142-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb142-8"><a href="#cb142-8" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb142-9"><a href="#cb142-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-performance-numeric-gpt-1.png" alt="Comparing the percentage of correct numeric predictions for OpenAi's LLMs with some Qwen 3 models" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-performance-numeric-gpt)Comparing the percentage of correct numeric predictions for OpenAi’s LLMs with some Qwen 3 models
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="#cb143-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NA_F1 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(NA_F1), <span class="dv">0</span>, NA_F1)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb143-4"><a href="#cb143-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb143-5"><a href="#cb143-5" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> NA_F1, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb143-6"><a href="#cb143-6" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> df_overview_gpt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(NA_F1)), <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">height =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb143-7"><a href="#cb143-7" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb143-8"><a href="#cb143-8" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb143-9"><a href="#cb143-9" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb143-10"><a href="#cb143-10" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb143-11"><a href="#cb143-11" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-f1-gpt-1.png" alt="Comparing the F1 score for predicting the missingness of a value for OpenAi's LLMs with some Qwen 3 models. The green crosses indicate results where a model has predicted only numeric values even though there have been missing values." width="100%" height="90%" keepaspectratio />
<p class="caption">
(#fig:table-extraction-llm-f1-gpt)Comparing the F1 score for predicting the missingness of a value for OpenAi’s LLMs with some Qwen 3 models. The green crosses indicate results where a model has predicted only numeric values even though there have been missing values.
</p>
</div>
</div>
<div id="hypotheses-5" class="section level4 hasAnchor" number="14.2.2.3">
<h4 class="hasAnchor"><span class="header-section-number">14.2.2.3</span> Hypotheses<a href="#hypotheses-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb144-2"><a href="#cb144-2" tabindex="-1"></a>  real_table_extraction_llm_shap_plot[[i]] <span class="ot">&lt;-</span> real_table_extraction_llm_shap_plot[[i]] <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">tag_level =</span> <span class="st">&#39;new&#39;</span>)</span>
<span id="cb144-3"><a href="#cb144-3" tabindex="-1"></a>}</span>
<span id="cb144-4"><a href="#cb144-4" tabindex="-1"></a>  </span>
<span id="cb144-5"><a href="#cb144-5" tabindex="-1"></a>real_table_extraction_llm_shap_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;1&#39;</span>), <span class="at">tag_sep =</span> <span class="st">&#39;.&#39;</span>) <span class="sc">+</span></span>
<span id="cb144-6"><a href="#cb144-6" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb144-7"><a href="#cb144-7" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&#39;The surprising truth about mtcars&#39;</span>,</span>
<span id="cb144-8"><a href="#cb144-8" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">&#39;These 3 plots will reveal yet-untold secrets about our beloved data-set&#39;</span>,</span>
<span id="cb144-9"><a href="#cb144-9" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;Disclaimer: None of these plots are insightful&#39;</span></span>
<span id="cb144-10"><a href="#cb144-10" tabindex="-1"></a>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>))</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/real-table-extraction-llm-shap-plot-1.png" alt="Mean absolute SHAP values and beeswarm plots for real table extraction with LLMs" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:real-table-extraction-llm-shap-plot)Mean absolute SHAP values and beeswarm plots for real table extraction with LLMs
</p>
</div>
</div>
</div>
<div id="synthetic-tables-3" class="section level3 hasAnchor" number="14.2.3">
<h3 class="hasAnchor"><span class="header-section-number">14.2.3</span> Synthetic tables<a href="#synthetic-tables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" tabindex="-1"></a>df_overview_synth <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb145-3"><a href="#cb145-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> synth_table_extraction_regex_total_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-4"><a href="#cb145-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb145-5"><a href="#cb145-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb145-6"><a href="#cb145-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb145-7"><a href="#cb145-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb145-8"><a href="#cb145-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb145-9"><a href="#cb145-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-llm-performance-total-overview-1.png" alt="Percentage of correct extracted or as missing categorized values for table extraction task on synthetic Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:synth-table-extraction-llm-performance-total-overview)Percentage of correct extracted or as missing categorized values for table extraction task on synthetic Aktiva tables
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" tabindex="-1"></a>df_overview_synth <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="#cb146-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb146-3"><a href="#cb146-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> synth_table_extraction_regex_num_performance_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_numeric, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb146-5"><a href="#cb146-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb146-6"><a href="#cb146-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb146-7"><a href="#cb146-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb146-8"><a href="#cb146-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb146-9"><a href="#cb146-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-llm-performance-numeric-overview-1.png" alt="Percentage of correct extracted numeric values for table extraction task on synthetic Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:synth-table-extraction-llm-performance-numeric-overview)Percentage of correct extracted numeric values for table extraction task on synthetic Aktiva tables
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" tabindex="-1"></a>df_overview_synth <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> synth_table_extraction_regex_NA_F1_median, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb147-4"><a href="#cb147-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> NA_F1, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb147-5"><a href="#cb147-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb147-6"><a href="#cb147-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb147-7"><a href="#cb147-7" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb147-8"><a href="#cb147-8" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb147-9"><a href="#cb147-9" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/synth-table-extraction-llm-f1-overview-1.png" alt="F1 score for the missing classification if a value is missing for table extraction task on synthetic Aktiva tables" width="100%" height="95%" keepaspectratio />
<p class="caption">
(#fig:synth-table-extraction-llm-f1-overview)F1 score for the missing classification if a value is missing for table extraction task on synthetic Aktiva tables
</p>
</div>
<div id="confidence-4" class="section level4 hasAnchor" number="14.2.3.1">
<h4 class="hasAnchor"><span class="header-section-number">14.2.3.1</span> Confidence<a href="#confidence-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" tabindex="-1"></a>confidence_intervals_synth_by_format <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/confidence_intervals_synth_by_format.rds&quot;</span>)</span>
<span id="cb148-2"><a href="#cb148-2" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" tabindex="-1"></a><span class="co"># confidence_vs_truth_synth &lt;- df_synth_table_extraction %&gt;% </span></span>
<span id="cb148-4"><a href="#cb148-4" tabindex="-1"></a><span class="co">#   # filter(method_family %in% c(&quot;top_n_rag_examples&quot;, &quot;n_random_examples&quot;)) %&gt;% </span></span>
<span id="cb148-5"><a href="#cb148-5" tabindex="-1"></a><span class="co">#   filter(model %in% c(&quot;Ministral-8B-Instruct-2410&quot;, &quot;Qwen3-8B&quot;, &quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;)) %&gt;% </span></span>
<span id="cb148-6"><a href="#cb148-6" tabindex="-1"></a><span class="co">#   group_by(method, model, loop) %&gt;% mutate(</span></span>
<span id="cb148-7"><a href="#cb148-7" tabindex="-1"></a><span class="co">#     mean_percentage_correct_total = mean(percentage_correct_total, na.rm=TRUE), .before = 1,</span></span>
<span id="cb148-8"><a href="#cb148-8" tabindex="-1"></a><span class="co">#     respect_units = !ignore_units</span></span>
<span id="cb148-9"><a href="#cb148-9" tabindex="-1"></a><span class="co">#   ) %&gt;% group_by(respect_units, model, filepath, input_format) %&gt;% </span></span>
<span id="cb148-10"><a href="#cb148-10" tabindex="-1"></a><span class="co">#   # arrange(desc(mean_percentage_correct_total)) %&gt;% </span></span>
<span id="cb148-11"><a href="#cb148-11" tabindex="-1"></a><span class="co">#   slice_max(mean_percentage_correct_total, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb148-12"><a href="#cb148-12" tabindex="-1"></a><span class="co">#   mutate(predictions_processed = map(predictions, ~{</span></span>
<span id="cb148-13"><a href="#cb148-13" tabindex="-1"></a><span class="co">#     .x %&gt;% </span></span>
<span id="cb148-14"><a href="#cb148-14" tabindex="-1"></a><span class="co">#       select(-&quot;_merge&quot;) %&gt;% </span></span>
<span id="cb148-15"><a href="#cb148-15" tabindex="-1"></a><span class="co">#       mutate(</span></span>
<span id="cb148-16"><a href="#cb148-16" tabindex="-1"></a><span class="co">#         match = (year_truth == year_result) | (is.na(year_truth) &amp; is.na(year_result)),</span></span>
<span id="cb148-17"><a href="#cb148-17" tabindex="-1"></a><span class="co">#         confidence = confidence_this_year,</span></span>
<span id="cb148-18"><a href="#cb148-18" tabindex="-1"></a><span class="co">#         truth_NA = is.na(year_truth),</span></span>
<span id="cb148-19"><a href="#cb148-19" tabindex="-1"></a><span class="co">#         predicted_NA = is.na(year_result),</span></span>
<span id="cb148-20"><a href="#cb148-20" tabindex="-1"></a><span class="co">#         .before = 4</span></span>
<span id="cb148-21"><a href="#cb148-21" tabindex="-1"></a><span class="co">#       ) %&gt;% nest(</span></span>
<span id="cb148-22"><a href="#cb148-22" tabindex="-1"></a><span class="co">#         tuple_year = c(match, confidence, truth_NA, predicted_NA)</span></span>
<span id="cb148-23"><a href="#cb148-23" tabindex="-1"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb148-24"><a href="#cb148-24" tabindex="-1"></a><span class="co">#       mutate(</span></span>
<span id="cb148-25"><a href="#cb148-25" tabindex="-1"></a><span class="co">#         confidence = confidence_previous_year,</span></span>
<span id="cb148-26"><a href="#cb148-26" tabindex="-1"></a><span class="co">#         match = (previous_year_truth == previous_year_result) | (is.na(previous_year_truth) &amp; is.na(previous_year_result)),</span></span>
<span id="cb148-27"><a href="#cb148-27" tabindex="-1"></a><span class="co">#         truth_NA = is.na(previous_year_truth),</span></span>
<span id="cb148-28"><a href="#cb148-28" tabindex="-1"></a><span class="co">#         predicted_NA = is.na(previous_year_result),</span></span>
<span id="cb148-29"><a href="#cb148-29" tabindex="-1"></a><span class="co">#         .before = 4</span></span>
<span id="cb148-30"><a href="#cb148-30" tabindex="-1"></a><span class="co">#       ) %&gt;% nest(</span></span>
<span id="cb148-31"><a href="#cb148-31" tabindex="-1"></a><span class="co">#         tuple_previous_year = c(match, confidence, truth_NA, predicted_NA)</span></span>
<span id="cb148-32"><a href="#cb148-32" tabindex="-1"></a><span class="co">#       ) %&gt;% select(</span></span>
<span id="cb148-33"><a href="#cb148-33" tabindex="-1"></a><span class="co">#         -c(year_truth, previous_year_truth, year_result, previous_year_result,</span></span>
<span id="cb148-34"><a href="#cb148-34" tabindex="-1"></a><span class="co">#            confidence_this_year, confidence_previous_year)</span></span>
<span id="cb148-35"><a href="#cb148-35" tabindex="-1"></a><span class="co">#       ) %&gt;% </span></span>
<span id="cb148-36"><a href="#cb148-36" tabindex="-1"></a><span class="co">#       pivot_longer(-c(&quot;E1&quot;, &quot;E2&quot;, &quot;E3&quot;)) %&gt;% </span></span>
<span id="cb148-37"><a href="#cb148-37" tabindex="-1"></a><span class="co">#       unnest(cols = value) %&gt;% mutate(</span></span>
<span id="cb148-38"><a href="#cb148-38" tabindex="-1"></a><span class="co">#         match = if_else(is.na(match), FALSE, match)</span></span>
<span id="cb148-39"><a href="#cb148-39" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb148-40"><a href="#cb148-40" tabindex="-1"></a><span class="co">#   })) %&gt;% </span></span>
<span id="cb148-41"><a href="#cb148-41" tabindex="-1"></a><span class="co">#   unnest(predictions_processed) %&gt;% mutate(</span></span>
<span id="cb148-42"><a href="#cb148-42" tabindex="-1"></a><span class="co">#     match = factor(match, levels = c(F, T)),</span></span>
<span id="cb148-43"><a href="#cb148-43" tabindex="-1"></a><span class="co">#     truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb148-44"><a href="#cb148-44" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb148-45"><a href="#cb148-45" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb148-46"><a href="#cb148-46" tabindex="-1"></a><span class="co"># confidence_intervals_synth &lt;- confidence_vs_truth_synth %&gt;% #rename(confidence = confidence_score) %&gt;% </span></span>
<span id="cb148-47"><a href="#cb148-47" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb148-48"><a href="#cb148-48" tabindex="-1"></a><span class="co">#     conf_interval = cut(confidence, breaks = seq(0, 1, by = 0.05), include.lowest = TRUE),</span></span>
<span id="cb148-49"><a href="#cb148-49" tabindex="-1"></a><span class="co">#     conf_center = as.numeric(sub(&quot;\\((.+),(.+)\\]&quot;, &quot;\\1&quot;, levels(conf_interval))[conf_interval]) + 0.025</span></span>
<span id="cb148-50"><a href="#cb148-50" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb148-51"><a href="#cb148-51" tabindex="-1"></a><span class="co">#   group_by(conf_center, predicted_NA, model, respect_units, input_format) %&gt;%</span></span>
<span id="cb148-52"><a href="#cb148-52" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb148-53"><a href="#cb148-53" tabindex="-1"></a><span class="co">#     n_true = sum(match == TRUE, na.rm = TRUE),</span></span>
<span id="cb148-54"><a href="#cb148-54" tabindex="-1"></a><span class="co">#     n_false = sum(match == FALSE, na.rm = TRUE),</span></span>
<span id="cb148-55"><a href="#cb148-55" tabindex="-1"></a><span class="co">#     total = n_true + n_false,</span></span>
<span id="cb148-56"><a href="#cb148-56" tabindex="-1"></a><span class="co">#     chance_false = if_else(total &gt; 0, n_false / total * 100, NA_real_),</span></span>
<span id="cb148-57"><a href="#cb148-57" tabindex="-1"></a><span class="co">#     chance_zero = chance_false == 0,</span></span>
<span id="cb148-58"><a href="#cb148-58" tabindex="-1"></a><span class="co">#     chance_below_1 = chance_false &lt; 1,</span></span>
<span id="cb148-59"><a href="#cb148-59" tabindex="-1"></a><span class="co">#     chance_low = if_else(chance_zero, 0, if_else(chance_below_1, 1, 2)),</span></span>
<span id="cb148-60"><a href="#cb148-60" tabindex="-1"></a><span class="co">#     chance_low = factor(chance_low, levels = c(0,1,2), labels = c(&quot;equls 0 %&quot;, &quot;below 1 %&quot;, &quot;more&quot;))</span></span>
<span id="cb148-61"><a href="#cb148-61" tabindex="-1"></a><span class="co">#   ) %&gt;% group_by(predicted_NA, model, respect_units) %&gt;% mutate(</span></span>
<span id="cb148-62"><a href="#cb148-62" tabindex="-1"></a><span class="co">#     perc = total/sum(total)*100</span></span>
<span id="cb148-63"><a href="#cb148-63" tabindex="-1"></a><span class="co">#   ) %&gt;% ungroup() %&gt;% </span></span>
<span id="cb148-64"><a href="#cb148-64" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb148-65"><a href="#cb148-65" tabindex="-1"></a><span class="co">#     chance_false_interval = cut(</span></span>
<span id="cb148-66"><a href="#cb148-66" tabindex="-1"></a><span class="co">#       chance_false,</span></span>
<span id="cb148-67"><a href="#cb148-67" tabindex="-1"></a><span class="co">#       breaks = c(0, 1, 2, 4, 8, 16, 32, 64, Inf),</span></span>
<span id="cb148-68"><a href="#cb148-68" tabindex="-1"></a><span class="co">#       labels = c(&quot;[0,1)&quot;, &quot;[1,2)&quot;, &quot;[2,4)&quot;, &quot;[4,8)&quot;, </span></span>
<span id="cb148-69"><a href="#cb148-69" tabindex="-1"></a><span class="co">#                  &quot;[8,16)&quot;, &quot;[16,32)&quot;, &quot;[32,64)&quot;, &quot;[64,Inf)&quot;),</span></span>
<span id="cb148-70"><a href="#cb148-70" tabindex="-1"></a><span class="co">#       right = FALSE,</span></span>
<span id="cb148-71"><a href="#cb148-71" tabindex="-1"></a><span class="co">#       ordered_result = TRUE</span></span>
<span id="cb148-72"><a href="#cb148-72" tabindex="-1"></a><span class="co">#     ),</span></span>
<span id="cb148-73"><a href="#cb148-73" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb148-74"><a href="#cb148-74" tabindex="-1"></a></span>
<span id="cb148-75"><a href="#cb148-75" tabindex="-1"></a>confidence_intervals_synth_by_format <span class="sc">%&gt;%</span></span>
<span id="cb148-76"><a href="#cb148-76" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb148-77"><a href="#cb148-77" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb148-78"><a href="#cb148-78" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb148-79"><a href="#cb148-79" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb148-80"><a href="#cb148-80" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb148-81"><a href="#cb148-81" tabindex="-1"></a>  ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb148-82"><a href="#cb148-82" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb148-83"><a href="#cb148-83" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb148-84"><a href="#cb148-84" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb148-85"><a href="#cb148-85" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb148-86"><a href="#cb148-86" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb148-87"><a href="#cb148-87" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb148-88"><a href="#cb148-88" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb148-89"><a href="#cb148-89" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb148-90"><a href="#cb148-90" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb148-91"><a href="#cb148-91" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb148-92"><a href="#cb148-92" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-93"><a href="#cb148-93" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb148-94"><a href="#cb148-94" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb148-95"><a href="#cb148-95" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb148-96"><a href="#cb148-96" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb148-97"><a href="#cb148-97" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">+</span><span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model<span class="sc">+</span>input_format)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-synth-grouped-by-input-format-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task. Additionally grouped by input format." width="100%" />
<p class="caption">
(#fig:table-extraction-llm-confidence-lm-synth-grouped-by-input-format)Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task. Additionally grouped by input format.
</p>
</div>
</div>
</div>
<div id="hybrid-approach-3" class="section level3 hasAnchor" number="14.2.4">
<h3 class="hasAnchor"><span class="header-section-number">14.2.4</span> Hybrid approach<a href="#hybrid-approach-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb149-2"><a href="#cb149-2" tabindex="-1"></a>  df_real_table_extraction_synth <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">context =</span> <span class="st">&quot;synth&quot;</span>), </span>
<span id="cb149-3"><a href="#cb149-3" tabindex="-1"></a>  df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">context =</span> <span class="st">&quot;real&quot;</span>)</span>
<span id="cb149-4"><a href="#cb149-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb149-5"><a href="#cb149-5" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> best_models_with_examples<span class="sc">$</span>model) <span class="sc">%&gt;%</span> </span>
<span id="cb149-6"><a href="#cb149-6" tabindex="-1"></a>  <span class="fu">filter</span>(method_family <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb149-7"><a href="#cb149-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-8"><a href="#cb149-8" tabindex="-1"></a>    <span class="co"># model = factor(model, levels = model_by_size),</span></span>
<span id="cb149-9"><a href="#cb149-9" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb149-10"><a href="#cb149-10" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb149-11"><a href="#cb149-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb149-12"><a href="#cb149-12" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb149-13"><a href="#cb149-13" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill=</span>context, <span class="at">y =</span> percentage_correct_total), <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb149-14"><a href="#cb149-14" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = c(&quot;blue&quot;, &quot;orange&quot;)) +</span></span>
<span id="cb149-15"><a href="#cb149-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb149-16"><a href="#cb149-16" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model)</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/compare-real-table-extraction-by-context-type-1.png" alt="Comparing table extraction perfromance for real Aktiva extraction task with synthetic and real examples for in-context learning" width="100%" />
<p class="caption">
(#fig:compare-real-table-extraction-by-context-type)Comparing table extraction perfromance for real Aktiva extraction task with synthetic and real examples for in-context learning
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb150-3"><a href="#cb150-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>respect_units, <span class="at">y =</span> percentage_correct_total), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb150-4"><a href="#cb150-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb150-5"><a href="#cb150-5" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb150-6"><a href="#cb150-6" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>respect_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> percentage_correct_total), </span>
<span id="cb150-7"><a href="#cb150-7" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb150-8"><a href="#cb150-8" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb150-9"><a href="#cb150-9" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb150-10"><a href="#cb150-10" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb150-11"><a href="#cb150-11" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>respect_units) <span class="sc">+</span></span>
<span id="cb150-12"><a href="#cb150-12" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb150-13"><a href="#cb150-13" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb150-14"><a href="#cb150-14" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/compare-effect-of-respecting-units-on-overall-performance-1.png" alt="Comparing the effect on overall perfrormance if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units." width="100%" />
<p class="caption">
(#fig:compare-effect-of-respecting-units-on-overall-performance)Comparing the effect on overall perfrormance if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> </span>
<span id="cb151-2"><a href="#cb151-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb151-3"><a href="#cb151-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>respect_units, <span class="at">y =</span> percentage_correct_numeric), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb151-5"><a href="#cb151-5" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb151-6"><a href="#cb151-6" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>respect_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> percentage_correct_numeric), </span>
<span id="cb151-7"><a href="#cb151-7" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb151-8"><a href="#cb151-8" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb151-9"><a href="#cb151-9" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb151-10"><a href="#cb151-10" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb151-11"><a href="#cb151-11" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>respect_units) <span class="sc">+</span></span>
<span id="cb151-12"><a href="#cb151-12" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb151-13"><a href="#cb151-13" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb151-14"><a href="#cb151-14" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/compare-effect-of-respecting-units-on-numeric-performance-1.png" alt="Comparing the effect on numeric perfrormance if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units." width="100%" />
<p class="caption">
(#fig:compare-effect-of-respecting-units-on-numeric-performance)Comparing the effect on numeric perfrormance if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" tabindex="-1"></a>df_real_table_extraction_synth_respect_units <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb152-3"><a href="#cb152-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>respect_units, <span class="at">y =</span> NA_F1), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb152-4"><a href="#cb152-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb152-5"><a href="#cb152-5" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb152-6"><a href="#cb152-6" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>respect_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> NA_F1), </span>
<span id="cb152-7"><a href="#cb152-7" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb152-8"><a href="#cb152-8" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb152-9"><a href="#cb152-9" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb152-10"><a href="#cb152-10" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb152-11"><a href="#cb152-11" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>respect_units) <span class="sc">+</span></span>
<span id="cb152-12"><a href="#cb152-12" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb152-13"><a href="#cb152-13" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb152-14"><a href="#cb152-14" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="figure">
<img src="_main_files/figure-html/compare-effect-of-respecting-units-on-NA-F1-1.png" alt="Comparing the effect on NA F1 score if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units." width="100%" />
<p class="caption">
(#fig:compare-effect-of-respecting-units-on-NA-F1)Comparing the effect on NA F1 score if currency units should be respected on all predictions and specifically on predictions where all or just some columns have units.
</p>
</div>
<p>real_table_extraction_llm_synth_context_shap_plot</p>
<!--chapter:end:15_Figures.Rmd-->
</div>
</div>
</div>
<div id="layout-testing" class="section level1 hasAnchor" number="15">
<h1 class="hasAnchor"><span class="header-section-number">15</span> Layout testing<a href="#layout-testing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>12sdgsdgj</p>
<p>Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape Landscape</p>
<p>Hello</p>
<!--chapter:end:test.Rmd-->
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Most of the time the thesis was inspected at a third of the authors 42” screen with 4k resolution. For inspecting the large overview graphics it is a very handy tool the author recommends every data scientist or software developer.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>We replaced <span class="math inline">\(F\)</span> by <span class="math inline">\(P\)</span> to speak in the terms of players instead of features. We also replcaed <span class="math inline">\(f\)</span> by <span class="math inline">\(val\)</span>, because it better fits the story, that this is the value gain in a game, as explained by <span class="citation">O’Sullivan (<a href="#ref-osullivanMathematicsShapleyValues2023">2023</a>)</span>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I downloaded all publicly available annual reports for some of the companies shown in the first row of Figure @ref(fig:beteiligungsunternehmen). I assumed that this will give a representative sample of document structures for the other companies of the same type. Realizing that the degewo AG reports would require ocr preprocessing I additionally downloaded reports for GESOBAU AG. This approach could have been more systematic. For the second task I downloaded reports for all companies available and tried to use a balanced amount of reports per company.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>For the next project we probably will start using <em>Quarto</em> instead of <em>bookdown</em>. This is the new reporting framework of Posit, we became aware of too late.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Personal opinion: Developing well performing regular
expressions can be a very tedious and setting appropriate rules
requires some domain knowledge. It can be worth the effort if there
are a lot of documents with similar information to extract. For this
thesis it took multiple months. At least, now there is kind of a
pipeline one can reuse, exchanging the rules and key word lists.
Thus the next similar task should be solved faster.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>In some cases the information of interest is spanning
two pages. These rare cases are not covered from the approaches
presented here, yet.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Potentially smaller fine tuned models can solve the
task even more efficient.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Unfortunately, well known companies as BVG and BSR
publish a less detailed form. Thus, their documents are not included
in the document base for this task.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The row <em>Geleistete Anzahlungen</em> can be found in two parts of the table and the simple approach just matches the numbers to the first found entry.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>In this case the <a href="#acronyms_regex">regex</a> takes the sum as the value for the previous year.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>This can form unexpected numeric patterns or prevent the row names to be recognized.<a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>The approach takes care of line breaks between words, but not within. This leads to unrecognized row names as well.<a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>The idea is that the regular expression approach is
computationally cheap. If we can rely on the fact, that it keeps all
relevant pages we can use additional, computationally more expensive
approaches to further refine the page range.<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>See Figure
@ref(fig:display-metrics-plot-regex-page-identification) for a
graphical representation.<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>I don’t understand why the restricted version is
finding the page but the non-restricted regex is not.<a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Since the results are not depending on the text
extraction library, the <em>exhaustive regex restricted</em> ran only with
the text extracted by the fastest extraction library: <em>pdfium</em>. This
library is used for the most tasks in this thesis. Later faced
issues with the text extracted by <em>pdfium</em> are discussed in @ref().<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>This result is based on a single test run.<a href="#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>With json the key <em>page_number</em> gets repeated every
line, while it is just mentiones once in the beginning of the
markdown formatted tables.<a href="#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>See also Table
@ref(tab:comparing-actual-number-of-in-context-examples).<a href="#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>It takes around 30 minutes to setup a vllm instance
with Llama-4 Scout compared to 4:30 minutes setuptime for Mistral 8B
2410.<a href="#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>This is not due to a temporary technical problems
caused by a bug in the transformers version shipped with the vllm
0-9-2 image. Those problems have been overcome. The performance
stays bad.<a href="#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>It has a better F1 score, when examples from the same
company are permitted. The recall is better with examples from same
company. The precision is better without. The improvement in the
recall is stronger.<a href="#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p>In this case five examples for the target table type
and two examples for each other type are provided, totaling at
twelve examples.<a href="#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p>Earlier experiments on a subset of the pages have been
run five times indicating stable results. Running the experiments up
to tree times in this very task indicate this as well.<a href="#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>The random forest build with undersampling performs
much better as a classifier, that is trained using n oversamples
train dataset.<a href="#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>A comparison of the numeric values over all methods
can be found in section @ref(comparing-table-extraction-methods).<a href="#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>The models <em>deepseek-ai_DeepSeek-R1-Distill-Qwen-32B</em>
and <em>google_gemma-3n-E4B-it</em> have been tested as well but don’t get
presented as they never performed anywhere beyond random guessing.<a href="#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>There is an external guidance through the provided
xgrammar template but it is not communicated to the model in form of
a promt.<a href="#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>With the gpt-oss models we found the new Harmony
response format to produce a lot of tokens in the chain of thought
stream, we discarded, because we only need the <a href="#acronyms_json">json</a> in the
final stream Maybe this is similar for gpt-5 models as well but the
chain of thought stream is kept on Azures side?<a href="#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>Without the Harmony format 4_000 are enough.<a href="#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>When we say, it runs well, it gets rated as <em>okay</em> on
the <a href="https://apxml.com/tools/vram-calculator">LLM Inference: VRAM &amp; Performance
Calculator</a>.<a href="#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>The model could be forced to return multiple answers,
but it was not. The confidence score is given as log probability.
The exponential function was applied to show the results on the more
common scale of 0 to 1.<a href="#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p>There was a single prediction where <a href="#acronyms_LLM">LLM</a> predicts
<strong>Aktiva</strong> with high confidence, when the truth is <strong>Passiva</strong>
instead. Because Qwen was showing the same wrong prediction for one
<strong>Passiva</strong> table, I double checked the ground truth. I found, that
the page shows <strong>Aktiva</strong> and <strong>Passiva</strong> simultaneously and was not
correct codified. This was not the only time, where a mistake in the
gold truth was found, by examining potential <a href="#acronyms_LLM">LLM</a> mistakes.<a href="#fnref33" class="footnote-back">↩︎</a></p></li>
<li id="fn34"><p>Thus, a human has in average to check four pages and
select the correct <strong>Passiva</strong> page among them.<a href="#fnref34" class="footnote-back">↩︎</a></p></li>
<li id="fn35"><p>It might be possible to request the n most probable
answers to get confidence scores for all different predictions. But
this was not investigated.<a href="#fnref35" class="footnote-back">↩︎</a></p></li>
<li id="fn36"><p>The best performance results with
<em>top_11_rag_examples</em> but the plot was less interesting and its F1
score was not listed in Table
@ref(tab:table-metrics-llm-page-identification-multi-small-models).<a href="#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>The size of intervals has been narrowed down to 0.1 %
and still there was no range without wrong classification for Llama
4 Scout.<a href="#fnref37" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
<script>
// Lightbox functionality for displaying images in a modal view
document.addEventListener("DOMContentLoaded", function () {
  // Create a lightbox container
  const lightbox = document.createElement("div");
  lightbox.id = "lightbox";
  lightbox.style.position = "fixed";
  lightbox.style.top = "0";
  lightbox.style.left = "0";
  lightbox.style.width = "100%";
  lightbox.style.height = "100%";
  lightbox.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
  lightbox.style.display = "none";
  lightbox.style.justifyContent = "center";
  lightbox.style.alignItems = "center";
  lightbox.style.zIndex = "1000";
  document.body.appendChild(lightbox);

  // Add an image element to the lightbox
  const lightboxImage = document.createElement("img");
  lightboxImage.id = "lightbox-image";
  // lightboxImage.style.maxWidth = "90%";
  // lightboxImage.style.maxHeight = "90%";
  lightbox.appendChild(lightboxImage);

  // Close lightbox on click
  lightbox.addEventListener("click", function () {
    lightbox.style.display = "none";
  });

  // Add onclick event to all images except the excluded one
  const images = document.querySelectorAll("img");
  images.forEach((img) => {
    if (img.src.includes("images/BHT_Logo_horizontal_Anthrazit_transparent.svg")) {
      return; // Skip the excluded image
    }
    img.style.cursor = "pointer"; // Change cursor to indicate clickability
    img.addEventListener("click", function () {
      lightboxImage.src = img.src; // Set the lightbox image source
      lightbox.style.display = "flex"; // Show the lightbox
    });
  });
});
</script>

<script>
// Image slider/carousel functionality for divs with class "image-slider"
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-slider').forEach(function (slider) {
    const images = slider.querySelectorAll('img');
    if (images.length < 2) return; // No need for slider if only one image

    // Hide all images except the first
    images.forEach((img, i) => img.style.display = i === 0 ? 'inline' : 'none');
    let current = 0;

    // Create navigation buttons
    const prevBtn = document.createElement('button');
    prevBtn.textContent = '⟨ Prev';
    prevBtn.style.marginRight = '10px';
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next ⟩';
    nextBtn.style.marginLeft = '10px';

    // Create a caption container
    const captionContainer = document.createElement('div');
    captionContainer.style.fontStyle = 'italic';
    captionContainer.style.color = '#555';

    // Create a flex container for buttons and caption
    const controlsContainer = document.createElement('div');
    controlsContainer.style.display = 'flex';
    controlsContainer.style.justifyContent = 'space-between';
    controlsContainer.style.alignItems = 'center';
    controlsContainer.style.marginTop = '10px';
    controlsContainer.style.width = '100%';

    // Place buttons and caption in flex container
    controlsContainer.appendChild(prevBtn);
    controlsContainer.appendChild(captionContainer);
    controlsContainer.appendChild(nextBtn);

    // Function to update the caption
    const updateCaption = () => {
      const caption = images[current].nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        captionContainer.textContent = caption.textContent;
      } else {
        captionContainer.textContent = ''; // Clear caption if none exists
      }
    };

    // Function to show the next image
    const showNextImage = () => {
      images[current].style.display = 'none';
      current = (current + 1) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Function to show the previous image
    const showPrevImage = () => {
      images[current].style.display = 'none';
      current = (current - 1 + images.length) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Button click handlers
    prevBtn.onclick = function () {
      stopAutoSlide();
      showPrevImage();
    };
    nextBtn.onclick = function () {
      stopAutoSlide();
      showNextImage();
    };

    // Insert controls container below images
    slider.appendChild(controlsContainer);

    // Automatic sliding
    let autoSlideInterval = setInterval(showNextImage, 2000);

    // Stop automatic sliding on user interaction
    const stopAutoSlide = () => {
      clearInterval(autoSlideInterval);
    };

    // Stop auto-slide when the user interacts with the slider
    prevBtn.addEventListener('click', stopAutoSlide);
    nextBtn.addEventListener('click', stopAutoSlide);
    images.forEach((img) => {
      img.addEventListener('click', stopAutoSlide);
    });

    // Initialize the caption
    updateCaption();
  });
});
</script>

<script>
// Dropdown filter functionality for images with lightbox
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-selector').forEach(function (selector) {
    const images = selector.querySelectorAll('img');
    if (images.length === 0) return;

    // Create a dropdown filter container
    const filterContainer = document.createElement('div');
    filterContainer.classList.add('filter-container');

    const dropdown = document.createElement('select');
    dropdown.multiple = true;
    dropdown.classList.add('filter-dropdown');

    // Add options to the dropdown
    const uniqueCategories = [];
    images.forEach((img) => {
      const caption = img.nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        const category = caption.textContent.trim();
        if (!uniqueCategories.includes(category)) uniqueCategories.push(category);
      }
    });

    uniqueCategories.forEach((category) => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      // Do NOT set option.selected here!
      dropdown.appendChild(option);
    });

    filterContainer.appendChild(dropdown);
    selector.appendChild(filterContainer);

    // Add a grid container for filtered images
    const gridContainer = document.createElement('div');
    gridContainer.classList.add('image-grid');
    selector.appendChild(gridContainer);

    // Choices.js initialization
    const choices = new Choices(dropdown, {
      removeItemButton: true,
      shouldSort: false,
      searchEnabled: false,
      placeholder: true,
      placeholderValue: 'Filter categories',
    });

    // Clear any existing selection first, then set initial selection
    choices.removeActiveItems(); // This clears existing selections
    choices.setChoiceByValue(uniqueCategories[0]); // This sets only the first category

    // Filtering function
    const filterImages = () => {
      const selectedCategories = Array.from(dropdown.selectedOptions).map(opt => opt.value);
      gridContainer.innerHTML = '';
      let shownWrappers = [];
      images.forEach((img) => {
        const caption = img.nextElementSibling;
        if (caption && caption.classList.contains('image-caption')) {
          const category = caption.textContent.trim();
          if (selectedCategories.includes(category)) {
            const imgWrapper = document.createElement('div');
            imgWrapper.classList.add('image-wrapper');
            const imgClone = img.cloneNode(true);
            imgClone.style.cursor = 'pointer';
            imgClone.addEventListener('click', function () {
              const lightboxImage = document.querySelector("#lightbox img");
              const lightbox = document.querySelector("#lightbox");
              lightboxImage.src = imgClone.src;
              lightbox.style.display = 'flex';
            });
            imgWrapper.appendChild(imgClone);
            const captionClone = caption.cloneNode(true);
            imgWrapper.appendChild(captionClone);
            gridContainer.appendChild(imgWrapper);
            shownWrappers.push(imgWrapper);
          }
        }
      });
      // If only one image is shown, make it span both columns
      if (shownWrappers.length === 1) {
        shownWrappers[0].style.gridColumn = "span 2";
      }
    };

    // Listen for changes from Choices.js
    dropdown.addEventListener('change', filterImages);

    // Initial grid (only first category shown)
    filterImages();
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  var codes = document.querySelectorAll('.hideme');
  var code, i, d, s, p;
  for (i = 0; i < codes.length; i++) {
    code = codes[i];
    p = code.parentNode;
    d = document.createElement('details');
    s = document.createElement('summary');
    s.innerText = 'Details';
    // <details><summary>Details</summary></details>
    d.appendChild(s);
    // move the code into <details>
    p.replaceChild(d, code);
    d.appendChild(code);
  }
});
</script>
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
