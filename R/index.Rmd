---
title: "Extraction of tabular data from annual reports with LLMs"
author: "Simon Sch√§fer"
date: "September 8, 2025"
site: "bookdown::bookdown_site"
# Change this to FALSE if you'd like to install them manually on your own.
# params:
#   'Install needed packages for {thesisdown}': True

output:
  # bookdown::pdf_book:
  bookdown::pdf_document2:
    # latex_engine: xelatex
    # extra_dependencies: ["float"]
    extra_dependencies: ["flafter"]
    pandoc_args: 
      # - --lua-filter=report_misc/acrfull.lua
      - !expr acronymsdown::add_filter()
    toc: false
    lof: yes 
    lot: yes
    includes:
      in_header:
        - report_misc/bhtThesis.sty
        - report_misc/preamble.tex
  bookdown::gitbook:
    pandoc_args: 
      # - --lua-filter=report_misc/acrfull.lua
      - !expr acronymsdown::add_filter()
    code_folding: hide
    toc_depth: 4
    config:
      toc:
        before: |
          <li class="toc-logo"><a href="./"><img src="images/BHT_Logo_horizontal_Anthrazit_transparent.svg"></a></li>
    includes:
      in_header:
        - report_misc/head.html
      after_body: 
        - report_misc/image_effects.html
        - report_misc/code_folding.html
css: "report_misc/style.css"
documentclass: book
bibliography: ["report_misc/DS 4th: Extracting financial data from annual reports.bib"]
biblio-style: apa
link-citations: yes
csl: report_misc/apa-single-spaced.csl
acronyms:
  fromfile: ./report_misc/acronyms.yml
  loa_title: ""
  insert_loa: false
  insert_links: true
  sorting: usage
  include_unused: false
  style: short-long
# urlcolor: blue
# linkcolor: blue
# citecolor: green
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(kableExtra.latex.load_packages = FALSE)
# knitr::opts_chunk$set(fig.width=8, fig.height=4) 
# knitr::opts_chunk$set(fig.pos = "H", out.extra = "")

library(jsonlite)
library(tidyverse)
library(reticulate)
use_python("~/anaconda3/envs/llm/bin/python")

library(knitr)
library(kableExtra)
library(DT) # For interactive HTML tables

library(shapviz)
library(h2o)

library(stringr)
library(readr)
library(xml2)
library(knitr)

library(ggplot2)
library(patchwork)
library(ggh4x)
library(PRROC)
library(yardstick)
```

```{r load_layout_functions, include=FALSE}
source("report_misc/layout_functions.R")
source("report_misc/helper_functions.R")

echo_flag <- knitr::is_html_output() ? NA : FALSE
message_flag = FALSE
warning_flag = FALSE
cache_large_figures = TRUE
std_dev <- knitr::is_html_output() ? 'png' : 'pdf'
```

\setDefaultLayout
\pagenumbering{gobble}
\pagestyle{empty}

#  {.unlisted .unnumbered}

## Abstract {.unlisted .unnumbered}

Content of this thesis is a benchmark on information extraction from PDFs. The focus are annual reports of German companies. Special characteristic of the task is handling hierarchies in tables with financial data to prepare the data for import into a relational database.

The benchmark is composed of two sub tasks and the performance of different open source large language models is tested with different prompting approaches and compared to alternative methods.

This can be seen as a reimplementation study of "Extracting Financial Data from Unstructured Sources: Leveraging Large Language Models" - a paper published by @liExtractingFinancialData2023. The key differences are the application on German documents using open source large language models.

We show, that also smaller open source \acr{LLM}s can be used to identify the pages that contain the information of interest and to extract it. Based on these findings we sketch a process, how humans can use \acr{LLM}s to extract information from financial reports.

## Zusammenfassung {.unlisted .unnumbered}

Gegenstand dieser Arbeit ist ein Benchmark zur Informationsextraktion aus PDF-Dateien. Dabei wird sich auf das Auslesen der Bilanzen und Gewinn- und Verlustrechnungen aus Jahresabschl√ºssen deutscher Unternehmen beschr√§nkt. Ein besonderer Aspekt der Aufgabe ist die Ber√ºcksichtigung der Hierarchie innerhalb der Tabellen, um die Werte einem festen Schema zuzuordnen und so den Import in eine relationale Datenbank vorzubereiten.

## Reading advices {.unlisted .unnumbered}

The author recommends to read the thesis in its [digital gitbook version](https://famondir.github.io/Thesis/) instead of the PDF version. Furthermore, the author recommends to read the thesis (any version) on a screen that is larger than 21" and has at least full HD resolution[^index-1]. The more, the merrier.

[^index-1]: Most of the time the thesis was inspected at a third of the authors 42" screen with 4k resolution. For inspecting the large overview graphics it is a very handy tool the author recommends every data scientist or software developer.

\huge [üòä]{style="font-size: 1.5em;"} \normalsize

## Declaration of the Use of Artificial Intelligence {.unlisted .unnumbered}

We use Github Copilot in VSCode for coding assistance. Mostly the GPT-4.1 is used. Sometimes Claude Sonnet 4.

We use perplexity.ai in our literature research process.

We use [] for 

## Goals and Learnings {.unlisted .unnumbered}

Achieved:

-   thesis with bookdown
-   docker image creation
-   cluster orchestration
-   llm usage
-   guided decoding

Missed:

-   Administrating a k8s cluster
-   Fine tuning a model
-   using small language models
-   training a lm
-   using vllms

## Dedication {.unlisted .unnumbered}

Micha

\pagestyle{fancy}

\cleardoublepage
\pagenumbering{roman}
\setcounter{page}{1}
\tableofcontents

\large\bfseries
\addthumbsoverviewtocontents{section}{Thumb marks overview}
\thumbsoverviewback{Table of Thumbs}
\normalsize\mdseries

\cleardoublepage
\pagenumbering{arabic}
\setcounter{page}{1}
