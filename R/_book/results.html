<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Results | Extraction of tabular data from annual reports with LLMs</title>
  <meta name="description" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  
  
  

<meta name="author" content="Simon Schäfer" />


<meta name="date" content="2025-09-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="implementation-max-5p.html"/>
<link rel="next" href="discussion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css">
<script src="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js"></script> -->


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="report_misc/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/BHT_Logo_horizontal_Anthrazit_transparent.svg"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#objectives"><i class="fa fa-check"></i><b>1.2</b> Objectives</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#methodology-1-p"><i class="fa fa-check"></i><b>1.3</b> Methodology (1 p)</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#thesis-outline-0.5-p"><i class="fa fa-check"></i><b>1.4</b> Thesis Outline (0.5 p)</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#to-place-in-chapters-above"><i class="fa fa-check"></i><b>1.5</b> To place in chapters above</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#rhvb"><i class="fa fa-check"></i><b>1.6</b> RHvB</a></li>
<li class="chapter" data-level="1.7" data-path="05_Results.html"><a href="#datenverf%C3%BCgbarkeit"><i class="fa fa-check"></i><b>1.7</b> Datenverfügbarkeit</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#unstrukturierte-daten"><i class="fa fa-check"></i><b>1.8</b> Unstrukturierte Daten</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="introduction.html"><a href="introduction.html#portable-document-format"><i class="fa fa-check"></i><b>1.8.1</b> Portable Document Format</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html"><i class="fa fa-check"></i><b>2</b> Literature review (less than 10 p)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#nlp-history"><i class="fa fa-check"></i><b>2.1</b> NLP history</a></li>
<li class="chapter" data-level="2.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#basic-terms"><i class="fa fa-check"></i><b>2.2</b> Basic terms</a></li>
<li class="chapter" data-level="2.3" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#supervised-learning-approaches"><i class="fa fa-check"></i><b>2.3</b> Supervised Learning Approaches</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#generalized-linear-models"><i class="fa fa-check"></i><b>2.3.1</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="2.3.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#random-forest"><i class="fa fa-check"></i><b>2.3.2</b> Random Forest</a></li>
<li class="chapter" data-level="2.3.3" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#large-language-models"><i class="fa fa-check"></i><b>2.3.3</b> Large Language Models</a>
<ul>
<li class="chapter" data-level="2.3.3.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#embeddings"><i class="fa fa-check"></i><b>2.3.3.1</b> Embeddings</a></li>
<li class="chapter" data-level="2.3.3.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#neural-networks-in-nlp"><i class="fa fa-check"></i><b>2.3.3.2</b> Neural networks in NLP</a></li>
<li class="chapter" data-level="2.3.3.3" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#attention-multi-head"><i class="fa fa-check"></i><b>2.3.3.3</b> Attention / Multi-Head</a></li>
<li class="chapter" data-level="2.3.3.4" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#transformers"><i class="fa fa-check"></i><b>2.3.3.4</b> Transformers</a></li>
<li class="chapter" data-level="2.3.3.5" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#encoder"><i class="fa fa-check"></i><b>2.3.3.5</b> Encoder</a></li>
<li class="chapter" data-level="2.3.3.6" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#decoder"><i class="fa fa-check"></i><b>2.3.3.6</b> Decoder</a></li>
<li class="chapter" data-level="2.3.3.7" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#bert"><i class="fa fa-check"></i><b>2.3.3.7</b> BERT</a></li>
<li class="chapter" data-level="2.3.3.8" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#bi-encoder"><i class="fa fa-check"></i><b>2.3.3.8</b> Bi-Encoder</a></li>
<li class="chapter" data-level="2.3.3.9" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#mixture-of-experts"><i class="fa fa-check"></i><b>2.3.3.9</b> Mixture of Experts</a></li>
<li class="chapter" data-level="2.3.3.10" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#guided-decoding"><i class="fa fa-check"></i><b>2.3.3.10</b> Guided decoding</a></li>
<li class="chapter" data-level="2.3.3.11" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#classification-trained-models-not-used"><i class="fa fa-check"></i><b>2.3.3.11</b> Classification trained models (not used)</a></li>
<li class="chapter" data-level="2.3.3.12" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#few-shot-learning"><i class="fa fa-check"></i><b>2.3.3.12</b> Few-shot Learning</a></li>
<li class="chapter" data-level="2.3.3.13" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#rag"><i class="fa fa-check"></i><b>2.3.3.13</b> RAG</a></li>
<li class="chapter" data-level="2.3.3.14" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#gpt-generative-pretrained-transformers"><i class="fa fa-check"></i><b>2.3.3.14</b> GPT (Generative Pretrained Transformers)</a></li>
</ul></li>
<li class="chapter" data-level="2.3.4" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#information-extraction"><i class="fa fa-check"></i><b>2.3.4</b> Information extraction</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#data-balancing"><i class="fa fa-check"></i><b>2.4</b> Data balancing</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#under-sampling-oversampling"><i class="fa fa-check"></i><b>2.4.1</b> Under sampling, oversampling</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#evaluation-metrics"><i class="fa fa-check"></i><b>2.5</b> Evaluation Metrics</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#for-classification"><i class="fa fa-check"></i><b>2.5.1</b> For classification</a></li>
<li class="chapter" data-level="2.5.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#for-regression"><i class="fa fa-check"></i><b>2.5.2</b> For regression</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#technological-topic-related-work"><i class="fa fa-check"></i><b>2.6</b> Technological topic (related work)</a></li>
<li class="chapter" data-level="2.7" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#term-frequency"><i class="fa fa-check"></i><b>2.7</b> Term frequency</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#extraction-of-numeric-values"><i class="fa fa-check"></i><b>2.7.1</b> Extraction of numeric values</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#optinal-more-topics-like-previous"><i class="fa fa-check"></i><b>2.8</b> optinal more topics like previous</a></li>
<li class="chapter" data-level="2.9" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#summary-0.5-p"><i class="fa fa-check"></i><b>2.9</b> Summary (0.5 p)</a></li>
<li class="chapter" data-level="2.10" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#to-place-in-chapters-above-1"><i class="fa fa-check"></i><b>2.10</b> To place in chapters above</a></li>
<li class="chapter" data-level="2.11" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#table-extraction-tasks"><i class="fa fa-check"></i><b>2.11</b> Table extraction tasks</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#difficulties"><i class="fa fa-check"></i><b>2.11.1</b> Difficulties</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#document-extrtaction-process"><i class="fa fa-check"></i><b>2.12</b> Document Extrtaction Process</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#document-layout-analysis"><i class="fa fa-check"></i><b>2.12.1</b> Document Layout Analysis</a>
<ul>
<li class="chapter" data-level="2.12.1.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#vision-grid-transformer"><i class="fa fa-check"></i><b>2.12.1.1</b> Vision Grid Transformer</a></li>
</ul></li>
<li class="chapter" data-level="2.12.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#section-1"><i class="fa fa-check"></i><b>2.12.2</b> </a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#tools"><i class="fa fa-check"></i><b>2.13</b> Tools</a>
<ul>
<li class="chapter" data-level="2.13.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#tableformer"><i class="fa fa-check"></i><b>2.13.1</b> TableFormer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="methods.html"><a href="methods.html#data"><i class="fa fa-check"></i><b>3.1</b> Data</a></li>
<li class="chapter" data-level="3.2" data-path="methods.html"><a href="methods.html#page-identification"><i class="fa fa-check"></i><b>3.2</b> Page identification</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="methods.html"><a href="methods.html#baselines"><i class="fa fa-check"></i><b>3.2.1</b> Baselines</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="methods.html"><a href="methods.html#regex-based"><i class="fa fa-check"></i><b>3.2.1.1</b> Regex based</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="methods.html"><a href="methods.html#term-frequency-based"><i class="fa fa-check"></i><b>3.2.1.2</b> Term frequency based</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="methods.html"><a href="methods.html#table-detection"><i class="fa fa-check"></i><b>3.3</b> Table detection</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="methods.html"><a href="methods.html#llm"><i class="fa fa-check"></i><b>3.3.1</b> LLM</a></li>
<li class="chapter" data-level="3.3.2" data-path="methods.html"><a href="methods.html#vision-model"><i class="fa fa-check"></i><b>3.3.2</b> Vision Model</a></li>
<li class="chapter" data-level="3.3.3" data-path="methods.html"><a href="methods.html#docling-and-co"><i class="fa fa-check"></i><b>3.3.3</b> Docling and Co</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="methods.html"><a href="methods.html#information-extraction-1"><i class="fa fa-check"></i><b>3.4</b> Information extraction</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="methods.html"><a href="methods.html#baselines-1"><i class="fa fa-check"></i><b>3.4.1</b> Baselines</a></li>
<li class="chapter" data-level="3.4.2" data-path="methods.html"><a href="methods.html#simple-pipeline"><i class="fa fa-check"></i><b>3.4.2</b> Simple pipeline</a></li>
<li class="chapter" data-level="3.4.3" data-path="methods.html"><a href="methods.html#sophisticated-approaches"><i class="fa fa-check"></i><b>3.4.3</b> Sophisticated approaches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html"><i class="fa fa-check"></i><b>4</b> Implementation (max 5p)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html#speedup-with-vllm-and-batching"><i class="fa fa-check"></i><b>4.1</b> Speedup with vLLM and batching</a></li>
<li class="chapter" data-level="4.2" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html#setup-dockerfile-and-pv"><i class="fa fa-check"></i><b>4.2</b> Setup (Dockerfile and PV)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#page-identification-1"><i class="fa fa-check"></i><b>5.1</b> Page identification</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#regex-page-identification"><i class="fa fa-check"></i><b>5.1.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#table-of-contents-understanding"><i class="fa fa-check"></i><b>5.1.2</b> Table of Contents understanding</a>
<ul>
<li class="chapter" data-level="5.1.2.1" data-path="results.html"><a href="results.html#text-based"><i class="fa fa-check"></i><b>5.1.2.1</b> Text based</a></li>
<li class="chapter" data-level="5.1.2.2" data-path="results.html"><a href="results.html#comparison-of-the-different-approaches"><i class="fa fa-check"></i><b>5.1.2.2</b> Comparison of the different approaches</a></li>
</ul></li>
<li class="chapter" data-level="5.1.3" data-path="results.html"><a href="results.html#llm-page-identification"><i class="fa fa-check"></i><b>5.1.3</b> Classification with LLMs</a>
<ul>
<li class="chapter" data-level="5.1.3.1" data-path="results.html"><a href="results.html#binary-classification"><i class="fa fa-check"></i><b>5.1.3.1</b> Binary classification</a></li>
<li class="chapter" data-level="5.1.3.2" data-path="results.html"><a href="results.html#multi-classification"><i class="fa fa-check"></i><b>5.1.3.2</b> Multi classification</a></li>
</ul></li>
<li class="chapter" data-level="5.1.4" data-path="results.html"><a href="results.html#term-frequency-based-classifier"><i class="fa fa-check"></i><b>5.1.4</b> Term frequency based classifier</a>
<ul>
<li class="chapter" data-level="5.1.4.1" data-path="results.html"><a href="results.html#two-predictors"><i class="fa fa-check"></i><b>5.1.4.1</b> Two predictors</a></li>
<li class="chapter" data-level="5.1.4.2" data-path="results.html"><a href="results.html#four-predictors"><i class="fa fa-check"></i><b>5.1.4.2</b> Four predictors</a></li>
</ul></li>
<li class="chapter" data-level="5.1.5" data-path="results.html"><a href="results.html#comparison"><i class="fa fa-check"></i><b>5.1.5</b> Comparison</a>
<ul>
<li class="chapter" data-level="5.1.5.1" data-path="results.html"><a href="results.html#prediction-performance"><i class="fa fa-check"></i><b>5.1.5.1</b> Prediction performance</a></li>
<li class="chapter" data-level="5.1.5.2" data-path="results.html"><a href="results.html#energy-usage-and-runtime"><i class="fa fa-check"></i><b>5.1.5.2</b> Energy usage and runtime</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#table-extraction"><i class="fa fa-check"></i><b>5.2</b> Table extraction</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#baseline-regex"><i class="fa fa-check"></i><b>5.2.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#extraction-with-llms"><i class="fa fa-check"></i><b>5.2.2</b> Extraction with LLMs</a>
<ul>
<li class="chapter" data-level="5.2.2.1" data-path="results.html"><a href="results.html#real-tables-only"><i class="fa fa-check"></i><b>5.2.2.1</b> Real tables only</a></li>
<li class="chapter" data-level="5.2.2.2" data-path="results.html"><a href="results.html#synthetic-tables-only"><i class="fa fa-check"></i><b>5.2.2.2</b> Synthetic tables only</a></li>
<li class="chapter" data-level="5.2.2.3" data-path="results.html"><a href="results.html#extract-from-real-tables-with-synthetic-content"><i class="fa fa-check"></i><b>5.2.2.3</b> Extract from real tables with synthetic content</a></li>
</ul></li>
<li class="chapter" data-level="5.2.3" data-path="results.html"><a href="results.html#comparing-table-extraction-methods"><i class="fa fa-check"></i><b>5.2.3</b> Comparison</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>6</b> Discussion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="discussion.html"><a href="discussion.html#table-extraction-1"><i class="fa fa-check"></i><b>6.1</b> Table extraction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="discussion.html"><a href="discussion.html#regex-baseline"><i class="fa fa-check"></i><b>6.1.1</b> Regex baseline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="discussion.html"><a href="discussion.html#not-covered"><i class="fa fa-check"></i><b>6.2</b> Not covered</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="8" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>8</b> Appendix</a>
<ul>
<li class="chapter" data-level="8.1" data-path="appendix.html"><a href="appendix.html#local-machine"><i class="fa fa-check"></i><b>8.1</b> Local machine</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#system-details-report"><i class="fa fa-check"></i>System Details Report</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#report-details"><i class="fa fa-check"></i>Report details</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#hardware-information"><i class="fa fa-check"></i>Hardware Information:</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#software-information"><i class="fa fa-check"></i>Software Information:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="appendix.html"><a href="appendix.html#benchmarks"><i class="fa fa-check"></i><b>8.2</b> Benchmarks</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="appendix.html"><a href="appendix.html#text-extraction-benchmark"><i class="fa fa-check"></i><b>8.2.1</b> Text extraction</a></li>
<li class="chapter" data-level="8.2.2" data-path="appendix.html"><a href="appendix.html#table-detection-benchmark"><i class="fa fa-check"></i><b>8.2.2</b> Table detection</a></li>
<li class="chapter" data-level="8.2.3" data-path="appendix.html"><a href="appendix.html#large-language-model-process-speed"><i class="fa fa-check"></i><b>8.2.3</b> Large language model process speed</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="appendix.html"><a href="appendix.html#regex-page-identification-code"><i class="fa fa-check"></i><b>8.3</b> Regular expressions</a></li>
<li class="chapter" data-level="8.4" data-path="appendix.html"><a href="appendix.html#figures"><i class="fa fa-check"></i><b>8.4</b> Figures</a></li>
<li class="chapter" data-level="8.5" data-path="appendix.html"><a href="appendix.html#annual-comprehensive-financial-report-balance-sheet"><i class="fa fa-check"></i><b>8.5</b> Annual Comprehensive Financial Report Balance Sheet</a></li>
<li class="chapter" data-level="8.6" data-path="appendix.html"><a href="appendix.html#extraction-framework-flow-chart"><i class="fa fa-check"></i><b>8.6</b> Extraction framework flow chart</a></li>
<li class="chapter" data-level="8.7" data-path="appendix.html"><a href="appendix.html#regex-extraction-mistakes"><i class="fa fa-check"></i><b>8.7</b> Table extraction with regular expressions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extraction of tabular data from annual reports with LLMs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="results" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Results<a href="results.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="page-identification-1" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Page identification<a href="results.html#page-identification-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As described in <a href="appendix.html#text-extraction-benchmark">8.2.1</a> open source libraries have been used to extract the text from the annual reports.</p>
<div id="regex-page-identification" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Baseline: Regex<a href="results.html#regex-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="results.html#cb5-1" tabindex="-1"></a>data_page_identification_regex <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/page_identification_regex.rds&quot;</span>)</span>
<span id="cb5-2"><a href="results.html#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="results.html#cb5-3" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metrics</span>
<span id="cb5-4"><a href="results.html#cb5-4" tabindex="-1"></a>metric_summaries <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metric_summaries</span>
<span id="cb5-5"><a href="results.html#cb5-5" tabindex="-1"></a>metrics_by_company_and_type <span class="ot">&lt;-</span> data_page_identification_regex<span class="sc">$</span>metrics_by_company_and_type</span>
<span id="cb5-6"><a href="results.html#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="results.html#cb5-7" tabindex="-1"></a><span class="co"># Initialize a counter for the total page count</span></span>
<span id="cb5-8"><a href="results.html#cb5-8" tabindex="-1"></a>total_pages <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-9"><a href="results.html#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="results.html#cb5-10" tabindex="-1"></a><span class="co"># Get the list of PDF files in the specified directory</span></span>
<span id="cb5-11"><a href="results.html#cb5-11" tabindex="-1"></a>pdf_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;../Geschaeftsberichte&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.pdf$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-12"><a href="results.html#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="results.html#cb5-13" tabindex="-1"></a><span class="co"># Loop through each PDF file to count pages</span></span>
<span id="cb5-14"><a href="results.html#cb5-14" tabindex="-1"></a><span class="cf">for</span> (pdf_file <span class="cf">in</span> pdf_files) {</span>
<span id="cb5-15"><a href="results.html#cb5-15" tabindex="-1"></a>  <span class="co"># Use the pdftools package to count pages</span></span>
<span id="cb5-16"><a href="results.html#cb5-16" tabindex="-1"></a>  total_pages <span class="ot">&lt;-</span> total_pages <span class="sc">+</span> pdftools<span class="sc">::</span><span class="fu">pdf_info</span>(pdf_file)<span class="sc">$</span>pages</span>
<span id="cb5-17"><a href="results.html#cb5-17" tabindex="-1"></a>}</span>
<span id="cb5-18"><a href="results.html#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="results.html#cb5-19" tabindex="-1"></a><span class="co"># all tables that could have been found</span></span>
<span id="cb5-20"><a href="results.html#cb5-20" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;../benchmark_truth/aktiva_passiva_guv_table_pages_no_ocr.csv&quot;</span>)</span>
<span id="cb5-21"><a href="results.html#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="results.html#cb5-22" tabindex="-1"></a><span class="co"># Split the &quot;type&quot; column by &#39;&amp;&#39; and explode it into multiple rows</span></span>
<span id="cb5-23"><a href="results.html#cb5-23" tabindex="-1"></a>data_unnested <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="results.html#cb5-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">strsplit</span>(<span class="fu">as.character</span>(type), <span class="st">&quot;&amp;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="results.html#cb5-25" tabindex="-1"></a>  <span class="fu">unnest</span>(type)</span>
<span id="cb5-26"><a href="results.html#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="results.html#cb5-27" tabindex="-1"></a>num_tables <span class="ot">&lt;-</span> data_unnested <span class="sc">%&gt;%</span> </span>
<span id="cb5-28"><a href="results.html#cb5-28" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
</details>
<p>Building a sound regular expression often is an iterative process. In a first approach a very simple one was implemented.</p>
<p>Comparing the differences in the metrics based on the different text extraction libraries it can be said that the extracted text is very similar but not identical. Since the resukts are not depending on the used text extraction library the <em>exhaustive regex restricted</em> has only been run with the fast text extraction library <em>pdfium</em>. The results of the regex based page identification are presented in the following tables.</p>
<ul>
<li>look into details where they differ and if it is because of a line break or whitespace ?</li>
</ul>
<p>Due to the imbalanced distribution of the classes the accuracy is not a good metric to compare the performance of the different methods. The number of pages of interest is much smaller than the number of irrelevant pages. Therefore, precision, recall and F1 score are presented as well.</p>
<p>The regular expressions can be found in the appendix (see <a href="results.html#regex-page-identification">5.1.1</a>).</p>
<p>General bad precision. Increasing recall degrades precision even further. number of pages positive identified total; used as subset for table identification task</p>
<p><a href="results.html#tab:display-metrics-regex-page-identification-aktiva">5.1</a></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="results.html#cb6-1" tabindex="-1"></a>metric_summaries[<span class="st">&quot;Aktiva&quot;</span>][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="results.html#cb6-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb6-3"><a href="results.html#cb6-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb6-4"><a href="results.html#cb6-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb6-5"><a href="results.html#cb6-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-6"><a href="results.html#cb6-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb6-7"><a href="results.html#cb6-7" tabindex="-1"></a>      .</span>
<span id="cb6-8"><a href="results.html#cb6-8" tabindex="-1"></a>    )</span>
<span id="cb6-9"><a href="results.html#cb6-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="results.html#cb6-10" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(method)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="results.html#cb6-11" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb6-12"><a href="results.html#cb6-12" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llrrr&quot;</span>,</span>
<span id="cb6-13"><a href="results.html#cb6-13" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing page identification metrics for different regular expressions for classification task &#39;Aktiva&#39;&quot;</span>,</span>
<span id="cb6-14"><a href="results.html#cb6-14" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-aktiva">Table 5.1: </span>Comparing page identification metrics for different regular expressions for classification task ‘Aktiva’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-62355954b585527ef10a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-62355954b585527ef10a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["<b>0.267<\/b>","0.005","0.19",null,"0.13","0"],["0.778","0.01","0.98",null,"<b>0.993<\/b>","0.01"],["<b>0.397<\/b>","0.005","0.32",null,"0.23","0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="results.html#cb7-1" tabindex="-1"></a>metric_summaries[<span class="st">&quot;Passiva&quot;</span>][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="results.html#cb7-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb7-3"><a href="results.html#cb7-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb7-4"><a href="results.html#cb7-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb7-5"><a href="results.html#cb7-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-6"><a href="results.html#cb7-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb7-7"><a href="results.html#cb7-7" tabindex="-1"></a>      .</span>
<span id="cb7-8"><a href="results.html#cb7-8" tabindex="-1"></a>    )</span>
<span id="cb7-9"><a href="results.html#cb7-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(method)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="results.html#cb7-10" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing page identification metrics for different regular expressions for classification task &#39;Passiva&#39;&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-passiva">Table 5.2: </span>Comparing page identification metrics for different regular expressions for classification task ‘Passiva’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e8c449bd1a54c4014034" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e8c449bd1a54c4014034">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["<b>0.385<\/b>","0.005","0.19",null,"0.127","0.005"],["0.78","0.009","0.98",null,"<b>0.993<\/b>","0.01"],["<b>0.515<\/b>","0.005","0.32",null,"0.223","0.01"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="results.html#cb8-1" tabindex="-1"></a>metric_summaries[<span class="st">&quot;GuV&quot;</span>][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="results.html#cb8-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb8-3"><a href="results.html#cb8-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb8-4"><a href="results.html#cb8-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb8-5"><a href="results.html#cb8-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-6"><a href="results.html#cb8-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb8-7"><a href="results.html#cb8-7" tabindex="-1"></a>      .</span>
<span id="cb8-8"><a href="results.html#cb8-8" tabindex="-1"></a>    )</span>
<span id="cb8-9"><a href="results.html#cb8-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(method)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="results.html#cb8-10" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;llrrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing page identification metrics for different regular expressions for classification task &#39;Gewinn- und Verlustrechnung&#39;&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-guv">Table 5.3: </span>Comparing page identification metrics for different regular expressions for classification task ‘Gewinn- und Verlustrechnung’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3ed90b9d1978018f5a2d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3ed90b9d1978018f5a2d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["0.173","0.008","<b>0.21<\/b>",null,"0.172","0.004"],["0.752","0.004","<b>0.83<\/b>",null,"0.815","0.01"],["0.283","0.008","<b>0.34<\/b>",null,"0.282","0.004"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="results.html#cb9-1" tabindex="-1"></a>metrics <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="results.html#cb9-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-3"><a href="results.html#cb9-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(package, method, classification_type),</span>
<span id="cb9-4"><a href="results.html#cb9-4" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>,</span>
<span id="cb9-5"><a href="results.html#cb9-5" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb9-6"><a href="results.html#cb9-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="results.html#cb9-7" tabindex="-1"></a>  <span class="fu">filter</span>(metric <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb9-8"><a href="results.html#cb9-8" tabindex="-1"></a>    <span class="co"># &quot;acc&quot;, </span></span>
<span id="cb9-9"><a href="results.html#cb9-9" tabindex="-1"></a>    <span class="st">&quot;precision&quot;</span>, <span class="st">&quot;recall&quot;</span>, <span class="st">&quot;F1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="results.html#cb9-10" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-11"><a href="results.html#cb9-11" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> method, <span class="at">y =</span> value, <span class="at">color =</span> package), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb9-12"><a href="results.html#cb9-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(metric<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb9-13"><a href="results.html#cb9-13" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb9-14"><a href="results.html#cb9-14" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-15"><a href="results.html#cb9-15" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb9-16"><a href="results.html#cb9-16" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-1.png" width="100%" /></p>
<p>Results by company?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="results.html#cb10-1" tabindex="-1"></a>metrics_by_company_and_type <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="results.html#cb10-2" tabindex="-1"></a>    <span class="fu">select</span>(company, n_files, method, F1, precision, recall, classification_type) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="results.html#cb10-3" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(F1, precision, recall), <span class="at">names_to =</span> <span class="st">&quot;metric&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="results.html#cb10-4" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="results.html#cb10-5" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> value, <span class="at">fill =</span> n_files), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="results.html#cb10-6" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> value, <span class="at">color =</span> method), <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="results.html#cb10-7" tabindex="-1"></a>    <span class="fu">facet_grid</span>(classification_type<span class="sc">~</span>metric) <span class="sc">+</span></span>
<span id="cb10-8"><a href="results.html#cb10-8" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb10-9"><a href="results.html#cb10-9" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-10"><a href="results.html#cb10-10" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb10-11"><a href="results.html#cb10-11" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-details-1.png" width="100%" /></p>
</div>
<div id="table-of-contents-understanding" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Table of Contents understanding<a href="results.html#table-of-contents-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="results.html#cb11-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;scripts/page_identification_toc_data_loading.R&quot;</span>)</span></code></pre></div>
</details>
<p>An optional step for larger documents in <span class="citation">Li et al. (<a href="#ref-li_extracting_2023">2023</a>)</span> framework is to identify the pages of interest based on the table of contents (TOC). This would be more efficent than processing the whole document with an LLM. The TOC in a PDF can be given explicit and machine readable or it can be presented in form of text on any page. Of course it can be missing completely as well.</p>
<ul>
<li><p>For a lot of short annual reports one can find the tables of interest within the first eight pages as well.</p></li>
<li><p>calculate and add Qwen, Gemini or LLama results? &lt;– No time!</p></li>
</ul>
<div id="text-based" class="section level4 hasAnchor" number="5.1.2.1">
<h4><span class="header-section-number">5.1.2.1</span> Text based<a href="results.html#text-based" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="citation">Li et al. (<a href="#ref-li_extracting_2023">2023</a>)</span> used the table of contents to identify the pages of interest. In their approach the table of contents is extracted from the text. Based on their observation, that the TOC that “ACFRs typically spans no more than the initial 165 lines of the converted document” (p. 20), they use the first 200 lines of text.</p>
<p>My expectation was to find the TOC within the first five pages. Often we find way less than 200 lines of text on the five first pages (see Figure <a href="results.html#fig:page-identification-toc-histogram">5.1</a>). Some files are not machine readable without OCR and thus show zero lines in the first five pages as well.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="results.html#cb12-1" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">num_lines =</span> num_lines) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-2"><a href="results.html#cb12-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_lines), <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="results.html#cb12-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of lines in the first 5 pages&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-histogram"></span>
<img src="_main_files/figure-html/page-identification-toc-histogram-1.png" alt="Histogram of the number of lines in the first 5 pages of the annual reports" width="80%" />
<p class="caption">
Figure 5.1: Histogram of the number of lines in the first 5 pages of the annual reports
</p>
</div>
<div id="first-five-pages" class="section level5 hasAnchor" number="5.1.2.1.1">
<h5><span class="header-section-number">5.1.2.1.1</span> First five pages<a href="results.html#first-five-pages" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A request to Mistral results in 63 strings that should represent a table of contents among the first five pages [strings not checked in detail].</p>
</div>
<div id="first-200-lines" class="section level5 hasAnchor" number="5.1.2.1.2">
<h5><span class="header-section-number">5.1.2.1.2</span> First 200 lines<a href="results.html#first-200-lines" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A request to Mistral results in 68 strings that should represent a table of contents among the first five pages [strings not checked in detail].</p>
</div>
<div id="machine-readable-toc-based" class="section level5 hasAnchor" number="5.1.2.1.3">
<h5><span class="header-section-number">5.1.2.1.3</span> Machine readable TOC based<a href="results.html#machine-readable-toc-based" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To limit the text and hopefully increase the quality of the input data one can work with the TOC representation embedded within the PDF files. From 80 annual reports 43 files do have a machine readable separate table of contents and 37 do not have one.</p>
<p>One can see that correct predictions for the page range are more probable when the TOC has a medium number of entries. It is possible to drop PDFs with less than 9 without loosing a single correct prediction. This means that for PDFs with TOC with less then 9 entieres the LLM was not able to make a correct prediction. This is not surprising since neither <em>Bilanz</em> nor <em>Gewinn- und Verlustrechnung</em> are mentioned there.</p>
<p>Almost no influence if TOC is passed formated as markdown or json. With the json formated TOC it found two more correct page ranges (single test run). It was testes because the relation <em>page_number</em> heading and value might have been clearer in json for a linear working LLM.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="results.html#cb13-1" tabindex="-1"></a>df_toc_benchmark_mr_degration <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-2"><a href="results.html#cb13-2" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_entries, <span class="at">y =</span> value, <span class="at">fill =</span> correct)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="results.html#cb13-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(n_entries), <span class="at">y =</span> <span class="dv">100</span><span class="sc">*</span>perc_correct, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="results.html#cb13-4" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="results.html#cb13-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/page-identification-toc-mr-degration-1.png" width="672" /></p>
</div>
</div>
<div id="comparison-of-the-different-approaches" class="section level4 hasAnchor" number="5.1.2.2">
<h4><span class="header-section-number">5.1.2.2</span> Comparison of the different approaches<a href="results.html#comparison-of-the-different-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>toc analysis</li>
<li>cleaned measures</li>
</ul>
<p>The LLM performed best on the machine readable TOC. It resulted in highest ratio of correct page ranges as well as in highest absolute numbers even though there were least available TOC.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="results.html#cb14-1" tabindex="-1"></a>df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-2"><a href="results.html#cb14-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range, <span class="at">colour =</span> min_distance <span class="sc">&lt;=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="results.html#cb14-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb14-4"><a href="results.html#cb14-4" tabindex="-1"></a>    <span class="at">data =</span> df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-5"><a href="results.html#cb14-5" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb14-6"><a href="results.html#cb14-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb14-7"><a href="results.html#cb14-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb14-8"><a href="results.html#cb14-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb14-9"><a href="results.html#cb14-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-10"><a href="results.html#cb14-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb14-11"><a href="results.html#cb14-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb14-12"><a href="results.html#cb14-12" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb14-13"><a href="results.html#cb14-13" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb14-14"><a href="results.html#cb14-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb14-15"><a href="results.html#cb14-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-16"><a href="results.html#cb14-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="co"># +</span></span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-analysis"></span>
<img src="_main_files/figure-html/page-identification-toc-analysis-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
Figure 5.2: Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="results.html#cb15-1" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb15-2"><a href="results.html#cb15-2" tabindex="-1"></a>  <span class="co">#   legend.position = &quot;bottom&quot;</span></span>
<span id="cb15-3"><a href="results.html#cb15-3" tabindex="-1"></a>  <span class="co"># )</span></span></code></pre></div>
</details>
<p>Values can be higher than 80, the total number of PDF files, since there can be multiple tables of interested for the same type in a single document or a table of interest can span two pages. Since the prompt for the LLM was not elaborated enough to cover cases, where there are multiple tables of interest for a single type that are not placed on concurrent pages, one could argue to drop those files from the analysis. This does not change the results significantly, since there are only few files with more than one table of interest per type.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="results.html#cb16-1" tabindex="-1"></a>df_toc_benchmark_cleaned <span class="ot">&lt;-</span> df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(filepath, benchmark_type) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="results.html#cb16-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(count <span class="sc">&lt;=</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(type, benchmark_type) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="results.html#cb16-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-4"><a href="results.html#cb16-4" tabindex="-1"></a>    <span class="at">perc_correct =</span> <span class="fu">sum</span>(in_range)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb16-5"><a href="results.html#cb16-5" tabindex="-1"></a>  )</span>
<span id="cb16-6"><a href="results.html#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="results.html#cb16-7" tabindex="-1"></a> df_toc_benchmark_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="results.html#cb16-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-9"><a href="results.html#cb16-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="results.html#cb16-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb16-11"><a href="results.html#cb16-11" tabindex="-1"></a>    <span class="at">data =</span> df_toc_benchmark_cleaned <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-12"><a href="results.html#cb16-12" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb16-13"><a href="results.html#cb16-13" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb16-14"><a href="results.html#cb16-14" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb16-15"><a href="results.html#cb16-15" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb16-16"><a href="results.html#cb16-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-17"><a href="results.html#cb16-17" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb16-18"><a href="results.html#cb16-18" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb16-19"><a href="results.html#cb16-19" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb16-20"><a href="results.html#cb16-20" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb16-21"><a href="results.html#cb16-21" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb16-22"><a href="results.html#cb16-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-23"><a href="results.html#cb16-23" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/page-identification-toc-analysis-cleaned-1.png" width="672" /></p>
<p>Besides a single group that was predicted far off for the machine readable TOC approach the LLM reported higher confidence for the correct page ranges and got the ranges less far off. But it did not predict the smallest ranges.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="results.html#cb17-1" tabindex="-1"></a>mean_ranges <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="results.html#cb17-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb17-3"><a href="results.html#cb17-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb17-4"><a href="results.html#cb17-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb17-5"><a href="results.html#cb17-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-6"><a href="results.html#cb17-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb17-7"><a href="results.html#cb17-7" tabindex="-1"></a>      .</span>
<span id="cb17-8"><a href="results.html#cb17-8" tabindex="-1"></a>    )</span>
<span id="cb17-9"><a href="results.html#cb17-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="st">`</span><span class="at">mean range</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="results.html#cb17-10" tabindex="-1"></a>  <span class="fu">render_table</span>()</span></code></pre></div>
</details>
<div class="datatables html-widget html-fill-item" id="htmlwidget-969d1a23e52be8cfe504" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-969d1a23e52be8cfe504">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["5 pages","200 lines","machine readable"],["<b>2.35<\/b>","2.78","2.81"],["<b>1.79<\/b>","2.33","4.35"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark_type<\/th>\n      <th>mean range<\/th>\n      <th>SD range<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark_type","targets":1},{"name":"mean range","targets":2},{"name":"SD range","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="results.html#cb18-1" tabindex="-1"></a>df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(filepath, benchmark_type) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="results.html#cb18-2" tabindex="-1"></a>  <span class="fu">distance_confidence_plot</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="results.html#cb18-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="results.html#cb18-4" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-5"><a href="results.html#cb18-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb18-6"><a href="results.html#cb18-6" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/page-identification-toc-range_logprobs-1.png" width="100%" /></p>
<p>In general the LLM performed worst to identify the correct page range for <em>Passiva</em>. The median distance is one page bigger than for <em>Aktiva</em> and <em>Gewinn- und Verlustrechnung</em>. This makes sense for <em>Aktiva</em> because the <em>Passiva</em> is often on the next page but the predicted page range for <em>Aktiva</em> and <em>Passiva</em> are often identical. Furthermore the predicted page range for <em>Aktiva</em> is often only a single page wide. Thus the <em>Passiva</em> on the next page is not inside the predicted page range.</p>
<p>This problem was solved by explicitly mentioning that assets and liabilities are both part of the balance sheets for the five pages and 200 lines approach but not for the machine readable TOC one.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="results.html#cb19-1" tabindex="-1"></a>balanced_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-2"><a href="results.html#cb19-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">fill =</span> in_range, <span class="at">colour =</span> min_distance <span class="sc">&lt;=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="results.html#cb19-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb19-4"><a href="results.html#cb19-4" tabindex="-1"></a>    <span class="at">data =</span> balanced_df_toc_benchmark <span class="sc">%&gt;%</span> <span class="fu">filter</span>(in_range <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-5"><a href="results.html#cb19-5" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb19-6"><a href="results.html#cb19-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb19-7"><a href="results.html#cb19-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.2</span>,</span>
<span id="cb19-8"><a href="results.html#cb19-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb19-9"><a href="results.html#cb19-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-10"><a href="results.html#cb19-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb19-11"><a href="results.html#cb19-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">1</span><span class="sc">-</span>perc_correct, <span class="dv">2</span>), <span class="st">&quot;&quot;</span>)),</span>
<span id="cb19-12"><a href="results.html#cb19-12" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb19-13"><a href="results.html#cb19-13" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb19-14"><a href="results.html#cb19-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span></span>
<span id="cb19-15"><a href="results.html#cb19-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-16"><a href="results.html#cb19-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>benchmark_type, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="co"># +</span></span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-analysis-balanced"></span>
<img src="_main_files/figure-html/page-identification-toc-analysis-balanced-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
Figure 5.3: Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="results.html#cb20-1" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb20-2"><a href="results.html#cb20-2" tabindex="-1"></a>  <span class="co">#   legend.position = &quot;bottom&quot;</span></span>
<span id="cb20-3"><a href="results.html#cb20-3" tabindex="-1"></a>  <span class="co"># )</span></span></code></pre></div>
</details>
<p>A pragmatic way would be to use the machine readable TOC approachs prediction for the <em>Aktiva</em> page range and add one to the end page to get the <em>Passiva</em> page range. Beside the problem to predict a correct page range for <em>Passiva</em> the machine readable TOC approach was very effective and is also pretty efficient if one counts in the effort the LLM driven TOC extraction takes.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="results.html#cb21-1" tabindex="-1"></a>gpu_time_per_document_page_range <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(</span>
<span id="cb21-2"><a href="results.html#cb21-2" tabindex="-1"></a>  is.numeric, </span>
<span id="cb21-3"><a href="results.html#cb21-3" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb21-4"><a href="results.html#cb21-4" tabindex="-1"></a>    . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-5"><a href="results.html#cb21-5" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb21-6"><a href="results.html#cb21-6" tabindex="-1"></a>    .</span>
<span id="cb21-7"><a href="results.html#cb21-7" tabindex="-1"></a>  )</span>
<span id="cb21-8"><a href="results.html#cb21-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="results.html#cb21-9" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">alignment=</span><span class="st">&quot;lrr&quot;</span>, <span class="at">caption=</span><span class="st">&quot;Comparing GPU time for page range prediction and table of contents extraction&quot;</span>, <span class="at">ref=</span><span class="st">&quot;page-identification-toc-gpu-time-comparison&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:page-identification-toc-gpu-time-comparison">Table 5.4: </span>Comparing GPU time for page range prediction and table of contents extraction
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3afb22896dd07b3cea3f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3afb22896dd07b3cea3f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["5 pages","200 lines","machine readable"],["<b>0.56<\/b>","0.57","0.63"],["<b>2.19<\/b>","3.8",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Benchmark Type<\/th>\n      <th>Page range predicting<\/th>\n      <th>TOC extracting<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Benchmark Type","targets":1},{"name":"Page range predicting","targets":2},{"name":"TOC extracting","targets":3}],"scrollX":true,"dom":"tiprfl","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="llm-page-identification" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Classification with LLMs<a href="results.html#llm-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="results.html#cb22-1" tabindex="-1"></a>temp_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/page_identification_llm.rds&quot;</span>)</span>
<span id="cb22-2"><a href="results.html#cb22-2" tabindex="-1"></a>df_binary <span class="ot">&lt;-</span> temp_list<span class="sc">$</span>df_binary</span>
<span id="cb22-3"><a href="results.html#cb22-3" tabindex="-1"></a>df_multi <span class="ot">&lt;-</span> temp_list<span class="sc">$</span>df_multi</span>
<span id="cb22-4"><a href="results.html#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="results.html#cb22-5" tabindex="-1"></a>method_families <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;zero_shot&quot;</span>, <span class="st">&quot;law_context&quot;</span>, <span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>, <span class="st">&#39;n_rag_examples&#39;</span>)</span>
<span id="cb22-6"><a href="results.html#cb22-6" tabindex="-1"></a>method_familiy_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-7"><a href="results.html#cb22-7" tabindex="-1"></a>  <span class="st">&quot;zero_shot&quot;</span> <span class="ot">=</span> <span class="st">&quot;#e41a1c&quot;</span>, </span>
<span id="cb22-8"><a href="results.html#cb22-8" tabindex="-1"></a>  <span class="st">&quot;law_context&quot;</span> <span class="ot">=</span> <span class="st">&quot;#377eb8&quot;</span>, </span>
<span id="cb22-9"><a href="results.html#cb22-9" tabindex="-1"></a>  <span class="st">&quot;top_n_rag_examples&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4daf4a&quot;</span>, </span>
<span id="cb22-10"><a href="results.html#cb22-10" tabindex="-1"></a>  <span class="st">&quot;n_random_examples&quot;</span> <span class="ot">=</span> <span class="st">&quot;#984ea3&quot;</span>, </span>
<span id="cb22-11"><a href="results.html#cb22-11" tabindex="-1"></a>  <span class="st">&#39;n_rag_examples&#39;</span> <span class="ot">=</span> <span class="st">&quot;#ff7f00&quot;</span></span>
<span id="cb22-12"><a href="results.html#cb22-12" tabindex="-1"></a>  )</span>
<span id="cb22-13"><a href="results.html#cb22-13" tabindex="-1"></a></span>
<span id="cb22-14"><a href="results.html#cb22-14" tabindex="-1"></a>df_binary <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(model, <span class="st">&quot;gemma&quot;</span>) <span class="sc">||</span> <span class="fu">str_detect</span>(model, <span class="st">&quot;0-9-1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-15"><a href="results.html#cb22-15" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-16"><a href="results.html#cb22-16" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">as.numeric</span>(n_examples),</span>
<span id="cb22-17"><a href="results.html#cb22-17" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>, <span class="dv">0</span>, n_examples),</span>
<span id="cb22-18"><a href="results.html#cb22-18" tabindex="-1"></a>  <span class="at">n_examples =</span> <span class="fu">if_else</span>(method_family <span class="sc">==</span> <span class="st">&quot;law_context&quot;</span>, <span class="dv">1</span>, n_examples),</span>
<span id="cb22-19"><a href="results.html#cb22-19" tabindex="-1"></a>  <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_families)</span>
<span id="cb22-20"><a href="results.html#cb22-20" tabindex="-1"></a>)</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="results.html#cb23-1" tabindex="-1"></a>binary_task <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-2"><a href="results.html#cb23-2" tabindex="-1"></a>binary_task<span class="sc">$</span>n_models <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>model <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb23-3"><a href="results.html#cb23-3" tabindex="-1"></a>binary_task<span class="sc">$</span>n_model_families <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>model_family <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span>
<span id="cb23-4"><a href="results.html#cb23-4" tabindex="-1"></a>binary_task<span class="sc">$</span>n_method_families <span class="ot">&lt;-</span> df_binary<span class="sc">$</span>method_family <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span></code></pre></div>
</details>
<p>structured outputs forcing to answer with a <em>yes</em> or <em>no</em> for binary task or with <em>Aktiva</em>, <em>Passiva</em>, <em>GuV</em> or <em>other</em> for multi classification task</p>
<p>top n accuracy</p>
<p>out of company vs in compnay rag</p>
<div id="binary-classification" class="section level4 hasAnchor" number="5.1.3.1">
<h4><span class="header-section-number">5.1.3.1</span> Binary classification<a href="results.html#binary-classification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Could be more efficient to predict “is any of interest” and then which type, because dataset is highly imbalanced.</p>
<p>24 models from 6 haven been benchmarked among 5 methods</p>
<p>Most models have been used up to 3 examples for the context.</p>
<p>The best combination of model and method for each method family is presented in the following table. It is clear that the Google Gemma models are performing worst.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Surprisingly Mistral 2410 is the best performing model for all three prediction tasks even though it only has 8B parameters.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="results.html#cb24-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="results.html#cb24-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="results.html#cb24-3" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="results.html#cb24-4" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, classification_type) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="results.html#cb24-5" tabindex="-1"></a>  <span class="fu">filter</span>(f1_score <span class="sc">==</span> <span class="fu">max</span>(f1_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="results.html#cb24-6" tabindex="-1"></a>  <span class="co"># mutate(</span></span>
<span id="cb24-7"><a href="results.html#cb24-7" tabindex="-1"></a>  <span class="co">#   n = n()</span></span>
<span id="cb24-8"><a href="results.html#cb24-8" tabindex="-1"></a>  <span class="co"># ) %&gt;% filter(n &gt; 1)</span></span>
<span id="cb24-9"><a href="results.html#cb24-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="co"># head(10) %&gt;% </span></span>
<span id="cb24-10"><a href="results.html#cb24-10" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, classification_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="results.html#cb24-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-12"><a href="results.html#cb24-12" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb24-13"><a href="results.html#cb24-13" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb24-14"><a href="results.html#cb24-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb24-15"><a href="results.html#cb24-15" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb24-16"><a href="results.html#cb24-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-17"><a href="results.html#cb24-17" tabindex="-1"></a>  <span class="fu">render_table</span>()</span></code></pre></div>
</details>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1c610e711bf08b4f1c8a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1c610e711bf08b4f1c8a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["mistralai","meta-llama","mistralai","mistralai","Qwen","meta-llama","Qwen","Qwen","meta-llama","Qwen","microsoft","microsoft","google","google","tiiuae","google","tiiuae","tiiuae"],["mistralai_Ministral-8B-Instruct-2410","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","Qwen_Qwen2.5-32B-Instruct","meta-llama_Llama-4-Scout-17B-16E-Instruct","Qwen_Qwen2.5-32B-Instruct","Qwen_Qwen3-235B-A22B-Instruct-2507","meta-llama_Llama-4-Scout-17B-16E-Instruct","Qwen_Qwen2.5-32B-Instruct","microsoft_phi-4","microsoft_phi-4","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct"],["GuV","GuV","Passiva","Aktiva","GuV","Passiva","Aktiva","Aktiva","Aktiva","Passiva","Aktiva","Passiva","Passiva","Aktiva","Passiva","GuV","Aktiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","law_context","law_context","n_rag_examples","n_rag_examples","n_random_examples","n_rag_examples","n_rag_examples","top_n_rag_examples"],["3","3","3","3","1","3","1","3","3","1","1","1","1","1","1","1","1","1"],["0.93","0.92","0.92","0.92","0.87","0.85","0.84","0.84","0.83","0.79","0.68","0.65","0.54","0.51","0.5","0.49","0.44","0.33"],["917","4062","858","878","1985","3037","1806","7442","3052","1967","169","299","1849","2588","469","1800","1065","205"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>classification_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"classification_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>It is interesting that the predictions do not get better by providing more and more examples. Especially for the n-rag-example approach we find a significant drop in the F1 score if the examples pages come from different companies annual reports. This is caused by a sever recall drop. But also for the n-ranom-example approach we see this for the prediction of class Passiva.</p>
<p>Recall better with examples from same company. Precision better without.</p>
<p>We can also see that the prediction performance is stable.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="results.html#cb25-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;mistralai_Ministral-8B-Instruct-2410&quot;</span>, loop <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="results.html#cb25-2" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="results.html#cb25-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb25-4"><a href="results.html#cb25-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="results.html#cb25-5" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-6"><a href="results.html#cb25-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="results.html#cb25-7" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="sc">+</span></span>
<span id="cb25-8"><a href="results.html#cb25-8" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb25-9"><a href="results.html#cb25-9" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb25-10"><a href="results.html#cb25-10" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb25-11"><a href="results.html#cb25-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>),</span>
<span id="cb25-12"><a href="results.html#cb25-12" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb25-13"><a href="results.html#cb25-13" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="100%" /></p>
<ul>
<li>f1</li>
<li>multiple models</li>
<li>best model detail (different methods / settings)</li>
</ul>
<p>The experiments for the best performing model, Ministral-8B-Instruct-2410, have been extended by methods with even more examples. Especially for the top-n-rag-example approach to get a better comparable picture based on the real number of examples / context length.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="results.html#cb26-1" tabindex="-1"></a>df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;mistralai_Ministral-8B-Instruct-2410&quot;</span>, loop <span class="sc">&lt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="results.html#cb26-2" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="results.html#cb26-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb26-4"><a href="results.html#cb26-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="results.html#cb26-5" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-6"><a href="results.html#cb26-6" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="sc">+</span></span>
<span id="cb26-7"><a href="results.html#cb26-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb26-8"><a href="results.html#cb26-8" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>classification_type) <span class="sc">+</span></span>
<span id="cb26-9"><a href="results.html#cb26-9" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb26-10"><a href="results.html#cb26-10" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb26-11"><a href="results.html#cb26-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>),</span>
<span id="cb26-12"><a href="results.html#cb26-12" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb26-13"><a href="results.html#cb26-13" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="results.html#cb27-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_truth/real_example_count.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
approach
</th>
<th style="text-align:left;">
classification
</th>
<th style="text-align:right;">
n_example
</th>
<th style="text-align:right;">
target
</th>
<th style="text-align:right;">
other
</th>
<th style="text-align:right;">
sum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
13
</td>
</tr>
</tbody>
</table>
<p>Predictions very accurate. Confidence not always 1. Wrong predictions with often with medium confidence. If Aktiva and Passiva on same page more often Aktiva predicted. Confidence for no displayed as 1-confidence to represent confidence for yes (binary classification).</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="results.html#cb28-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="results.html#cb28-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb28-3"><a href="results.html#cb28-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb28-4"><a href="results.html#cb28-4" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="results.html#cb28-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-6"><a href="results.html#cb28-6" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb28-7"><a href="results.html#cb28-7" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb28-8"><a href="results.html#cb28-8" tabindex="-1"></a>  )</span>
<span id="cb28-9"><a href="results.html#cb28-9" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb28-10"><a href="results.html#cb28-10" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb28-11"><a href="results.html#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="results.html#cb28-12" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="results.html#cb28-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-14"><a href="results.html#cb28-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb28-15"><a href="results.html#cb28-15" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="results.html#cb28-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb28-17"><a href="results.html#cb28-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb28-18"><a href="results.html#cb28-18" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<p>Qwen returns always high confidence even if it is wrong.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="results.html#cb29-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>, model_family<span class="sc">==</span><span class="st">&quot;Qwen&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="results.html#cb29-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb29-3"><a href="results.html#cb29-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb29-4"><a href="results.html#cb29-4" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="results.html#cb29-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-6"><a href="results.html#cb29-6" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb29-7"><a href="results.html#cb29-7" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb29-8"><a href="results.html#cb29-8" tabindex="-1"></a>  )</span>
<span id="cb29-9"><a href="results.html#cb29-9" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb29-10"><a href="results.html#cb29-10" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb29-11"><a href="results.html#cb29-11" tabindex="-1"></a></span>
<span id="cb29-12"><a href="results.html#cb29-12" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb29-13"><a href="results.html#cb29-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-14"><a href="results.html#cb29-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb29-15"><a href="results.html#cb29-15" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb29-16"><a href="results.html#cb29-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb29-17"><a href="results.html#cb29-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb29-18"><a href="results.html#cb29-18" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
<ul>
<li>IBB other law</li>
<li>degewo only one where no ocr is needed</li>
</ul>
<p>mistral: recall IBB and Netzholding big range
meta &amp; mistral: very high precision for Amt für Statistik BBB &lt;- lowest average pagecount (29.3) but IBB has more pages than berlinovo but better precision. No information about which company / report the page is from</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="results.html#cb30-1" tabindex="-1"></a>no_ocr_needed <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_truth/aktiva_passiva_guv_table_pages_no_ocr.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="results.html#cb30-2" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">filepath =</span> <span class="fu">str_replace</span>(filepath, <span class="st">&quot;..&quot;</span>, <span class="st">&quot;/pvc&quot;</span>)) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb30-3"><a href="results.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="results.html#cb30-4" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb30-5"><a href="results.html#cb30-5" tabindex="-1"></a></span>
<span id="cb30-6"><a href="results.html#cb30-6" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;Aktiva&#39;</span>, <span class="st">&#39;Passiva&#39;</span>, <span class="st">&#39;GuV&#39;</span>)) {</span>
<span id="cb30-7"><a href="results.html#cb30-7" tabindex="-1"></a>  df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> t) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="results.html#cb30-8" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model, method, predictions, model_family, method_family)</span>
<span id="cb30-9"><a href="results.html#cb30-9" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(filepath <span class="sc">%in%</span> no_ocr_needed)</span>
<span id="cb30-10"><a href="results.html#cb30-10" tabindex="-1"></a>  </span>
<span id="cb30-11"><a href="results.html#cb30-11" tabindex="-1"></a>  df_f1_by_company <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company, predicted_type, match, model,model_family, method, method_family) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(</span>
<span id="cb30-12"><a href="results.html#cb30-12" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb30-13"><a href="results.html#cb30-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">complete</span>(company, predicted_type, match, model,model_family, method, method_family,<span class="at">fill=</span><span class="fu">list</span>(<span class="at">n=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="results.html#cb30-14" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-15"><a href="results.html#cb30-15" tabindex="-1"></a>      <span class="at">metric =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> t <span class="sc">&amp;</span> match, <span class="st">&quot;true_positive&quot;</span>, <span class="st">&#39;&#39;</span>),</span>
<span id="cb30-16"><a href="results.html#cb30-16" tabindex="-1"></a>      <span class="at">metric =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> t <span class="sc">&amp;</span> <span class="sc">!</span>match, <span class="st">&quot;false_positive&quot;</span>, metric),</span>
<span id="cb30-17"><a href="results.html#cb30-17" tabindex="-1"></a>      <span class="at">metric =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">!=</span> t <span class="sc">&amp;</span> <span class="sc">!</span>match, <span class="st">&quot;false_negative&quot;</span>, metric),</span>
<span id="cb30-18"><a href="results.html#cb30-18" tabindex="-1"></a>      <span class="at">metric =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">!=</span> t <span class="sc">&amp;</span> match, <span class="st">&quot;true_negative&quot;</span>, metric),</span>
<span id="cb30-19"><a href="results.html#cb30-19" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>predicted_type, <span class="sc">-</span>match) <span class="sc">%&gt;%</span> </span>
<span id="cb30-20"><a href="results.html#cb30-20" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> metric, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb30-21"><a href="results.html#cb30-21" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb30-22"><a href="results.html#cb30-22" tabindex="-1"></a>      <span class="at">precision =</span> true_positive<span class="sc">/</span>(true_positive<span class="sc">+</span>false_positive),</span>
<span id="cb30-23"><a href="results.html#cb30-23" tabindex="-1"></a>      <span class="at">recall =</span> true_positive<span class="sc">/</span>(true_positive<span class="sc">+</span>false_negative),</span>
<span id="cb30-24"><a href="results.html#cb30-24" tabindex="-1"></a>      <span class="at">f1_score =</span> <span class="dv">2</span><span class="sc">*</span>precision<span class="sc">*</span>recall<span class="sc">/</span>(precision<span class="sc">+</span>recall),</span>
<span id="cb30-25"><a href="results.html#cb30-25" tabindex="-1"></a>      <span class="at">classification_type =</span> t</span>
<span id="cb30-26"><a href="results.html#cb30-26" tabindex="-1"></a>    )</span>
<span id="cb30-27"><a href="results.html#cb30-27" tabindex="-1"></a>  </span>
<span id="cb30-28"><a href="results.html#cb30-28" tabindex="-1"></a>  l[t] <span class="ot">&lt;-</span> <span class="fu">list</span>(df_f1_by_company)</span>
<span id="cb30-29"><a href="results.html#cb30-29" tabindex="-1"></a>}</span>
<span id="cb30-30"><a href="results.html#cb30-30" tabindex="-1"></a></span>
<span id="cb30-31"><a href="results.html#cb30-31" tabindex="-1"></a>df_f1_by_company <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(l)</span>
<span id="cb30-32"><a href="results.html#cb30-32" tabindex="-1"></a></span>
<span id="cb30-33"><a href="results.html#cb30-33" tabindex="-1"></a>df_f1_by_company <span class="sc">%&gt;%</span> </span>
<span id="cb30-34"><a href="results.html#cb30-34" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>model_family <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;microsoft&#39;</span>, <span class="st">&#39;tiiuae&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-35"><a href="results.html#cb30-35" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-36"><a href="results.html#cb30-36" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> company, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb30-37"><a href="results.html#cb30-37" tabindex="-1"></a>  <span class="co"># geom_jitter(aes(x = company, y = f1_score, color = model), alpha = .4) +</span></span>
<span id="cb30-38"><a href="results.html#cb30-38" tabindex="-1"></a>  <span class="fu">facet_grid</span>(classification_type<span class="sc">~</span>model_family) <span class="sc">+</span></span>
<span id="cb30-39"><a href="results.html#cb30-39" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>))</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="results.html#cb31-1" tabindex="-1"></a>n_reports_by_company_no_ocr <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">select</span>(company, filepath) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb31-2"><a href="results.html#cb31-2" tabindex="-1"></a>n_reports_by_company <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">select</span>(company, filepath) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb31-3"><a href="results.html#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="results.html#cb31-4" tabindex="-1"></a>n_reports_by_company_no_ocr <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
company
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Amt für Statistik Berlin-Brandenburg
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlin Energie und Netzholding
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Berliner Bäder Betriebe
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlinovo
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
GESOBAU AG
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
IBB
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
degewo AG
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="results.html#cb32-1" tabindex="-1"></a>n_reports_by_company <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
company
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Amt für Statistik Berlin-Brandenburg
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlin Energie und Netzholding
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Berliner Bäder Betriebe
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlinovo
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
GESOBAU AG
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
IBB
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
degewo AG
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
<ul>
<li>Performance makes a jump at a critical parameter number (3B) then slow increase (compare Qwen 2.5)</li>
<li>Changes unsystematic with new models (see Mistral, Qwen 3 old vs llama 4)</li>
</ul>
<p>PR curves for all classes look very alike- showing micro average curve</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="results.html#cb33-1" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb33-2"><a href="results.html#cb33-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb33-3"><a href="results.html#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="results.html#cb33-4" tabindex="-1"></a>model_rank <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb33-5"><a href="results.html#cb33-5" tabindex="-1"></a>l_temp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-6"><a href="results.html#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="results.html#cb33-7" tabindex="-1"></a><span class="cf">for</span> (target <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;Aktiva&#39;</span>, <span class="st">&#39;GuV&#39;</span>, <span class="st">&#39;Passiva&#39;</span>)) {</span>
<span id="cb33-8"><a href="results.html#cb33-8" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="st">&quot;Aktiva&quot;</span></span>
<span id="cb33-9"><a href="results.html#cb33-9" tabindex="-1"></a>  df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> t,</span>
<span id="cb33-10"><a href="results.html#cb33-10" tabindex="-1"></a>      loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-11"><a href="results.html#cb33-11" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb33-12"><a href="results.html#cb33-12" tabindex="-1"></a>  model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb33-13"><a href="results.html#cb33-13" tabindex="-1"></a>  method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb33-14"><a href="results.html#cb33-14" tabindex="-1"></a>  </span>
<span id="cb33-15"><a href="results.html#cb33-15" tabindex="-1"></a>  df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="results.html#cb33-16" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb33-17"><a href="results.html#cb33-17" tabindex="-1"></a>      classification_type <span class="sc">==</span> target,</span>
<span id="cb33-18"><a href="results.html#cb33-18" tabindex="-1"></a>      model <span class="sc">==</span> model_name_best_f1_aktiva,</span>
<span id="cb33-19"><a href="results.html#cb33-19" tabindex="-1"></a>      method <span class="sc">==</span> method__best_f1_aktiva,</span>
<span id="cb33-20"><a href="results.html#cb33-20" tabindex="-1"></a>      loop <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb33-21"><a href="results.html#cb33-21" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-22"><a href="results.html#cb33-22" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb33-23"><a href="results.html#cb33-23" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb33-24"><a href="results.html#cb33-24" tabindex="-1"></a>  df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb33-25"><a href="results.html#cb33-25" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb33-26"><a href="results.html#cb33-26" tabindex="-1"></a>      <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb33-27"><a href="results.html#cb33-27" tabindex="-1"></a>      <span class="at">target =</span> target</span>
<span id="cb33-28"><a href="results.html#cb33-28" tabindex="-1"></a>    )</span>
<span id="cb33-29"><a href="results.html#cb33-29" tabindex="-1"></a>  l_temp[target] <span class="ot">&lt;-</span> <span class="fu">list</span>(df_flipped_score)</span>
<span id="cb33-30"><a href="results.html#cb33-30" tabindex="-1"></a>}</span>
<span id="cb33-31"><a href="results.html#cb33-31" tabindex="-1"></a></span>
<span id="cb33-32"><a href="results.html#cb33-32" tabindex="-1"></a>df_temp2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(l_temp) <span class="co"># %&gt;% filter(target == &quot;Passiva&quot;)</span></span>
<span id="cb33-33"><a href="results.html#cb33-33" tabindex="-1"></a><span class="co"># plot(pr_obj, color = &quot;orange&quot;, main = &quot;Precision-Recall Curve&quot;)</span></span>
<span id="cb33-34"><a href="results.html#cb33-34" tabindex="-1"></a></span>
<span id="cb33-35"><a href="results.html#cb33-35" tabindex="-1"></a>pr_obj <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> df_temp2<span class="sc">$</span>confidence_score[df_temp2<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb33-36"><a href="results.html#cb33-36" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> df_temp2<span class="sc">$</span>confidence_score[df_temp2<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb33-37"><a href="results.html#cb33-37" tabindex="-1"></a>                   <span class="at">curve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-38"><a href="results.html#cb33-38" tabindex="-1"></a></span>
<span id="cb33-39"><a href="results.html#cb33-39" tabindex="-1"></a><span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb33-40"><a href="results.html#cb33-40" tabindex="-1"></a></span>
<span id="cb33-41"><a href="results.html#cb33-41" tabindex="-1"></a>pr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb33-42"><a href="results.html#cb33-42" tabindex="-1"></a>  <span class="at">recall =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">1</span>],</span>
<span id="cb33-43"><a href="results.html#cb33-43" tabindex="-1"></a>  <span class="at">precision =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">2</span>],</span>
<span id="cb33-44"><a href="results.html#cb33-44" tabindex="-1"></a>  <span class="at">threshold =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">3</span>]</span>
<span id="cb33-45"><a href="results.html#cb33-45" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb33-46"><a href="results.html#cb33-46" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb33-47"><a href="results.html#cb33-47" tabindex="-1"></a></span>
<span id="cb33-48"><a href="results.html#cb33-48" tabindex="-1"></a>pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(pr_obj<span class="sc">$</span>auc.integral, <span class="dv">3</span>)</span>
<span id="cb33-49"><a href="results.html#cb33-49" tabindex="-1"></a></span>
<span id="cb33-50"><a href="results.html#cb33-50" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb33-51"><a href="results.html#cb33-51" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb33-52"><a href="results.html#cb33-52" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-53"><a href="results.html#cb33-53" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-54"><a href="results.html#cb33-54" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-55"><a href="results.html#cb33-55" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Precision-Recall Curve (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb33-56"><a href="results.html#cb33-56" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">str_c</span>(model_name_best_f1_aktiva, <span class="st">&quot; with &quot;</span>, method__best_f1_aktiva),</span>
<span id="cb33-57"><a href="results.html#cb33-57" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb33-58"><a href="results.html#cb33-58" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb33-59"><a href="results.html#cb33-59" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-60"><a href="results.html#cb33-60" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb33-61"><a href="results.html#cb33-61" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-62"><a href="results.html#cb33-62" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb33-63"><a href="results.html#cb33-63" tabindex="-1"></a>  )</span>
<span id="cb33-64"><a href="results.html#cb33-64" tabindex="-1"></a></span>
<span id="cb33-65"><a href="results.html#cb33-65" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb33-66"><a href="results.html#cb33-66" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb33-67"><a href="results.html#cb33-67" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-68"><a href="results.html#cb33-68" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-69"><a href="results.html#cb33-69" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-70"><a href="results.html#cb33-70" tabindex="-1"></a>    <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb33-71"><a href="results.html#cb33-71" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb33-72"><a href="results.html#cb33-72" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb33-73"><a href="results.html#cb33-73" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb33-74"><a href="results.html#cb33-74" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-75"><a href="results.html#cb33-75" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb33-76"><a href="results.html#cb33-76" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-77"><a href="results.html#cb33-77" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb33-78"><a href="results.html#cb33-78" tabindex="-1"></a>  )</span>
<span id="cb33-79"><a href="results.html#cb33-79" tabindex="-1"></a></span>
<span id="cb33-80"><a href="results.html#cb33-80" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-binary-1-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="results.html#cb34-1" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb34-2"><a href="results.html#cb34-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb34-3"><a href="results.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="results.html#cb34-4" tabindex="-1"></a>l_temp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb34-5"><a href="results.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="results.html#cb34-6" tabindex="-1"></a><span class="cf">for</span> (target <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;Aktiva&#39;</span>, <span class="st">&#39;GuV&#39;</span>, <span class="st">&#39;Passiva&#39;</span>)) {</span>
<span id="cb34-7"><a href="results.html#cb34-7" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="st">&quot;Aktiva&quot;</span></span>
<span id="cb34-8"><a href="results.html#cb34-8" tabindex="-1"></a>  df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> t,</span>
<span id="cb34-9"><a href="results.html#cb34-9" tabindex="-1"></a>      loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="results.html#cb34-10" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb34-11"><a href="results.html#cb34-11" tabindex="-1"></a>  model_rank <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(df_filtered)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb34-12"><a href="results.html#cb34-12" tabindex="-1"></a>  </span>
<span id="cb34-13"><a href="results.html#cb34-13" tabindex="-1"></a>  model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb34-14"><a href="results.html#cb34-14" tabindex="-1"></a>  method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb34-15"><a href="results.html#cb34-15" tabindex="-1"></a>  </span>
<span id="cb34-16"><a href="results.html#cb34-16" tabindex="-1"></a>  df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb34-17"><a href="results.html#cb34-17" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb34-18"><a href="results.html#cb34-18" tabindex="-1"></a>      classification_type <span class="sc">==</span> target,</span>
<span id="cb34-19"><a href="results.html#cb34-19" tabindex="-1"></a>      model <span class="sc">==</span> model_name_best_f1_aktiva,</span>
<span id="cb34-20"><a href="results.html#cb34-20" tabindex="-1"></a>      method <span class="sc">==</span> method__best_f1_aktiva,</span>
<span id="cb34-21"><a href="results.html#cb34-21" tabindex="-1"></a>      loop <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb34-22"><a href="results.html#cb34-22" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-23"><a href="results.html#cb34-23" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb34-24"><a href="results.html#cb34-24" tabindex="-1"></a>  df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb34-25"><a href="results.html#cb34-25" tabindex="-1"></a>  df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb34-26"><a href="results.html#cb34-26" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-27"><a href="results.html#cb34-27" tabindex="-1"></a>      <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb34-28"><a href="results.html#cb34-28" tabindex="-1"></a>      <span class="at">target =</span> target</span>
<span id="cb34-29"><a href="results.html#cb34-29" tabindex="-1"></a>    )</span>
<span id="cb34-30"><a href="results.html#cb34-30" tabindex="-1"></a>  l_temp[target] <span class="ot">&lt;-</span> <span class="fu">list</span>(df_flipped_score)</span>
<span id="cb34-31"><a href="results.html#cb34-31" tabindex="-1"></a>}</span>
<span id="cb34-32"><a href="results.html#cb34-32" tabindex="-1"></a></span>
<span id="cb34-33"><a href="results.html#cb34-33" tabindex="-1"></a>df_temp2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(l_temp) <span class="co"># %&gt;% filter(target == &quot;Passiva&quot;)</span></span>
<span id="cb34-34"><a href="results.html#cb34-34" tabindex="-1"></a><span class="co"># plot(pr_obj, color = &quot;orange&quot;, main = &quot;Precision-Recall Curve&quot;)</span></span>
<span id="cb34-35"><a href="results.html#cb34-35" tabindex="-1"></a></span>
<span id="cb34-36"><a href="results.html#cb34-36" tabindex="-1"></a>pr_obj <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> df_temp2<span class="sc">$</span>confidence_score[df_temp2<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb34-37"><a href="results.html#cb34-37" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> df_temp2<span class="sc">$</span>confidence_score[df_temp2<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb34-38"><a href="results.html#cb34-38" tabindex="-1"></a>                   <span class="at">curve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-39"><a href="results.html#cb34-39" tabindex="-1"></a></span>
<span id="cb34-40"><a href="results.html#cb34-40" tabindex="-1"></a><span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb34-41"><a href="results.html#cb34-41" tabindex="-1"></a></span>
<span id="cb34-42"><a href="results.html#cb34-42" tabindex="-1"></a>pr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-43"><a href="results.html#cb34-43" tabindex="-1"></a>  <span class="at">recall =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">1</span>],</span>
<span id="cb34-44"><a href="results.html#cb34-44" tabindex="-1"></a>  <span class="at">precision =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">2</span>],</span>
<span id="cb34-45"><a href="results.html#cb34-45" tabindex="-1"></a>  <span class="at">threshold =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">3</span>]</span>
<span id="cb34-46"><a href="results.html#cb34-46" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-47"><a href="results.html#cb34-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb34-48"><a href="results.html#cb34-48" tabindex="-1"></a></span>
<span id="cb34-49"><a href="results.html#cb34-49" tabindex="-1"></a>pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(pr_obj<span class="sc">$</span>auc.integral, <span class="dv">3</span>)</span>
<span id="cb34-50"><a href="results.html#cb34-50" tabindex="-1"></a></span>
<span id="cb34-51"><a href="results.html#cb34-51" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb34-52"><a href="results.html#cb34-52" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb34-53"><a href="results.html#cb34-53" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-54"><a href="results.html#cb34-54" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-55"><a href="results.html#cb34-55" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-56"><a href="results.html#cb34-56" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Precision-Recall Curve (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb34-57"><a href="results.html#cb34-57" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">str_c</span>(model_name_best_f1_aktiva, <span class="st">&quot; with &quot;</span>, method__best_f1_aktiva),</span>
<span id="cb34-58"><a href="results.html#cb34-58" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb34-59"><a href="results.html#cb34-59" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb34-60"><a href="results.html#cb34-60" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-61"><a href="results.html#cb34-61" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb34-62"><a href="results.html#cb34-62" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-63"><a href="results.html#cb34-63" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb34-64"><a href="results.html#cb34-64" tabindex="-1"></a>  )</span>
<span id="cb34-65"><a href="results.html#cb34-65" tabindex="-1"></a></span>
<span id="cb34-66"><a href="results.html#cb34-66" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb34-67"><a href="results.html#cb34-67" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb34-68"><a href="results.html#cb34-68" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-69"><a href="results.html#cb34-69" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-70"><a href="results.html#cb34-70" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-71"><a href="results.html#cb34-71" tabindex="-1"></a>    <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb34-72"><a href="results.html#cb34-72" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb34-73"><a href="results.html#cb34-73" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb34-74"><a href="results.html#cb34-74" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb34-75"><a href="results.html#cb34-75" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-76"><a href="results.html#cb34-76" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb34-77"><a href="results.html#cb34-77" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-78"><a href="results.html#cb34-78" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb34-79"><a href="results.html#cb34-79" tabindex="-1"></a>  )</span>
<span id="cb34-80"><a href="results.html#cb34-80" tabindex="-1"></a></span>
<span id="cb34-81"><a href="results.html#cb34-81" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-binary-300-1.png" width="100%" /></p>
</div>
<div id="multi-classification" class="section level4 hasAnchor" number="5.1.3.2">
<h4><span class="header-section-number">5.1.3.2</span> Multi classification<a href="results.html#multi-classification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>bigger models are better with the multi classification task
Llama-4-Scout almost perfect F1 for all classes</p>
<p>Llama-4-Scout runs fast but needs long to load because it has 109B in total with 17B actives
Gemma performs much better than with binary classification</p>
<p>drop with Qwen-14B</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="results.html#cb35-1" tabindex="-1"></a>df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="results.html#cb35-2" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="results.html#cb35-3" tabindex="-1"></a>  <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="results.html#cb35-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="results.html#cb35-5" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="results.html#cb35-6" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="results.html#cb35-7" tabindex="-1"></a>  <span class="fu">filter</span>(f1_score <span class="sc">==</span> <span class="fu">max</span>(f1_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="results.html#cb35-8" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="co"># head(10) %&gt;% </span></span>
<span id="cb35-9"><a href="results.html#cb35-9" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, metric_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="results.html#cb35-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-11"><a href="results.html#cb35-11" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb35-12"><a href="results.html#cb35-12" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb35-13"><a href="results.html#cb35-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb35-14"><a href="results.html#cb35-14" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb35-15"><a href="results.html#cb35-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb35-16"><a href="results.html#cb35-16" tabindex="-1"></a>  <span class="fu">render_table</span>()</span></code></pre></div>
</details>
<div class="datatables html-widget html-fill-item" id="htmlwidget-aeb2c348e3d58c2e2218" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aeb2c348e3d58c2e2218">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["meta-llama","meta-llama","mistralai","meta-llama","mistralai","Qwen","Qwen","mistralai","mistralai","Qwen","google","google","google","tiiuae","microsoft","microsoft","tiiuae","tiiuae","microsoft"],["meta-llama_Llama-4-Scout-17B-16E-Instruct","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Mistral-Large-Instruct-2411","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Mistral-Large-Instruct-2411","Qwen_Qwen2.5-32B-Instruct","Qwen_Qwen3-235B-A22B-Instruct-2507","mistralai_Mistral-Large-Instruct-2411","mistralai_Mistral-Large-Instruct-2411","Qwen_Qwen2.5-72B-Instruct","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","microsoft_phi-4","microsoft_phi-4","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct","microsoft_phi-4"],["GuV","Aktiva","Passiva","Passiva","Aktiva","Aktiva","GuV","GuV","GuV","Passiva","Aktiva","Passiva","GuV","GuV","Passiva","Aktiva","Aktiva","Passiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_random_examples","n_rag_examples","n_rag_examples","n_rag_examples"],["1","3","1","3","3","3","3","1","3","1","3","1","1","1","1","1","1","1","1"],["1","0.99","0.99","0.99","0.97","0.97","0.97","0.95","0.95","0.95","0.88","0.81","0.78","0.7","0.66","0.59","0.55","0.55","0.45"],["2541","4451","7061","4451","18744","5664","11164","7061","18744","3908","4297","2606","2606","868","2862","817","868","868","2862"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>metric_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"metric_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="results.html#cb36-1" tabindex="-1"></a><span class="co"># df_multi %&gt;% </span></span>
<span id="cb36-2"><a href="results.html#cb36-2" tabindex="-1"></a><span class="co">#   unnest(metrics) %&gt;% </span></span>
<span id="cb36-3"><a href="results.html#cb36-3" tabindex="-1"></a><span class="co">#   filter(metric_type %in% c(&quot;micro_minorities&quot;)) %&gt;% </span></span>
<span id="cb36-4"><a href="results.html#cb36-4" tabindex="-1"></a><span class="co">#   filter(is.finite(f1_score), loop == 0) %&gt;% </span></span>
<span id="cb36-5"><a href="results.html#cb36-5" tabindex="-1"></a><span class="co">#   filter(n_examples &lt;= 3 | is.na(n_examples)) %&gt;%</span></span>
<span id="cb36-6"><a href="results.html#cb36-6" tabindex="-1"></a><span class="co">#   group_by(model_family, metric_type) %&gt;% </span></span>
<span id="cb36-7"><a href="results.html#cb36-7" tabindex="-1"></a><span class="co">#   filter(f1_score == max(f1_score, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb36-8"><a href="results.html#cb36-8" tabindex="-1"></a><span class="co">#   arrange(desc(f1_score)) %&gt;% # head(10) %&gt;% </span></span>
<span id="cb36-9"><a href="results.html#cb36-9" tabindex="-1"></a><span class="co">#   select(model_family, model, metric_type, method_family, n_examples, f1_score, norm_runtime) %&gt;%</span></span>
<span id="cb36-10"><a href="results.html#cb36-10" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb36-11"><a href="results.html#cb36-11" tabindex="-1"></a><span class="co">#     f1_score = round(f1_score, 2),</span></span>
<span id="cb36-12"><a href="results.html#cb36-12" tabindex="-1"></a><span class="co">#     norm_runtime = round(norm_runtime, 0),</span></span>
<span id="cb36-13"><a href="results.html#cb36-13" tabindex="-1"></a><span class="co">#   ) %&gt;% rename(</span></span>
<span id="cb36-14"><a href="results.html#cb36-14" tabindex="-1"></a><span class="co">#     &quot;runtime in s&quot; = norm_runtime,</span></span>
<span id="cb36-15"><a href="results.html#cb36-15" tabindex="-1"></a><span class="co">#   ) </span></span></code></pre></div>
</details>
<p>Mistral-8B-2410 almost as good as Mistral-123B-2411 but much faster</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="results.html#cb37-1" tabindex="-1"></a>df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="results.html#cb37-2" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="results.html#cb37-3" tabindex="-1"></a>  <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="results.html#cb37-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(f1_score), loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="results.html#cb37-5" tabindex="-1"></a>  <span class="fu">filter</span>(parameter_count<span class="sc">&lt;</span><span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="results.html#cb37-6" tabindex="-1"></a>  <span class="fu">filter</span>(n_examples <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">is.na</span>(n_examples)) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="results.html#cb37-7" tabindex="-1"></a>  <span class="fu">group_by</span>(model_family, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="results.html#cb37-8" tabindex="-1"></a>  <span class="fu">filter</span>(f1_score <span class="sc">==</span> <span class="fu">max</span>(f1_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="results.html#cb37-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score)) <span class="sc">%&gt;%</span> <span class="co"># head(10) %&gt;% </span></span>
<span id="cb37-10"><a href="results.html#cb37-10" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, metric_type, method_family, n_examples, f1_score, norm_runtime) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="results.html#cb37-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-12"><a href="results.html#cb37-12" tabindex="-1"></a>    <span class="at">f1_score =</span> <span class="fu">round</span>(f1_score, <span class="dv">2</span>),</span>
<span id="cb37-13"><a href="results.html#cb37-13" tabindex="-1"></a>    <span class="at">norm_runtime =</span> <span class="fu">round</span>(norm_runtime, <span class="dv">0</span>),</span>
<span id="cb37-14"><a href="results.html#cb37-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(</span>
<span id="cb37-15"><a href="results.html#cb37-15" tabindex="-1"></a>    <span class="st">&quot;runtime in s&quot;</span> <span class="ot">=</span> norm_runtime,</span>
<span id="cb37-16"><a href="results.html#cb37-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="results.html#cb37-17" tabindex="-1"></a>  <span class="fu">render_table</span>()</span></code></pre></div>
</details>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c60cbe848706eaf48617" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c60cbe848706eaf48617">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"],["mistralai","mistralai","mistralai","mistralai","meta-llama","Qwen","meta-llama","google","Qwen","Qwen","tiiuae","google","meta-llama","meta-llama","tiiuae","tiiuae","google"],["mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","meta-llama_Llama-3.1-8B-Instruct","Qwen_Qwen2.5-3B-Instruct","meta-llama_Llama-3.1-8B-Instruct","google_gemma-3-12b-it-0-9-1","Qwen_Qwen2.5-3B-Instruct","Qwen_Qwen2.5-3B-Instruct","tiiuae_Falcon3-10B-Instruct","google_gemma-3-12b-it-0-9-1","meta-llama_Llama-3.1-8B-Instruct","meta-llama_Llama-3.1-8B-Instruct","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct","google_gemma-3-12b-it-0-9-1"],["Aktiva","Passiva","GuV","GuV","Passiva","Aktiva","Aktiva","Aktiva","Passiva","GuV","GuV","Passiva","GuV","GuV","Aktiva","Passiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","law_context","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples"],["1","1","3","3","1","1","3","3",null,"1","1","1","1","1","1","1","1"],["0.97","0.95","0.95","0.95","0.94","0.86","0.85","0.84","0.81","0.76","0.7","0.68","0.62","0.62","0.55","0.55","0.46"],["686","686","1399","279","593","492","269","2733","28","492","868","1259","593","205","868","868","232"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>metric_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"dom":"tiprfl","columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"metric_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Mistral-2410 reaches good performance already with few examples and can work with law-context approach but more examples don’t realy help any further</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="results.html#cb38-1" tabindex="-1"></a>df_selected <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb38-2"><a href="results.html#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="results.html#cb38-3" tabindex="-1"></a>df_selected <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="results.html#cb38-4" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb38-5"><a href="results.html#cb38-5" tabindex="-1"></a>    <span class="st">&quot;mistralai_Ministral-8B-Instruct-2410&quot;</span>,</span>
<span id="cb38-6"><a href="results.html#cb38-6" tabindex="-1"></a>    <span class="co"># &quot;mistralai_Mistral-Large-Instruct-2411&quot;,</span></span>
<span id="cb38-7"><a href="results.html#cb38-7" tabindex="-1"></a>    <span class="co"># &quot;mistralai_Mistral-Small-3.1-24B-Instruct-2503&quot;,</span></span>
<span id="cb38-8"><a href="results.html#cb38-8" tabindex="-1"></a>    <span class="st">&quot;meta-llama_Llama-4-Scout-17B-16E-Instruct&quot;</span></span>
<span id="cb38-9"><a href="results.html#cb38-9" tabindex="-1"></a>    <span class="co"># &quot;meta-llama_Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span></span>
<span id="cb38-10"><a href="results.html#cb38-10" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="results.html#cb38-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> norm_runtime, <span class="at">y =</span> f1_score)) <span class="sc">+</span></span>
<span id="cb38-12"><a href="results.html#cb38-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> method_family, <span class="at">shape =</span> out_of_company), <span class="at">size =</span> <span class="dv">7</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb38-13"><a href="results.html#cb38-13" tabindex="-1"></a>  <span class="fu">scale_shape</span>(<span class="at">na.value =</span> <span class="dv">15</span>, <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-14"><a href="results.html#cb38-14" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_examples)) <span class="sc">+</span></span>
<span id="cb38-15"><a href="results.html#cb38-15" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model<span class="sc">~</span>metric_type) <span class="sc">+</span></span>
<span id="cb38-16"><a href="results.html#cb38-16" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> method_familiy_colors) <span class="co">#+</span></span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="results.html#cb39-1" tabindex="-1"></a>  <span class="co"># theme(legend.position = &quot;bottom&quot;) +</span></span>
<span id="cb39-2"><a href="results.html#cb39-2" tabindex="-1"></a>  <span class="co"># guides(</span></span>
<span id="cb39-3"><a href="results.html#cb39-3" tabindex="-1"></a>  <span class="co">#   color = guide_legend(ncol = 1, title.position = &quot;top&quot;),</span></span>
<span id="cb39-4"><a href="results.html#cb39-4" tabindex="-1"></a>  <span class="co">#   shape = guide_legend(ncol = 1, title.position = &quot;top&quot;)</span></span>
<span id="cb39-5"><a href="results.html#cb39-5" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb39-6"><a href="results.html#cb39-6" tabindex="-1"></a>  <span class="co"># scale_x_discrete(guide = guide_axis(angle = 30))</span></span></code></pre></div>
</details>
<p>Most of the time pretty confident
most problems with class “other”
If Aktiva and Passiva on same page it predicts Aktiva. Also one Passiva missclassified as Aktiva
No flipped confidence
<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="results.html#cb40-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="results.html#cb40-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb40-3"><a href="results.html#cb40-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb40-4"><a href="results.html#cb40-4" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="results.html#cb40-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-6"><a href="results.html#cb40-6" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb40-7"><a href="results.html#cb40-7" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb40-8"><a href="results.html#cb40-8" tabindex="-1"></a>  )</span>
<span id="cb40-9"><a href="results.html#cb40-9" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb40-10"><a href="results.html#cb40-10" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb40-11"><a href="results.html#cb40-11" tabindex="-1"></a></span>
<span id="cb40-12"><a href="results.html#cb40-12" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb40-13"><a href="results.html#cb40-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="results.html#cb40-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb40-15"><a href="results.html#cb40-15" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb40-16"><a href="results.html#cb40-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb40-17"><a href="results.html#cb40-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb40-18"><a href="results.html#cb40-18" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="100%" /></p>
<p>Microsoft phi 4 and Falcon 3 only ran with one and two examples because their context window is smaller.</p>
<ul>
<li>f1</li>
<li>multiple models</li>
<li>best model detail (different methods / settings)</li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="results.html#cb41-1" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb41-2"><a href="results.html#cb41-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb41-3"><a href="results.html#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="results.html#cb41-4" tabindex="-1"></a>model_rank <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-5"><a href="results.html#cb41-5" tabindex="-1"></a></span>
<span id="cb41-6"><a href="results.html#cb41-6" tabindex="-1"></a>df_selected <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics)</span>
<span id="cb41-7"><a href="results.html#cb41-7" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb41-8"><a href="results.html#cb41-8" tabindex="-1"></a>  metric_type <span class="sc">==</span> <span class="st">&quot;micro_minorities&quot;</span></span>
<span id="cb41-9"><a href="results.html#cb41-9" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="results.html#cb41-10" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb41-11"><a href="results.html#cb41-11" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[model_rank,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb41-12"><a href="results.html#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="results.html#cb41-13" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb41-14"><a href="results.html#cb41-14" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb41-15"><a href="results.html#cb41-15" tabindex="-1"></a></span>
<span id="cb41-16"><a href="results.html#cb41-16" tabindex="-1"></a>pr_obj <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> df_temp<span class="sc">$</span>confidence_score[df_temp<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb41-17"><a href="results.html#cb41-17" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> df_temp<span class="sc">$</span>confidence_score[df_temp<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb41-18"><a href="results.html#cb41-18" tabindex="-1"></a>                   <span class="at">curve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-19"><a href="results.html#cb41-19" tabindex="-1"></a></span>
<span id="cb41-20"><a href="results.html#cb41-20" tabindex="-1"></a><span class="co"># plot(pr_obj, color = &quot;orange&quot;, main = &quot;Precision-Recall Curve&quot;)</span></span>
<span id="cb41-21"><a href="results.html#cb41-21" tabindex="-1"></a></span>
<span id="cb41-22"><a href="results.html#cb41-22" tabindex="-1"></a><span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb41-23"><a href="results.html#cb41-23" tabindex="-1"></a></span>
<span id="cb41-24"><a href="results.html#cb41-24" tabindex="-1"></a>pr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb41-25"><a href="results.html#cb41-25" tabindex="-1"></a>  <span class="at">recall =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">1</span>],</span>
<span id="cb41-26"><a href="results.html#cb41-26" tabindex="-1"></a>  <span class="at">precision =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">2</span>],</span>
<span id="cb41-27"><a href="results.html#cb41-27" tabindex="-1"></a>  <span class="at">threshold =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">3</span>]</span>
<span id="cb41-28"><a href="results.html#cb41-28" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb41-29"><a href="results.html#cb41-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb41-30"><a href="results.html#cb41-30" tabindex="-1"></a></span>
<span id="cb41-31"><a href="results.html#cb41-31" tabindex="-1"></a>pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(pr_obj<span class="sc">$</span>auc.integral, <span class="dv">3</span>)</span>
<span id="cb41-32"><a href="results.html#cb41-32" tabindex="-1"></a></span>
<span id="cb41-33"><a href="results.html#cb41-33" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb41-34"><a href="results.html#cb41-34" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb41-35"><a href="results.html#cb41-35" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb41-36"><a href="results.html#cb41-36" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-37"><a href="results.html#cb41-37" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-38"><a href="results.html#cb41-38" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Precision-Recall Curve (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb41-39"><a href="results.html#cb41-39" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">str_c</span>(model_name_best_f1_aktiva, <span class="st">&quot; with &quot;</span>, method__best_f1_aktiva),</span>
<span id="cb41-40"><a href="results.html#cb41-40" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb41-41"><a href="results.html#cb41-41" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb41-42"><a href="results.html#cb41-42" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-43"><a href="results.html#cb41-43" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-44"><a href="results.html#cb41-44" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb41-45"><a href="results.html#cb41-45" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb41-46"><a href="results.html#cb41-46" tabindex="-1"></a>  )</span>
<span id="cb41-47"><a href="results.html#cb41-47" tabindex="-1"></a></span>
<span id="cb41-48"><a href="results.html#cb41-48" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb41-49"><a href="results.html#cb41-49" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb41-50"><a href="results.html#cb41-50" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb41-51"><a href="results.html#cb41-51" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-52"><a href="results.html#cb41-52" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-53"><a href="results.html#cb41-53" tabindex="-1"></a>    <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb41-54"><a href="results.html#cb41-54" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb41-55"><a href="results.html#cb41-55" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb41-56"><a href="results.html#cb41-56" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb41-57"><a href="results.html#cb41-57" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-58"><a href="results.html#cb41-58" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb41-59"><a href="results.html#cb41-59" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb41-60"><a href="results.html#cb41-60" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb41-61"><a href="results.html#cb41-61" tabindex="-1"></a>  )</span>
<span id="cb41-62"><a href="results.html#cb41-62" tabindex="-1"></a></span>
<span id="cb41-63"><a href="results.html#cb41-63" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-multi-1-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="results.html#cb42-1" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb42-2"><a href="results.html#cb42-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb42-3"><a href="results.html#cb42-3" tabindex="-1"></a></span>
<span id="cb42-4"><a href="results.html#cb42-4" tabindex="-1"></a>df_selected <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics)</span>
<span id="cb42-5"><a href="results.html#cb42-5" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb42-6"><a href="results.html#cb42-6" tabindex="-1"></a>  metric_type <span class="sc">==</span> <span class="st">&quot;micro_minorities&quot;</span>,</span>
<span id="cb42-7"><a href="results.html#cb42-7" tabindex="-1"></a>      loop <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb42-8"><a href="results.html#cb42-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="results.html#cb42-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb42-10"><a href="results.html#cb42-10" tabindex="-1"></a>model_rank <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(df_filtered)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb42-11"><a href="results.html#cb42-11" tabindex="-1"></a></span>
<span id="cb42-12"><a href="results.html#cb42-12" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb42-13"><a href="results.html#cb42-13" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[model_rank, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb42-14"><a href="results.html#cb42-14" tabindex="-1"></a></span>
<span id="cb42-15"><a href="results.html#cb42-15" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[model_rank,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb42-16"><a href="results.html#cb42-16" tabindex="-1"></a></span>
<span id="cb42-17"><a href="results.html#cb42-17" tabindex="-1"></a>pr_obj <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> df_temp<span class="sc">$</span>confidence_score[df_temp<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb42-18"><a href="results.html#cb42-18" tabindex="-1"></a>                   <span class="at">scores.class1 =</span> df_temp<span class="sc">$</span>confidence_score[df_temp<span class="sc">$</span>match <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb42-19"><a href="results.html#cb42-19" tabindex="-1"></a>                   <span class="at">curve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-20"><a href="results.html#cb42-20" tabindex="-1"></a></span>
<span id="cb42-21"><a href="results.html#cb42-21" tabindex="-1"></a><span class="co"># plot(pr_obj, color = &quot;orange&quot;, main = &quot;Precision-Recall Curve&quot;)</span></span>
<span id="cb42-22"><a href="results.html#cb42-22" tabindex="-1"></a></span>
<span id="cb42-23"><a href="results.html#cb42-23" tabindex="-1"></a><span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb42-24"><a href="results.html#cb42-24" tabindex="-1"></a></span>
<span id="cb42-25"><a href="results.html#cb42-25" tabindex="-1"></a>pr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-26"><a href="results.html#cb42-26" tabindex="-1"></a>  <span class="at">recall =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">1</span>],</span>
<span id="cb42-27"><a href="results.html#cb42-27" tabindex="-1"></a>  <span class="at">precision =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">2</span>],</span>
<span id="cb42-28"><a href="results.html#cb42-28" tabindex="-1"></a>  <span class="at">threshold =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">3</span>]</span>
<span id="cb42-29"><a href="results.html#cb42-29" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-30"><a href="results.html#cb42-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb42-31"><a href="results.html#cb42-31" tabindex="-1"></a></span>
<span id="cb42-32"><a href="results.html#cb42-32" tabindex="-1"></a>pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(pr_obj<span class="sc">$</span>auc.integral, <span class="dv">3</span>)</span>
<span id="cb42-33"><a href="results.html#cb42-33" tabindex="-1"></a></span>
<span id="cb42-34"><a href="results.html#cb42-34" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb42-35"><a href="results.html#cb42-35" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb42-36"><a href="results.html#cb42-36" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb42-37"><a href="results.html#cb42-37" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-38"><a href="results.html#cb42-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-39"><a href="results.html#cb42-39" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Precision-Recall Curve (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb42-40"><a href="results.html#cb42-40" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">str_c</span>(model_name_best_f1_aktiva, <span class="st">&quot; with &quot;</span>, method__best_f1_aktiva),</span>
<span id="cb42-41"><a href="results.html#cb42-41" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb42-42"><a href="results.html#cb42-42" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb42-43"><a href="results.html#cb42-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-44"><a href="results.html#cb42-44" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb42-45"><a href="results.html#cb42-45" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-46"><a href="results.html#cb42-46" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb42-47"><a href="results.html#cb42-47" tabindex="-1"></a>  )</span>
<span id="cb42-48"><a href="results.html#cb42-48" tabindex="-1"></a></span>
<span id="cb42-49"><a href="results.html#cb42-49" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb42-50"><a href="results.html#cb42-50" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb42-51"><a href="results.html#cb42-51" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb42-52"><a href="results.html#cb42-52" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-53"><a href="results.html#cb42-53" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-54"><a href="results.html#cb42-54" tabindex="-1"></a>    <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb42-55"><a href="results.html#cb42-55" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb42-56"><a href="results.html#cb42-56" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb42-57"><a href="results.html#cb42-57" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb42-58"><a href="results.html#cb42-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-59"><a href="results.html#cb42-59" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb42-60"><a href="results.html#cb42-60" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-61"><a href="results.html#cb42-61" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb42-62"><a href="results.html#cb42-62" tabindex="-1"></a>  )</span>
<span id="cb42-63"><a href="results.html#cb42-63" tabindex="-1"></a></span>
<span id="cb42-64"><a href="results.html#cb42-64" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-multi-300-1.png" width="100%" /></p>
</div>
</div>
<div id="term-frequency-based-classifier" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Term frequency based classifier<a href="results.html#term-frequency-based-classifier" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RandomForest performs much better than a logistic regression
Better results with
* undersampling
* training on all types simultaniousely</p>
<div id="two-predictors" class="section level4 hasAnchor" number="5.1.4.1">
<h4><span class="header-section-number">5.1.4.1</span> Two predictors<a href="results.html#two-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Term frequency of nouns of the law about Aktiva
Float freqency (floats divided by word count)</p>
</div>
<div id="four-predictors" class="section level4 hasAnchor" number="5.1.4.2">
<h4><span class="header-section-number">5.1.4.2</span> Four predictors<a href="results.html#four-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Count of integers
Count of dates</p>
<ul>
<li>top 1</li>
<li>top k</li>
</ul>
<p>low precision llm linked to position of correct page? numeric frequency?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="results.html#cb43-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb43-2"><a href="results.html#cb43-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb43-3"><a href="results.html#cb43-3" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb43-4"><a href="results.html#cb43-4" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb43-5"><a href="results.html#cb43-5" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb43-6"><a href="results.html#cb43-6" tabindex="-1"></a></span>
<span id="cb43-7"><a href="results.html#cb43-7" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb43-8"><a href="results.html#cb43-8" tabindex="-1"></a></span>
<span id="cb43-9"><a href="results.html#cb43-9" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb43-10"><a href="results.html#cb43-10" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb43-11"><a href="results.html#cb43-11" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb43-12"><a href="results.html#cb43-12" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb43-13"><a href="results.html#cb43-13" tabindex="-1"></a></span>
<span id="cb43-14"><a href="results.html#cb43-14" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb43-15"><a href="results.html#cb43-15" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb43-16"><a href="results.html#cb43-16" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb43-17"><a href="results.html#cb43-17" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb43-18"><a href="results.html#cb43-18" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-19"><a href="results.html#cb43-19" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb43-20"><a href="results.html#cb43-20" tabindex="-1"></a></span>
<span id="cb43-21"><a href="results.html#cb43-21" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb43-22"><a href="results.html#cb43-22" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb43-23"><a href="results.html#cb43-23" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb43-24"><a href="results.html#cb43-24" tabindex="-1"></a></span>
<span id="cb43-25"><a href="results.html#cb43-25" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb43-26"><a href="results.html#cb43-26" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb43-27"><a href="results.html#cb43-27" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb43-28"><a href="results.html#cb43-28" tabindex="-1"></a>)</span>
<span id="cb43-29"><a href="results.html#cb43-29" tabindex="-1"></a></span>
<span id="cb43-30"><a href="results.html#cb43-30" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb43-31"><a href="results.html#cb43-31" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb43-32"><a href="results.html#cb43-32" tabindex="-1"></a>clf.fit(X_train, y_train)</span>
<span id="cb43-33"><a href="results.html#cb43-33" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_train, y_train)</span>
<span id="cb43-34"><a href="results.html#cb43-34" tabindex="-1"></a><span class="co"># print(f&quot;Training accuracy: {score:.2%}&quot;)</span></span>
<span id="cb43-35"><a href="results.html#cb43-35" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_test, y_test)</span>
<span id="cb43-36"><a href="results.html#cb43-36" tabindex="-1"></a><span class="co"># print(f&quot;Test accuracy: {score:.2%}&quot;)</span></span>
<span id="cb43-37"><a href="results.html#cb43-37" tabindex="-1"></a></span>
<span id="cb43-38"><a href="results.html#cb43-38" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb43-39"><a href="results.html#cb43-39" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb43-40"><a href="results.html#cb43-40" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb43-41"><a href="results.html#cb43-41" tabindex="-1"></a></span>
<span id="cb43-42"><a href="results.html#cb43-42" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb43-43"><a href="results.html#cb43-43" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb43-44"><a href="results.html#cb43-44" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb43-45"><a href="results.html#cb43-45" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values)[:, <span class="dv">1</span>]</span>
<span id="cb43-46"><a href="results.html#cb43-46" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb43-47"><a href="results.html#cb43-47" tabindex="-1"></a></span>
<span id="cb43-48"><a href="results.html#cb43-48" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb43-49"><a href="results.html#cb43-49" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-50"><a href="results.html#cb43-50" tabindex="-1"></a></span>
<span id="cb43-51"><a href="results.html#cb43-51" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb43-52"><a href="results.html#cb43-52" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb43-53"><a href="results.html#cb43-53" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="results.html#cb44-1" tabindex="-1"></a>df_2_predictors_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_2_predictors_test.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="results.html#cb44-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;test&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">2</span>)</span>
<span id="cb44-3"><a href="results.html#cb44-3" tabindex="-1"></a>df_2_predictors_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_2_predictors_train.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="results.html#cb44-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;train&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">2</span>)</span>
<span id="cb44-5"><a href="results.html#cb44-5" tabindex="-1"></a>df_4_predictors_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_4_predictors_test.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="results.html#cb44-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;test&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">4</span>)</span>
<span id="cb44-7"><a href="results.html#cb44-7" tabindex="-1"></a>df_4_predictors_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;/home/simon/Documents/data_science/Thesis/benchmark_results/page_identification/term_frequency_results_4_predictors_train.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="results.html#cb44-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_split =</span> <span class="st">&#39;train&#39;</span>, <span class="at">n_predictors =</span> <span class="dv">4</span>)</span>
<span id="cb44-9"><a href="results.html#cb44-9" tabindex="-1"></a></span>
<span id="cb44-10"><a href="results.html#cb44-10" tabindex="-1"></a>df_rf_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb44-11"><a href="results.html#cb44-11" tabindex="-1"></a>  df_2_predictors_train, df_2_predictors_test,</span>
<span id="cb44-12"><a href="results.html#cb44-12" tabindex="-1"></a>  df_4_predictors_train, df_4_predictors_test</span>
<span id="cb44-13"><a href="results.html#cb44-13" tabindex="-1"></a>  )</span>
<span id="cb44-14"><a href="results.html#cb44-14" tabindex="-1"></a></span>
<span id="cb44-15"><a href="results.html#cb44-15" tabindex="-1"></a>max_rank <span class="ot">=</span> df_rf_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(is_truth <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rank) <span class="sc">%&gt;%</span> <span class="fu">max</span>()</span>
<span id="cb44-16"><a href="results.html#cb44-16" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span>max_rank, <span class="cf">function</span>(i_rank) {</span>
<span id="cb44-17"><a href="results.html#cb44-17" tabindex="-1"></a>  df_rf_results <span class="sc">%&gt;%</span> </span>
<span id="cb44-18"><a href="results.html#cb44-18" tabindex="-1"></a>    <span class="fu">filter</span>(is_truth <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-19"><a href="results.html#cb44-19" tabindex="-1"></a>    <span class="fu">group_by</span>(type, data_split, n_predictors) <span class="sc">%&gt;%</span> </span>
<span id="cb44-20"><a href="results.html#cb44-20" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">le =</span> <span class="fu">if_else</span>(rank <span class="sc">&lt;=</span> i_rank, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-21"><a href="results.html#cb44-21" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(le), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-22"><a href="results.html#cb44-22" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">i_rank =</span> i_rank)</span>
<span id="cb44-23"><a href="results.html#cb44-23" tabindex="-1"></a>})</span>
<span id="cb44-24"><a href="results.html#cb44-24" tabindex="-1"></a></span>
<span id="cb44-25"><a href="results.html#cb44-25" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb44-26"><a href="results.html#cb44-26" tabindex="-1"></a></span>
<span id="cb44-27"><a href="results.html#cb44-27" tabindex="-1"></a>results <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-28"><a href="results.html#cb44-28" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> i_rank, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb44-29"><a href="results.html#cb44-29" tabindex="-1"></a>  <span class="fu">facet_nested</span>(type <span class="sc">~</span> data_split <span class="sc">+</span> n_predictors) <span class="sc">+</span></span>
<span id="cb44-30"><a href="results.html#cb44-30" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-31"><a href="results.html#cb44-31" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;rank&quot;</span>,</span>
<span id="cb44-32"><a href="results.html#cb44-32" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;top n accuracy&quot;</span>,</span>
<span id="cb44-33"><a href="results.html#cb44-33" tabindex="-1"></a>    <span class="co"># title = &quot;Top n accuracy for different ranks, data splits and number of predictors&quot;</span></span>
<span id="cb44-34"><a href="results.html#cb44-34" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/top-n-accuracy-term-frequency-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="results.html#cb45-1" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb45-2"><a href="results.html#cb45-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb45-3"><a href="results.html#cb45-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-4"><a href="results.html#cb45-4" tabindex="-1"></a></span>
<span id="cb45-5"><a href="results.html#cb45-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-6"><a href="results.html#cb45-6" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> DecisionBoundaryDisplay</span>
<span id="cb45-7"><a href="results.html#cb45-7" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb45-8"><a href="results.html#cb45-8" tabindex="-1"></a></span>
<span id="cb45-9"><a href="results.html#cb45-9" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb45-10"><a href="results.html#cb45-10" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb45-11"><a href="results.html#cb45-11" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb45-12"><a href="results.html#cb45-12" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb45-13"><a href="results.html#cb45-13" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb45-14"><a href="results.html#cb45-14" tabindex="-1"></a>]</span>
<span id="cb45-15"><a href="results.html#cb45-15" tabindex="-1"></a></span>
<span id="cb45-16"><a href="results.html#cb45-16" tabindex="-1"></a>clf <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">&#39;data_storage/rf-tf-2preds.sav&#39;</span>, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb45-17"><a href="results.html#cb45-17" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.read_csv(<span class="st">&quot;data_storage/term_frequency_results_2_predictors_test.csv&quot;</span>)</span>
<span id="cb45-18"><a href="results.html#cb45-18" tabindex="-1"></a></span>
<span id="cb45-19"><a href="results.html#cb45-19" tabindex="-1"></a></span>
<span id="cb45-20"><a href="results.html#cb45-20" tabindex="-1"></a>X <span class="op">=</span> df_test_split[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb45-21"><a href="results.html#cb45-21" tabindex="-1"></a></span>
<span id="cb45-22"><a href="results.html#cb45-22" tabindex="-1"></a>cm <span class="op">=</span> plt.cm.RdBu</span>
<span id="cb45-23"><a href="results.html#cb45-23" tabindex="-1"></a>cm_bright <span class="op">=</span> ListedColormap([<span class="st">&quot;#FF0000&quot;</span>, <span class="st">&quot;#0000FF&quot;</span>])</span>
<span id="cb45-24"><a href="results.html#cb45-24" tabindex="-1"></a>x_min, x_max <span class="op">=</span> X[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.05</span>, X[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.05</span></span>
<span id="cb45-25"><a href="results.html#cb45-25" tabindex="-1"></a>y_min, y_max <span class="op">=</span> X[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">0.05</span>, X[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">0.05</span></span>
<span id="cb45-26"><a href="results.html#cb45-26" tabindex="-1"></a></span>
<span id="cb45-27"><a href="results.html#cb45-27" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb45-28"><a href="results.html#cb45-28" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()</span>
<span id="cb45-29"><a href="results.html#cb45-29" tabindex="-1"></a>catch_this_message <span class="op">=</span>DecisionBoundaryDisplay.from_estimator(</span>
<span id="cb45-30"><a href="results.html#cb45-30" tabindex="-1"></a>    clf, X, cmap<span class="op">=</span>cm, alpha<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax, eps<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb45-31"><a href="results.html#cb45-31" tabindex="-1"></a>)</span>
<span id="cb45-32"><a href="results.html#cb45-32" tabindex="-1"></a></span>
<span id="cb45-33"><a href="results.html#cb45-33" tabindex="-1"></a>df_test_split_sorted <span class="op">=</span> df_test_split.sort_values(<span class="st">&#39;is_truth&#39;</span>)</span>
<span id="cb45-34"><a href="results.html#cb45-34" tabindex="-1"></a>X_test <span class="op">=</span> df_test_split_sorted[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb45-35"><a href="results.html#cb45-35" tabindex="-1"></a>y_test <span class="op">=</span> df_test_split_sorted[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb45-36"><a href="results.html#cb45-36" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_test, y_test)</span>
<span id="cb45-37"><a href="results.html#cb45-37" tabindex="-1"></a></span>
<span id="cb45-38"><a href="results.html#cb45-38" tabindex="-1"></a><span class="co"># ax.scatter(X_train[:, 0], X_train[:, 1], c=y_train, cmap=cm_bright, edgecolors=&quot;k&quot;, label=&quot;Train&quot;)</span></span>
<span id="cb45-39"><a href="results.html#cb45-39" tabindex="-1"></a>ax.scatter(X_test[:, <span class="dv">0</span>], X_test[:, <span class="dv">1</span>], c<span class="op">=</span>y_test, cmap<span class="op">=</span>cm_bright, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolors<span class="op">=</span><span class="st">&quot;k&quot;</span>, label<span class="op">=</span><span class="st">&quot;Test&quot;</span>)</span>
<span id="cb45-40"><a href="results.html#cb45-40" tabindex="-1"></a>catch_this_message <span class="op">=</span>ax.set_xlim(x_min, x_max)</span>
<span id="cb45-41"><a href="results.html#cb45-41" tabindex="-1"></a>catch_this_message <span class="op">=</span>ax.set_ylim(y_min, y_max)</span>
<span id="cb45-42"><a href="results.html#cb45-42" tabindex="-1"></a>ax.set_xlabel(<span class="st">&quot;term_frequency&quot;</span>)</span>
<span id="cb45-43"><a href="results.html#cb45-43" tabindex="-1"></a>ax.set_ylabel(<span class="st">&quot;float_frequency&quot;</span>)</span>
<span id="cb45-44"><a href="results.html#cb45-44" tabindex="-1"></a>ax.set_title(<span class="ss">f&quot;RandomForestClassifier (accuracy=</span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">)&quot;</span>)</span>
<span id="cb45-45"><a href="results.html#cb45-45" tabindex="-1"></a>plt.legend()</span>
<span id="cb45-46"><a href="results.html#cb45-46" tabindex="-1"></a>plt.show()</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/forest-map-tf-2-predictors-1.png" width="768" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="results.html#cb46-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-2"><a href="results.html#cb46-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb46-3"><a href="results.html#cb46-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-4"><a href="results.html#cb46-4" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb46-5"><a href="results.html#cb46-5" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb46-6"><a href="results.html#cb46-6" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb46-7"><a href="results.html#cb46-7" tabindex="-1"></a></span>
<span id="cb46-8"><a href="results.html#cb46-8" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb46-9"><a href="results.html#cb46-9" tabindex="-1"></a></span>
<span id="cb46-10"><a href="results.html#cb46-10" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb46-11"><a href="results.html#cb46-11" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb46-12"><a href="results.html#cb46-12" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb46-13"><a href="results.html#cb46-13" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb46-14"><a href="results.html#cb46-14" tabindex="-1"></a></span>
<span id="cb46-15"><a href="results.html#cb46-15" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb46-16"><a href="results.html#cb46-16" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb46-17"><a href="results.html#cb46-17" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb46-18"><a href="results.html#cb46-18" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb46-19"><a href="results.html#cb46-19" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-20"><a href="results.html#cb46-20" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb46-21"><a href="results.html#cb46-21" tabindex="-1"></a></span>
<span id="cb46-22"><a href="results.html#cb46-22" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb46-23"><a href="results.html#cb46-23" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb46-24"><a href="results.html#cb46-24" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb46-25"><a href="results.html#cb46-25" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb46-26"><a href="results.html#cb46-26" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb46-27"><a href="results.html#cb46-27" tabindex="-1"></a>]</span>
<span id="cb46-28"><a href="results.html#cb46-28" tabindex="-1"></a></span>
<span id="cb46-29"><a href="results.html#cb46-29" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb46-30"><a href="results.html#cb46-30" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[predictors].values <span class="co"># only better with date and integer counts; otherwise worse</span></span>
<span id="cb46-31"><a href="results.html#cb46-31" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb46-32"><a href="results.html#cb46-32" tabindex="-1"></a></span>
<span id="cb46-33"><a href="results.html#cb46-33" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb46-34"><a href="results.html#cb46-34" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb46-35"><a href="results.html#cb46-35" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb46-36"><a href="results.html#cb46-36" tabindex="-1"></a>)</span>
<span id="cb46-37"><a href="results.html#cb46-37" tabindex="-1"></a></span>
<span id="cb46-38"><a href="results.html#cb46-38" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb46-39"><a href="results.html#cb46-39" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb46-40"><a href="results.html#cb46-40" tabindex="-1"></a>catch_this_message <span class="op">=</span>clf.fit(X_train, y_train)</span>
<span id="cb46-41"><a href="results.html#cb46-41" tabindex="-1"></a></span>
<span id="cb46-42"><a href="results.html#cb46-42" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb46-43"><a href="results.html#cb46-43" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb46-44"><a href="results.html#cb46-44" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb46-45"><a href="results.html#cb46-45" tabindex="-1"></a></span>
<span id="cb46-46"><a href="results.html#cb46-46" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb46-47"><a href="results.html#cb46-47" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb46-48"><a href="results.html#cb46-48" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb46-49"><a href="results.html#cb46-49" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[predictors].values)[:, <span class="dv">1</span>]</span>
<span id="cb46-50"><a href="results.html#cb46-50" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb46-51"><a href="results.html#cb46-51" tabindex="-1"></a></span>
<span id="cb46-52"><a href="results.html#cb46-52" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb46-53"><a href="results.html#cb46-53" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-54"><a href="results.html#cb46-54" tabindex="-1"></a></span>
<span id="cb46-55"><a href="results.html#cb46-55" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb46-56"><a href="results.html#cb46-56" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb46-57"><a href="results.html#cb46-57" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="results.html#cb47-1" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb47-2"><a href="results.html#cb47-2" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb47-3"><a href="results.html#cb47-3" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-4"><a href="results.html#cb47-4" tabindex="-1"></a></span>
<span id="cb47-5"><a href="results.html#cb47-5" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb47-6"><a href="results.html#cb47-6" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb47-7"><a href="results.html#cb47-7" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb47-8"><a href="results.html#cb47-8" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb47-9"><a href="results.html#cb47-9" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb47-10"><a href="results.html#cb47-10" tabindex="-1"></a>]</span>
<span id="cb47-11"><a href="results.html#cb47-11" tabindex="-1"></a></span>
<span id="cb47-12"><a href="results.html#cb47-12" tabindex="-1"></a>clf <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">&#39;data_storage/rf-tf-4preds.sav&#39;</span>, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb47-13"><a href="results.html#cb47-13" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.read_csv(<span class="st">&quot;data_storage/term_frequency_results_4_predictors_test.csv&quot;</span>)</span>
<span id="cb47-14"><a href="results.html#cb47-14" tabindex="-1"></a></span>
<span id="cb47-15"><a href="results.html#cb47-15" tabindex="-1"></a><span class="co"># Use the same predictors and trained RandomForestClassifier (clf) as in cell 20</span></span>
<span id="cb47-16"><a href="results.html#cb47-16" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(clf)</span>
<span id="cb47-17"><a href="results.html#cb47-17" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(df_test_split[predictors].values)</span>
<span id="cb47-18"><a href="results.html#cb47-18" tabindex="-1"></a></span>
<span id="cb47-19"><a href="results.html#cb47-19" tabindex="-1"></a><span class="co"># Plot summary for class 1 (is_truth == 1)</span></span>
<span id="cb47-20"><a href="results.html#cb47-20" tabindex="-1"></a>shap.summary_plot(shap_values[:,:,<span class="dv">1</span>], df_test_split[predictors].values, feature_names<span class="op">=</span>predictors)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/shap-tf-4-predictors-3.png" width="768" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="results.html#cb48-1" tabindex="-1"></a><span class="fu">library</span>(PRROC)</span>
<span id="cb48-2"><a href="results.html#cb48-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb48-3"><a href="results.html#cb48-3" tabindex="-1"></a></span>
<span id="cb48-4"><a href="results.html#cb48-4" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_rf_results <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_predictors <span class="sc">==</span> <span class="dv">4</span>, data_split <span class="sc">==</span> <span class="st">&quot;test&quot;</span>)</span>
<span id="cb48-5"><a href="results.html#cb48-5" tabindex="-1"></a>pr_obj <span class="ot">&lt;-</span> <span class="fu">pr.curve</span>(<span class="at">scores.class0 =</span> df_temp<span class="sc">$</span>score[df_temp<span class="sc">$</span>is_truth <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb48-6"><a href="results.html#cb48-6" tabindex="-1"></a>           <span class="at">scores.class1 =</span> df_temp<span class="sc">$</span>score[df_temp<span class="sc">$</span>is_truth <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb48-7"><a href="results.html#cb48-7" tabindex="-1"></a>           <span class="at">curve =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-8"><a href="results.html#cb48-8" tabindex="-1"></a></span>
<span id="cb48-9"><a href="results.html#cb48-9" tabindex="-1"></a><span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb48-10"><a href="results.html#cb48-10" tabindex="-1"></a></span>
<span id="cb48-11"><a href="results.html#cb48-11" tabindex="-1"></a>pr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb48-12"><a href="results.html#cb48-12" tabindex="-1"></a>  <span class="at">recall =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">1</span>],</span>
<span id="cb48-13"><a href="results.html#cb48-13" tabindex="-1"></a>  <span class="at">precision =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">2</span>],</span>
<span id="cb48-14"><a href="results.html#cb48-14" tabindex="-1"></a>  <span class="at">threshold =</span> pr_obj<span class="sc">$</span>curve[, <span class="dv">3</span>]</span>
<span id="cb48-15"><a href="results.html#cb48-15" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb48-16"><a href="results.html#cb48-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb48-17"><a href="results.html#cb48-17" tabindex="-1"></a></span>
<span id="cb48-18"><a href="results.html#cb48-18" tabindex="-1"></a>pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(pr_obj<span class="sc">$</span>auc.integral, <span class="dv">3</span>)</span>
<span id="cb48-19"><a href="results.html#cb48-19" tabindex="-1"></a></span>
<span id="cb48-20"><a href="results.html#cb48-20" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb48-21"><a href="results.html#cb48-21" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb48-22"><a href="results.html#cb48-22" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb48-23"><a href="results.html#cb48-23" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-24"><a href="results.html#cb48-24" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-25"><a href="results.html#cb48-25" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">str_c</span>(<span class="st">&quot;Precision-Recall Curve (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb48-26"><a href="results.html#cb48-26" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb48-27"><a href="results.html#cb48-27" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb48-28"><a href="results.html#cb48-28" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-29"><a href="results.html#cb48-29" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb48-30"><a href="results.html#cb48-30" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-31"><a href="results.html#cb48-31" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb48-32"><a href="results.html#cb48-32" tabindex="-1"></a>  )</span>
<span id="cb48-33"><a href="results.html#cb48-33" tabindex="-1"></a></span>
<span id="cb48-34"><a href="results.html#cb48-34" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="results.html#cb48-35" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb48-36"><a href="results.html#cb48-36" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb48-37"><a href="results.html#cb48-37" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-38"><a href="results.html#cb48-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-39"><a href="results.html#cb48-39" tabindex="-1"></a>    <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb48-40"><a href="results.html#cb48-40" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb48-41"><a href="results.html#cb48-41" tabindex="-1"></a>    <span class="co"># y = &quot;Precision&quot;,</span></span>
<span id="cb48-42"><a href="results.html#cb48-42" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb48-43"><a href="results.html#cb48-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-44"><a href="results.html#cb48-44" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb48-45"><a href="results.html#cb48-45" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-46"><a href="results.html#cb48-46" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb48-47"><a href="results.html#cb48-47" tabindex="-1"></a>  )</span>
<span id="cb48-48"><a href="results.html#cb48-48" tabindex="-1"></a></span>
<span id="cb48-49"><a href="results.html#cb48-49" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/micro-pr-curve-tf-4-predictors-1.png" width="100%" /></p>
</div>
</div>
<div id="comparison" class="section level3 hasAnchor" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Comparison<a href="results.html#comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="prediction-performance" class="section level4 hasAnchor" number="5.1.5.1">
<h4><span class="header-section-number">5.1.5.1</span> Prediction performance<a href="results.html#prediction-performance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>F1 scores for llms are much higher</p>
</div>
<div id="energy-usage-and-runtime" class="section level4 hasAnchor" number="5.1.5.2">
<h4><span class="header-section-number">5.1.5.2</span> Energy usage and runtime<a href="results.html#energy-usage-and-runtime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Multiclassification more effective than three times single classification
Combine term frequency with llm approach to limit page range</p>
</div>
</div>
</div>
<div id="table-extraction" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Table extraction<a href="results.html#table-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="baseline-regex" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Baseline: Regex<a href="results.html#baseline-regex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The baseline for the table extraction task is set by an approach using regular expressions on the text extract. The approach performs much better<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> on the synthetic dataset compared to the real dataset (see Figure <a href="results.html#fig:table-extraction-regex-performance">5.4</a>). Even though, it does not perform perfectly and its performance is more consistent on the text extracted with pymupdf compared to pdfium. Some possible explanations are:</p>
<ul>
<li>a duplicated row name<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></li>
<li>numeric columns extracted separated from row names by extraction libraries</li>
<li>sums in the same row as the single values<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></li>
<li>with pdfium: missing white space<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></li>
<li>with pdfium: random line breaks<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></li>
</ul>
<p>You can find some examples for incorrect extracted texts in section <a href="appendix.html#regex-extraction-mistakes">8.7</a>.</p>
<p>On the real dataset the approach shows a wider spread for the percentage of correct extracted numeric values as well as a considerable number of annual reports where the extraction did not work at all. Interestingly, the used text extraction library has no noticeable influence on the real dataset.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="results.html#cb49-1" tabindex="-1"></a>df_table_extraction_regex <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="results.html#cb49-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(table_type, percentage_correct_numeric, percentage_correct_total, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="results.html#cb49-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(table_type, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="results.html#cb49-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb49-5"><a href="results.html#cb49-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb49-6"><a href="results.html#cb49-6" tabindex="-1"></a>    <span class="at">data=</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(table_type <span class="sc">==</span> <span class="st">&quot;real_tables&quot;</span>, name <span class="sc">==</span> <span class="st">&quot;percentage_correct_numeric&quot;</span>),</span>
<span id="cb49-7"><a href="results.html#cb49-7" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> table_type, <span class="at">y =</span> value, <span class="at">alpha =</span> extraction_backend), <span class="at">color =</span> <span class="st">&quot;#264DEB&quot;</span>,</span>
<span id="cb49-8"><a href="results.html#cb49-8" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">position=</span><span class="fu">position_jitterdodge</span>(<span class="at">dodge.width=</span><span class="fl">0.9</span>, <span class="at">jitter.width =</span> <span class="fl">0.2</span>, <span class="at">jitter.height =</span> <span class="fl">0.005</span>)</span>
<span id="cb49-9"><a href="results.html#cb49-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb49-10"><a href="results.html#cb49-10" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> table_type, <span class="at">y =</span> value, <span class="at">fill =</span> extraction_backend), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="results.html#cb49-11" tabindex="-1"></a>  <span class="co"># geom_jitter(data= . %&gt;% filter(table_type == &quot;real_tables&quot;), aes(x = table_type, y = value, color = T_EUR), alpha = .8, height = 0, shape = 4) +</span></span>
<span id="cb49-12"><a href="results.html#cb49-12" tabindex="-1"></a>  <span class="co"># facet_wrap(~name, ncol = 1) +</span></span>
<span id="cb49-13"><a href="results.html#cb49-13" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-14"><a href="results.html#cb49-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#94EB1F&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb49-15"><a href="results.html#cb49-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb49-16"><a href="results.html#cb49-16" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>name)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-regex-performance"></span>
<img src="_main_files/figure-html/table-extraction-regex-performance-1.png" alt="Performance overall and on numeric value extraction with regular expressions. Showing single scores for *percentage correct numeric* on real tables to explain wide boxes." width="100%" />
<p class="caption">
Figure 5.4: Performance overall and on numeric value extraction with regular expressions. Showing single scores for <em>percentage correct numeric</em> on real tables to explain wide boxes.
</p>
</div>
<p>The random line breaks result in some missed row names which is reflected by the bigger spread for NA precision with pdfium on the synthetic dataset (see Figure <a href="results.html#fig:table-extraction-regex-NA">5.5</a>). Nevertheless, the NA precision for the majority of the cases is perfect. This is different with the real dataset. The NA precision is found to be at only 0.7.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="results.html#cb50-1" tabindex="-1"></a><span class="co"># NAs for F1 are valid if there is not thinning</span></span>
<span id="cb50-2"><a href="results.html#cb50-2" tabindex="-1"></a>df_table_extraction_regex <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(table_type, NA_precision, NA_recall, NA_F1, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="results.html#cb50-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(table_type, T_EUR, extraction_backend)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="results.html#cb50-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-5"><a href="results.html#cb50-5" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> table_type, <span class="at">y =</span> value, <span class="at">fill =</span> extraction_backend), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="results.html#cb50-6" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb50-7"><a href="results.html#cb50-7" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#94EB1F&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb50-8"><a href="results.html#cb50-8" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb50-9"><a href="results.html#cb50-9" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>name)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-regex-NA"></span>
<img src="_main_files/figure-html/table-extraction-regex-NA-1.png" alt="Performance on classification for missing values with regular expressions" width="100%" />
<p class="caption">
Figure 5.5: Performance on classification for missing values with regular expressions
</p>
</div>
<div id="hypotheses" class="section level5 hasAnchor" number="5.2.1.0.1">
<h5><span class="header-section-number">5.2.1.0.1</span> Hypotheses<a href="results.html#hypotheses" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The formulated hypotheses have been evaluated visually using the dependence and beeswarm plots from the shapviz library based on the <a href="glossary.html#acronyms_SHAP">SHAP</a> values calculated with a random forest.</p>
<div id="real-dataset" class="section level6 hasAnchor" number="5.2.1.0.1.1">
<h6><span class="header-section-number">5.2.1.0.1.1</span> Real dataset<a href="results.html#real-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="results.html#cb51-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/real_table_extraction_regex_h2o_results_sample_50000_shap_2000.rds&quot;</span>)</span>
<span id="cb51-2"><a href="results.html#cb51-2" tabindex="-1"></a></span>
<span id="cb51-3"><a href="results.html#cb51-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb51-4"><a href="results.html#cb51-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb51-5"><a href="results.html#cb51-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-6"><a href="results.html#cb51-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb51-7"><a href="results.html#cb51-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-8"><a href="results.html#cb51-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb51-9"><a href="results.html#cb51-9" tabindex="-1"></a></span>
<span id="cb51-10"><a href="results.html#cb51-10" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb51-11"><a href="results.html#cb51-11" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb51-12"><a href="results.html#cb51-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-13"><a href="results.html#cb51-13" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb51-14"><a href="results.html#cb51-14" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-15"><a href="results.html#cb51-15" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb51-16"><a href="results.html#cb51-16" tabindex="-1"></a></span>
<span id="cb51-17"><a href="results.html#cb51-17" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb51-18"><a href="results.html#cb51-18" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="results.html#cb51-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-20"><a href="results.html#cb51-20" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.225</span>))</span>
<span id="cb51-21"><a href="results.html#cb51-21" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-22"><a href="results.html#cb51-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.35</span>, <span class="fl">0.35</span>))</span>
<span id="cb51-23"><a href="results.html#cb51-23" tabindex="-1"></a></span>
<span id="cb51-24"><a href="results.html#cb51-24" tabindex="-1"></a>real_table_extraction_regex_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb51-25"><a href="results.html#cb51-25" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb51-26"><a href="results.html#cb51-26" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b)</span></code></pre></div>
</details>
<p>There are multiple hypotheses that don’t get supported by the visual results (see Figure <a href="appendix.html#fig:real-table-extraction-regex-shap-plot">8.1</a>). The pretty surprising results are:</p>
<ol style="list-style-type: decimal">
<li>The visual separation of columns or rows has an effect on the text processing at all.</li>
<li>It seems to have a positive effect on F1 and numeric correctness rate if the Passiva table is on the same page, even though it has no influence on the single predictions.</li>
</ol>
<p>But one has to keep in mind that the number of data points on the aggregated values for the test set of the real dataset is only 18. So these findings are not strongly supporting any interpretation at all. Furthermore, the found effects are not very large - most below 5 %. Only the hypothesis for a positive influence of a missing of a value for the binomial prediction gets solid support with a mean absolute <a href="glossary.html#acronyms_SHAP">SHAP</a> value of over 20` %. To get reliable results more tables have to be included which would require additional manual encoding.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="results.html#cb52-1" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">includeHTML</span>(</span>
<span id="cb52-2"><a href="results.html#cb52-2" tabindex="-1"></a>  <span class="fu">textConnection</span>(</span>
<span id="cb52-3"><a href="results.html#cb52-3" tabindex="-1"></a>    xml2<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_real_table_extraction_regex.html&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="results.html#cb52-4" tabindex="-1"></a>      xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">&quot;//table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="results.html#cb52-5" tabindex="-1"></a>      <span class="fu">as.character</span>()</span>
<span id="cb52-6"><a href="results.html#cb52-6" tabindex="-1"></a>  )</span>
<span id="cb52-7"><a href="results.html#cb52-7" tabindex="-1"></a>)</span></code></pre></div>
</details>
<table cellspacing="0" border="0">
<colgroup span="7" width="85"></colgroup>
<tr>
<td rowspan="2" height="34" align="left" valign="bottom" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "predictor"}'><b><font color="#FFFFFF">predictor</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "F1"}'><b><font color="#FFFFFF">F1</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "% numeric correct"}'><b><font color="#FFFFFF">% numeric correct</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "binomial"}'><b><font color="#FFFFFF">binomial</font></b></td>
        </tr>
<tr>
<td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "extraction_backend"}'>extraction_backend</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "n_columns"}'>n_columns</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "4 is worse"}'>4 is worse</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "4 is worse"}'>4 is worse</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "sum_same_line"}'>sum_same_line</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "header_span"}'>header_span</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "enumeration"}'>enumeration</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "T_in_previous_year"}'>T_in_previous_year</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "T_in_year"}'>T_in_year</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "passiva_same_page"}'>passiva_same_page</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b><font color="#C9211E">positive</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b><font color="#C9211E">positive</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vorjahr"}'>vorjahr</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vis_separated_cols"}'>vis_separated_cols</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vis_separated_rows"}'>vis_separated_rows</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label_length"}'>label_length</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label"}'>label</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "missing"}'>missing</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
    </tr>
</table>

</div>
<div id="synthetic-dataset" class="section level6 hasAnchor" number="5.2.1.0.1.2">
<h6><span class="header-section-number">5.2.1.0.1.2</span> Synthetic dataset<a href="results.html#synthetic-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="results.html#cb53-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/synth_table_extraction_regex_h2o_results_sample_50000_shap_2000.rds&quot;</span>)</span>
<span id="cb53-2"><a href="results.html#cb53-2" tabindex="-1"></a></span>
<span id="cb53-3"><a href="results.html#cb53-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb53-4"><a href="results.html#cb53-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="results.html#cb53-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="results.html#cb53-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb53-7"><a href="results.html#cb53-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-8"><a href="results.html#cb53-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb53-9"><a href="results.html#cb53-9" tabindex="-1"></a></span>
<span id="cb53-10"><a href="results.html#cb53-10" tabindex="-1"></a>p1c <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;extraction_backend&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="results.html#cb53-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;dependence plot for extraction_backend&quot;</span>)</span>
<span id="cb53-12"><a href="results.html#cb53-12" tabindex="-1"></a>p1d <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;header_span&quot;</span>, <span class="at">color_var =</span> <span class="st">&quot;extraction_backend&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-13"><a href="results.html#cb53-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;dependence plot for header_span&quot;</span>)</span>
<span id="cb53-14"><a href="results.html#cb53-14" tabindex="-1"></a></span>
<span id="cb53-15"><a href="results.html#cb53-15" tabindex="-1"></a></span>
<span id="cb53-16"><a href="results.html#cb53-16" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb53-17"><a href="results.html#cb53-17" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb53-18"><a href="results.html#cb53-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-19"><a href="results.html#cb53-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb53-20"><a href="results.html#cb53-20" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-21"><a href="results.html#cb53-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb53-22"><a href="results.html#cb53-22" tabindex="-1"></a></span>
<span id="cb53-23"><a href="results.html#cb53-23" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb53-24"><a href="results.html#cb53-24" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb53-25"><a href="results.html#cb53-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-26"><a href="results.html#cb53-26" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb53-27"><a href="results.html#cb53-27" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-28"><a href="results.html#cb53-28" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb53-29"><a href="results.html#cb53-29" tabindex="-1"></a></span>
<span id="cb53-30"><a href="results.html#cb53-30" tabindex="-1"></a>synth_table_extraction_regex_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb53-31"><a href="results.html#cb53-31" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb53-32"><a href="results.html#cb53-32" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b)</span>
<span id="cb53-33"><a href="results.html#cb53-33" tabindex="-1"></a></span>
<span id="cb53-34"><a href="results.html#cb53-34" tabindex="-1"></a>synth_table_extraction_regex_shap_num_details_plot <span class="ot">&lt;-</span> p1c <span class="sc">|</span> p1d</span></code></pre></div>
</details>
<p>Interpreting the visual results for the <a href="glossary.html#acronyms_SHAP">SHAP</a> analysis on the synthetic dataset brought some interesting insides into the question under which condition the two PDF extraction libraries perform differently. These results can be treated as reliable since the model has been trained with 50_000 rows and the <a href="glossary.html#acronyms_SHAP">SHAP</a> values have been calculated on 2_000 rows each.</p>
<p>Very interestingly the number of columns is having an opposite effect for the two libraries (see Figure <a href="results.html#fig:synth-table-extraction-regex-shap-num-details-plot">5.6</a>A). Besides that often only pdfium struggled with some of the table characteristics while pymupdf is not influenced by them (for an example with header_span see Figure <a href="results.html#fig:synth-table-extraction-regex-shap-num-details-plot">5.6</a>B).</p>
<p>It might be worth noting that the row for <em>Anteile an verbundenen Unternehmen</em> was rated to have a clear negative effect on the chance to extract the correct value.</p>
<p>Since there has no synthetic data created where also the Passiva table is present the result found with the real dataset can’t be investigated further. Also the question if visual separation is having an effect was not studied, even though, creating such additional synthetic data would be very easy with the current generation process and could be done in future work. It would be interesting if the visual separation is cause for the maleous text extractions of pdfium as well.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="results.html#cb54-1" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">includeHTML</span>(</span>
<span id="cb54-2"><a href="results.html#cb54-2" tabindex="-1"></a>  <span class="fu">textConnection</span>(</span>
<span id="cb54-3"><a href="results.html#cb54-3" tabindex="-1"></a>    xml2<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_synth_table_extraction_regex.html&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="results.html#cb54-4" tabindex="-1"></a>      xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">&quot;//table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="results.html#cb54-5" tabindex="-1"></a>      <span class="fu">as.character</span>()</span>
<span id="cb54-6"><a href="results.html#cb54-6" tabindex="-1"></a>  )</span>
<span id="cb54-7"><a href="results.html#cb54-7" tabindex="-1"></a>)</span></code></pre></div>
</details>
<table cellspacing="0" border="0">
<colgroup span="7" width="85"></colgroup>
<tr>
<td rowspan="2" height="34" align="left" valign="bottom" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "predictor"}'><b><font color="#FFFFFF">predictor</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "F1"}'><b><font color="#FFFFFF">F1</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "% numeric correct"}'><b><font color="#FFFFFF">% numeric correct</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "binomial"}'><b><font color="#FFFFFF">binomial</font></b></td>
        </tr>
<tr>
<td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "extraction_backend"}'>extraction_backend</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "pymupdf better"}'><font color="#C9211E">pymupdf better</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "pymupdf better"}'><font color="#C9211E">pymupdf better</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "pymupdf better"}'><font color="#C9211E">pymupdf better</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "n_columns"}'>n_columns</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "4 is worse"}'>4 is worse</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b><font color="#C9211E">positive</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b><font color="#C9211E">positive</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b><font color="#C9211E">positive</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "sum_same_line"}'>sum_same_line</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'>negative*</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "header_span"}'>header_span</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "thin"}'>thin</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "NA"}'>NA</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "year_as"}'>year_as</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "unit_in_first_cell"}'>unit_in_first_cell</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'>negative*</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'>negative*</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'>negative*</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "log10_unit_multiplier"}'>log10_unit_multiplier</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative*"}'><font color="#C9211E">negative*</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "enumeration"}'>enumeration</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'>positive*</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive*"}'><font color="#C9211E">positive*</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "shuffle_rows"}'>shuffle_rows</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "text_around"}'>text_around</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "many_line_breaks"}'>many_line_breaks</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label_length"}'>label_length</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label"}'>label</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "missing"}'>missing</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
    </tr>
</table>

<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="results.html#cb55-1" tabindex="-1"></a>synth_table_extraction_regex_shap_num_details_plot <span class="sc">+</span> </span>
<span id="cb55-2"><a href="results.html#cb55-2" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&#39;A&#39;</span>)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:synth-table-extraction-regex-shap-num-details-plot"></span>
<img src="_main_files/figure-html/synth-table-extraction-regex-shap-num-details-plot-1.png" alt="Showing the influence of the extraxtion library on the numeric text extraction task with synthetic data" width="100%" />
<p class="caption">
Figure 5.6: Showing the influence of the extraxtion library on the numeric text extraction task with synthetic data
</p>
</div>
</div>
</div>
</div>
<div id="extraction-with-llms" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Extraction with LLMs<a href="results.html#extraction-with-llms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="results.html#cb56-1" tabindex="-1"></a>df_real_table_extraction <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_llm.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="results.html#cb56-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;deepseek-ai_DeepSeek-R1-Distill-Qwen-32B&quot;</span>, <span class="st">&#39;google_gemma-3n-E4B-it&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="results.html#cb56-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model))</span>
<span id="cb56-4"><a href="results.html#cb56-4" tabindex="-1"></a>df_real_table_extraction_synth <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_synth.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href="results.html#cb56-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model))</span>
<span id="cb56-6"><a href="results.html#cb56-6" tabindex="-1"></a>df_real_table_extraction_azure <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/real_table_extraction_azure.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="results.html#cb56-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">gsub</span>(<span class="st">&quot;^[^_]+_&quot;</span>, <span class="st">&quot;&quot;</span>, model))</span>
<span id="cb56-8"><a href="results.html#cb56-8" tabindex="-1"></a></span>
<span id="cb56-9"><a href="results.html#cb56-9" tabindex="-1"></a>model_by_size <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb56-10"><a href="results.html#cb56-10" tabindex="-1"></a>  <span class="st">&#39;gemma-3-4b-it&#39;</span>, <span class="co">#&#39;gemma-3n-E4B-it&#39;, </span></span>
<span id="cb56-11"><a href="results.html#cb56-11" tabindex="-1"></a>  <span class="st">&quot;gemma-3-12b-it&quot;</span>, <span class="st">&quot;gemma-3-27b-it&quot;</span>, </span>
<span id="cb56-12"><a href="results.html#cb56-12" tabindex="-1"></a>  <span class="st">&quot;Llama-3.1-8B-Instruct&quot;</span>, <span class="st">&quot;Llama-3.1-70B-Instruct&quot;</span>, <span class="st">&quot;Llama-3.3-70B-Instruct&quot;</span>,</span>
<span id="cb56-13"><a href="results.html#cb56-13" tabindex="-1"></a>  <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span>, <span class="st">&quot;Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,</span>
<span id="cb56-14"><a href="results.html#cb56-14" tabindex="-1"></a>  <span class="st">&quot;Mistral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Mistral-Small-3.1-24B-Instruct-2503&quot;</span>,</span>
<span id="cb56-15"><a href="results.html#cb56-15" tabindex="-1"></a>  <span class="st">&quot;Mistral-Large-Instruct-2411&quot;</span>, <span class="st">&quot;Qwen2.5-0.5B-Instruct&quot;</span>,</span>
<span id="cb56-16"><a href="results.html#cb56-16" tabindex="-1"></a>  <span class="st">&quot;Qwen2.5-1.5B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-3B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-7B-Instruct&quot;</span>,</span>
<span id="cb56-17"><a href="results.html#cb56-17" tabindex="-1"></a>  <span class="st">&quot;Qwen2.5-14B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-32B-Instruct&quot;</span>, <span class="st">&quot;Qwen2.5-72B-Instruct&quot;</span>,</span>
<span id="cb56-18"><a href="results.html#cb56-18" tabindex="-1"></a>  <span class="st">&quot;Qwen3-0.6B&quot;</span>, <span class="st">&quot;Qwen3-1.7B&quot;</span>, <span class="st">&quot;Qwen3-4B&quot;</span>,</span>
<span id="cb56-19"><a href="results.html#cb56-19" tabindex="-1"></a>  <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-14B&quot;</span>, <span class="st">&quot;Qwen3-30B-A3B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen3-32B&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span>,</span>
<span id="cb56-20"><a href="results.html#cb56-20" tabindex="-1"></a>  <span class="co"># &quot;gpt-4.1-nano&quot;, &quot;gpt-4.1-mini&quot;, &quot;gpt-4.1&quot;,</span></span>
<span id="cb56-21"><a href="results.html#cb56-21" tabindex="-1"></a>  <span class="st">&quot;Falcon3-10B-Instruct&quot;</span>, <span class="st">&quot;phi-4&quot;</span></span>
<span id="cb56-22"><a href="results.html#cb56-22" tabindex="-1"></a>)</span>
<span id="cb56-23"><a href="results.html#cb56-23" tabindex="-1"></a></span>
<span id="cb56-24"><a href="results.html#cb56-24" tabindex="-1"></a>method_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;top_n_rag_examples&quot;</span>, <span class="st">&quot;n_random_examples&quot;</span>, <span class="st">&quot;top_n_rag_examples_out_of_sample&quot;</span>, <span class="st">&quot;static_example&quot;</span>, <span class="st">&quot;zero_shot&quot;</span> )</span>
<span id="cb56-25"><a href="results.html#cb56-25" tabindex="-1"></a></span>
<span id="cb56-26"><a href="results.html#cb56-26" tabindex="-1"></a>df_overview <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb56-27"><a href="results.html#cb56-27" tabindex="-1"></a>  <span class="fu">filter</span>(out_of_company <span class="sc">!=</span> <span class="cn">TRUE</span> <span class="sc">|</span> <span class="fu">is.na</span>(out_of_company), n_examples <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-28"><a href="results.html#cb56-28" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size) <span class="sc">%&gt;%</span></span>
<span id="cb56-29"><a href="results.html#cb56-29" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-30"><a href="results.html#cb56-30" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb56-31"><a href="results.html#cb56-31" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb56-32"><a href="results.html#cb56-32" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb56-33"><a href="results.html#cb56-33" tabindex="-1"></a>    )</span>
<span id="cb56-34"><a href="results.html#cb56-34" tabindex="-1"></a></span>
<span id="cb56-35"><a href="results.html#cb56-35" tabindex="-1"></a>units_real_tables <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../benchmark_truth/real_tables/table_characteristics.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb56-36"><a href="results.html#cb56-36" tabindex="-1"></a>  <span class="at">filepath =</span> <span class="fu">paste0</span>(<span class="st">&#39;/pvc/benchmark_truth/real_tables/&#39;</span>, company, <span class="st">&#39;__&#39;</span>, filename),</span>
<span id="cb56-37"><a href="results.html#cb56-37" tabindex="-1"></a>  <span class="at">T_EUR =</span> (T_in_year <span class="sc">+</span> T_in_previous_year)<span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb56-38"><a href="results.html#cb56-38" tabindex="-1"></a>  <span class="at">T_EUR_both =</span> (T_in_year <span class="sc">+</span> T_in_previous_year)<span class="sc">&gt;</span><span class="dv">1</span></span>
<span id="cb56-39"><a href="results.html#cb56-39" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(filepath, T_EUR, T_EUR_both)</span>
<span id="cb56-40"><a href="results.html#cb56-40" tabindex="-1"></a></span>
<span id="cb56-41"><a href="results.html#cb56-41" tabindex="-1"></a>df_real_table_extraction_synth <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(units_real_tables)</span>
<span id="cb56-42"><a href="results.html#cb56-42" tabindex="-1"></a></span>
<span id="cb56-43"><a href="results.html#cb56-43" tabindex="-1"></a>zero_shot_stars <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;zero_shot&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_num =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_F1 =</span> <span class="fu">mean</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mean_total<span class="sc">&gt;</span>real_table_extraction_regex_total_performance_mean, mean_num<span class="sc">&gt;</span>real_table_extraction_regex_num_performance_mean, mean_F1<span class="sc">&gt;</span>real_table_extraction_regex_NA_F1_mean)</span>
<span id="cb56-44"><a href="results.html#cb56-44" tabindex="-1"></a></span>
<span id="cb56-45"><a href="results.html#cb56-45" tabindex="-1"></a>static_example_stars <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(method <span class="sc">==</span> <span class="st">&quot;static_example&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_num =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_F1 =</span> <span class="fu">mean</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mean_total<span class="sc">&gt;</span>real_table_extraction_regex_total_performance_mean, mean_num<span class="sc">&gt;</span>real_table_extraction_regex_num_performance_mean, mean_F1<span class="sc">&gt;</span>real_table_extraction_regex_NA_F1_mean)</span>
<span id="cb56-46"><a href="results.html#cb56-46" tabindex="-1"></a></span>
<span id="cb56-47"><a href="results.html#cb56-47" tabindex="-1"></a>underperformer <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_num =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_F1 =</span> <span class="fu">mean</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(mean_total<span class="sc">&lt;</span>real_table_extraction_regex_total_performance_mean, mean_num<span class="sc">&lt;</span>real_table_extraction_regex_num_performance_mean, mean_F1<span class="sc">&lt;</span>real_table_extraction_regex_NA_F1_mean)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(mean_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb56-48"><a href="results.html#cb56-48" tabindex="-1"></a></span>
<span id="cb56-49"><a href="results.html#cb56-49" tabindex="-1"></a>super_underperformer <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;zero_shot&#39;</span>, <span class="st">&#39;static_example&#39;</span>), n_examples<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_numeric, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_num =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_F1 =</span> <span class="fu">mean</span>(NA_F1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">any</span>(mean_total<span class="sc">&lt;</span>real_table_extraction_regex_total_performance_mean, mean_num<span class="sc">&lt;</span>real_table_extraction_regex_num_performance_mean, mean_F1<span class="sc">&lt;</span>real_table_extraction_regex_NA_F1_mean)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(mean_total) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div>
</details>
<ul>
<li>confidence usable to head for user checks?</li>
<li>not handled new entries</li>
<li>five examples bring not much more, but a little</li>
<li>random forest / SHAP</li>
</ul>
<div id="real-tables-only" class="section level4 hasAnchor" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> Real tables only<a href="results.html#real-tables-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For the table extraction task 30 open source models have been benchmarked<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>. The results are presented in Figure <a href="appendix.html#fig:table-extraction-llm-performance-total-overview">8.4</a>, <a href="appendix.html#fig:table-extraction-llm-performance-numeric-overview">8.5</a> and <a href="appendix.html#fig:table-extraction-llm-f1-overview">8.6</a>).</p>
<p>Most models need a context learning approach to beat the performance of the regular expression approach at total and numeric correctness rate and F1 score. Only 4 models perform better without any guidance<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> (see Table <a href="results.html#tab:zero-and-synth-performing-models-tab">5.5</a>). 8 models achieved an performance better as the regex baseline using the approach to learn with a fixed example from the synthetic dataset.</p>
<p>In contrast: most of the models achieved a better performance than the regex baseline when they were provided with one or more examples from real <em>Aktiva</em> tables. Just 5 don’t achieve a better value even with three or five realistic examples (see Table <a href="results.html#tab:super-underperforming-models-tab">5.6</a>). Here we find the smallest models with less than 2B parameters which don’t achieve a consistence performance no matter how many examples they get. But we also find models that start to perform bad if they get a too long context with too many examples like the very recent and large model Llama 4 Maverick.</p>
<p>With one and three examples the performance within one model family is positive correlated with the number of parameters the models have. Once the 4B parameters are passed the improvements get less and less getting closer to a perfect performance but never reaching it on all documents. Table <a href="results.html#tab:table-metrics-llm-real-table-extraction">5.7</a> shows the mean performance for the best model-method approach for each model family. Most of the top performing model-method combinations rely on the maximum number of examples provided. Only the Llama-3 and Falcon3 model perform best with three examples<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="results.html#cb57-1" tabindex="-1"></a>zero_shot_stars <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(static_example_stars, <span class="fu">join_by</span>(model), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_zero_shot&quot;</span>, <span class="st">&quot;static_example&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(model, <span class="fu">starts_with</span>(<span class="st">&quot;mean_total&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="results.html#cb57-2" tabindex="-1"></a><span class="fu">mutate_if</span>(</span>
<span id="cb57-3"><a href="results.html#cb57-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb57-4"><a href="results.html#cb57-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb57-5"><a href="results.html#cb57-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-6"><a href="results.html#cb57-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb57-7"><a href="results.html#cb57-7" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb57-8"><a href="results.html#cb57-8" tabindex="-1"></a>    )</span>
<span id="cb57-9"><a href="results.html#cb57-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="results.html#cb57-10" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb57-11"><a href="results.html#cb57-11" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;lrr&quot;</span>,</span>
<span id="cb57-12"><a href="results.html#cb57-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing table extraction performance with real &#39;Aktiva&#39; dataset for models that perform well without or with little context learning&quot;</span>,</span>
<span id="cb57-13"><a href="results.html#cb57-13" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:zero-and-synth-performing-models-tab">Table 5.5: </span>Comparing table extraction performance with real ‘Aktiva’ dataset for models that perform well without or with little context learning
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3e948c99b62ae91a04f5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3e948c99b62ae91a04f5">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Llama-4-Maverick-17B-128E-Instruct-FP8","Qwen2.5-32B-Instruct","Qwen3-235B-A22B-Instruct-2507","phi-4","Mistral-Small-3.1-24B-Instruct-2503","Qwen2.5-72B-Instruct","Qwen3-30B-A3B-Instruct-2507","gemma-3-27b-it"],["0.717","0.766","<b>0.805<\/b>","0.792",null,null,null,null],["0.747","0.838","<b>0.855<\/b>","0.703","0.788","0.765","0.768","0.735"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>mean_total_zero_shot<\/th>\n      <th>mean_totalstatic_example<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"mean_total_zero_shot","targets":2},{"name":"mean_totalstatic_example","targets":3}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="results.html#cb58-1" tabindex="-1"></a>super_underperformer <span class="sc">%&gt;%</span> <span class="fu">select</span>(model, method, mean_total) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="co"># mutate(model = str_replace_all(model, &quot;_&quot;, &quot; &quot;)) %&gt;% </span></span>
<span id="cb58-2"><a href="results.html#cb58-2" tabindex="-1"></a><span class="fu">mutate_if</span>(</span>
<span id="cb58-3"><a href="results.html#cb58-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb58-4"><a href="results.html#cb58-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb58-5"><a href="results.html#cb58-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">max</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb58-6"><a href="results.html#cb58-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, <span class="fu">round</span>(., <span class="dv">3</span>), <span class="st">&quot;**&quot;</span>),</span>
<span id="cb58-7"><a href="results.html#cb58-7" tabindex="-1"></a>      <span class="fu">round</span>(., <span class="dv">3</span>)</span>
<span id="cb58-8"><a href="results.html#cb58-8" tabindex="-1"></a>    )</span>
<span id="cb58-9"><a href="results.html#cb58-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb58-10"><a href="results.html#cb58-10" tabindex="-1"></a>  <span class="fu">render_table</span>(</span>
<span id="cb58-11"><a href="results.html#cb58-11" tabindex="-1"></a>    <span class="at">alignment =</span> <span class="st">&quot;llr&quot;</span>,</span>
<span id="cb58-12"><a href="results.html#cb58-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Comparing table extraction performance with real &#39;Aktiva&#39; dataset for models that worse than the regex baselin with 3 or 5 examples for in-context learning&quot;</span>,</span>
<span id="cb58-13"><a href="results.html#cb58-13" tabindex="-1"></a>    <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:super-underperforming-models-tab">Table 5.6: </span>Comparing table extraction performance with real ‘Aktiva’ dataset for models that worse than the regex baselin with 3 or 5 examples for in-context learning
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5db30b781e95d66c7daf" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5db30b781e95d66c7daf">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5"],["Llama-4-Maverick-17B-128E-Instruct-FP8","Qwen2.5-0.5B-Instruct","Qwen2.5-1.5B-Instruct","Qwen3-0.6B","gemma-3-4b-it"],["top_5_rag_examples","top_3_rag_examples_out_of_sample","top_3_rag_examples_out_of_sample","3_random_examples","5_random_examples"],["0.004","0.094","0.611","0.443","<b>0.635<\/b>"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>method<\/th>\n      <th>mean_total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"method","targets":2},{"name":"mean_total","targets":3}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="results.html#cb59-1" tabindex="-1"></a>df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="results.html#cb59-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model_family) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="results.html#cb59-3" tabindex="-1"></a>  <span class="fu">select</span>(model_family, model, method_family, n_examples, mean_total) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="results.html#cb59-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_total =</span> <span class="fu">round</span>(mean_total, <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="results.html#cb59-5" tabindex="-1"></a>  <span class="fu">render_table</span>(<span class="at">caption =</span> <span class="st">&quot;Comparing best mean table extraction performance with real &#39;Aktiva&#39; dataset for each model family&quot;</span>, <span class="at">ref =</span> opts_current<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;label&quot;</span>), <span class="at">alignment =</span> <span class="st">&quot;lllrr&quot;</span>, <span class="at">dom=</span><span class="st">&quot;t&quot;</span>)</span></code></pre></div>
</details>
<table>
<caption>
<span id="tab:table-metrics-llm-real-table-extraction">Table 5.7: </span>Comparing best mean table extraction performance with real ‘Aktiva’ dataset for each model family
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-9cbd0b35f6bf0f4db284" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9cbd0b35f6bf0f4db284">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8"],["Qwen 3","Llama-4","mistralai","Llama-3","Qwen 2.5","microsoft","tiiuae","google"],["Qwen3-235B-A22B-Instruct-2507","Llama-4-Scout-17B-16E-Instruct","Mistral-Large-Instruct-2411","Llama-3.1-70B-Instruct","Qwen2.5-14B-Instruct","phi-4","Falcon3-10B-Instruct","gemma-3-27b-it"],["top_n_rag_examples","top_n_rag_examples","top_n_rag_examples","n_random_examples","n_random_examples","n_random_examples","top_n_rag_examples","n_random_examples"],["5","5","5","3","5","3","3","5"],["0.961","0.931","0.929","0.911","0.908","0.893","0.862","0.821"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>mean_total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-left"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"method_family","targets":3},{"name":"n_examples","targets":4},{"name":"mean_total","targets":5}],"scrollX":true,"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Based on a small sample of 8 documents by the <em>Amt für Statistik Berlin-Brandenburg</em> it seems that there is support for the hypothesis, that providing Aktiva tables from the same company in in-context learning, is improving the results. This is especially noticeable for models with very few parameters and when providing only a single example. This seems intuitive, since there the potential for possibilities is much bigger. Figure <a href="appendix.html#fig:table-extraction-llm-performance-total-overview-out-of-company">8.7</a> shows that on this limited sample</p>
<ul>
<li>the improvement is bigger for Qwen 3 than for Qwen 2.5</li>
<li>Googles gemma 27b and GPT 4.1 mini could overcome an unnoticed issue with the extraction with just one example.</li>
<li>the effect of being overwhelmed by a too rich context with LLamas Maverick model could get reduced a bit.</li>
</ul>
<p>To examine the question, if the reported confidence score of the responses can be used, to flag the predicted values as potentially wrong. Again, Figure <a href="results.html#fig:table-extraction-llm-confidence">5.7</a> shows, that Qwen 3 reports very high confidence values no matter if the results are correct or not. With the Mistral model we find a wider range of confidences given and for wrong results lower confidence is reported.</p>
<p>Figure <a href="results.html#fig:table-extraction-llm-confidence-lm">5.8</a> shows, that the chance to make an mistake by believing the prediction is rising with lower confidence. The chance to make a mistake is higher for predictions of numeric values than for believing a value is not present in the table. The chance to make such a mistake is higher using the confidence reported by Qwen 3.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="results.html#cb60-1" tabindex="-1"></a>confidence_vs_truth <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="results.html#cb60-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="results.html#cb60-3" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb60-4"><a href="results.html#cb60-4" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb60-5"><a href="results.html#cb60-5" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="results.html#cb60-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="results.html#cb60-7" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_percentage_correct_total, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="results.html#cb60-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_processed =</span> <span class="fu">map</span>(predictions, <span class="sc">~</span>{</span>
<span id="cb60-9"><a href="results.html#cb60-9" tabindex="-1"></a>    .x <span class="sc">%&gt;%</span> </span>
<span id="cb60-10"><a href="results.html#cb60-10" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;_merge&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-11"><a href="results.html#cb60-11" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb60-12"><a href="results.html#cb60-12" tabindex="-1"></a>        <span class="at">match =</span> (year_truth <span class="sc">==</span> year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(year_result)),</span>
<span id="cb60-13"><a href="results.html#cb60-13" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_this_year,</span>
<span id="cb60-14"><a href="results.html#cb60-14" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(year_truth),</span>
<span id="cb60-15"><a href="results.html#cb60-15" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(year_result),</span>
<span id="cb60-16"><a href="results.html#cb60-16" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb60-17"><a href="results.html#cb60-17" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb60-18"><a href="results.html#cb60-18" tabindex="-1"></a>        <span class="at">tuple_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb60-19"><a href="results.html#cb60-19" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb60-20"><a href="results.html#cb60-20" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb60-21"><a href="results.html#cb60-21" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_previous_year,</span>
<span id="cb60-22"><a href="results.html#cb60-22" tabindex="-1"></a>        <span class="at">match =</span> (previous_year_truth <span class="sc">==</span> previous_year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(previous_year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(previous_year_result)),</span>
<span id="cb60-23"><a href="results.html#cb60-23" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(previous_year_truth),</span>
<span id="cb60-24"><a href="results.html#cb60-24" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(previous_year_result),</span>
<span id="cb60-25"><a href="results.html#cb60-25" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb60-26"><a href="results.html#cb60-26" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb60-27"><a href="results.html#cb60-27" tabindex="-1"></a>        <span class="at">tuple_previous_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb60-28"><a href="results.html#cb60-28" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb60-29"><a href="results.html#cb60-29" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">c</span>(year_truth, previous_year_truth, year_result, previous_year_result,</span>
<span id="cb60-30"><a href="results.html#cb60-30" tabindex="-1"></a>           confidence_this_year, confidence_previous_year)</span>
<span id="cb60-31"><a href="results.html#cb60-31" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb60-32"><a href="results.html#cb60-32" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;E1&quot;</span>, <span class="st">&quot;E2&quot;</span>, <span class="st">&quot;E3&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-33"><a href="results.html#cb60-33" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb60-34"><a href="results.html#cb60-34" tabindex="-1"></a>        <span class="at">match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(match), <span class="cn">FALSE</span>, match)</span>
<span id="cb60-35"><a href="results.html#cb60-35" tabindex="-1"></a>      )</span>
<span id="cb60-36"><a href="results.html#cb60-36" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb60-37"><a href="results.html#cb60-37" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions_processed) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb60-38"><a href="results.html#cb60-38" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb60-39"><a href="results.html#cb60-39" tabindex="-1"></a>    <span class="at">truth_NA =</span> <span class="fu">factor</span>(truth_NA, <span class="at">levels =</span> <span class="fu">c</span>(F, T))</span>
<span id="cb60-40"><a href="results.html#cb60-40" tabindex="-1"></a>  )</span>
<span id="cb60-41"><a href="results.html#cb60-41" tabindex="-1"></a></span>
<span id="cb60-42"><a href="results.html#cb60-42" tabindex="-1"></a>confidence_vs_truth <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-43"><a href="results.html#cb60-43" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb60-44"><a href="results.html#cb60-44" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence, <span class="at">fill =</span> truth_NA), </span>
<span id="cb60-45"><a href="results.html#cb60-45" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-46"><a href="results.html#cb60-46" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-47"><a href="results.html#cb60-47" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-48"><a href="results.html#cb60-48" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-1.png" alt="Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
Figure 5.7: Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="results.html#cb61-1" tabindex="-1"></a>confidence_vs_truth <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="results.html#cb61-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-3"><a href="results.html#cb61-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb61-4"><a href="results.html#cb61-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.005</span></span>
<span id="cb61-5"><a href="results.html#cb61-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="results.html#cb61-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, predicted_NA, model) <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="results.html#cb61-7" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb61-8"><a href="results.html#cb61-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb61-9"><a href="results.html#cb61-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb61-10"><a href="results.html#cb61-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb61-11"><a href="results.html#cb61-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb61-12"><a href="results.html#cb61-12" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb61-13"><a href="results.html#cb61-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-14"><a href="results.html#cb61-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> chance_false, <span class="at">color =</span> predicted_NA)) <span class="sc">+</span></span>
<span id="cb61-15"><a href="results.html#cb61-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb61-16"><a href="results.html#cb61-16" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb61-17"><a href="results.html#cb61-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Chance False (%)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Predicted NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-18"><a href="results.html#cb61-18" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb61-19"><a href="results.html#cb61-19" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence-lm"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals" width="100%" />
<p class="caption">
Figure 5.8: Estimating the relative frequency to find a wrong extraction result over different confidence intervals
</p>
</div>
<div id="hypotheses-1" class="section level5 hasAnchor" number="5.2.2.1.1">
<h5><span class="header-section-number">5.2.2.1.1</span> Hypotheses<a href="results.html#hypotheses-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The formulated hypotheses have been evaluated visually using the dependence and beeswarm plots from the shapviz library based on the <a href="glossary.html#acronyms_SHAP">SHAP</a> values calculated with a random forest.</p>
<div id="real-dataset-1" class="section level6 hasAnchor" number="5.2.2.1.1.1">
<h6><span class="header-section-number">5.2.2.1.1.1</span> Real dataset<a href="results.html#real-dataset-1" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="results.html#cb62-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/h2o/real_table_extraction_h2o_results_sample_50000_shap_2000.rds&quot;</span>)</span>
<span id="cb62-2"><a href="results.html#cb62-2" tabindex="-1"></a></span>
<span id="cb62-3"><a href="results.html#cb62-3" tabindex="-1"></a>shap_num <span class="ot">&lt;-</span> results<span class="sc">$</span>perc_numeric<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb62-4"><a href="results.html#cb62-4" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-5"><a href="results.html#cb62-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% numeric correct&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="results.html#cb62-6" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb62-7"><a href="results.html#cb62-7" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="results.html#cb62-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb62-9"><a href="results.html#cb62-9" tabindex="-1"></a>p1c <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;n_examples&quot;</span>)</span>
<span id="cb62-10"><a href="results.html#cb62-10" tabindex="-1"></a>p1d <span class="ot">&lt;-</span> shap_num <span class="sc">%&gt;%</span> <span class="fu">sv_dependence</span>(<span class="st">&quot;T_in_year&quot;</span>)</span>
<span id="cb62-11"><a href="results.html#cb62-11" tabindex="-1"></a></span>
<span id="cb62-12"><a href="results.html#cb62-12" tabindex="-1"></a>shap_f1 <span class="ot">&lt;-</span> results<span class="sc">$</span>NA_F1<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb62-13"><a href="results.html#cb62-13" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-14"><a href="results.html#cb62-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;F1 NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-15"><a href="results.html#cb62-15" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb62-16"><a href="results.html#cb62-16" tabindex="-1"></a>p2b <span class="ot">&lt;-</span> shap_f1 <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-17"><a href="results.html#cb62-17" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb62-18"><a href="results.html#cb62-18" tabindex="-1"></a></span>
<span id="cb62-19"><a href="results.html#cb62-19" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>binomial<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb62-20"><a href="results.html#cb62-20" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-21"><a href="results.html#cb62-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;binomial&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-22"><a href="results.html#cb62-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb62-23"><a href="results.html#cb62-23" tabindex="-1"></a>p3b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-24"><a href="results.html#cb62-24" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb62-25"><a href="results.html#cb62-25" tabindex="-1"></a></span>
<span id="cb62-26"><a href="results.html#cb62-26" tabindex="-1"></a>shap_binom <span class="ot">&lt;-</span> results<span class="sc">$</span>confidence<span class="sc">$</span>shap_values<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">convert_shap_x</span>()</span>
<span id="cb62-27"><a href="results.html#cb62-27" tabindex="-1"></a>p4a <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">show_numbers =</span> <span class="cn">TRUE</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-28"><a href="results.html#cb62-28" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-29"><a href="results.html#cb62-29" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.12</span>))</span>
<span id="cb62-30"><a href="results.html#cb62-30" tabindex="-1"></a>p4b <span class="ot">&lt;-</span> shap_binom <span class="sc">%&gt;%</span> <span class="fu">sv_importance</span>(<span class="at">kind =</span> <span class="st">&quot;beeswarm&quot;</span>, <span class="at">max_display =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb62-31"><a href="results.html#cb62-31" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.35</span>))</span>
<span id="cb62-32"><a href="results.html#cb62-32" tabindex="-1"></a></span>
<span id="cb62-33"><a href="results.html#cb62-33" tabindex="-1"></a>real_table_extraction_llm_shap_plot <span class="ot">&lt;-</span> (p1a <span class="sc">|</span> p1b) <span class="sc">/</span></span>
<span id="cb62-34"><a href="results.html#cb62-34" tabindex="-1"></a>  (p2a <span class="sc">|</span> p2b) <span class="sc">/</span></span>
<span id="cb62-35"><a href="results.html#cb62-35" tabindex="-1"></a>  (p3a <span class="sc">|</span> p3b) <span class="sc">/</span></span>
<span id="cb62-36"><a href="results.html#cb62-36" tabindex="-1"></a>  (p4a <span class="sc">|</span> p4b)</span>
<span id="cb62-37"><a href="results.html#cb62-37" tabindex="-1"></a></span>
<span id="cb62-38"><a href="results.html#cb62-38" tabindex="-1"></a>real_table_extraction_llm_shap_num_details_plot <span class="ot">&lt;-</span> p1c <span class="sc">|</span> p1d</span></code></pre></div>
</details>
<p>Even though the samples size of Aktiva tables did not increase, the available training, test and <a href="glossary.html#acronyms_SHAP">SHAP</a> sample size is much larger, because the experiment has been repeated with different models and methods. Thus, the interpretations based on the visual evaluation (see Figure <a href="appendix.html#fig:real-table-extraction-llm-shap-plot">8.2</a>)) are more reliable for model and method specific predictors. Since there is one Aktiva example for every company files were found for they might even be generalizable for this population. But one has to keep in mind that there have been more Aktiva tables for <em>Amt Stat BBB</em> which might nudge the results a bit.</p>
<p>The results assign much more influence on model and method specific attributes than on the table specific attributes. The importance of the table attributes are as low as found with the regular expresion approach. Only for the binomial prediction we find the predictor <em>missing</em> to get assigned more importance than to all model and method specific attributes. Same is true for the <em>label</em> that is having the highest influence on the reported confidence. Nevertheless, in the case of the binomial prediction there is half of the predictors <em>missing</em> and <em>label</em> importance shifted to model and method specific predictors.</p>
<p>Again, multiple hypotheses don’t get supported by the visual results. The surprising results are:</p>
<ol style="list-style-type: decimal">
<li>In general more examples are helpful except for Llamas Maverick model that performs poorly with five examples. But this effect is only noticeable with the aggregated metrics nor for the case wise binomial evaluation.</li>
<li>The number of columns has a negative effect on the performance but no effect on the reported confidence.</li>
<li>There was no negative effect found if the <em>Passiva</em> table is on the same page as the Aktiva table.</li>
<li>Larger models start to report less confidence again. This is not unexpected for the Mistral model but was surprising for the largest Qwen 3 model. (Discussion: New Generation? Aktive paramaters count? Irrelevant because not well distinguishing?)</li>
<li>It not only influences the the performance to extract the correct numeric value from a row where there are additional sums present but also the F1 score.</li>
</ol>
<p>Two interesting details found while inspecting the dependence plots for the metric <em>percentage_numeric_correct</em> are (see Figure <a href="results.html#fig:real-table-extraction-llm-shap-num-details-plot">5.9</a>A) that the bad performance of LLamas Maverick with five examples is easily spottable and that the negative effect of <em>T_in_year</em> might be caused by an interaction with <em>vis_separated_rows</em> completely (see Figure <a href="results.html#fig:real-table-extraction-llm-shap-num-details-plot">5.9</a>B). To investigate the second finding one would need tables where the uni is present in the year column and having no visual separation of the rows at the same time. Synthetic data potentiall could help to answer such questions.</p>
<div class="scroll-x">
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="results.html#cb63-1" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">includeHTML</span>(</span>
<span id="cb63-2"><a href="results.html#cb63-2" tabindex="-1"></a>  <span class="fu">textConnection</span>(</span>
<span id="cb63-3"><a href="results.html#cb63-3" tabindex="-1"></a>    xml2<span class="sc">::</span><span class="fu">read_html</span>(<span class="st">&quot;../benchmark_results/table_extraction/hypotheses_and_results_real_table_extraction_llm.html&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="results.html#cb63-4" tabindex="-1"></a>      xml2<span class="sc">::</span><span class="fu">xml_find_first</span>(<span class="st">&quot;//table&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="results.html#cb63-5" tabindex="-1"></a>      <span class="fu">as.character</span>()</span>
<span id="cb63-6"><a href="results.html#cb63-6" tabindex="-1"></a>  )</span>
<span id="cb63-7"><a href="results.html#cb63-7" tabindex="-1"></a>)</span></code></pre></div>
</details>
<table cellspacing="0" border="0">
<colgroup width="112"></colgroup>
<colgroup width="110"></colgroup>
<colgroup span="7" width="85"></colgroup>
<tr>
<td rowspan="2" height="34" align="left" valign="bottom" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "predictor"}'><b><font color="#FFFFFF">predictor</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "F1"}'><b><font color="#FFFFFF">F1</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "% numeric correct"}'><b><font color="#FFFFFF">% numeric correct</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "binomial"}'><b><font color="#FFFFFF">binomial</font></b></td>
        <td colspan="2" align="center" valign="middle" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "confidence"}'><b><font color="#FFFFFF">confidence</font></b></td>
        </tr>
<tr>
<td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Hypothesis"}'><b><font color="#FFFFFF">Hypothesis</font></b></td>
        <td align="left" bgcolor="#000000" data-sheets-value='{ "1": 2, "2": "Result"}'><b><font color="#FFFFFF">Result</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "model_family"}'>model_family</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "parameter_count"}'>parameter_count</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "Positive (dropping again)"}'><b><font color="#C9211E">Positive (dropping again)</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "method_family"}'>method_family</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "Zero &amp; static worse"}'><font color="#C9211E">Zero &amp; static worse</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "Zero &amp; static worse"}'><font color="#C9211E">Zero &amp; static worse</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "Zero &amp; static worse"}'><font color="#C9211E">Zero &amp; static worse</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><b><font color="#C9211E">neutral</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "n_examples"}'>n_examples</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "1 and 3 best"}'><b><font color="#C9211E">1 and 3 best</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "1 and 3 best"}'><b><font color="#C9211E">1 and 3 best</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><b>positive</b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "n_columns"}'>n_columns</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "4 is worse"}'>4 is worse</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "4 is worse"}'>4 is worse</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "sum_same_line"}'>sum_same_line</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><b><font color="#C9211E">negative</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "header_span"}'>header_span</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "enumeration"}'>enumeration</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><font color="#C9211E">positive</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "T_in_previous_year"}'>T_in_previous_year</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "T_in_year"}'>T_in_year</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "passiva_same_page"}'>passiva_same_page</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><b><font color="#C9211E">neutral</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><b><font color="#C9211E">neutral</font></b></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><font color="#C9211E">neutral</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'><b><font color="#C9211E">neutral</font></b></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vorjahr"}'>vorjahr</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vis_separated_cols"}'>vis_separated_cols</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "vis_separated_rows"}'>vis_separated_rows</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'><font color="#C9211E">negative</font></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "neutral"}'>neutral</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label_length"}'>label_length</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "negative"}'>negative</td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "label"}'>label</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "missing"}'>missing</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "unknown"}'>unknown</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'><font color="#C9211E">positive</font></td>
    </tr>
<tr>
<td height="17" align="left" data-sheets-value='{ "1": 2, "2": "confidence"}'>confidence</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": "positive"}'>positive</td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
        <td align="left" data-sheets-value='{ "1": 2, "2": ""}'><br></td>
    </tr>
</table>

</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="results.html#cb64-1" tabindex="-1"></a>real_table_extraction_llm_shap_num_details_plot <span class="sc">+</span> </span>
<span id="cb64-2"><a href="results.html#cb64-2" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&#39;A&#39;</span>)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:real-table-extraction-llm-shap-num-details-plot"></span>
<img src="_main_files/figure-html/real-table-extraction-llm-shap-num-details-plot-1.png" alt="Showing the influence of many examples on Llama 4 Maverick (A) and interaction between *T in year* and *vis separated rows* (B)" width="100%" />
<p class="caption">
Figure 5.9: Showing the influence of many examples on Llama 4 Maverick (A) and interaction between <em>T in year</em> and <em>vis separated rows</em> (B)
</p>
</div>
</div>
</div>
<div id="gpt" class="section level5 hasAnchor" number="5.2.2.1.2">
<h5><span class="header-section-number">5.2.2.1.2</span> GPT<a href="results.html#gpt" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="results.html#cb65-1" tabindex="-1"></a>model_by_size_gpt <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb65-2"><a href="results.html#cb65-2" tabindex="-1"></a>  <span class="st">&quot;Qwen3-0.6B&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-30B-A3B-Instruct-2507&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span>,</span>
<span id="cb65-3"><a href="results.html#cb65-3" tabindex="-1"></a> <span class="st">&quot;gpt-4.1-nano&quot;</span>, <span class="st">&quot;gpt-4.1-mini&quot;</span>, <span class="st">&quot;gpt-5-mini&quot;</span>,</span>
<span id="cb65-4"><a href="results.html#cb65-4" tabindex="-1"></a> <span class="st">&quot;gpt-oss-120b&quot;</span>, <span class="st">&quot;gpt-4.1&quot;</span></span>
<span id="cb65-5"><a href="results.html#cb65-5" tabindex="-1"></a>)</span>
<span id="cb65-6"><a href="results.html#cb65-6" tabindex="-1"></a></span>
<span id="cb65-7"><a href="results.html#cb65-7" tabindex="-1"></a>df_overview_gpt <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df_real_table_extraction, df_real_table_extraction_azure) <span class="sc">%&gt;%</span> </span>
<span id="cb65-8"><a href="results.html#cb65-8" tabindex="-1"></a>  <span class="fu">filter</span>(out_of_company <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">|</span> <span class="fu">is.na</span>(out_of_company), n_examples <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-9"><a href="results.html#cb65-9" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> model_by_size_gpt) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="results.html#cb65-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-11"><a href="results.html#cb65-11" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size_gpt),</span>
<span id="cb65-12"><a href="results.html#cb65-12" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb65-13"><a href="results.html#cb65-13" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb65-14"><a href="results.html#cb65-14" tabindex="-1"></a>    )</span></code></pre></div>
</details>
<p>Even though a lot of documents to processed at <a href="glossary.html#acronyms_RHvB">RHvB (Rechnungshof von Berlin)</a> will not be public and thus must not be processed on public cloud infrastructure, the performance of models like OpenAI’s GPT or Google’s Gemini are interesting benchmark references within this thesis and for comparing these findings with other papers results. Therefore for this thesis the public available versions of annual reports have been used instead of the ones used internally or for public administration purposes. Those public available reports often are visually more appealing and more heterogeneous in their structure.</p>
<p>As a reference to compare the performance of OpenAI’s models with the results of four Qwen 3 models are shown as well. Surprisingly gpt-5-mini performed best among all models of OpenAI and is performing as good as the top Qwen 3 model.</p>
<p>Using gpt-oss-20b, gpt-5-nano and gpt-5-chat for the table extraction task was not working. With gpt-5-nano the answers were not respecting the provided grammar. Running gpt-5-chat resultet in the error informing that a <em>json_schema</em> can’t be used with this model. With gpt-5-mini the very approach worked flawless. Running gpt-oss-20b with the vllm offline inference framework was possible but the xgrammar was not respected by the new harmony output format. With a gpt-oss-120b instance hosted on Azure the guided decoding worked.</p>
<p>GPT 4.1 nano not sufficiently powerful (can’t extract numerics, but NA prediction okay), GPT 4.1 mini good to moderate in most cases, GPT 4.1 performs very good. How does gpt-4.1-nano s total score can be so low? Predicting not all rows and then just checking present rows?</p>
<p>GPT 4.1 costs five times of mini and 20 times of nano. But nano is useless for the task</p>
<p>GPT oss 120 b better as 4.1 mini, GPT 5 mini better (best) as 4.1</p>
<p>Costs for gpt-5-mini and gpt-oss-120b not shown in Azure yet. :(</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="results.html#cb66-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="results.html#cb66-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-3"><a href="results.html#cb66-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_total_performance_mean, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="results.html#cb66-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_total, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb66-5"><a href="results.html#cb66-5" tabindex="-1"></a>  <span class="co"># geom_jitter(aes(x = model, y = percentage_correct_total)) +</span></span>
<span id="cb66-6"><a href="results.html#cb66-6" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb66-7"><a href="results.html#cb66-7" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/table-extraction-llm-performance-total-gpt-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="results.html#cb67-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="results.html#cb67-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="results.html#cb67-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_num_performance_mean, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="results.html#cb67-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> percentage_correct_numeric, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb67-5"><a href="results.html#cb67-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb67-6"><a href="results.html#cb67-6" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/table-extraction-llm-performance-numeric-gpt-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="results.html#cb68-1" tabindex="-1"></a>df_overview_gpt <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="results.html#cb68-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb68-3"><a href="results.html#cb68-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> real_table_extraction_regex_NA_F1_mean, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="results.html#cb68-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> NA_F1, <span class="at">fill =</span> model_family)) <span class="sc">+</span></span>
<span id="cb68-5"><a href="results.html#cb68-5" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(NA_F1)), <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">height =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="results.html#cb68-6" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb68-7"><a href="results.html#cb68-7" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family <span class="sc">+</span> n_examples <span class="sc">~</span> .)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-f1-gpt"></span>
<img src="_main_files/figure-html/table-extraction-llm-f1-gpt-1.png" alt="The blue crosses indicate runs where a model has predicted only numeric values even though there have been missing values." width="100%" />
<p class="caption">
Figure 5.10: The blue crosses indicate runs where a model has predicted only numeric values even though there have been missing values.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="results.html#cb69-1" tabindex="-1"></a>costs_azure <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../CostManagement_master-thesis_2025.csv&quot;</span>)</span>
<span id="cb69-2"><a href="results.html#cb69-2" tabindex="-1"></a></span>
<span id="cb69-3"><a href="results.html#cb69-3" tabindex="-1"></a>token_prop <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, method, n_examples) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb69-4"><a href="results.html#cb69-4" tabindex="-1"></a>    <span class="at">request_tokens_total =</span> <span class="fu">sum</span>(request_tokens[[<span class="dv">1</span>]])) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="results.html#cb69-5" tabindex="-1"></a>    <span class="fu">group_by</span>(method, n_examples) <span class="sc">%&gt;%</span> </span>
<span id="cb69-6"><a href="results.html#cb69-6" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(request_tokens_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">five_examples =</span> n_examples <span class="sc">==</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(five_examples) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">sum</span>(mean))</span>
<span id="cb69-7"><a href="results.html#cb69-7" tabindex="-1"></a></span>
<span id="cb69-8"><a href="results.html#cb69-8" tabindex="-1"></a>five_ex_tokens <span class="ot">&lt;-</span> token_prop <span class="sc">%&gt;%</span> <span class="fu">filter</span>(five_examples <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sum)</span>
<span id="cb69-9"><a href="results.html#cb69-9" tabindex="-1"></a>other_tokens <span class="ot">&lt;-</span> token_prop <span class="sc">%&gt;%</span> <span class="fu">filter</span>(five_examples <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sum)</span>
<span id="cb69-10"><a href="results.html#cb69-10" tabindex="-1"></a></span>
<span id="cb69-11"><a href="results.html#cb69-11" tabindex="-1"></a>costs_azure <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb69-12"><a href="results.html#cb69-12" tabindex="-1"></a>  <span class="at">Cost_all_tasks =</span> Cost,</span>
<span id="cb69-13"><a href="results.html#cb69-13" tabindex="-1"></a>  <span class="at">Cost_all_tasks =</span> <span class="fu">if_else</span>(Meter <span class="sc">==</span> <span class="st">&quot;gpt 4.1 Inp glbl Tokens&quot;</span>, Cost_all_tasks<span class="sc">+</span>Cost_all_tasks<span class="sc">*</span>five_ex_tokens<span class="sc">/</span>other_tokens, Cost_all_tasks),</span>
<span id="cb69-14"><a href="results.html#cb69-14" tabindex="-1"></a>  <span class="at">Cost_all_tasks =</span> <span class="fu">if_else</span>(Meter <span class="sc">==</span> <span class="st">&quot;gpt 4.1 Outp glbl Tokens&quot;</span>, Cost_all_tasks<span class="sc">+</span>Cost_all_tasks<span class="sc">*</span><span class="dv">3</span><span class="sc">/</span><span class="dv">11</span>, Cost_all_tasks)</span>
<span id="cb69-15"><a href="results.html#cb69-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb69-16"><a href="results.html#cb69-16" tabindex="-1"></a>    <span class="at">Cost =</span> <span class="fu">round</span>(Cost, <span class="dv">2</span>),</span>
<span id="cb69-17"><a href="results.html#cb69-17" tabindex="-1"></a>    <span class="at">Cost_all_tasks =</span> <span class="fu">round</span>(Cost_all_tasks, <span class="dv">2</span>)</span>
<span id="cb69-18"><a href="results.html#cb69-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
Meter
</th>
<th style="text-align:right;">
Cost
</th>
<th style="text-align:left;">
Currency
</th>
<th style="text-align:right;">
Cost_all_tasks
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
gpt 4.1 Inp glbl Tokens
</td>
<td style="text-align:right;">
3.53
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
7.02
</td>
</tr>
<tr>
<td style="text-align:left;">
gpt 4.1 Outp glbl Tokens
</td>
<td style="text-align:right;">
2.71
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
3.44
</td>
</tr>
<tr>
<td style="text-align:left;">
gpt 4.1 mini Inp glbl Tokens
</td>
<td style="text-align:right;">
1.23
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
1.23
</td>
</tr>
<tr>
<td style="text-align:left;">
gpt 4.1 mini Outp glbl Tokens
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
0.71
</td>
</tr>
<tr>
<td style="text-align:left;">
gpt 4.1 nano Inp glbl Tokens
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
0.31
</td>
</tr>
<tr>
<td style="text-align:left;">
gpt 4.1 nano Outp glbl Tokens
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:left;">
EUR
</td>
<td style="text-align:right;">
0.15
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="synthetic-tables-only" class="section level4 hasAnchor" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> Synthetic tables only<a href="results.html#synthetic-tables-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>span argument was not implemented correct in html tables and md :/</p>
</div>
<div id="extract-from-real-tables-with-synthetic-content" class="section level4 hasAnchor" number="5.2.2.3">
<h4><span class="header-section-number">5.2.2.3</span> Extract from real tables with synthetic content<a href="results.html#extract-from-real-tables-with-synthetic-content" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Real context better for real tables. But not useless.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="results.html#cb70-1" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb70-2"><a href="results.html#cb70-2" tabindex="-1"></a>  df_real_table_extraction_synth <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">context =</span> <span class="st">&quot;synth&quot;</span>), </span>
<span id="cb70-3"><a href="results.html#cb70-3" tabindex="-1"></a>  df_real_table_extraction <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">context =</span> <span class="st">&quot;real&quot;</span>)</span>
<span id="cb70-4"><a href="results.html#cb70-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb70-5"><a href="results.html#cb70-5" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Qwen3-8B&quot;</span>,<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href="results.html#cb70-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb70-7"><a href="results.html#cb70-7" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb70-8"><a href="results.html#cb70-8" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb70-9"><a href="results.html#cb70-9" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb70-10"><a href="results.html#cb70-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb70-11"><a href="results.html#cb70-11" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb70-12"><a href="results.html#cb70-12" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>,, <span class="at">fill=</span>context, <span class="at">y =</span> percentage_correct_total), <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb70-13"><a href="results.html#cb70-13" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = c(&quot;blue&quot;, &quot;orange&quot;)) +</span></span>
<span id="cb70-14"><a href="results.html#cb70-14" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb70-15"><a href="results.html#cb70-15" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/compare-real-table-extraction-by-context-type-1.png" width="100%" /></p>
<p>no examples with units only for one column. Can learn from synth context new skills</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="results.html#cb71-1" tabindex="-1"></a>df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="results.html#cb71-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_col_T_EUR =</span> T_EUR_both <span class="sc">+</span> T_EUR) <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="results.html#cb71-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb71-4"><a href="results.html#cb71-4" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb71-5"><a href="results.html#cb71-5" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb71-6"><a href="results.html#cb71-6" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb71-7"><a href="results.html#cb71-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="results.html#cb71-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb71-9"><a href="results.html#cb71-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>ignore_units, <span class="at">y =</span> percentage_correct_total), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb71-10"><a href="results.html#cb71-10" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb71-11"><a href="results.html#cb71-11" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb71-12"><a href="results.html#cb71-12" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>ignore_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> percentage_correct_total), </span>
<span id="cb71-13"><a href="results.html#cb71-13" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb71-14"><a href="results.html#cb71-14" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb71-15"><a href="results.html#cb71-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb71-16"><a href="results.html#cb71-16" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb71-17"><a href="results.html#cb71-17" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>ignore_units) <span class="sc">+</span></span>
<span id="cb71-18"><a href="results.html#cb71-18" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb71-19"><a href="results.html#cb71-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb71-20"><a href="results.html#cb71-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="results.html#cb72-1" tabindex="-1"></a>df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="results.html#cb72-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_col_T_EUR =</span> T_EUR_both <span class="sc">+</span> T_EUR) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="results.html#cb72-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-4"><a href="results.html#cb72-4" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb72-5"><a href="results.html#cb72-5" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb72-6"><a href="results.html#cb72-6" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb72-7"><a href="results.html#cb72-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="results.html#cb72-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb72-9"><a href="results.html#cb72-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>ignore_units, <span class="at">y =</span> percentage_correct_numeric), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb72-10"><a href="results.html#cb72-10" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb72-11"><a href="results.html#cb72-11" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb72-12"><a href="results.html#cb72-12" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>ignore_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> percentage_correct_numeric), </span>
<span id="cb72-13"><a href="results.html#cb72-13" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb72-14"><a href="results.html#cb72-14" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb72-15"><a href="results.html#cb72-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb72-16"><a href="results.html#cb72-16" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb72-17"><a href="results.html#cb72-17" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>ignore_units) <span class="sc">+</span></span>
<span id="cb72-18"><a href="results.html#cb72-18" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb72-19"><a href="results.html#cb72-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb72-20"><a href="results.html#cb72-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="results.html#cb73-1" tabindex="-1"></a>df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="results.html#cb73-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_col_T_EUR =</span> T_EUR_both <span class="sc">+</span> T_EUR) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="results.html#cb73-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-4"><a href="results.html#cb73-4" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> model_by_size),</span>
<span id="cb73-5"><a href="results.html#cb73-5" tabindex="-1"></a>    <span class="at">method_family =</span> <span class="fu">factor</span>(method_family, <span class="at">levels =</span> method_order),</span>
<span id="cb73-6"><a href="results.html#cb73-6" tabindex="-1"></a>    <span class="at">n_examples =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(<span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, n_examples)))</span>
<span id="cb73-7"><a href="results.html#cb73-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb73-8"><a href="results.html#cb73-8" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-9"><a href="results.html#cb73-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">fill=</span>ignore_units, <span class="at">y =</span> NA_F1), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-10"><a href="results.html#cb73-10" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb73-11"><a href="results.html#cb73-11" tabindex="-1"></a>    <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_col_T_EUR <span class="sc">&gt;</span> <span class="dv">0</span>), </span>
<span id="cb73-12"><a href="results.html#cb73-12" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">group=</span>ignore_units, <span class="at">color =</span> <span class="fu">factor</span>(n_col_T_EUR), <span class="at">y =</span> NA_F1), </span>
<span id="cb73-13"><a href="results.html#cb73-13" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.3</span></span>
<span id="cb73-14"><a href="results.html#cb73-14" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb73-15"><a href="results.html#cb73-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-16"><a href="results.html#cb73-16" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb73-17"><a href="results.html#cb73-17" tabindex="-1"></a>  <span class="fu">facet_nested</span>(method_family<span class="sc">+</span>n_examples<span class="sc">~</span>model<span class="sc">+</span>ignore_units) <span class="sc">+</span></span>
<span id="cb73-18"><a href="results.html#cb73-18" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb73-19"><a href="results.html#cb73-19" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb73-20"><a href="results.html#cb73-20" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="100%" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="results.html#cb74-1" tabindex="-1"></a>confidence_vs_truth <span class="ot">&lt;-</span> df_real_table_extraction_synth <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="results.html#cb74-2" tabindex="-1"></a>  <span class="co"># filter(model == &quot;Qwen3-8B&quot;) %&gt;% </span></span>
<span id="cb74-3"><a href="results.html#cb74-3" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="results.html#cb74-4" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb74-5"><a href="results.html#cb74-5" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb74-6"><a href="results.html#cb74-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ignore_units) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="results.html#cb74-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_percentage_correct_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-8"><a href="results.html#cb74-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_percentage_correct_total, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-9"><a href="results.html#cb74-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_processed =</span> <span class="fu">map</span>(predictions, <span class="sc">~</span>{</span>
<span id="cb74-10"><a href="results.html#cb74-10" tabindex="-1"></a>    .x <span class="sc">%&gt;%</span> </span>
<span id="cb74-11"><a href="results.html#cb74-11" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;_merge&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-12"><a href="results.html#cb74-12" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb74-13"><a href="results.html#cb74-13" tabindex="-1"></a>        <span class="at">match =</span> (year_truth <span class="sc">==</span> year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(year_result)),</span>
<span id="cb74-14"><a href="results.html#cb74-14" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_this_year,</span>
<span id="cb74-15"><a href="results.html#cb74-15" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(year_truth),</span>
<span id="cb74-16"><a href="results.html#cb74-16" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(year_result),</span>
<span id="cb74-17"><a href="results.html#cb74-17" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb74-18"><a href="results.html#cb74-18" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb74-19"><a href="results.html#cb74-19" tabindex="-1"></a>        <span class="at">tuple_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb74-20"><a href="results.html#cb74-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb74-21"><a href="results.html#cb74-21" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb74-22"><a href="results.html#cb74-22" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_previous_year,</span>
<span id="cb74-23"><a href="results.html#cb74-23" tabindex="-1"></a>        <span class="at">match =</span> (previous_year_truth <span class="sc">==</span> previous_year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(previous_year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(previous_year_result)),</span>
<span id="cb74-24"><a href="results.html#cb74-24" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(previous_year_truth),</span>
<span id="cb74-25"><a href="results.html#cb74-25" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(previous_year_result),</span>
<span id="cb74-26"><a href="results.html#cb74-26" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb74-27"><a href="results.html#cb74-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb74-28"><a href="results.html#cb74-28" tabindex="-1"></a>        <span class="at">tuple_previous_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb74-29"><a href="results.html#cb74-29" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb74-30"><a href="results.html#cb74-30" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">c</span>(year_truth, previous_year_truth, year_result, previous_year_result,</span>
<span id="cb74-31"><a href="results.html#cb74-31" tabindex="-1"></a>           confidence_this_year, confidence_previous_year)</span>
<span id="cb74-32"><a href="results.html#cb74-32" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb74-33"><a href="results.html#cb74-33" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;E1&quot;</span>, <span class="st">&quot;E2&quot;</span>, <span class="st">&quot;E3&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-34"><a href="results.html#cb74-34" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb74-35"><a href="results.html#cb74-35" tabindex="-1"></a>        <span class="at">match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(match), <span class="cn">FALSE</span>, match)</span>
<span id="cb74-36"><a href="results.html#cb74-36" tabindex="-1"></a>      )</span>
<span id="cb74-37"><a href="results.html#cb74-37" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb74-38"><a href="results.html#cb74-38" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions_processed) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb74-39"><a href="results.html#cb74-39" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb74-40"><a href="results.html#cb74-40" tabindex="-1"></a>    <span class="at">truth_NA =</span> <span class="fu">factor</span>(truth_NA, <span class="at">levels =</span> <span class="fu">c</span>(F, T))</span>
<span id="cb74-41"><a href="results.html#cb74-41" tabindex="-1"></a>  )</span>
<span id="cb74-42"><a href="results.html#cb74-42" tabindex="-1"></a></span>
<span id="cb74-43"><a href="results.html#cb74-43" tabindex="-1"></a>confidence_vs_truth <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-44"><a href="results.html#cb74-44" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb74-45"><a href="results.html#cb74-45" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence, <span class="at">fill =</span> truth_NA), </span>
<span id="cb74-46"><a href="results.html#cb74-46" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb74-47"><a href="results.html#cb74-47" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-48"><a href="results.html#cb74-48" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-49"><a href="results.html#cb74-49" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ignore_units)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/table-extraction-llm-confidence-synth-context-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="results.html#cb75-1" tabindex="-1"></a>confidence_vs_truth <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="results.html#cb75-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-3"><a href="results.html#cb75-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-4"><a href="results.html#cb75-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.005</span></span>
<span id="cb75-5"><a href="results.html#cb75-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="results.html#cb75-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, predicted_NA, ignore_units) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="results.html#cb75-7" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-8"><a href="results.html#cb75-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-9"><a href="results.html#cb75-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-10"><a href="results.html#cb75-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb75-11"><a href="results.html#cb75-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb75-12"><a href="results.html#cb75-12" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb75-13"><a href="results.html#cb75-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="results.html#cb75-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> chance_false, <span class="at">color =</span> predicted_NA)) <span class="sc">+</span></span>
<span id="cb75-15"><a href="results.html#cb75-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb75-16"><a href="results.html#cb75-16" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb75-17"><a href="results.html#cb75-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Chance False (%)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Predicted NA&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-18"><a href="results.html#cb75-18" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb75-19"><a href="results.html#cb75-19" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>ignore_units)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="comparing-table-extraction-methods" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Comparison<a href="results.html#comparing-table-extraction-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-li_extracting_2023" class="csl-entry">
Li, H., Gao, H. (Harry)., Wu, C., &amp; Vasarhelyi, M. A. (2023). <em>Extracting <span>Financial</span> <span>Data</span> from <span>Unstructured</span> <span>Sources</span>: <span>Leveraging</span> <span>Large</span> <span>Language</span> <span>Models</span></em> [{SSRN} {Scholarly} {Paper}]. Social Science Research Network. <a href="https://doi.org/10.2139/ssrn.4567607">https://doi.org/10.2139/ssrn.4567607</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>This is not due to a temporary technical problems caused by a bug in the transformers version shipped with the vllm 0-9-2 image. Those problems have been overcome. The performance stays bad.<a href="results.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Earlier experiments on a subset of the pages have been run five times indicating stable results. Running the experiments up to tree times in this very task indicate this as well.<a href="results.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>classify framework in needs special models with pooling capability. Would have been interesting but time was limited and would have needed new special models in most cases<a href="results.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>A comparison of the numeric values over all methods can be found in section <a href="results.html#comparing-table-extraction-methods">5.2.3</a>.<a href="results.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>The row <em>Geleistete Anzahlungen</em> can be found in two parts of the table and the simple approach just matches the numbers to the first found entry.<a href="results.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>In this case the <a href="glossary.html#acronyms_regex">regex (regular expression)</a> takes the sum as the value for the previous year.<a href="results.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>This can form unexpected numeric patterns or prevent the row names to be recognized.<a href="results.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The approach takes care of line breaks between words, but not within. This leads to unrecognized row names as well.<a href="results.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>The models <em>deepseek-ai_DeepSeek-R1-Distill-Qwen-32B</em> and <em>google_gemma-3n-E4B-it</em> have been tested as well but don’t get presented as they never performed anywhere beyond random guessing.<a href="results.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>There is an external guidance through the provided xgrammar template but it is not communicated to the model in a promt.<a href="results.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>Phi4 also perfroms best with three examples. But this is the maximum it can process due to a limited context length.<a href="results.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<script>
// Lightbox functionality for displaying images in a modal view
document.addEventListener("DOMContentLoaded", function () {
  // Create a lightbox container
  const lightbox = document.createElement("div");
  lightbox.id = "lightbox";
  lightbox.style.position = "fixed";
  lightbox.style.top = "0";
  lightbox.style.left = "0";
  lightbox.style.width = "100%";
  lightbox.style.height = "100%";
  lightbox.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
  lightbox.style.display = "none";
  lightbox.style.justifyContent = "center";
  lightbox.style.alignItems = "center";
  lightbox.style.zIndex = "1000";
  document.body.appendChild(lightbox);

  // Add an image element to the lightbox
  const lightboxImage = document.createElement("img");
  lightboxImage.id = "lightbox-image";
  lightboxImage.style.maxWidth = "90%";
  lightboxImage.style.maxHeight = "90%";
  lightbox.appendChild(lightboxImage);

  // Close lightbox on click
  lightbox.addEventListener("click", function () {
    lightbox.style.display = "none";
  });

  // Add onclick event to all images
  const images = document.querySelectorAll("img");
  images.forEach((img) => {
    img.style.cursor = "pointer"; // Change cursor to indicate clickability
    img.addEventListener("click", function () {
      lightboxImage.src = img.src; // Set the lightbox image source
      lightbox.style.display = "flex"; // Show the lightbox
    });
  });
});
</script>

<script>
// Image slider/carousel functionality for divs with class "image-slider"
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-slider').forEach(function (slider) {
    const images = slider.querySelectorAll('img');
    if (images.length < 2) return; // No need for slider if only one image

    // Hide all images except the first
    images.forEach((img, i) => img.style.display = i === 0 ? 'inline' : 'none');
    let current = 0;

    // Create navigation buttons
    const prevBtn = document.createElement('button');
    prevBtn.textContent = '⟨ Prev';
    prevBtn.style.marginRight = '10px';
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next ⟩';
    nextBtn.style.marginLeft = '10px';

    // Create a caption container
    const captionContainer = document.createElement('div');
    captionContainer.style.fontStyle = 'italic';
    captionContainer.style.color = '#555';

    // Create a flex container for buttons and caption
    const controlsContainer = document.createElement('div');
    controlsContainer.style.display = 'flex';
    controlsContainer.style.justifyContent = 'space-between';
    controlsContainer.style.alignItems = 'center';
    controlsContainer.style.marginTop = '10px';
    controlsContainer.style.width = '100%';

    // Place buttons and caption in flex container
    controlsContainer.appendChild(prevBtn);
    controlsContainer.appendChild(captionContainer);
    controlsContainer.appendChild(nextBtn);

    // Function to update the caption
    const updateCaption = () => {
      const caption = images[current].nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        captionContainer.textContent = caption.textContent;
      } else {
        captionContainer.textContent = ''; // Clear caption if none exists
      }
    };

    // Function to show the next image
    const showNextImage = () => {
      images[current].style.display = 'none';
      current = (current + 1) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Function to show the previous image
    const showPrevImage = () => {
      images[current].style.display = 'none';
      current = (current - 1 + images.length) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Button click handlers
    prevBtn.onclick = function () {
      stopAutoSlide();
      showPrevImage();
    };
    nextBtn.onclick = function () {
      stopAutoSlide();
      showNextImage();
    };

    // Insert controls container below images
    slider.appendChild(controlsContainer);

    // Automatic sliding
    let autoSlideInterval = setInterval(showNextImage, 2000);

    // Stop automatic sliding on user interaction
    const stopAutoSlide = () => {
      clearInterval(autoSlideInterval);
    };

    // Stop auto-slide when the user interacts with the slider
    prevBtn.addEventListener('click', stopAutoSlide);
    nextBtn.addEventListener('click', stopAutoSlide);
    images.forEach((img) => {
      img.addEventListener('click', stopAutoSlide);
    });

    // Initialize the caption
    updateCaption();
  });
});
</script>

<script>
// Dropdown filter functionality for images with lightbox
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-selector').forEach(function (selector) {
    const images = selector.querySelectorAll('img');
    if (images.length === 0) return;

    // Create a dropdown filter container
    const filterContainer = document.createElement('div');
    filterContainer.classList.add('filter-container');

    const dropdown = document.createElement('select');
    dropdown.multiple = true;
    dropdown.classList.add('filter-dropdown');

    // Add options to the dropdown
    const uniqueCategories = [];
    images.forEach((img) => {
      const caption = img.nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        const category = caption.textContent.trim();
        if (!uniqueCategories.includes(category)) uniqueCategories.push(category);
      }
    });

    uniqueCategories.forEach((category) => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      // Do NOT set option.selected here!
      dropdown.appendChild(option);
    });

    filterContainer.appendChild(dropdown);
    selector.appendChild(filterContainer);

    // Add a grid container for filtered images
    const gridContainer = document.createElement('div');
    gridContainer.classList.add('image-grid');
    selector.appendChild(gridContainer);

    // Choices.js initialization
    const choices = new Choices(dropdown, {
      removeItemButton: true,
      shouldSort: false,
      searchEnabled: false,
      placeholder: true,
      placeholderValue: 'Filter categories',
    });

    // Clear any existing selection first, then set initial selection
    choices.removeActiveItems(); // This clears existing selections
    choices.setChoiceByValue(uniqueCategories[0]); // This sets only the first category

    // Filtering function
    const filterImages = () => {
      const selectedCategories = Array.from(dropdown.selectedOptions).map(opt => opt.value);
      gridContainer.innerHTML = '';
      let shownWrappers = [];
      images.forEach((img) => {
        const caption = img.nextElementSibling;
        if (caption && caption.classList.contains('image-caption')) {
          const category = caption.textContent.trim();
          if (selectedCategories.includes(category)) {
            const imgWrapper = document.createElement('div');
            imgWrapper.classList.add('image-wrapper');
            const imgClone = img.cloneNode(true);
            imgClone.style.cursor = 'pointer';
            imgClone.addEventListener('click', function () {
              const lightboxImage = document.querySelector("#lightbox img");
              const lightbox = document.querySelector("#lightbox");
              lightboxImage.src = imgClone.src;
              lightbox.style.display = 'flex';
            });
            imgWrapper.appendChild(imgClone);
            const captionClone = caption.cloneNode(true);
            imgWrapper.appendChild(captionClone);
            gridContainer.appendChild(imgWrapper);
            shownWrappers.push(imgWrapper);
          }
        }
      });
      // If only one image is shown, make it span both columns
      if (shownWrappers.length === 1) {
        shownWrappers[0].style.gridColumn = "span 2";
      }
    };

    // Listen for changes from Choices.js
    dropdown.addEventListener('change', filterImages);

    // Initial grid (only first category shown)
    filterImages();
  });
});
</script>
            </section>

          </div>
        </div>
      </div>
<a href="implementation-max-5p.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
