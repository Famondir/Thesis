<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Results | Extraction of tabular data from annual reports with LLMs</title>
  <meta name="description" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Results | Extraction of tabular data from annual reports with LLMs" />
  
  
  

<meta name="author" content="Simon Schäfer" />


<meta name="date" content="2025-09-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="implementation-max-5p.html"/>
<link rel="next" href="discussion.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="report_misc/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/BHT_Logo_horizontal_Anthrazit_transparent.svg"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#objectives"><i class="fa fa-check"></i><b>1.2</b> Objectives</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#methodology-1-p"><i class="fa fa-check"></i><b>1.3</b> Methodology (1 p)</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#thesis-outline-0.5-p"><i class="fa fa-check"></i><b>1.4</b> Thesis Outline (0.5 p)</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#to-place-in-chapters-abovehttp127.0.0.129003rmd_output4imagesbeteiligungsunternehmen.png"><i class="fa fa-check"></i><b>1.5</b> To place in chapters abovehttp://127.0.0.1:29003/rmd_output/4/images/beteiligungsunternehmen.png</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#rhvb"><i class="fa fa-check"></i><b>1.6</b> RHvB</a></li>
<li class="chapter" data-level="1.7" data-path="05_Results.html"><a href="#datenverf%C3%BCgbarkeit"><i class="fa fa-check"></i><b>1.7</b> Datenverfügbarkeit</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#unstrukturierte-daten"><i class="fa fa-check"></i><b>1.8</b> Unstrukturierte Daten</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="introduction.html"><a href="introduction.html#portable-document-format"><i class="fa fa-check"></i><b>1.8.1</b> Portable Document Format</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html"><i class="fa fa-check"></i><b>2</b> Literature review (less than 10 p)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#basic-terms"><i class="fa fa-check"></i><b>2.1</b> Basic terms</a></li>
<li class="chapter" data-level="2.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#technological-topic-related-work"><i class="fa fa-check"></i><b>2.2</b> Technological topic (related work)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#extraction-of-numeric-values"><i class="fa fa-check"></i><b>2.2.1</b> Extraction of numeric values</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#optinal-more-topics-like-previous"><i class="fa fa-check"></i><b>2.3</b> optinal more topics like previous</a></li>
<li class="chapter" data-level="2.4" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#summary-0.5-p"><i class="fa fa-check"></i><b>2.4</b> Summary (0.5 p)</a></li>
<li class="chapter" data-level="2.5" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#to-place-in-chapters-above"><i class="fa fa-check"></i><b>2.5</b> To place in chapters above</a></li>
<li class="chapter" data-level="2.6" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#table-extraction-tasks"><i class="fa fa-check"></i><b>2.6</b> Table extraction tasks</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#difficulties"><i class="fa fa-check"></i><b>2.6.1</b> Difficulties</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#document-extrtaction-process"><i class="fa fa-check"></i><b>2.7</b> Document Extrtaction Process</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#document-layout-analysis"><i class="fa fa-check"></i><b>2.7.1</b> Document Layout Analysis</a>
<ul>
<li class="chapter" data-level="2.7.1.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#vision-grid-transformer"><i class="fa fa-check"></i><b>2.7.1.1</b> Vision Grid Transformer</a></li>
</ul></li>
<li class="chapter" data-level="2.7.2" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#section-1"><i class="fa fa-check"></i><b>2.7.2</b> </a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#tools"><i class="fa fa-check"></i><b>2.8</b> Tools</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="literature-review-less-than-10-p.html"><a href="literature-review-less-than-10-p.html#tableformer"><i class="fa fa-check"></i><b>2.8.1</b> TableFormer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a>
<ul>
<li class="chapter" data-level="3.1" data-path="methods.html"><a href="methods.html#data"><i class="fa fa-check"></i><b>3.1</b> Data</a></li>
<li class="chapter" data-level="3.2" data-path="methods.html"><a href="methods.html#page-identification"><i class="fa fa-check"></i><b>3.2</b> Page identification</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="methods.html"><a href="methods.html#baselines"><i class="fa fa-check"></i><b>3.2.1</b> Baselines</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="methods.html"><a href="methods.html#regex-based"><i class="fa fa-check"></i><b>3.2.1.1</b> Regex based</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="methods.html"><a href="methods.html#term-frequency-based"><i class="fa fa-check"></i><b>3.2.1.2</b> Term frequency based</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="methods.html"><a href="methods.html#table-detection"><i class="fa fa-check"></i><b>3.3</b> Table detection</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="methods.html"><a href="methods.html#llm"><i class="fa fa-check"></i><b>3.3.1</b> LLM</a></li>
<li class="chapter" data-level="3.3.2" data-path="methods.html"><a href="methods.html#vision-model"><i class="fa fa-check"></i><b>3.3.2</b> Vision Model</a></li>
<li class="chapter" data-level="3.3.3" data-path="methods.html"><a href="methods.html#docling-and-co"><i class="fa fa-check"></i><b>3.3.3</b> Docling and Co</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="methods.html"><a href="methods.html#information-extraction"><i class="fa fa-check"></i><b>3.4</b> Information extraction</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="methods.html"><a href="methods.html#baselines-1"><i class="fa fa-check"></i><b>3.4.1</b> Baselines</a></li>
<li class="chapter" data-level="3.4.2" data-path="methods.html"><a href="methods.html#simple-pipeline"><i class="fa fa-check"></i><b>3.4.2</b> Simple pipeline</a></li>
<li class="chapter" data-level="3.4.3" data-path="methods.html"><a href="methods.html#sophisticated-approaches"><i class="fa fa-check"></i><b>3.4.3</b> Sophisticated approaches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html"><i class="fa fa-check"></i><b>4</b> Implementation (max 5p)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html#speedup-with-vllm-and-batching"><i class="fa fa-check"></i><b>4.1</b> Speedup with vLLM and batching</a></li>
<li class="chapter" data-level="4.2" data-path="implementation-max-5p.html"><a href="implementation-max-5p.html#setup-dockerfile-and-pv"><i class="fa fa-check"></i><b>4.2</b> Setup (Dockerfile and PV)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#page-identification-1"><i class="fa fa-check"></i><b>5.1</b> Page identification</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#regex-page-identification"><i class="fa fa-check"></i><b>5.1.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#table-of-contents-understanding"><i class="fa fa-check"></i><b>5.1.2</b> Table of Contents understanding</a>
<ul>
<li class="chapter" data-level="5.1.2.1" data-path="results.html"><a href="results.html#text-based"><i class="fa fa-check"></i><b>5.1.2.1</b> Text based</a></li>
<li class="chapter" data-level="5.1.2.2" data-path="results.html"><a href="results.html#comparison-of-the-different-approaches"><i class="fa fa-check"></i><b>5.1.2.2</b> Comparison of the different approaches</a></li>
</ul></li>
<li class="chapter" data-level="5.1.3" data-path="results.html"><a href="results.html#llm-page-identification"><i class="fa fa-check"></i><b>5.1.3</b> Classification with LLMs</a>
<ul>
<li class="chapter" data-level="5.1.3.1" data-path="results.html"><a href="results.html#binary-classification"><i class="fa fa-check"></i><b>5.1.3.1</b> Binary classification</a></li>
<li class="chapter" data-level="5.1.3.2" data-path="results.html"><a href="results.html#multi-classification"><i class="fa fa-check"></i><b>5.1.3.2</b> Multi classification</a></li>
</ul></li>
<li class="chapter" data-level="5.1.4" data-path="results.html"><a href="results.html#term-frequency-based-classifier"><i class="fa fa-check"></i><b>5.1.4</b> Term frequency based classifier</a>
<ul>
<li class="chapter" data-level="5.1.4.1" data-path="results.html"><a href="results.html#two-predictors"><i class="fa fa-check"></i><b>5.1.4.1</b> Two predictors</a></li>
<li class="chapter" data-level="5.1.4.2" data-path="results.html"><a href="results.html#four-predictors"><i class="fa fa-check"></i><b>5.1.4.2</b> Four predictors</a></li>
</ul></li>
<li class="chapter" data-level="5.1.5" data-path="results.html"><a href="results.html#comparison"><i class="fa fa-check"></i><b>5.1.5</b> Comparison</a>
<ul>
<li class="chapter" data-level="5.1.5.1" data-path="results.html"><a href="results.html#prediction-performance"><i class="fa fa-check"></i><b>5.1.5.1</b> Prediction performance</a></li>
<li class="chapter" data-level="5.1.5.2" data-path="results.html"><a href="results.html#energy-usage-and-runtime"><i class="fa fa-check"></i><b>5.1.5.2</b> Energy usage and runtime</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#table-extraction"><i class="fa fa-check"></i><b>5.2</b> Table extraction</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#baseline-regex"><i class="fa fa-check"></i><b>5.2.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#extraction-with-llms"><i class="fa fa-check"></i><b>5.2.2</b> Extraction with LLMs</a>
<ul>
<li class="chapter" data-level="5.2.2.1" data-path="results.html"><a href="results.html#real-tables-only"><i class="fa fa-check"></i><b>5.2.2.1</b> Real tables only</a></li>
<li class="chapter" data-level="5.2.2.2" data-path="results.html"><a href="results.html#synthetic-tables-only"><i class="fa fa-check"></i><b>5.2.2.2</b> Synthetic tables only</a></li>
<li class="chapter" data-level="5.2.2.3" data-path="results.html"><a href="results.html#extract-from-real-tables-with-synthetic-content"><i class="fa fa-check"></i><b>5.2.2.3</b> Extract from real tables with synthetic content</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>6</b> Discussion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="discussion.html"><a href="discussion.html#not-covered"><i class="fa fa-check"></i><b>6.1</b> Not covered</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="8" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>8</b> Appendix</a>
<ul>
<li class="chapter" data-level="8.1" data-path="appendix.html"><a href="appendix.html#local-machine"><i class="fa fa-check"></i><b>8.1</b> Local machine</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#system-details-report"><i class="fa fa-check"></i>System Details Report</a>
<ul>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#report-details"><i class="fa fa-check"></i>Report details</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#hardware-information"><i class="fa fa-check"></i>Hardware Information:</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html#software-information"><i class="fa fa-check"></i>Software Information:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="appendix.html"><a href="appendix.html#benchmarks"><i class="fa fa-check"></i><b>8.2</b> Benchmarks</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="appendix.html"><a href="appendix.html#text-extraction-benchmark"><i class="fa fa-check"></i><b>8.2.1</b> Text extraction</a></li>
<li class="chapter" data-level="8.2.2" data-path="appendix.html"><a href="appendix.html#table-detection-benchmark"><i class="fa fa-check"></i><b>8.2.2</b> Table detection</a></li>
<li class="chapter" data-level="8.2.3" data-path="appendix.html"><a href="appendix.html#large-language-model-process-speed"><i class="fa fa-check"></i><b>8.2.3</b> Large language model process speed</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="appendix.html"><a href="appendix.html#regex-page-identification-code"><i class="fa fa-check"></i><b>8.3</b> Regular expressions</a></li>
<li class="chapter" data-level="8.4" data-path="appendix.html"><a href="appendix.html#figures"><i class="fa fa-check"></i><b>8.4</b> Figures</a></li>
<li class="chapter" data-level="8.5" data-path="appendix.html"><a href="appendix.html#extraction-framework-flow-chart"><i class="fa fa-check"></i><b>8.5</b> Extraction framework flow chart</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extraction of tabular data from annual reports with LLMs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="results" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Results<a href="results.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="page-identification-1" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Page identification<a href="results.html#page-identification-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As described in <a href="appendix.html#text-extraction-benchmark">8.2.1</a> open source libraries have been used to extract the text from the annual reports.</p>
<div id="regex-page-identification" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Baseline: Regex<a href="results.html#regex-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Building a sound regular expression often is an iterative process. In a first approach a very simple one was implemented.</p>
<p>Comparing the differences in the metrics based on the different text extraction libraries it can be said that the extracted text is very similar but not identical. Since the resukts are not depending on the used text extraction library the <em>exhaustive regex restricted</em> has only been run with the fast text extraction library <em>pdfium</em>. The results of the regex based page identification are presented in the following tables.</p>
<ul>
<li>look into details where they differ and if it is because of a line break or whitespace ?</li>
</ul>
<p>Due to the imbalanced distribution of the classes the accuracy is not a good metric to compare the performance of the different methods. The number of pages of interest is much smaller than the number of irrelevant pages. Therefore, precision, recall and F1 score are presented as well.</p>
<p>The regular expressions can be found in the appendix (see <a href="results.html#regex-page-identification">5.1.1</a>).</p>
<p>General bad precision. Increasing recall degrades precision even further. number of pages positive identified total; used as subset for table identification task</p>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-aktiva">Table 5.1: </span>Comparing page identification metrics for different regular expressions for classification task ‘Aktiva’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-7fe16c775791c9c2b7d7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7fe16c775791c9c2b7d7">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["<b>0.267<\/b>","0.005","0.19",null,"0.13","0"],["0.778","0.01","0.98",null,"<b>0.993<\/b>","0.01"],["<b>0.397<\/b>","0.005","0.32",null,"0.23","0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-passiva">Table 5.2: </span>Comparing page identification metrics for different regular expressions for classification task ‘Passiva’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-0d84febfb9f05205ac21" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0d84febfb9f05205ac21">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["<b>0.385<\/b>","0.005","0.19",null,"0.127","0.005"],["0.78","0.009","0.98",null,"<b>0.993<\/b>","0.01"],["<b>0.515<\/b>","0.005","0.32",null,"0.223","0.01"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<table>
<caption>
<span id="tab:display-metrics-regex-page-identification-guv">Table 5.3: </span>Comparing page identification metrics for different regular expressions for classification task ‘Gewinn- und Verlustrechnung’
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5cabbd58a9f8412d7a5c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5cabbd58a9f8412d7a5c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6"],["simple regex","simple regex","exhaustive regex restricted","exhaustive regex restricted","exhaustive regex","exhaustive regex"],["mean","sd","mean","sd","mean","sd"],["0.173","0.008","<b>0.21<\/b>",null,"0.172","0.004"],["0.752","0.004","<b>0.83<\/b>",null,"0.815","0.01"],["0.283","0.008","<b>0.34<\/b>",null,"0.282","0.004"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>method<\/th>\n      <th>stat<\/th>\n      <th>precision<\/th>\n      <th>recall<\/th>\n      <th>F1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-left"},{"targets":3,"className":"dt-right"},{"targets":4,"className":"dt-right"},{"targets":5,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"method","targets":1},{"name":"stat","targets":2},{"name":"precision","targets":3},{"name":"recall","targets":4},{"name":"F1","targets":5}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-1.png" width="100%" /></p>
<p>Results by company?</p>
<pre><code>## Warning: Removed 24 rows containing non-finite outside the scale range
## (`stat_boxplot()`).</code></pre>
<pre><code>## Warning: Removed 24 rows containing missing values or values outside the
## scale range (`geom_point()`).</code></pre>
<p><img src="_main_files/figure-html/display-metrics-plot-regex-page-identification-details-1.png" width="100%" /></p>
</div>
<div id="table-of-contents-understanding" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Table of Contents understanding<a href="results.html#table-of-contents-understanding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<pre><code>## Joining with `by = join_by(filepath)`
## `summarise()` has grouped output by &#39;type&#39;, &#39;benchmark_type&#39;. You
## can override using the `.groups` argument.</code></pre>
<p>An optional step for larger documents in <span class="citation">Li et al. (<a href="#ref-li_extracting_2023">2023</a>)</span> framework is to identify the pages of interest based on the table of contents (TOC). This would be more efficent than processing the whole document with an LLM. The TOC in a PDF can be given explicit and machine readable or it can be presented in form of text on any page. Of course it can be missing completely as well.</p>
<ul>
<li><p>For a lot of short annual reports one can find the tables of interest within the first eight pages as well.</p></li>
<li><p>calculate and add Qwen, Gemini or LLama results? &lt;– No time!</p></li>
</ul>
<div id="text-based" class="section level4 hasAnchor" number="5.1.2.1">
<h4><span class="header-section-number">5.1.2.1</span> Text based<a href="results.html#text-based" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span class="citation">Li et al. (<a href="#ref-li_extracting_2023">2023</a>)</span> used the table of contents to identify the pages of interest. In their approach the table of contents is extracted from the text. Based on their observation, that the TOC that “ACFRs typically spans no more than the initial 165 lines of the converted document” (p. 20), they use the first 200 lines of text.</p>
<p>My expectation was to find the TOC within the first five pages. Often we find way less than 200 lines of text on the five first pages (see Figure <a href="results.html#fig:page-identification-toc-histogram">5.1</a>). Some files are not machine readable without OCR and thus show zero lines in the first five pages as well.</p>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-histogram"></span>
<img src="_main_files/figure-html/page-identification-toc-histogram-1.png" alt="Histogram of the number of lines in the first 5 pages of the annual reports" width="80%" />
<p class="caption">
Figure 5.1: Histogram of the number of lines in the first 5 pages of the annual reports
</p>
</div>
<div id="first-five-pages" class="section level5 hasAnchor" number="5.1.2.1.1">
<h5><span class="header-section-number">5.1.2.1.1</span> First five pages<a href="results.html#first-five-pages" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A request to Mistral results in 63 strings that should represent a table of contents among the first five pages [strings not checked in detail].</p>
</div>
<div id="first-200-lines" class="section level5 hasAnchor" number="5.1.2.1.2">
<h5><span class="header-section-number">5.1.2.1.2</span> First 200 lines<a href="results.html#first-200-lines" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A request to Mistral results in 68 strings that should represent a table of contents among the first five pages [strings not checked in detail].</p>
</div>
<div id="machine-readable-toc-based" class="section level5 hasAnchor" number="5.1.2.1.3">
<h5><span class="header-section-number">5.1.2.1.3</span> Machine readable TOC based<a href="results.html#machine-readable-toc-based" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To limit the text and hopefully increase the quality of the input data one can work with the TOC representation embedded within the PDF files. From 80 annual reports 43 files do have a machine readable separate table of contents and 37 do not have one.</p>
<p>One can see that correct predictions for the page range are more probable when the TOC has a medium number of entries. It is possible to drop PDFs with less than 9 without loosing a single correct prediction. This means that for PDFs with TOC with less then 9 entieres the LLM was not able to make a correct prediction. This is not surprising since neither <em>Bilanz</em> nor <em>Gewinn- und Verlustrechnung</em> are mentioned there.</p>
<p>Almost no influence if TOC is passed formated as markdown or json. With the json formated TOC it found two more correct page ranges (single test run). It was testes because the relation <em>page_number</em> heading and value might have been clearer in json for a linear working LLM.</p>
<p><img src="_main_files/figure-html/page-identification-toc-mr-degration-1.png" width="672" /></p>
</div>
</div>
<div id="comparison-of-the-different-approaches" class="section level4 hasAnchor" number="5.1.2.2">
<h4><span class="header-section-number">5.1.2.2</span> Comparison of the different approaches<a href="results.html#comparison-of-the-different-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>toc analysis</li>
<li>cleaned measures</li>
</ul>
<p>The LLM performed best on the machine readable TOC. It resulted in highest ratio of correct page ranges as well as in highest absolute numbers even though there were least available TOC.</p>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-analysis"></span>
<img src="_main_files/figure-html/page-identification-toc-analysis-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
Figure 5.2: Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<p>Values can be higher than 80, the total number of PDF files, since there can be multiple tables of interested for the same type in a single document or a table of interest can span two pages. Since the prompt for the LLM was not elaborated enough to cover cases, where there are multiple tables of interest for a single type that are not placed on concurrent pages, one could argue to drop those files from the analysis. This does not change the results significantly, since there are only few files with more than one table of interest per type.</p>
<p><img src="_main_files/figure-html/page-identification-toc-analysis-cleaned-1.png" width="672" /></p>
<p>Besides a single group that was predicted far off for the machine readable TOC approach the LLM reported higher confidence for the correct page ranges and got the ranges less far off. But it did not predict the smallest ranges.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="results.html#cb4-1" tabindex="-1"></a>mean_ranges <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="results.html#cb4-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(</span>
<span id="cb4-3"><a href="results.html#cb4-3" tabindex="-1"></a>    is.numeric, </span>
<span id="cb4-4"><a href="results.html#cb4-4" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">ifelse</span>(</span>
<span id="cb4-5"><a href="results.html#cb4-5" tabindex="-1"></a>      . <span class="sc">==</span> <span class="fu">min</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-6"><a href="results.html#cb4-6" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, ., <span class="st">&quot;**&quot;</span>),</span>
<span id="cb4-7"><a href="results.html#cb4-7" tabindex="-1"></a>      .</span>
<span id="cb4-8"><a href="results.html#cb4-8" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="results.html#cb4-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="st">`</span><span class="at">mean range</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="results.html#cb4-10" tabindex="-1"></a>  <span class="fu">render_table</span>()</span></code></pre></div>
</details>
<div class="datatables html-widget html-fill-item" id="htmlwidget-97fc64db1e67b72ac4af" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-97fc64db1e67b72ac4af">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["5 pages","200 lines","machine readable"],["<b>2.35<\/b>","2.78","2.81"],["<b>1.79<\/b>","2.33","4.35"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>benchmark_type<\/th>\n      <th>mean range<\/th>\n      <th>SD range<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"benchmark_type","targets":1},{"name":"mean range","targets":2},{"name":"SD range","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre><code>## Warning: Removed 78 rows containing non-finite outside the scale range
## (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 78 rows containing missing values or values outside the
## scale range (`geom_point()`).</code></pre>
<p><img src="_main_files/figure-html/page-identification-toc-range_logprobs-1.png" width="100%" /></p>
<p>In general the LLM performed worst to identify the correct page range for <em>Passiva</em>. The median distance is one page bigger than for <em>Aktiva</em> and <em>Gewinn- und Verlustrechnung</em>. This makes sense for <em>Aktiva</em> because the <em>Passiva</em> is often on the next page but the predicted page range for <em>Aktiva</em> and <em>Passiva</em> are often identical. Furthermore the predicted page range for <em>Aktiva</em> is often only a single page wide. Thus the <em>Passiva</em> on the next page is not inside the predicted page range.</p>
<p>This problem was solved by explicitly mentioning that assets and liabilities are both part of the balance sheets for the five pages and 200 lines approach but not for the machine readable TOC one.</p>
<div class="figure"><span style="display:block;" id="fig:page-identification-toc-analysis-balanced"></span>
<img src="_main_files/figure-html/page-identification-toc-analysis-balanced-1.png" alt="Comparing number of fount TOC and amount of correct and incorrect predicted page ranges" width="100%" />
<p class="caption">
Figure 5.3: Comparing number of fount TOC and amount of correct and incorrect predicted page ranges
</p>
</div>
<p>A pragmatic way would be to use the machine readable TOC approachs prediction for the <em>Aktiva</em> page range and add one to the end page to get the <em>Passiva</em> page range. Beside the problem to predict a correct page range for <em>Passiva</em> the machine readable TOC approach was very effective and is also pretty efficient if one counts in the effort the LLM driven TOC extraction takes.</p>
<table>
<caption>
<span id="tab:page-identification-toc-gpu-time-comparison">Table 5.4: </span>Comparing GPU time for page range prediction and table of contents extraction
</caption>
</table>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1bd30495f92543af88d1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1bd30495f92543af88d1">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["5 pages","200 lines","machine readable"],["<b>0.56<\/b>","0.57","0.63"],["<b>2.19<\/b>","3.8",null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Benchmark Type<\/th>\n      <th>Page range predicting<\/th>\n      <th>TOC extracting<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"targets":0,"className":"dt-left"},{"targets":1,"className":"dt-left"},{"targets":2,"className":"dt-right"},{"targets":3,"className":"dt-right"},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Benchmark Type","targets":1},{"name":"Page range predicting","targets":2},{"name":"TOC extracting","targets":3}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="llm-page-identification" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Classification with LLMs<a href="results.html#llm-page-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>structured outputs forcing to answer with a <em>yes</em> or <em>no</em> for binary task or with <em>Aktiva</em>, <em>Passiva</em>, <em>GuV</em> or <em>other</em> for multi classification task</p>
<p>top n accuracy</p>
<div id="binary-classification" class="section level4 hasAnchor" number="5.1.3.1">
<h4><span class="header-section-number">5.1.3.1</span> Binary classification<a href="results.html#binary-classification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Could be more efficient to predict “is any of interest” and then which type, because dataset is highly imbalanced.</p>
<p>24 models from 6 haven been benchmarked among 5 methods</p>
<p>Most models have been used up to 3 examples for the context.</p>
<p>The best combination of model and method for each method family is presented in the following table. It is clear that the Google Gemma models are performing worst.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Surprisingly Mistral 2410 is the best performing model for all three prediction tasks even though it only has 8B parameters.</p>
<pre><code>## `mutate_all()` ignored the following grouping variables:
## • Columns `model_family`, `classification_type`
## ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence
##   the message.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-b9663a88561fb84e1fc8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b9663a88561fb84e1fc8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],["mistralai","meta-llama","mistralai","mistralai","Qwen","meta-llama","Qwen","Qwen","meta-llama","Qwen","microsoft","microsoft","google","google","tiiuae","google","tiiuae","tiiuae"],["mistralai_Ministral-8B-Instruct-2410","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","Qwen_Qwen2.5-32B-Instruct","meta-llama_Llama-4-Scout-17B-16E-Instruct","Qwen_Qwen2.5-32B-Instruct","Qwen_Qwen3-235B-A22B-Instruct-2507","meta-llama_Llama-4-Scout-17B-16E-Instruct","Qwen_Qwen2.5-32B-Instruct","microsoft_phi-4","microsoft_phi-4","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct"],["GuV","GuV","Passiva","Aktiva","GuV","Passiva","Aktiva","Aktiva","Aktiva","Passiva","Aktiva","Passiva","Passiva","Aktiva","Passiva","GuV","Aktiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","law_context","law_context","n_rag_examples","n_rag_examples","n_random_examples","n_rag_examples","n_rag_examples","top_n_rag_examples"],["3","3","3","3","1","3","1","3","3","1","1","1","1","1","1","1","1","1"],["0.93","0.92","0.92","0.92","0.87","0.85","0.84","0.84","0.83","0.79","0.68","0.65","0.54","0.51","0.5","0.49","0.44","0.33"],["917","4062","858","878","1985","3037","1806","7442","3052","1967","169","299","1849","2588","469","1800","1065","205"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>classification_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"classification_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>It is interesting that the predictions do not get better by providing more and more examples. Especially for the n-rag-example approach we find a significant drop in the F1 score if the examples pages come from different companies annual reports. This is caused by a sever recall drop. But also for the n-ranom-example approach we see this for the prediction of class Passiva.</p>
<p>Recall better with examples from same company. Precision better without.</p>
<p>We can also see that the prediction performance is stable.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="100%" /></p>
<ul>
<li>f1</li>
<li>multiple models</li>
<li>best model detail (different methods / settings)</li>
</ul>
<p>The experiments for the best performing model, Ministral-8B-Instruct-2410, have been extended by methods with even more examples. Especially for the top-n-rag-example approach to get a better comparable picture based on the real number of examples / context length.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="100%" /></p>
<pre><code>## Rows: 26 Columns: 6
## ── Column specification ─────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): approach, classification
## dbl (4): n_example, target, other, sum
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
approach
</th>
<th style="text-align:left;">
classification
</th>
<th style="text-align:right;">
n_example
</th>
<th style="text-align:right;">
target
</th>
<th style="text-align:right;">
other
</th>
<th style="text-align:right;">
sum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n_random_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
binary
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
top_n_rag_examples
</td>
<td style="text-align:left;">
multi
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
13
</td>
</tr>
</tbody>
</table>
<p>Predictions very accurate. Confidence not always 1. Wrong predictions with often with medium confidence. If Aktiva and Passiva on same page more often Aktiva predicted. Confidence for no displayed as 1-confidence to represent confidence for yes (binary classification).</p>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<p>Qwen returns always high confidence even if it is wrong.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
<ul>
<li>IBB other law</li>
<li>degewo only one where no ocr is needed</li>
</ul>
<p>mistral: recall IBB and Netzholding big range
meta &amp; mistral: very high precision for Amt für Statistik BBB &lt;- lowest average pagecount (29.3) but IBB has more pages than berlinovo but better precision. No information about which company / report the page is from</p>
<pre><code>## Rows: 252 Columns: 3
## ── Column specification ─────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): filepath, type
## dbl (1): page
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Warning: Removed 246547 rows containing non-finite outside the scale range
## (`stat_boxplot()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="100%" /></p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="results.html#cb11-1" tabindex="-1"></a>n_reports_by_company_no_ocr <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> <span class="fu">select</span>(company, filepath) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb11-2"><a href="results.html#cb11-2" tabindex="-1"></a>n_reports_by_company <span class="ot">&lt;-</span> df_filtered <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">select</span>(company, filepath) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(company) <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb11-3"><a href="results.html#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="results.html#cb11-4" tabindex="-1"></a>n_reports_by_company_no_ocr <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
company
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Amt für Statistik Berlin-Brandenburg
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlin Energie und Netzholding
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Berliner Bäder Betriebe
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlinovo
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
GESOBAU AG
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
IBB
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
degewo AG
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="results.html#cb12-1" tabindex="-1"></a>n_reports_by_company <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code></pre></div>
</details>
<table>
<thead>
<tr>
<th style="text-align:left;">
company
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Amt für Statistik Berlin-Brandenburg
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlin Energie und Netzholding
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Berliner Bäder Betriebe
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Berlinovo
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
GESOBAU AG
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
IBB
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
degewo AG
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
<ul>
<li>Performance makes a jump at a critical parameter number (3B) then slow increase (compare Qwen 2.5)</li>
<li>Changes unsystematic with new models (see Mistral, Qwen 3 old vs llama 4)</li>
</ul>
<p>PR curves for all classes look very alike- showing micro average curve</p>
<pre><code>## Loading required package: rlang</code></pre>
<pre><code>## 
## Attaching package: &#39;rlang&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,
##     flatten_raw, invoke, splice</code></pre>
<pre><code>## The following objects are masked from &#39;package:jsonlite&#39;:
## 
##     flatten, unbox</code></pre>
<pre><code>## Warning: Using one column matrices in `filter()` was deprecated in dplyr
## 1.1.0.
## ℹ Please use one dimensional logical vectors instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this
## warning was generated.</code></pre>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this
## warning was generated.</code></pre>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-binary-1-1.png" width="100%" /></p>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-binary-300-1.png" width="100%" /></p>
</div>
<div id="multi-classification" class="section level4 hasAnchor" number="5.1.3.2">
<h4><span class="header-section-number">5.1.3.2</span> Multi classification<a href="results.html#multi-classification" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>bigger models are better with the multi classification task
Llama-4-Scout almost perfect F1 for all classes</p>
<p>Llama-4-Scout runs fast but needs long to load because it has 109B in total with 17B actives
Gemma performs much better than with binary classification</p>
<p>drop with Qwen-14B</p>
<pre><code>## `mutate_all()` ignored the following grouping variables:
## • Columns `model_family`, `metric_type`
## ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence
##   the message.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6427d0bed1026fe4bfb6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6427d0bed1026fe4bfb6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],["meta-llama","meta-llama","mistralai","meta-llama","mistralai","Qwen","Qwen","mistralai","mistralai","Qwen","google","google","google","tiiuae","microsoft","microsoft","tiiuae","tiiuae","microsoft"],["meta-llama_Llama-4-Scout-17B-16E-Instruct","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Mistral-Large-Instruct-2411","meta-llama_Llama-4-Scout-17B-16E-Instruct","mistralai_Mistral-Large-Instruct-2411","Qwen_Qwen2.5-32B-Instruct","Qwen_Qwen3-235B-A22B-Instruct-2507","mistralai_Mistral-Large-Instruct-2411","mistralai_Mistral-Large-Instruct-2411","Qwen_Qwen2.5-72B-Instruct","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","google_gemma-3-27b-it-0-9-1","tiiuae_Falcon3-10B-Instruct","microsoft_phi-4","microsoft_phi-4","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct","microsoft_phi-4"],["GuV","Aktiva","Passiva","Passiva","Aktiva","Aktiva","GuV","GuV","GuV","Passiva","Aktiva","Passiva","GuV","GuV","Passiva","Aktiva","Aktiva","Passiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","n_random_examples","n_rag_examples","n_rag_examples","n_rag_examples"],["1","3","1","3","3","3","3","1","3","1","3","1","1","1","1","1","1","1","1"],["1","0.99","0.99","0.99","0.97","0.97","0.97","0.95","0.95","0.95","0.88","0.81","0.78","0.7","0.66","0.59","0.55","0.55","0.45"],["2541","4451","7061","4451","18744","5664","11164","7061","18744","3908","4297","2606","2606","868","2862","817","868","868","2862"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>metric_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"metric_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Mistral-8B-2410 almost as good as Mistral-123B-2411 but much faster</p>
<pre><code>## `mutate_all()` ignored the following grouping variables:
## • Columns `model_family`, `metric_type`
## ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence
##   the message.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4bb0fb9a60f68577a901" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4bb0fb9a60f68577a901">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"],["mistralai","mistralai","mistralai","mistralai","meta-llama","Qwen","meta-llama","google","Qwen","Qwen","tiiuae","google","meta-llama","meta-llama","tiiuae","tiiuae","google"],["mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","mistralai_Ministral-8B-Instruct-2410","meta-llama_Llama-3.1-8B-Instruct","Qwen_Qwen2.5-3B-Instruct","meta-llama_Llama-3.1-8B-Instruct","google_gemma-3-12b-it-0-9-1","Qwen_Qwen2.5-3B-Instruct","Qwen_Qwen2.5-3B-Instruct","tiiuae_Falcon3-10B-Instruct","google_gemma-3-12b-it-0-9-1","meta-llama_Llama-3.1-8B-Instruct","meta-llama_Llama-3.1-8B-Instruct","tiiuae_Falcon3-10B-Instruct","tiiuae_Falcon3-10B-Instruct","google_gemma-3-12b-it-0-9-1"],["Aktiva","Passiva","GuV","GuV","Passiva","Aktiva","Aktiva","Aktiva","Passiva","GuV","GuV","Passiva","GuV","GuV","Aktiva","Passiva","GuV"],["n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","law_context","n_rag_examples","n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples","n_rag_examples","n_rag_examples","top_n_rag_examples"],["1","1","3","3","1","1","3","3",null,"1","1","1","1","1","1","1","1"],["0.97","0.95","0.95","0.95","0.94","0.86","0.85","0.84","0.81","0.76","0.7","0.68","0.62","0.62","0.55","0.55","0.46"],["686","686","1399","279","593","492","269","2733","28","492","868","1259","593","205","868","868","232"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model_family<\/th>\n      <th>model<\/th>\n      <th>metric_type<\/th>\n      <th>method_family<\/th>\n      <th>n_examples<\/th>\n      <th>f1_score<\/th>\n      <th>runtime in s<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model_family","targets":1},{"name":"model","targets":2},{"name":"metric_type","targets":3},{"name":"method_family","targets":4},{"name":"n_examples","targets":5},{"name":"f1_score","targets":6},{"name":"runtime in s","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Mistral-2410 reaches good performance already with few examples and can work with law-context approach but more examples don’t realy help any further</p>
<pre><code>## Warning: Removed 6 rows containing missing values or values outside the scale
## range (`geom_text()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="100%" /></p>
<p>Most of the time pretty confident
most problems with class “other”
If Aktiva and Passiva on same page it predicts Aktiva. Also one Passiva missclassified as Aktiva
No flipped confidence
<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="100%" /></p>
<p>Microsoft phi 4 and Falcon 3 only ran with one and two examples because their context window is smaller.</p>
<ul>
<li>f1</li>
<li>multiple models</li>
<li>best model detail (different methods / settings)</li>
</ul>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-multi-1-1.png" width="100%" /></p>
<p><img src="_main_files/figure-html/micro-pr-curve-llm-multi-300-1.png" width="100%" /></p>
</div>
</div>
<div id="term-frequency-based-classifier" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Term frequency based classifier<a href="results.html#term-frequency-based-classifier" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RandomForest performs much better than a logistic regression
Better results with
* undersampling
* training on all types simultaniousely</p>
<div id="two-predictors" class="section level4 hasAnchor" number="5.1.4.1">
<h4><span class="header-section-number">5.1.4.1</span> Two predictors<a href="results.html#two-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Term frequency of nouns of the law about Aktiva
Float freqency (floats divided by word count)</p>
</div>
<div id="four-predictors" class="section level4 hasAnchor" number="5.1.4.2">
<h4><span class="header-section-number">5.1.4.2</span> Four predictors<a href="results.html#four-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Count of integers
Count of dates</p>
<ul>
<li>top 1</li>
<li>top k</li>
</ul>
<p>low precision llm linked to position of correct page? numeric frequency?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb22-1"><a href="results.html#cb22-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-2"><a href="results.html#cb22-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-3"><a href="results.html#cb22-3" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb22-4"><a href="results.html#cb22-4" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb22-5"><a href="results.html#cb22-5" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb22-6"><a href="results.html#cb22-6" tabindex="-1"></a></span>
<span id="cb22-7"><a href="results.html#cb22-7" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb22-8"><a href="results.html#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="results.html#cb22-9" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb22-10"><a href="results.html#cb22-10" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb22-11"><a href="results.html#cb22-11" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb22-12"><a href="results.html#cb22-12" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb22-13"><a href="results.html#cb22-13" tabindex="-1"></a></span>
<span id="cb22-14"><a href="results.html#cb22-14" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb22-15"><a href="results.html#cb22-15" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb22-16"><a href="results.html#cb22-16" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb22-17"><a href="results.html#cb22-17" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-18"><a href="results.html#cb22-18" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-19"><a href="results.html#cb22-19" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb22-20"><a href="results.html#cb22-20" tabindex="-1"></a></span>
<span id="cb22-21"><a href="results.html#cb22-21" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb22-22"><a href="results.html#cb22-22" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values</span>
<span id="cb22-23"><a href="results.html#cb22-23" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb22-24"><a href="results.html#cb22-24" tabindex="-1"></a></span>
<span id="cb22-25"><a href="results.html#cb22-25" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb22-26"><a href="results.html#cb22-26" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb22-27"><a href="results.html#cb22-27" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb22-28"><a href="results.html#cb22-28" tabindex="-1"></a>)</span>
<span id="cb22-29"><a href="results.html#cb22-29" tabindex="-1"></a></span>
<span id="cb22-30"><a href="results.html#cb22-30" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb22-31"><a href="results.html#cb22-31" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-32"><a href="results.html#cb22-32" tabindex="-1"></a>clf.fit(X_train, y_train)</span>
<span id="cb22-33"><a href="results.html#cb22-33" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_train, y_train)</span>
<span id="cb22-34"><a href="results.html#cb22-34" tabindex="-1"></a><span class="co"># print(f&quot;Training accuracy: {score:.2%}&quot;)</span></span>
<span id="cb22-35"><a href="results.html#cb22-35" tabindex="-1"></a>score <span class="op">=</span> clf.score(X_test, y_test)</span>
<span id="cb22-36"><a href="results.html#cb22-36" tabindex="-1"></a><span class="co"># print(f&quot;Test accuracy: {score:.2%}&quot;)</span></span>
<span id="cb22-37"><a href="results.html#cb22-37" tabindex="-1"></a></span>
<span id="cb22-38"><a href="results.html#cb22-38" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb22-39"><a href="results.html#cb22-39" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb22-40"><a href="results.html#cb22-40" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb22-41"><a href="results.html#cb22-41" tabindex="-1"></a></span>
<span id="cb22-42"><a href="results.html#cb22-42" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb22-43"><a href="results.html#cb22-43" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb22-44"><a href="results.html#cb22-44" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb22-45"><a href="results.html#cb22-45" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[[<span class="st">&quot;term_frequency&quot;</span>, <span class="st">&quot;float_frequency&quot;</span>]].values)[:, <span class="dv">1</span>]</span>
<span id="cb22-46"><a href="results.html#cb22-46" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb22-47"><a href="results.html#cb22-47" tabindex="-1"></a></span>
<span id="cb22-48"><a href="results.html#cb22-48" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb22-49"><a href="results.html#cb22-49" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-50"><a href="results.html#cb22-50" tabindex="-1"></a></span>
<span id="cb22-51"><a href="results.html#cb22-51" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb22-52"><a href="results.html#cb22-52" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb22-53"><a href="results.html#cb22-53" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/top-n-accuracy-term-frequency-1.png" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb23-1"><a href="results.html#cb23-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-2"><a href="results.html#cb23-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-3"><a href="results.html#cb23-3" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb23-4"><a href="results.html#cb23-4" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb23-5"><a href="results.html#cb23-5" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb23-6"><a href="results.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="results.html#cb23-7" tabindex="-1"></a>df_train_us <span class="op">=</span> pd.read_csv(<span class="st">&quot;../benchmark_results/page_identification/term_frequency_table.csv&quot;</span>)</span>
<span id="cb23-8"><a href="results.html#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="results.html#cb23-9" tabindex="-1"></a><span class="co"># Drop rows without ground truth</span></span>
<span id="cb23-10"><a href="results.html#cb23-10" tabindex="-1"></a><span class="co"># df_train_us = df_word_counts.merge(df_truth, on=[&quot;filepath&quot;, &quot;type&quot;], how=&quot;left&quot;)</span></span>
<span id="cb23-11"><a href="results.html#cb23-11" tabindex="-1"></a>df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">=</span> (df_train_us[<span class="st">&quot;page&quot;</span>] <span class="op">==</span> df_train_us[<span class="st">&quot;page_truth&quot;</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb23-12"><a href="results.html#cb23-12" tabindex="-1"></a>df_train_us <span class="op">=</span> df_train_us.dropna(subset<span class="op">=</span>[<span class="st">&quot;page_truth&quot;</span>])</span>
<span id="cb23-13"><a href="results.html#cb23-13" tabindex="-1"></a></span>
<span id="cb23-14"><a href="results.html#cb23-14" tabindex="-1"></a><span class="co"># Undersample the majority class (is_truth == 0)</span></span>
<span id="cb23-15"><a href="results.html#cb23-15" tabindex="-1"></a>df_true <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb23-16"><a href="results.html#cb23-16" tabindex="-1"></a>df_false <span class="op">=</span> df_train_us[df_train_us[<span class="st">&quot;is_truth&quot;</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb23-17"><a href="results.html#cb23-17" tabindex="-1"></a>df_false_undersampled <span class="op">=</span> df_false.sample(n<span class="op">=</span><span class="bu">len</span>(df_true), random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb23-18"><a href="results.html#cb23-18" tabindex="-1"></a>df_train_us_balanced <span class="op">=</span> pd.concat([df_true, df_false_undersampled]).sample(frac<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-19"><a href="results.html#cb23-19" tabindex="-1"></a><span class="co"># df_train_us_balanced</span></span>
<span id="cb23-20"><a href="results.html#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="results.html#cb23-21" tabindex="-1"></a>predictors <span class="op">=</span> [</span>
<span id="cb23-22"><a href="results.html#cb23-22" tabindex="-1"></a>    <span class="st">&quot;term_frequency&quot;</span>, </span>
<span id="cb23-23"><a href="results.html#cb23-23" tabindex="-1"></a>    <span class="st">&quot;float_frequency&quot;</span>, </span>
<span id="cb23-24"><a href="results.html#cb23-24" tabindex="-1"></a>    <span class="st">&quot;date_count&quot;</span>, </span>
<span id="cb23-25"><a href="results.html#cb23-25" tabindex="-1"></a>    <span class="st">&quot;integer_count&quot;</span></span>
<span id="cb23-26"><a href="results.html#cb23-26" tabindex="-1"></a>]</span>
<span id="cb23-27"><a href="results.html#cb23-27" tabindex="-1"></a></span>
<span id="cb23-28"><a href="results.html#cb23-28" tabindex="-1"></a><span class="co"># Features and target</span></span>
<span id="cb23-29"><a href="results.html#cb23-29" tabindex="-1"></a>X <span class="op">=</span> df_train_us_balanced[predictors].values <span class="co"># only better with date and integer counts; otherwise worse</span></span>
<span id="cb23-30"><a href="results.html#cb23-30" tabindex="-1"></a>y <span class="op">=</span> df_train_us_balanced[<span class="st">&quot;is_truth&quot;</span>].values</span>
<span id="cb23-31"><a href="results.html#cb23-31" tabindex="-1"></a></span>
<span id="cb23-32"><a href="results.html#cb23-32" tabindex="-1"></a><span class="co"># Train-test split (70% train, 30% test)</span></span>
<span id="cb23-33"><a href="results.html#cb23-33" tabindex="-1"></a>X_train, X_test, y_train, y_test, df_train_split, df_test_split <span class="op">=</span> train_test_split(</span>
<span id="cb23-34"><a href="results.html#cb23-34" tabindex="-1"></a>    X, y, df_train_us_balanced, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb23-35"><a href="results.html#cb23-35" tabindex="-1"></a>)</span>
<span id="cb23-36"><a href="results.html#cb23-36" tabindex="-1"></a></span>
<span id="cb23-37"><a href="results.html#cb23-37" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb23-38"><a href="results.html#cb23-38" tabindex="-1"></a>clf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb23-39"><a href="results.html#cb23-39" tabindex="-1"></a>dummy <span class="op">=</span> clf.fit(X_train, y_train)</span>
<span id="cb23-40"><a href="results.html#cb23-40" tabindex="-1"></a></span>
<span id="cb23-41"><a href="results.html#cb23-41" tabindex="-1"></a><span class="co"># Predict and rerank: get predicted probabilities for each page</span></span>
<span id="cb23-42"><a href="results.html#cb23-42" tabindex="-1"></a>df_train_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_train)[:, <span class="dv">1</span>]</span>
<span id="cb23-43"><a href="results.html#cb23-43" tabindex="-1"></a>df_test_split[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb23-44"><a href="results.html#cb23-44" tabindex="-1"></a></span>
<span id="cb23-45"><a href="results.html#cb23-45" tabindex="-1"></a><span class="co"># Add all not-chosen negatives from df_false to test split</span></span>
<span id="cb23-46"><a href="results.html#cb23-46" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false.loc[<span class="op">~</span>df_false.index.isin(df_false_undersampled.index)]</span>
<span id="cb23-47"><a href="results.html#cb23-47" tabindex="-1"></a>df_false_unused <span class="op">=</span> df_false_unused.copy()</span>
<span id="cb23-48"><a href="results.html#cb23-48" tabindex="-1"></a>df_false_unused[<span class="st">&quot;score&quot;</span>] <span class="op">=</span> clf.predict_proba(df_false_unused[predictors].values)[:, <span class="dv">1</span>]</span>
<span id="cb23-49"><a href="results.html#cb23-49" tabindex="-1"></a>df_false_unused[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> np.nan  <span class="co"># Not ranked yet</span></span>
<span id="cb23-50"><a href="results.html#cb23-50" tabindex="-1"></a></span>
<span id="cb23-51"><a href="results.html#cb23-51" tabindex="-1"></a><span class="co"># Concatenate with test split</span></span>
<span id="cb23-52"><a href="results.html#cb23-52" tabindex="-1"></a>df_test_split <span class="op">=</span> pd.concat([df_test_split, df_false_unused], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-53"><a href="results.html#cb23-53" tabindex="-1"></a></span>
<span id="cb23-54"><a href="results.html#cb23-54" tabindex="-1"></a><span class="co"># For each group (filepath, type), sort by score descending</span></span>
<span id="cb23-55"><a href="results.html#cb23-55" tabindex="-1"></a>df_train_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_train_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span>
<span id="cb23-56"><a href="results.html#cb23-56" tabindex="-1"></a>df_test_split[<span class="st">&quot;rank&quot;</span>] <span class="op">=</span> df_test_split.groupby([<span class="st">&quot;filepath&quot;</span>, <span class="st">&quot;type&quot;</span>])[<span class="st">&quot;score&quot;</span>].rank(ascending<span class="op">=</span><span class="va">False</span>, method<span class="op">=</span><span class="st">&quot;first&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/shap-tf-4-predictors-1.png" width="768" /></p>
<p><img src="_main_files/figure-html/micro-pr-curve-tf-4-predictors-3.png" width="100%" /></p>
</div>
</div>
<div id="comparison" class="section level3 hasAnchor" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Comparison<a href="results.html#comparison" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="prediction-performance" class="section level4 hasAnchor" number="5.1.5.1">
<h4><span class="header-section-number">5.1.5.1</span> Prediction performance<a href="results.html#prediction-performance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>F1 scores for llms are much higher</p>
</div>
<div id="energy-usage-and-runtime" class="section level4 hasAnchor" number="5.1.5.2">
<h4><span class="header-section-number">5.1.5.2</span> Energy usage and runtime<a href="results.html#energy-usage-and-runtime" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Multiclassification more effective than three times single classification
Combine term frequency with llm approach to limit page range</p>
</div>
</div>
</div>
<div id="table-extraction" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Table extraction<a href="results.html#table-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="baseline-regex" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Baseline: Regex<a href="results.html#baseline-regex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="results.html#cb24-1" tabindex="-1"></a>df_table_extraction_regex <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_storage/table_extraction_regex.rds&quot;</span>)</span></code></pre></div>
</details>
<pre><code>## Rows: 12324 Columns: 23
## ── Column specification ─────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (2): filepath, model
## dbl (17): NA_true_positive, NA_false_positive, NA_false_negative, NA_true_ne...
## lgl  (4): json_error, grammar_error, predictions, T_EUR
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Regex approach not even perfect with synthetic tables. Mistakes in the text parsed with pdfium.</p>
<pre><code>## Warning: Removed 322 rows containing non-finite outside the scale range
## (`stat_boxplot()`).</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values or values outside the scale
## range (`geom_point()`).</code></pre>
<p><img src="_main_files/figure-html/table-extraction-regex-performance-1.png" width="100%" /></p>
<pre><code>## Warning: Removed 18452 rows containing non-finite outside the scale range
## (`stat_boxplot()`).</code></pre>
<p><img src="_main_files/figure-html/table-extraction-regex-NA-1.png" width="100%" /></p>
</div>
<div id="extraction-with-llms" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Extraction with LLMs<a href="results.html#extraction-with-llms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Google models again start underperforming without changes in task (neither data nor prompt?!) even though it was done with vllm already before</p></li>
<li><p>confidence usable to head for user checks?</p></li>
</ul>
<div id="real-tables-only" class="section level4 hasAnchor" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> Real tables only<a href="results.html#real-tables-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="gpt" class="section level5 hasAnchor" number="5.2.2.1.1">
<h5><span class="header-section-number">5.2.2.1.1</span> GPT<a href="results.html#gpt" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>GPT results</p>
</div>
</div>
<div id="synthetic-tables-only" class="section level4 hasAnchor" number="5.2.2.2">
<h4><span class="header-section-number">5.2.2.2</span> Synthetic tables only<a href="results.html#synthetic-tables-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="extract-from-real-tables-with-synthetic-content" class="section level4 hasAnchor" number="5.2.2.3">
<h4><span class="header-section-number">5.2.2.3</span> Extract from real tables with synthetic content<a href="results.html#extract-from-real-tables-with-synthetic-content" class="anchor-section" aria-label="Anchor link to header"></a></h4>

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-li_extracting_2023" class="csl-entry">
Li, H., Gao, H. (Harry)., Wu, C., &amp; Vasarhelyi, M. A. (2023). <em>Extracting <span>Financial</span> <span>Data</span> from <span>Unstructured</span> <span>Sources</span>: <span>Leveraging</span> <span>Large</span> <span>Language</span> <span>Models</span></em> [{SSRN} {Scholarly} {Paper}]. Social Science Research Network. <a href="https://doi.org/10.2139/ssrn.4567607">https://doi.org/10.2139/ssrn.4567607</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>This is not due to a temporary technical problems caused by a bug in the transformers version shipped with the vllm 0-9-2 image. Those problems have been overcome. The performance stays bad.<a href="results.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Earlier experiments on a subset of the pages have been run five times indicating stable results. Running the experiments up to tree times in this very task indicate this as well.<a href="results.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>classify framework in needs special models with pooling capability. Would have been interesting but time was limited and would have needed new special models in most cases<a href="results.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="implementation-max-5p.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
