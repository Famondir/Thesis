<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Appendix C - Error rate guidance report | Extraction of tabular data from annual reports with LLMs</title>
  <meta name="description" content="10 Appendix C - Error rate guidance report | Extraction of tabular data from annual reports with LLMs" />
  <meta name="generator" content="bookdown 0.43.2 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Appendix C - Error rate guidance report | Extraction of tabular data from annual reports with LLMs" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Appendix C - Error rate guidance report | Extraction of tabular data from annual reports with LLMs" />
  
  
  

<meta name="author" content="Simon SchÃ¤fer" />


<meta name="date" content="2025-09-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="appendix-b---information-extraction-report.html"/>
<link rel="next" href="appendix-d---feature-effect-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/dt-ext-rowgroup-1.13.6/css/rowGroup.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-rowgroup-1.13.6/js/dataTables.rowGroup.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css">
<script src="https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js"></script> -->


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="report_misc/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/BHT_Logo_horizontal_Anthrazit_transparent.svg"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#objectives"><i class="fa fa-check"></i><b>1.2</b> Objectives</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#introduction-methodology"><i class="fa fa-check"></i><b>1.3</b> Methodology</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#thesis-outline"><i class="fa fa-check"></i><b>1.4</b> Thesis Outline</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#summary"><i class="fa fa-check"></i><b>1.5</b> Summary</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#to-place-in-chapters-above"><i class="fa fa-check"></i><b>1.6</b> To place in chapters above</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#unstrukturierte-daten"><i class="fa fa-check"></i><b>1.7</b> Unstrukturierte Daten</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="introduction.html"><a href="introduction.html#portable-document-format"><i class="fa fa-check"></i><b>1.7.1</b> Portable Document Format</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="literature-review.html"><a href="literature-review.html"><i class="fa fa-check"></i><b>2</b> Literature review</a>
<ul>
<li class="chapter" data-level="2.1" data-path="literature-review.html"><a href="literature-review.html#information-retrieval"><i class="fa fa-check"></i><b>2.1</b> Information extraction / retrieval</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="literature-review.html"><a href="literature-review.html#term-frequency"><i class="fa fa-check"></i><b>2.1.1</b> Term frequency</a></li>
<li class="chapter" data-level="2.1.2" data-path="literature-review.html"><a href="literature-review.html#text-processing"><i class="fa fa-check"></i><b>2.1.2</b> Text processing</a></li>
<li class="chapter" data-level="2.1.3" data-path="literature-review.html"><a href="literature-review.html#regular-expressions"><i class="fa fa-check"></i><b>2.1.3</b> Regular expressions</a></li>
<li class="chapter" data-level="2.1.4" data-path="literature-review.html"><a href="literature-review.html#llm-theory"><i class="fa fa-check"></i><b>2.1.4</b> Large Language Models</a>
<ul>
<li class="chapter" data-level="2.1.4.1" data-path="literature-review.html"><a href="literature-review.html#transformers"><i class="fa fa-check"></i><b>2.1.4.1</b> Transformers</a></li>
<li class="chapter" data-level="2.1.4.2" data-path="literature-review.html"><a href="literature-review.html#encoder"><i class="fa fa-check"></i><b>2.1.4.2</b> Encoder</a></li>
<li class="chapter" data-level="2.1.4.3" data-path="literature-review.html"><a href="literature-review.html#decoder"><i class="fa fa-check"></i><b>2.1.4.3</b> Decoder</a></li>
<li class="chapter" data-level="2.1.4.4" data-path="literature-review.html"><a href="literature-review.html#gpt-generative-pretrained-transformers"><i class="fa fa-check"></i><b>2.1.4.4</b> GPT (Generative Pretrained Transformers)</a></li>
<li class="chapter" data-level="2.1.4.5" data-path="literature-review.html"><a href="literature-review.html#mixture-of-experts"><i class="fa fa-check"></i><b>2.1.4.5</b> Mixture of Experts</a></li>
<li class="chapter" data-level="2.1.4.6" data-path="literature-review.html"><a href="literature-review.html#mixed-modal"><i class="fa fa-check"></i><b>2.1.4.6</b> Mixed modal</a></li>
</ul></li>
<li class="chapter" data-level="2.1.5" data-path="literature-review.html"><a href="literature-review.html#llm-methods"><i class="fa fa-check"></i><b>2.1.5</b> Methods for LLM application</a>
<ul>
<li class="chapter" data-level="2.1.5.1" data-path="literature-review.html"><a href="literature-review.html#few-shot-learning"><i class="fa fa-check"></i><b>2.1.5.1</b> Few-shot Learning</a></li>
<li class="chapter" data-level="2.1.5.2" data-path="literature-review.html"><a href="literature-review.html#rag"><i class="fa fa-check"></i><b>2.1.5.2</b> RAG</a></li>
<li class="chapter" data-level="2.1.5.3" data-path="literature-review.html"><a href="literature-review.html#guided-and-restricted-decoding"><i class="fa fa-check"></i><b>2.1.5.3</b> Guided and restricted decoding</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="literature-review.html"><a href="literature-review.html#other-concepts"><i class="fa fa-check"></i><b>2.2</b> Other concepts</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="literature-review.html"><a href="literature-review.html#sample-distribution-visualization-methods"><i class="fa fa-check"></i><b>2.2.1</b> Sample distribution visualization methods</a></li>
<li class="chapter" data-level="2.2.2" data-path="literature-review.html"><a href="literature-review.html#tree-based-machine-learning-algorithms"><i class="fa fa-check"></i><b>2.2.2</b> Tree based machine learning algorithms</a></li>
<li class="chapter" data-level="2.2.3" data-path="literature-review.html"><a href="literature-review.html#shap"><i class="fa fa-check"></i><b>2.2.3</b> Model agnostic explanation models</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="literature-review.html"><a href="literature-review.html#summary-0.5-p"><i class="fa fa-check"></i><b>2.3</b> Summary (0.5 p)</a></li>
<li class="chapter" data-level="2.4" data-path="literature-review.html"><a href="literature-review.html#to-place-in-chapters-above-1"><i class="fa fa-check"></i><b>2.4</b> To place in chapters above</a></li>
<li class="chapter" data-level="2.5" data-path="literature-review.html"><a href="literature-review.html#table-extraction-tasks"><i class="fa fa-check"></i><b>2.5</b> Table extraction tasks</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="literature-review.html"><a href="literature-review.html#difficulties"><i class="fa fa-check"></i><b>2.5.1</b> Difficulties</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="literature-review.html"><a href="literature-review.html#document-extraction-process"><i class="fa fa-check"></i><b>2.6</b> Document Extraction Process</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="literature-review.html"><a href="literature-review.html#document-layout-analysis"><i class="fa fa-check"></i><b>2.6.1</b> Document Layout Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="literature-review.html"><a href="literature-review.html#tools"><i class="fa fa-check"></i><b>2.7</b> Tools</a>
<ul>
<li class="chapter" data-level="2.7.0.1" data-path="literature-review.html"><a href="literature-review.html#vision-grid-transformer"><i class="fa fa-check"></i><b>2.7.0.1</b> Vision Grid Transformer</a></li>
<li class="chapter" data-level="2.7.0.2" data-path="literature-review.html"><a href="literature-review.html#tableformer"><i class="fa fa-check"></i><b>2.7.0.2</b> TableFormer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methodology.html"><a href="methodology.html"><i class="fa fa-check"></i><b>3</b> Methodology</a>
<ul>
<li class="chapter" data-level="3.1" data-path="methodology.html"><a href="methodology.html#problem-definition"><i class="fa fa-check"></i><b>3.1</b> Problem Definition</a></li>
<li class="chapter" data-level="3.2" data-path="methodology.html"><a href="methodology.html#research-design-philosophy"><i class="fa fa-check"></i><b>3.2</b> Research Design &amp; Philosophy</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="methodology.html"><a href="methodology.html#research-questions"><i class="fa fa-check"></i><b>3.2.1</b> Research questions</a></li>
<li class="chapter" data-level="3.2.2" data-path="methodology.html"><a href="methodology.html#evaluation-framework"><i class="fa fa-check"></i><b>3.2.2</b> Evaluation framework</a></li>
<li class="chapter" data-level="3.2.3" data-path="methodology.html"><a href="methodology.html#evaluation-research"><i class="fa fa-check"></i><b>3.2.3</b> Evaluation research</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="methodology.html"><a href="methodology.html#evaluation-strategy"><i class="fa fa-check"></i><b>3.3</b> Evaluation Strategy</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="methodology.html"><a href="methodology.html#metrics"><i class="fa fa-check"></i><b>3.3.1</b> Metrics</a></li>
<li class="chapter" data-level="3.3.2" data-path="methodology.html"><a href="methodology.html#benchmarking"><i class="fa fa-check"></i><b>3.3.2</b> Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="methodology.html"><a href="methodology.html#data-strategy"><i class="fa fa-check"></i><b>3.4</b> Data Strategy</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="methodology.html"><a href="methodology.html#sampling-methodology"><i class="fa fa-check"></i><b>3.4.1</b> Sampling methodology</a></li>
<li class="chapter" data-level="3.4.2" data-path="methodology.html"><a href="methodology.html#ground-truth-creation-process"><i class="fa fa-check"></i><b>3.4.2</b> Ground truth creation process</a></li>
<li class="chapter" data-level="3.4.3" data-path="methodology.html"><a href="methodology.html#preprocessing"><i class="fa fa-check"></i><b>3.4.3</b> Preprocessing</a></li>
<li class="chapter" data-level="3.4.4" data-path="methodology.html"><a href="methodology.html#data-splitting"><i class="fa fa-check"></i><b>3.4.4</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="methodology.html"><a href="methodology.html#experimental-framework"><i class="fa fa-check"></i><b>3.5</b> Experimental Framework</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="methodology.html"><a href="methodology.html#llm-overview"><i class="fa fa-check"></i><b>3.5.1</b> LLM overview</a></li>
<li class="chapter" data-level="3.5.2" data-path="methodology.html"><a href="methodology.html#gpu-benchmark"><i class="fa fa-check"></i><b>3.5.2</b> Hardware normalization</a></li>
<li class="chapter" data-level="3.5.3" data-path="methodology.html"><a href="methodology.html#error-analysis"><i class="fa fa-check"></i><b>3.5.3</b> Error analysis</a></li>
<li class="chapter" data-level="3.5.4" data-path="methodology.html"><a href="methodology.html#baseline-selection-rationale"><i class="fa fa-check"></i><b>3.5.4</b> Baseline selection rationale</a></li>
<li class="chapter" data-level="3.5.5" data-path="methodology.html"><a href="methodology.html#prompt-building"><i class="fa fa-check"></i><b>3.5.5</b> Prompt building</a></li>
<li class="chapter" data-level="3.5.6" data-path="methodology.html"><a href="methodology.html#evaluation-methods"><i class="fa fa-check"></i><b>3.5.6</b> Evaluation methods</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="methodology.html"><a href="methodology.html#ethical-practical-considerations-eher-am-ende-oder-weg"><i class="fa fa-check"></i><b>3.6</b> Ethical &amp; Practical Considerations (eher am Ende oder weg?)</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="methodology.html"><a href="methodology.html#pdf-extraction-limitations"><i class="fa fa-check"></i><b>3.6.1</b> PDF extraction limitations</a></li>
<li class="chapter" data-level="3.6.2" data-path="methodology.html"><a href="methodology.html#computational-constraints"><i class="fa fa-check"></i><b>3.6.2</b> Computational constraints</a></li>
<li class="chapter" data-level="3.6.3" data-path="methodology.html"><a href="methodology.html#generalizability-scope"><i class="fa fa-check"></i><b>3.6.3</b> Generalizability scope</a></li>
<li class="chapter" data-level="3.6.4" data-path="methodology.html"><a href="methodology.html#ethical-considerations"><i class="fa fa-check"></i><b>3.6.4</b> Ethical considerations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implementation.html"><a href="implementation.html"><i class="fa fa-check"></i><b>4</b> Implementation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="implementation.html"><a href="implementation.html#environments"><i class="fa fa-check"></i><b>4.1</b> Environments</a></li>
<li class="chapter" data-level="4.2" data-path="implementation.html"><a href="implementation.html#evaluation-and-reporting"><i class="fa fa-check"></i><b>4.2</b> Evaluation and Reporting</a></li>
<li class="chapter" data-level="4.3" data-path="implementation.html"><a href="implementation.html#software-packages"><i class="fa fa-check"></i><b>4.3</b> Software Packages</a></li>
<li class="chapter" data-level="4.4" data-path="implementation.html"><a href="implementation.html#speedup-with-vllm-and-batching"><i class="fa fa-check"></i><b>4.4</b> Speedup with vLLM and batching</a></li>
<li class="chapter" data-level="4.5" data-path="implementation.html"><a href="implementation.html#text-extraction"><i class="fa fa-check"></i><b>4.5</b> Text extraction</a></li>
<li class="chapter" data-level="4.6" data-path="implementation.html"><a href="implementation.html#data-processing"><i class="fa fa-check"></i><b>4.6</b> Data processing</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Results</a>
<ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#page-identification-introduction"><i class="fa fa-check"></i><b>5.1</b> Page identification</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="results.html"><a href="results.html#approaches"><i class="fa fa-check"></i><b>5.1.1</b> Approaches</a></li>
<li class="chapter" data-level="5.1.2" data-path="results.html"><a href="results.html#comparison-page-identification"><i class="fa fa-check"></i><b>5.1.2</b> Comparison</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#table-extraction-introduction"><i class="fa fa-check"></i><b>5.2</b> Information extraction</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="results.html"><a href="results.html#approaches-1"><i class="fa fa-check"></i><b>5.2.1</b> Approaches</a></li>
<li class="chapter" data-level="5.2.2" data-path="results.html"><a href="results.html#comparing-table-extraction-methods"><i class="fa fa-check"></i><b>5.2.2</b> Comparison</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="results.html"><a href="results.html#error-rate-guidance-results"><i class="fa fa-check"></i><b>5.3</b> Error rate guidance</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="results.html"><a href="results.html#page-identification-error-rate-results"><i class="fa fa-check"></i><b>5.3.1</b> Page identification</a></li>
<li class="chapter" data-level="5.3.2" data-path="results.html"><a href="results.html#information-extraction-error-rate-results"><i class="fa fa-check"></i><b>5.3.2</b> Information extraction</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="results.html"><a href="results.html#summary-results"><i class="fa fa-check"></i><b>5.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>6</b> Discussion</a>
<ul>
<li class="chapter" data-level="6.1" data-path="discussion.html"><a href="discussion.html#interpretations"><i class="fa fa-check"></i><b>6.1</b> Interpretations</a>
<ul>
<li class="chapter" data-level="6.1.0.1" data-path="discussion.html"><a href="discussion.html#table-extraction"><i class="fa fa-check"></i><b>6.1.0.1</b> Table extraction</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="discussion.html"><a href="discussion.html#limitations"><i class="fa fa-check"></i><b>6.2</b> Limitations</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="discussion.html"><a href="discussion.html#table-extraction-1"><i class="fa fa-check"></i><b>6.2.1</b> table extraction</a>
<ul>
<li class="chapter" data-level="6.2.1.1" data-path="discussion.html"><a href="discussion.html#regex-baseline"><i class="fa fa-check"></i><b>6.2.1.1</b> Regex baseline</a></li>
</ul></li>
<li class="chapter" data-level="6.2.2" data-path="discussion.html"><a href="discussion.html#classification"><i class="fa fa-check"></i><b>6.2.2</b> classification</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="discussion.html"><a href="discussion.html#not-covered"><i class="fa fa-check"></i><b>6.3</b> Not covered</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="discussion.html"><a href="discussion.html#table-detection-extraction"><i class="fa fa-check"></i><b>6.3.1</b> Table detection / extraction</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="discussion.html"><a href="discussion.html#outlook"><i class="fa fa-check"></i><b>6.4</b> Outlook</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="discussion.html"><a href="discussion.html#vision-model"><i class="fa fa-check"></i><b>6.4.1</b> Vision Model</a></li>
<li class="chapter" data-level="6.4.2" data-path="discussion.html"><a href="discussion.html#docling-and-co"><i class="fa fa-check"></i><b>6.4.2</b> Docling and Co</a></li>
<li class="chapter" data-level="6.4.3" data-path="discussion.html"><a href="discussion.html#table-extraction-2"><i class="fa fa-check"></i><b>6.4.3</b> Table extraction</a></li>
<li class="chapter" data-level="6.4.4" data-path="discussion.html"><a href="discussion.html#sophisticated-approaches-for-text-extraction"><i class="fa fa-check"></i><b>6.4.4</b> Sophisticated approaches for text extraction</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="discussion.html"><a href="discussion.html#error-analysis-1"><i class="fa fa-check"></i><b>6.5</b> Error analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="8" data-path="page-identification-report.html"><a href="page-identification-report.html"><i class="fa fa-check"></i><b>8</b> Appendix A - Page identification report</a>
<ul>
<li class="chapter" data-level="8.1" data-path="page-identification-report.html"><a href="page-identification-report.html#regex-page-identification"><i class="fa fa-check"></i><b>8.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="8.2" data-path="page-identification-report.html"><a href="page-identification-report.html#toc-understanding"><i class="fa fa-check"></i><b>8.2</b> Table of Contents understanding</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="page-identification-report.html"><a href="page-identification-report.html#text-based-toc-understanding"><i class="fa fa-check"></i><b>8.2.1</b> Details for the approaches</a></li>
<li class="chapter" data-level="8.2.2" data-path="page-identification-report.html"><a href="page-identification-report.html#results-1"><i class="fa fa-check"></i><b>8.2.2</b> Results</a></li>
<li class="chapter" data-level="8.2.3" data-path="page-identification-report.html"><a href="page-identification-report.html#machine-readable-toc-approach-specific-results"><i class="fa fa-check"></i><b>8.2.3</b> Machine readable TOC approach specific results</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="page-identification-report.html"><a href="page-identification-report.html#llm-page-identification"><i class="fa fa-check"></i><b>8.3</b> Classification with LLMs</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="page-identification-report.html"><a href="page-identification-report.html#binary-classification"><i class="fa fa-check"></i><b>8.3.1</b> Binary classification</a></li>
<li class="chapter" data-level="8.3.2" data-path="page-identification-report.html"><a href="page-identification-report.html#multi-class-classification"><i class="fa fa-check"></i><b>8.3.2</b> Multi-class classification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="page-identification-report.html"><a href="page-identification-report.html#tf-classifier"><i class="fa fa-check"></i><b>8.4</b> Term frequency based classifier</a></li>
<li class="chapter" data-level="8.5" data-path="page-identification-report.html"><a href="page-identification-report.html#summary-2"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html"><i class="fa fa-check"></i><b>9</b> Appendix B - Information extraction report</a>
<ul>
<li class="chapter" data-level="9.1" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#baseline-regex"><i class="fa fa-check"></i><b>9.1</b> Baseline: Regex</a></li>
<li class="chapter" data-level="9.2" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#extraction-with-llms-real-tables"><i class="fa fa-check"></i><b>9.2</b> Extraction with LLMs</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#real-table-extraction-results"><i class="fa fa-check"></i><b>9.2.1</b> Real tables</a></li>
<li class="chapter" data-level="9.2.2" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#synthetic-table-extraction"><i class="fa fa-check"></i><b>9.2.2</b> Synthetic tables</a></li>
<li class="chapter" data-level="9.2.3" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#real-table-extraction-synth-context"><i class="fa fa-check"></i><b>9.2.3</b> Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="appendix-b---information-extraction-report.html"><a href="appendix-b---information-extraction-report.html#summary-3"><i class="fa fa-check"></i><b>9.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html"><i class="fa fa-check"></i><b>10</b> Appendix C - Error rate guidance report</a>
<ul>
<li class="chapter" data-level="10.1" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#page-identification-4"><i class="fa fa-check"></i><b>10.1</b> Page identification</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#binary-classification-1"><i class="fa fa-check"></i><b>10.1.1</b> Binary classification</a></li>
<li class="chapter" data-level="10.1.2" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#multi-class-classification-1"><i class="fa fa-check"></i><b>10.1.2</b> Multi-class classification</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#extraction-with-llms"><i class="fa fa-check"></i><b>10.2</b> Extraction with LLMs</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#real-tables-1"><i class="fa fa-check"></i><b>10.2.1</b> Real tables</a></li>
<li class="chapter" data-level="10.2.2" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#synthetic-tables-1"><i class="fa fa-check"></i><b>10.2.2</b> Synthetic tables</a></li>
<li class="chapter" data-level="10.2.3" data-path="appendix-c---error-rate-guidance-report.html"><a href="appendix-c---error-rate-guidance-report.html#hybrid-aproach"><i class="fa fa-check"></i><b>10.2.3</b> Hybrid aproach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="appendix-d---feature-effect-analysis.html"><a href="appendix-d---feature-effect-analysis.html"><i class="fa fa-check"></i><b>11</b> Appendix D - Feature effect analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="appendix-d---feature-effect-analysis.html"><a href="appendix-d---feature-effect-analysis.html#regular-expressions-3"><i class="fa fa-check"></i><b>11.1</b> Regular expressions</a></li>
<li class="chapter" data-level="11.2" data-path="appendix-d---feature-effect-analysis.html"><a href="appendix-d---feature-effect-analysis.html#real-tables-2"><i class="fa fa-check"></i><b>11.2</b> Real tables</a></li>
<li class="chapter" data-level="11.3" data-path="appendix-d---feature-effect-analysis.html"><a href="appendix-d---feature-effect-analysis.html#hybrid-approach-1"><i class="fa fa-check"></i><b>11.3</b> Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html"><i class="fa fa-check"></i><b>12</b> Appendix E - Miscellaneous</a>
<ul>
<li class="chapter" data-level="12.1" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#hitl"><i class="fa fa-check"></i><b>12.1</b> Human in the loop application</a></li>
<li class="chapter" data-level="12.2" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#local-machine"><i class="fa fa-check"></i><b>12.2</b> Local machine</a></li>
<li class="chapter" data-level="12.3" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#benchmarks"><i class="fa fa-check"></i><b>12.3</b> Benchmarks</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#text-extraction-benchmark"><i class="fa fa-check"></i><b>12.3.1</b> Text extraction</a></li>
<li class="chapter" data-level="12.3.2" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#table-detection-benchmark"><i class="fa fa-check"></i><b>12.3.2</b> Table detection</a>
<ul>
<li class="chapter" data-level="12.3.2.1" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#yolo-benchmark-and-table-transformer"><i class="fa fa-check"></i><b>12.3.2.1</b> yolo benchmark and table transformer</a></li>
<li class="chapter" data-level="12.3.2.2" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#old-classification-with-llm"><i class="fa fa-check"></i><b>12.3.2.2</b> old classification with llm</a></li>
</ul></li>
<li class="chapter" data-level="12.3.3" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#vllm-batch-speed"><i class="fa fa-check"></i><b>12.3.3</b> Large language model process speed</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#prompts"><i class="fa fa-check"></i><b>12.4</b> Prompts</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#toc-understanding-promts"><i class="fa fa-check"></i><b>12.4.1</b> TOC understanding</a></li>
<li class="chapter" data-level="12.4.2" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#classification-prompts"><i class="fa fa-check"></i><b>12.4.2</b> Classification</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#regex-page-identification-code"><i class="fa fa-check"></i><b>12.5</b> Regular expressions</a></li>
<li class="chapter" data-level="12.6" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#annual-comprehensive-financial-report-balance-sheet"><i class="fa fa-check"></i><b>12.6</b> Annual Comprehensive Financial Report Balance Sheet</a></li>
<li class="chapter" data-level="12.7" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#extraction-framework-flow-chart"><i class="fa fa-check"></i><b>12.7</b> Extraction framework flow chart</a></li>
<li class="chapter" data-level="12.8" data-path="appendix-e---miscellaneous.html"><a href="appendix-e---miscellaneous.html#regex-extraction-mistakes"><i class="fa fa-check"></i><b>12.8</b> Table extraction with regular expressions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>13</b> Tables</a>
<ul>
<li class="chapter" data-level="13.1" data-path="tables.html"><a href="tables.html#classification-1"><i class="fa fa-check"></i><b>13.1</b> Classification</a></li>
<li class="chapter" data-level="13.2" data-path="tables.html"><a href="tables.html#table-extraction-3"><i class="fa fa-check"></i><b>13.2</b> Table extraction</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="tables.html"><a href="tables.html#hybrid-approach-2"><i class="fa fa-check"></i><b>13.2.1</b> Hybrid approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="figures.html"><a href="figures.html"><i class="fa fa-check"></i><b>14</b> Figures</a>
<ul>
<li class="chapter" data-level="14.1" data-path="figures.html"><a href="figures.html#page-identification-5"><i class="fa fa-check"></i><b>14.1</b> Page identification</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="figures.html"><a href="figures.html#regex-baseline-1"><i class="fa fa-check"></i><b>14.1.1</b> Regex baseline</a></li>
<li class="chapter" data-level="14.1.2" data-path="figures.html"><a href="figures.html#toc-understanding-1"><i class="fa fa-check"></i><b>14.1.2</b> TOC understanding</a></li>
<li class="chapter" data-level="14.1.3" data-path="figures.html"><a href="figures.html#classification-2"><i class="fa fa-check"></i><b>14.1.3</b> Classification</a>
<ul>
<li class="chapter" data-level="14.1.3.1" data-path="figures.html"><a href="figures.html#binary"><i class="fa fa-check"></i><b>14.1.3.1</b> Binary</a></li>
<li class="chapter" data-level="14.1.3.2" data-path="figures.html"><a href="figures.html#multi-class-classification-2"><i class="fa fa-check"></i><b>14.1.3.2</b> Multi-class classification</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="figures.html"><a href="figures.html#table-extraction-4"><i class="fa fa-check"></i><b>14.2</b> Table extraction</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="figures.html"><a href="figures.html#regex-approach"><i class="fa fa-check"></i><b>14.2.1</b> Regex approach</a>
<ul>
<li class="chapter" data-level="14.2.1.1" data-path="figures.html"><a href="figures.html#real-tables-3"><i class="fa fa-check"></i><b>14.2.1.1</b> Real tables</a></li>
<li class="chapter" data-level="14.2.1.2" data-path="figures.html"><a href="figures.html#synthetic-tables-2"><i class="fa fa-check"></i><b>14.2.1.2</b> Synthetic tables</a></li>
</ul></li>
<li class="chapter" data-level="14.2.2" data-path="figures.html"><a href="figures.html#real-tables-4"><i class="fa fa-check"></i><b>14.2.2</b> Real tables</a>
<ul>
<li class="chapter" data-level="14.2.2.1" data-path="figures.html"><a href="figures.html#examples-from-same-company"><i class="fa fa-check"></i><b>14.2.2.1</b> Examples from same company</a></li>
<li class="chapter" data-level="14.2.2.2" data-path="figures.html"><a href="figures.html#openai-models-1"><i class="fa fa-check"></i><b>14.2.2.2</b> OpenAI models</a></li>
<li class="chapter" data-level="14.2.2.3" data-path="figures.html"><a href="figures.html#hypotheses-5"><i class="fa fa-check"></i><b>14.2.2.3</b> Hypotheses</a></li>
</ul></li>
<li class="chapter" data-level="14.2.3" data-path="figures.html"><a href="figures.html#synthetic-tables-3"><i class="fa fa-check"></i><b>14.2.3</b> Synthetic tables</a>
<ul>
<li class="chapter" data-level="14.2.3.1" data-path="figures.html"><a href="figures.html#confidence-4"><i class="fa fa-check"></i><b>14.2.3.1</b> Confidence</a></li>
</ul></li>
<li class="chapter" data-level="14.2.4" data-path="figures.html"><a href="figures.html#hybrid-approach-3"><i class="fa fa-check"></i><b>14.2.4</b> Hybrid approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="layout-testing.html"><a href="layout-testing.html"><i class="fa fa-check"></i><b>15</b> Layout testing</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extraction of tabular data from annual reports with LLMs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appendix-c---error-rate-guidance-report" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Appendix C - Error rate guidance report<a href="appendix-c---error-rate-guidance-report.html#appendix-c---error-rate-guidance-report" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The side research question asks, if it is possible to guide the users attention to predictions that have a higher empirical rate of errors. In this thesis we focus the confidence score reported with <a href="glossary.html#acronyms_LLM">LLM</a>s responses.</p>
<p>The formula for the confidence score is given in Equation <a href="methodology.html#eq:confidence">(3.1)</a>.</p>
<div id="page-identification-4" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Page identification<a href="appendix-c---error-rate-guidance-report.html#page-identification-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="binary-classification-1" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Binary classification<a href="appendix-c---error-rate-guidance-report.html#binary-classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="appendix-c---error-rate-guidance-report.html#cb66-1" tabindex="-1"></a>target_type <span class="ot">&lt;-</span> <span class="st">&quot;Aktiva&quot;</span></span>
<span id="cb66-2"><a href="appendix-c---error-rate-guidance-report.html#cb66-2" tabindex="-1"></a></span>
<span id="cb66-3"><a href="appendix-c---error-rate-guidance-report.html#cb66-3" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb66-4"><a href="appendix-c---error-rate-guidance-report.html#cb66-4" tabindex="-1"></a>  classification_type <span class="sc">==</span> target_type, n_examples<span class="sc">&lt;=</span><span class="dv">3</span></span>
<span id="cb66-5"><a href="appendix-c---error-rate-guidance-report.html#cb66-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="appendix-c---error-rate-guidance-report.html#cb66-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb66-7"><a href="appendix-c---error-rate-guidance-report.html#cb66-7" tabindex="-1"></a></span>
<span id="cb66-8"><a href="appendix-c---error-rate-guidance-report.html#cb66-8" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb66-9"><a href="appendix-c---error-rate-guidance-report.html#cb66-9" tabindex="-1"></a></span>
<span id="cb66-10"><a href="appendix-c---error-rate-guidance-report.html#cb66-10" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb66-11"><a href="appendix-c---error-rate-guidance-report.html#cb66-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-12"><a href="appendix-c---error-rate-guidance-report.html#cb66-12" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb66-13"><a href="appendix-c---error-rate-guidance-report.html#cb66-13" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, target_type)</span>
<span id="cb66-14"><a href="appendix-c---error-rate-guidance-report.html#cb66-14" tabindex="-1"></a>  )</span>
<span id="cb66-15"><a href="appendix-c---error-rate-guidance-report.html#cb66-15" tabindex="-1"></a></span>
<span id="cb66-16"><a href="appendix-c---error-rate-guidance-report.html#cb66-16" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb66-17"><a href="appendix-c---error-rate-guidance-report.html#cb66-17" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span></code></pre></div>
</details>
<p>We investigate the relation between the reported confidence for an answer
and its correctness, to check if it is possible to inform humans in the
loop about results they should double check and which results they can
trust. The <a href="glossary.html#acronyms_LLM">LLM</a> just returns one
prediction and its confidence<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a> for the binary classification task. We calculate its confidence as <span class="math inline">\(confidence = exp(logprob)\)</span>, if the answer is <em>yes</em>. And we calculate its confidence as <span class="math inline">\(confidence = 1-exp(logprob)\)</span>, if the the answer is <em>no</em>,</p>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:confidence-match-plot-mistral-binary">10.1</a> shows the
distribution of reported confidence score for the binary classification
with target type <strong>Aktiva</strong> for all table types grouped by their
correctness for Ministral-8B-Instruct-2410. One can see that the predictions are very accurate making just
13 mistakes for 4981
predictions.</p>
<p>The reported confidence for answer <em>yes</em> is showing a wide
spread from around 0.25 to 1.0. This is true for the answer <em>no</em> as
well. Most wrong decisions are made for responses that have a reported
confidence in the range from 0.25 to 0.75. But there are more correct
answers in this range as well. It never misclassifies <strong>GuV</strong> or
<strong>Passiva</strong><a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a> as <strong>Aktiva</strong>. But it with shows some not
recalled <strong>Aktiva</strong> tables and is predicting some of the pages of
majority class, with not further described content and structure, as
<strong>Aktiva</strong>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="appendix-c---error-rate-guidance-report.html#cb67-1" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="appendix-c---error-rate-guidance-report.html#cb67-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb67-3"><a href="appendix-c---error-rate-guidance-report.html#cb67-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb67-4"><a href="appendix-c---error-rate-guidance-report.html#cb67-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="appendix-c---error-rate-guidance-report.html#cb67-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb67-6"><a href="appendix-c---error-rate-guidance-report.html#cb67-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb67-7"><a href="appendix-c---error-rate-guidance-report.html#cb67-7" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb67-8"><a href="appendix-c---error-rate-guidance-report.html#cb67-8" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:confidence-match-plot-mistral-binary"></span>
<img src="_main_files/figure-html/confidence-match-plot-mistral-binary-1.png" alt="Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Mistral-8B-Instruct-2410." width="100%" />
<p class="caption">
Figure 10.1: Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Mistral-8B-Instruct-2410.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="appendix-c---error-rate-guidance-report.html#cb68-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(classification_type <span class="sc">==</span> <span class="st">&quot;Aktiva&quot;</span>, model_family<span class="sc">==</span><span class="st">&quot;Qwen&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="appendix-c---error-rate-guidance-report.html#cb68-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb68-3"><a href="appendix-c---error-rate-guidance-report.html#cb68-3" tabindex="-1"></a></span>
<span id="cb68-4"><a href="appendix-c---error-rate-guidance-report.html#cb68-4" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb68-5"><a href="appendix-c---error-rate-guidance-report.html#cb68-5" tabindex="-1"></a></span>
<span id="cb68-6"><a href="appendix-c---error-rate-guidance-report.html#cb68-6" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb68-7"><a href="appendix-c---error-rate-guidance-report.html#cb68-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-8"><a href="appendix-c---error-rate-guidance-report.html#cb68-8" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb68-9"><a href="appendix-c---error-rate-guidance-report.html#cb68-9" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb68-10"><a href="appendix-c---error-rate-guidance-report.html#cb68-10" tabindex="-1"></a>  )</span>
<span id="cb68-11"><a href="appendix-c---error-rate-guidance-report.html#cb68-11" tabindex="-1"></a></span>
<span id="cb68-12"><a href="appendix-c---error-rate-guidance-report.html#cb68-12" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb68-13"><a href="appendix-c---error-rate-guidance-report.html#cb68-13" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span></code></pre></div>
</details>
<p>This is different for models of most other model families. Figure
<a href="appendix-c---error-rate-guidance-report.html#fig:confidence-match-plot-qwen-binary">10.2</a> shows, that
Qwen2.5-32B-Instruct returns always high confidence scores,
even when it is wrong. The model shows perfect recall but its precision
is worse than the precision of the Mistral model.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="appendix-c---error-rate-guidance-report.html#cb69-1" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb69-2"><a href="appendix-c---error-rate-guidance-report.html#cb69-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-3"><a href="appendix-c---error-rate-guidance-report.html#cb69-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="appendix-c---error-rate-guidance-report.html#cb69-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="appendix-c---error-rate-guidance-report.html#cb69-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb69-6"><a href="appendix-c---error-rate-guidance-report.html#cb69-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb69-7"><a href="appendix-c---error-rate-guidance-report.html#cb69-7" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:confidence-match-plot-qwen-binary"></span>
<img src="_main_files/figure-html/confidence-match-plot-qwen-binary-1.png" alt="Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Qwen-2.5-32B-Instruct." width="100%" />
<p class="caption">
Figure 10.2: Showing the confidence score for the Aktiva classification task grouped by table type and correctness for Qwen-2.5-32B-Instruct.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="appendix-c---error-rate-guidance-report.html#cb70-1" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb70-2"><a href="appendix-c---error-rate-guidance-report.html#cb70-2" tabindex="-1"></a></span>
<span id="cb70-3"><a href="appendix-c---error-rate-guidance-report.html#cb70-3" tabindex="-1"></a>calc_flipped_conf_all_types <span class="ot">&lt;-</span> <span class="cf">function</span>(df, model_name, method_name) {</span>
<span id="cb70-4"><a href="appendix-c---error-rate-guidance-report.html#cb70-4" tabindex="-1"></a>  l_temp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-5"><a href="appendix-c---error-rate-guidance-report.html#cb70-5" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb70-6"><a href="appendix-c---error-rate-guidance-report.html#cb70-6" tabindex="-1"></a>  </span>
<span id="cb70-7"><a href="appendix-c---error-rate-guidance-report.html#cb70-7" tabindex="-1"></a>  <span class="cf">for</span> (target <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&#39;Aktiva&#39;</span>, <span class="st">&#39;GuV&#39;</span>, <span class="st">&#39;Passiva&#39;</span>)) {</span>
<span id="cb70-8"><a href="appendix-c---error-rate-guidance-report.html#cb70-8" tabindex="-1"></a>    <span class="co"># t &lt;- &quot;Aktiva&quot;</span></span>
<span id="cb70-9"><a href="appendix-c---error-rate-guidance-report.html#cb70-9" tabindex="-1"></a>    <span class="co"># df_filtered &lt;- df %&gt;% filter(</span></span>
<span id="cb70-10"><a href="appendix-c---error-rate-guidance-report.html#cb70-10" tabindex="-1"></a>    <span class="co">#   classification_type == t,</span></span>
<span id="cb70-11"><a href="appendix-c---error-rate-guidance-report.html#cb70-11" tabindex="-1"></a>    <span class="co">#   n_examples &lt;= 3,</span></span>
<span id="cb70-12"><a href="appendix-c---error-rate-guidance-report.html#cb70-12" tabindex="-1"></a>    <span class="co">#   loop == 0) %&gt;% </span></span>
<span id="cb70-13"><a href="appendix-c---error-rate-guidance-report.html#cb70-13" tabindex="-1"></a>    <span class="co">#   arrange(desc(f1_score))</span></span>
<span id="cb70-14"><a href="appendix-c---error-rate-guidance-report.html#cb70-14" tabindex="-1"></a>    <span class="co"># model_name_best_f1_aktiva &lt;- df_filtered[model_rank, &quot;model&quot;]</span></span>
<span id="cb70-15"><a href="appendix-c---error-rate-guidance-report.html#cb70-15" tabindex="-1"></a>    <span class="co"># method_best_f1_aktiva &lt;- df_filtered[model_rank, &quot;method&quot;]</span></span>
<span id="cb70-16"><a href="appendix-c---error-rate-guidance-report.html#cb70-16" tabindex="-1"></a>    </span>
<span id="cb70-17"><a href="appendix-c---error-rate-guidance-report.html#cb70-17" tabindex="-1"></a>    df_filtered <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb70-18"><a href="appendix-c---error-rate-guidance-report.html#cb70-18" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb70-19"><a href="appendix-c---error-rate-guidance-report.html#cb70-19" tabindex="-1"></a>        classification_type <span class="sc">==</span> target,</span>
<span id="cb70-20"><a href="appendix-c---error-rate-guidance-report.html#cb70-20" tabindex="-1"></a>        model <span class="sc">==</span> model_name,</span>
<span id="cb70-21"><a href="appendix-c---error-rate-guidance-report.html#cb70-21" tabindex="-1"></a>        method <span class="sc">==</span> method_name,</span>
<span id="cb70-22"><a href="appendix-c---error-rate-guidance-report.html#cb70-22" tabindex="-1"></a>        loop <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb70-23"><a href="appendix-c---error-rate-guidance-report.html#cb70-23" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb70-24"><a href="appendix-c---error-rate-guidance-report.html#cb70-24" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb70-25"><a href="appendix-c---error-rate-guidance-report.html#cb70-25" tabindex="-1"></a>    </span>
<span id="cb70-26"><a href="appendix-c---error-rate-guidance-report.html#cb70-26" tabindex="-1"></a>    df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb70-27"><a href="appendix-c---error-rate-guidance-report.html#cb70-27" tabindex="-1"></a>    </span>
<span id="cb70-28"><a href="appendix-c---error-rate-guidance-report.html#cb70-28" tabindex="-1"></a>    df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb70-29"><a href="appendix-c---error-rate-guidance-report.html#cb70-29" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb70-30"><a href="appendix-c---error-rate-guidance-report.html#cb70-30" tabindex="-1"></a>        <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb70-31"><a href="appendix-c---error-rate-guidance-report.html#cb70-31" tabindex="-1"></a>        <span class="at">target =</span> target</span>
<span id="cb70-32"><a href="appendix-c---error-rate-guidance-report.html#cb70-32" tabindex="-1"></a>      )</span>
<span id="cb70-33"><a href="appendix-c---error-rate-guidance-report.html#cb70-33" tabindex="-1"></a>    l_temp[target] <span class="ot">&lt;-</span> <span class="fu">list</span>(df_flipped_score)</span>
<span id="cb70-34"><a href="appendix-c---error-rate-guidance-report.html#cb70-34" tabindex="-1"></a>  }</span>
<span id="cb70-35"><a href="appendix-c---error-rate-guidance-report.html#cb70-35" tabindex="-1"></a>  </span>
<span id="cb70-36"><a href="appendix-c---error-rate-guidance-report.html#cb70-36" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">df =</span> <span class="fu">bind_rows</span>(l_temp), <span class="at">model =</span> model_name, <span class="at">method =</span> method_name)</span>
<span id="cb70-37"><a href="appendix-c---error-rate-guidance-report.html#cb70-37" tabindex="-1"></a>}</span>
<span id="cb70-38"><a href="appendix-c---error-rate-guidance-report.html#cb70-38" tabindex="-1"></a></span>
<span id="cb70-39"><a href="appendix-c---error-rate-guidance-report.html#cb70-39" tabindex="-1"></a>plot_pr_double_curve <span class="ot">&lt;-</span> <span class="cf">function</span>(l, selected_type, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb70-40"><a href="appendix-c---error-rate-guidance-report.html#cb70-40" tabindex="-1"></a>  <span class="co"># browser()</span></span>
<span id="cb70-41"><a href="appendix-c---error-rate-guidance-report.html#cb70-41" tabindex="-1"></a>  df_temp2 <span class="ot">&lt;-</span> l<span class="sc">$</span>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(target <span class="sc">==</span> selected_type) <span class="sc">%&gt;%</span> </span>
<span id="cb70-42"><a href="appendix-c---error-rate-guidance-report.html#cb70-42" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> selected_type, type, <span class="st">&quot;no&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb70-43"><a href="appendix-c---error-rate-guidance-report.html#cb70-43" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(selected_type, <span class="st">&quot;no&quot;</span>)))</span>
<span id="cb70-44"><a href="appendix-c---error-rate-guidance-report.html#cb70-44" tabindex="-1"></a>  <span class="co"># pr_obj &lt;- pr.curve(scores.class0 = df_temp2$confidence_score[df_temp2$match == 1],</span></span>
<span id="cb70-45"><a href="appendix-c---error-rate-guidance-report.html#cb70-45" tabindex="-1"></a>  <span class="co">#                    scores.class1 = df_temp2$confidence_score[df_temp2$match == 0],</span></span>
<span id="cb70-46"><a href="appendix-c---error-rate-guidance-report.html#cb70-46" tabindex="-1"></a>  <span class="co">#                    curve = TRUE)</span></span>
<span id="cb70-47"><a href="appendix-c---error-rate-guidance-report.html#cb70-47" tabindex="-1"></a>  </span>
<span id="cb70-48"><a href="appendix-c---error-rate-guidance-report.html#cb70-48" tabindex="-1"></a>  <span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb70-49"><a href="appendix-c---error-rate-guidance-report.html#cb70-49" tabindex="-1"></a>  </span>
<span id="cb70-50"><a href="appendix-c---error-rate-guidance-report.html#cb70-50" tabindex="-1"></a>  pr_df <span class="ot">&lt;-</span> df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_curve</span>(type, confidence_score) <span class="sc">%&gt;%</span></span>
<span id="cb70-51"><a href="appendix-c---error-rate-guidance-report.html#cb70-51" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">threshold =</span> .threshold) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold<span class="sc">&lt;=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-52"><a href="appendix-c---error-rate-guidance-report.html#cb70-52" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb70-53"><a href="appendix-c---error-rate-guidance-report.html#cb70-53" tabindex="-1"></a>  </span>
<span id="cb70-54"><a href="appendix-c---error-rate-guidance-report.html#cb70-54" tabindex="-1"></a>  pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_auc</span>(type, confidence_score) <span class="sc">%&gt;%</span> .<span class="sc">$</span>.estimate, <span class="dv">3</span>)</span>
<span id="cb70-55"><a href="appendix-c---error-rate-guidance-report.html#cb70-55" tabindex="-1"></a>  best_F1_row <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb70-56"><a href="appendix-c---error-rate-guidance-report.html#cb70-56" tabindex="-1"></a>  best_F1_row_high_recall <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> </span>
<span id="cb70-57"><a href="appendix-c---error-rate-guidance-report.html#cb70-57" tabindex="-1"></a>    <span class="fu">filter</span>(recall <span class="sc">&gt;</span> <span class="fl">0.999</span>, precision <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb70-58"><a href="appendix-c---error-rate-guidance-report.html#cb70-58" tabindex="-1"></a>  best_F1 <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb70-59"><a href="appendix-c---error-rate-guidance-report.html#cb70-59" tabindex="-1"></a>  best_F1_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb70-60"><a href="appendix-c---error-rate-guidance-report.html#cb70-60" tabindex="-1"></a>  best_threshold <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb70-61"><a href="appendix-c---error-rate-guidance-report.html#cb70-61" tabindex="-1"></a>  best_threshold_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb70-62"><a href="appendix-c---error-rate-guidance-report.html#cb70-62" tabindex="-1"></a>  best_precision_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(precision)</span>
<span id="cb70-63"><a href="appendix-c---error-rate-guidance-report.html#cb70-63" tabindex="-1"></a>  </span>
<span id="cb70-64"><a href="appendix-c---error-rate-guidance-report.html#cb70-64" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb70-65"><a href="appendix-c---error-rate-guidance-report.html#cb70-65" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb70-66"><a href="appendix-c---error-rate-guidance-report.html#cb70-66" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb70-67"><a href="appendix-c---error-rate-guidance-report.html#cb70-67" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-68"><a href="appendix-c---error-rate-guidance-report.html#cb70-68" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb70-69"><a href="appendix-c---error-rate-guidance-report.html#cb70-69" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Precision-Recall Curve for &quot;</span>, selected_type, <span class="st">&quot; (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb70-70"><a href="appendix-c---error-rate-guidance-report.html#cb70-70" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb70-71"><a href="appendix-c---error-rate-guidance-report.html#cb70-71" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb70-72"><a href="appendix-c---error-rate-guidance-report.html#cb70-72" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-73"><a href="appendix-c---error-rate-guidance-report.html#cb70-73" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-74"><a href="appendix-c---error-rate-guidance-report.html#cb70-74" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb70-75"><a href="appendix-c---error-rate-guidance-report.html#cb70-75" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb70-76"><a href="appendix-c---error-rate-guidance-report.html#cb70-76" tabindex="-1"></a>    )</span>
<span id="cb70-77"><a href="appendix-c---error-rate-guidance-report.html#cb70-77" tabindex="-1"></a>  </span>
<span id="cb70-78"><a href="appendix-c---error-rate-guidance-report.html#cb70-78" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb70-79"><a href="appendix-c---error-rate-guidance-report.html#cb70-79" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb70-80"><a href="appendix-c---error-rate-guidance-report.html#cb70-80" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb70-81"><a href="appendix-c---error-rate-guidance-report.html#cb70-81" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-82"><a href="appendix-c---error-rate-guidance-report.html#cb70-82" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb70-83"><a href="appendix-c---error-rate-guidance-report.html#cb70-83" tabindex="-1"></a>      <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb70-84"><a href="appendix-c---error-rate-guidance-report.html#cb70-84" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb70-85"><a href="appendix-c---error-rate-guidance-report.html#cb70-85" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb70-86"><a href="appendix-c---error-rate-guidance-report.html#cb70-86" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb70-87"><a href="appendix-c---error-rate-guidance-report.html#cb70-87" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb70-88"><a href="appendix-c---error-rate-guidance-report.html#cb70-88" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb70-89"><a href="appendix-c---error-rate-guidance-report.html#cb70-89" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb70-90"><a href="appendix-c---error-rate-guidance-report.html#cb70-90" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb70-91"><a href="appendix-c---error-rate-guidance-report.html#cb70-91" tabindex="-1"></a>    ) </span>
<span id="cb70-92"><a href="appendix-c---error-rate-guidance-report.html#cb70-92" tabindex="-1"></a>  </span>
<span id="cb70-93"><a href="appendix-c---error-rate-guidance-report.html#cb70-93" tabindex="-1"></a>  <span class="cf">if</span> (x_stuff <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb70-94"><a href="appendix-c---error-rate-guidance-report.html#cb70-94" tabindex="-1"></a>    g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-95"><a href="appendix-c---error-rate-guidance-report.html#cb70-95" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb70-96"><a href="appendix-c---error-rate-guidance-report.html#cb70-96" tabindex="-1"></a>    </span>
<span id="cb70-97"><a href="appendix-c---error-rate-guidance-report.html#cb70-97" tabindex="-1"></a>    g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb70-98"><a href="appendix-c---error-rate-guidance-report.html#cb70-98" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb70-99"><a href="appendix-c---error-rate-guidance-report.html#cb70-99" tabindex="-1"></a>  }</span>
<span id="cb70-100"><a href="appendix-c---error-rate-guidance-report.html#cb70-100" tabindex="-1"></a>  </span>
<span id="cb70-101"><a href="appendix-c---error-rate-guidance-report.html#cb70-101" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> g1 <span class="sc">+</span> g2</span>
<span id="cb70-102"><a href="appendix-c---error-rate-guidance-report.html#cb70-102" tabindex="-1"></a>  combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb70-103"><a href="appendix-c---error-rate-guidance-report.html#cb70-103" tabindex="-1"></a>    <span class="st">&#39;Best F1 score of &#39;</span>, <span class="fu">round</span>(best_F1,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold,<span class="dv">3</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>,</span>
<span id="cb70-104"><a href="appendix-c---error-rate-guidance-report.html#cb70-104" tabindex="-1"></a>    <span class="st">&#39;Best F1 score with recall &gt; 0.999 of &#39;</span>, <span class="fu">round</span>(best_F1_high_recall,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold_high_recall,<span class="dv">3</span>), <span class="st">&#39; (corresp. precision value: &#39;</span>, <span class="fu">round</span>(best_precision_high_recall,<span class="dv">3</span>) , <span class="st">&#39;)&#39;</span>))</span>
<span id="cb70-105"><a href="appendix-c---error-rate-guidance-report.html#cb70-105" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:micro-pr-curve-llm-binary-1">10.3</a> shows the
precision-recall-curve for the best performing model twice for each
target type. On the left plots the line color represents the threshold
score one could use to decide when to accept a response as it is. On the
right plots the line color is showing the F1 score that results with a
chosen threshold.</p>
<p>The <a href="glossary.html#acronyms_AUC">AUC</a> value is lowest for <strong>Aktiva</strong>. Here the F1 score is
highest for a threshold value of 0.73. This prevents to classify the
pages of type <em>other</em> to get classified as <strong>Aktiva</strong>. If it is required
to have a very high recall value a threshold of 0.44 should be chosen.</p>
<p>The precision-recall-curve for <strong>Passiva</strong> is very similar but there is
a step close to the recall value of 1.0. This has the effect that for a
a guaranteed high recall a very low precision (0.24) and F1 (0.38) has
to be accepted<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>.</p>
<p>The shape of the precision-recall-curve for <strong>GuV</strong> almost perfectly
reaches the top right corner. The highest F1 score is found with a
threshold value of .56. With a threshold value of 0.5 a very high recall
is guaranteed and the F1 score is just a little lower.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="appendix-c---error-rate-guidance-report.html#cb71-1" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span></span>
<span id="cb71-2"><a href="appendix-c---error-rate-guidance-report.html#cb71-2" tabindex="-1"></a>method_name <span class="ot">&lt;-</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb71-3"><a href="appendix-c---error-rate-guidance-report.html#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="appendix-c---error-rate-guidance-report.html#cb71-4" tabindex="-1"></a>df_temp_mistral <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> <span class="fu">calc_flipped_conf_all_types</span>(model_name, method_name)</span>
<span id="cb71-5"><a href="appendix-c---error-rate-guidance-report.html#cb71-5" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-6"><a href="appendix-c---error-rate-guidance-report.html#cb71-6" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-7"><a href="appendix-c---error-rate-guidance-report.html#cb71-7" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp_mistral <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-8"><a href="appendix-c---error-rate-guidance-report.html#cb71-8" tabindex="-1"></a></span>
<span id="cb71-9"><a href="appendix-c---error-rate-guidance-report.html#cb71-9" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb71-10"><a href="appendix-c---error-rate-guidance-report.html#cb71-10" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb71-11"><a href="appendix-c---error-rate-guidance-report.html#cb71-11" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="fu">str_c</span>(model_name, <span class="st">&quot; with &quot;</span>, method_name))</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:micro-pr-curve-llm-binary-1"></span>
<img src="_main_files/figure-html/micro-pr-curve-llm-binary-1-1.png" alt="Showing the precsion-recall-curve for the best performing model." width="100%" />
<p class="caption">
Figure 10.3: Showing the precsion-recall-curve for the best performing model.
</p>
</div>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-identification-llm-confidence">10.4</a> summarizes the
relation between reported confidence and correctness of the
classification for all target types and compares it among the best
performing model-strategy combinations for Ministral-8B-Instruct-2410
and Qwen3-8B. One can see, that the reported confidence for correct and
incorrect classifications are separable in most cases for Mistral-8B.
This separation is worse for Qwen3-8B and worst for target type
<strong>Passiva</strong>.</p>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-identification-llm-confidence-lm">10.5</a> shows, that for
Ministral-8B values with a confidence of 0.7 and more, a human donât has
to double check the classification for target type <strong>GuV</strong>. This
interval is smallest for <strong>Passiva</strong> where only confidences above 0.9
can be fully trusted. These empirical intervals might shrink, once more
data is evaluated. If one is less strict and accepts misclassifiaction
rates of 1 % the found interval for <strong>Passiva</strong> starts at 0.8 and is
probably less depended on the sample evaluated. The percentage of
predictions that can be trusted without risk is greater than 93 % even
for target type <strong>Passiva</strong>.</p>
<p>For Qwen3-8B we find almost no range without any wrong classifications.
For <strong>GuV</strong> this range includes 35 % of all predictions. The ranges that
allow for 1 % of wrong classifications cover 57 % of all predictions at
least.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="appendix-c---error-rate-guidance-report.html#cb72-1" tabindex="-1"></a>confidence_vs_truth_binary <span class="ot">&lt;-</span> df_binary <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="appendix-c---error-rate-guidance-report.html#cb72-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-32B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="appendix-c---error-rate-guidance-report.html#cb72-3" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb72-4"><a href="appendix-c---error-rate-guidance-report.html#cb72-4" tabindex="-1"></a>    <span class="at">mean_f1 =</span> <span class="fu">mean</span>(f1_score, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb72-5"><a href="appendix-c---error-rate-guidance-report.html#cb72-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, classification_type) <span class="sc">%&gt;%</span> </span>
<span id="cb72-6"><a href="appendix-c---error-rate-guidance-report.html#cb72-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_f1)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="appendix-c---error-rate-guidance-report.html#cb72-7" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_f1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="appendix-c---error-rate-guidance-report.html#cb72-8" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb72-9"><a href="appendix-c---error-rate-guidance-report.html#cb72-9" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb72-10"><a href="appendix-c---error-rate-guidance-report.html#cb72-10" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb72-11"><a href="appendix-c---error-rate-guidance-report.html#cb72-11" tabindex="-1"></a>    <span class="co"># truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb72-12"><a href="appendix-c---error-rate-guidance-report.html#cb72-12" tabindex="-1"></a>  )</span>
<span id="cb72-13"><a href="appendix-c---error-rate-guidance-report.html#cb72-13" tabindex="-1"></a></span>
<span id="cb72-14"><a href="appendix-c---error-rate-guidance-report.html#cb72-14" tabindex="-1"></a>confidence_vs_truth_binary <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb72-15"><a href="appendix-c---error-rate-guidance-report.html#cb72-15" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb72-16"><a href="appendix-c---error-rate-guidance-report.html#cb72-16" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence_score, <span class="at">fill =</span> classification_type), </span>
<span id="cb72-17"><a href="appendix-c---error-rate-guidance-report.html#cb72-17" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb72-18"><a href="appendix-c---error-rate-guidance-report.html#cb72-18" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb72-19"><a href="appendix-c---error-rate-guidance-report.html#cb72-19" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb72-20"><a href="appendix-c---error-rate-guidance-report.html#cb72-20" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="sc">~</span> model <span class="sc">+</span> classification_type)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-identification-llm-confidence"></span>
<img src="_main_files/figure-html/table-identification-llm-confidence-1.png" alt="Comparing the reported confidence scores for the page identification task for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
Figure 10.4: Comparing the reported confidence scores for the page identification task for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="appendix-c---error-rate-guidance-report.html#cb73-1" tabindex="-1"></a>confidence_vs_truth_binary <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">confidence =</span> confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="appendix-c---error-rate-guidance-report.html#cb73-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-3"><a href="appendix-c---error-rate-guidance-report.html#cb73-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-4"><a href="appendix-c---error-rate-guidance-report.html#cb73-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb73-5"><a href="appendix-c---error-rate-guidance-report.html#cb73-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-6"><a href="appendix-c---error-rate-guidance-report.html#cb73-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, classification_type, model) <span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="appendix-c---error-rate-guidance-report.html#cb73-7" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-8"><a href="appendix-c---error-rate-guidance-report.html#cb73-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-9"><a href="appendix-c---error-rate-guidance-report.html#cb73-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-10"><a href="appendix-c---error-rate-guidance-report.html#cb73-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb73-11"><a href="appendix-c---error-rate-guidance-report.html#cb73-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb73-12"><a href="appendix-c---error-rate-guidance-report.html#cb73-12" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb73-13"><a href="appendix-c---error-rate-guidance-report.html#cb73-13" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb73-14"><a href="appendix-c---error-rate-guidance-report.html#cb73-14" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb73-15"><a href="appendix-c---error-rate-guidance-report.html#cb73-15" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb73-16"><a href="appendix-c---error-rate-guidance-report.html#cb73-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(classification_type, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb73-17"><a href="appendix-c---error-rate-guidance-report.html#cb73-17" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb73-18"><a href="appendix-c---error-rate-guidance-report.html#cb73-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-19"><a href="appendix-c---error-rate-guidance-report.html#cb73-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb73-20"><a href="appendix-c---error-rate-guidance-report.html#cb73-20" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb73-21"><a href="appendix-c---error-rate-guidance-report.html#cb73-21" tabindex="-1"></a>      chance_false,</span>
<span id="cb73-22"><a href="appendix-c---error-rate-guidance-report.html#cb73-22" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb73-23"><a href="appendix-c---error-rate-guidance-report.html#cb73-23" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb73-24"><a href="appendix-c---error-rate-guidance-report.html#cb73-24" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb73-25"><a href="appendix-c---error-rate-guidance-report.html#cb73-25" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-26"><a href="appendix-c---error-rate-guidance-report.html#cb73-26" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb73-27"><a href="appendix-c---error-rate-guidance-report.html#cb73-27" tabindex="-1"></a>    ),</span>
<span id="cb73-28"><a href="appendix-c---error-rate-guidance-report.html#cb73-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb73-29"><a href="appendix-c---error-rate-guidance-report.html#cb73-29" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-30"><a href="appendix-c---error-rate-guidance-report.html#cb73-30" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> perc, <span class="at">color =</span> chance_low, <span class="at">fill =</span> chance_false_interval), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-31"><a href="appendix-c---error-rate-guidance-report.html#cb73-31" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb73-32"><a href="appendix-c---error-rate-guidance-report.html#cb73-32" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb73-33"><a href="appendix-c---error-rate-guidance-report.html#cb73-33" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb73-34"><a href="appendix-c---error-rate-guidance-report.html#cb73-34" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb73-35"><a href="appendix-c---error-rate-guidance-report.html#cb73-35" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb73-36"><a href="appendix-c---error-rate-guidance-report.html#cb73-36" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-37"><a href="appendix-c---error-rate-guidance-report.html#cb73-37" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb73-38"><a href="appendix-c---error-rate-guidance-report.html#cb73-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb73-39"><a href="appendix-c---error-rate-guidance-report.html#cb73-39" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb73-40"><a href="appendix-c---error-rate-guidance-report.html#cb73-40" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb73-41"><a href="appendix-c---error-rate-guidance-report.html#cb73-41" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-42"><a href="appendix-c---error-rate-guidance-report.html#cb73-42" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb73-43"><a href="appendix-c---error-rate-guidance-report.html#cb73-43" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb73-44"><a href="appendix-c---error-rate-guidance-report.html#cb73-44" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb73-45"><a href="appendix-c---error-rate-guidance-report.html#cb73-45" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb73-46"><a href="appendix-c---error-rate-guidance-report.html#cb73-46" tabindex="-1"></a>  <span class="fu">facet_grid</span>(classification_type <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-identification-llm-confidence-lm"></span>
<img src="_main_files/figure-html/table-identification-llm-confidence-lm-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals" width="100%" />
<p class="caption">
Figure 10.5: Estimating the relative frequency to find a wrong classification over different confidence intervals
</p>
</div>
<p>Discussion:</p>
<ul>
<li><p>Could be more efficient to predict âis any of interestâ and then
which type, because dataset is highly imbalanced.</p></li>
<li><p>Why takes n_rag_examples so much longer?</p></li>
<li><p><strong>Aktiva</strong> and <strong>Passiva</strong> sometimes on the same page and more
similar than <strong>GuV</strong>?</p></li>
<li><p>Recall = 1 for human in the loop (looking at selection of pages that
could be target and none else, if the number of wrong pages are few
=&gt; what says F1 with recall 1?)</p></li>
<li><p>Confidence range to error rate</p></li>
</ul>
</div>
<div id="multi-class-classification-1" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Multi-class classification<a href="appendix-c---error-rate-guidance-report.html#multi-class-classification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence" class="section level5 hasAnchor paragraph-start" number="10.1.2.0.1">
<h5><span class="header-section-number">10.1.2.0.1</span> Confidence<a href="appendix-c---error-rate-guidance-report.html#confidence" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:confidence-match-plot-llama-multi">10.6</a> shows the reported
confidence scores for the predictions for the best performing
model-strategy combination, Llama 4 Scout with <em>3_rag_examples</em>. It is
confident for most correct predictions and only misclassifies some of
the pages with unknown characteristics. The target types are all
recognized correct. All confidences are greater than 0.5. Probably
because there is no case where the confidences for all possible classes
is below 0.5 and there always is a most probable class. It would have
been interesting to use the classification framework of <a href="glossary.html#acronyms_vllm">vLLM</a> to
get predictions for all competing classes. But this requires special
trained models with pooling capability<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="appendix-c---error-rate-guidance-report.html#cb74-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="appendix-c---error-rate-guidance-report.html#cb74-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb74-3"><a href="appendix-c---error-rate-guidance-report.html#cb74-3" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb74-4"><a href="appendix-c---error-rate-guidance-report.html#cb74-4" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="appendix-c---error-rate-guidance-report.html#cb74-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-6"><a href="appendix-c---error-rate-guidance-report.html#cb74-6" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb74-7"><a href="appendix-c---error-rate-guidance-report.html#cb74-7" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb74-8"><a href="appendix-c---error-rate-guidance-report.html#cb74-8" tabindex="-1"></a>  )</span>
<span id="cb74-9"><a href="appendix-c---error-rate-guidance-report.html#cb74-9" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb74-10"><a href="appendix-c---error-rate-guidance-report.html#cb74-10" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb74-11"><a href="appendix-c---error-rate-guidance-report.html#cb74-11" tabindex="-1"></a></span>
<span id="cb74-12"><a href="appendix-c---error-rate-guidance-report.html#cb74-12" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb74-13"><a href="appendix-c---error-rate-guidance-report.html#cb74-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-14"><a href="appendix-c---error-rate-guidance-report.html#cb74-14" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb74-15"><a href="appendix-c---error-rate-guidance-report.html#cb74-15" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb74-16"><a href="appendix-c---error-rate-guidance-report.html#cb74-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb74-17"><a href="appendix-c---error-rate-guidance-report.html#cb74-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb74-18"><a href="appendix-c---error-rate-guidance-report.html#cb74-18" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb74-19"><a href="appendix-c---error-rate-guidance-report.html#cb74-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:confidence-match-plot-llama-multi"></span>
<img src="_main_files/figure-html/confidence-match-plot-llama-multi-1.png" alt="Showing the reported confidence scores for all predictions of Llama 4 Scout grouped by the true target type. Errors have only been made within the majority class." width="100%" />
<p class="caption">
Figure 10.6: Showing the reported confidence scores for all predictions of Llama 4 Scout grouped by the true target type. Errors have only been made within the majority class.
</p>
</div>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:confidence-match-plot-mistral-multi">10.7</a> shows the reported
confidence scores for the predictions for the best performing
model-strategy combination among the small models limited to
<em>n_examples</em> with n smaller five<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a>,
Ministral-8B-Instruct-2410 with <em>3_rag_examples</em>. One can see there are
some wrong classifications for the minority classes as well. Especially,
the <strong>Passiva</strong> target type is often classified as <em>other</em>. This is
problematic for a smooth workflow (see discussion chapter?)</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="appendix-c---error-rate-guidance-report.html#cb75-1" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> df_selected <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb75-2"><a href="appendix-c---error-rate-guidance-report.html#cb75-2" tabindex="-1"></a>  model <span class="sc">==</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, </span>
<span id="cb75-3"><a href="appendix-c---error-rate-guidance-report.html#cb75-3" tabindex="-1"></a>  method <span class="sc">==</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb75-4"><a href="appendix-c---error-rate-guidance-report.html#cb75-4" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="appendix-c---error-rate-guidance-report.html#cb75-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(f1_score))</span>
<span id="cb75-6"><a href="appendix-c---error-rate-guidance-report.html#cb75-6" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>,<span class="st">&quot;predictions&quot;</span>][[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb75-7"><a href="appendix-c---error-rate-guidance-report.html#cb75-7" tabindex="-1"></a>df_flipped_score <span class="ot">&lt;-</span> df_temp <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="appendix-c---error-rate-guidance-report.html#cb75-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-9"><a href="appendix-c---error-rate-guidance-report.html#cb75-9" tabindex="-1"></a>    <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score),</span>
<span id="cb75-10"><a href="appendix-c---error-rate-guidance-report.html#cb75-10" tabindex="-1"></a>    <span class="at">is_aktiva =</span> <span class="fu">str_detect</span>(type, <span class="st">&quot;Aktiva&quot;</span>)</span>
<span id="cb75-11"><a href="appendix-c---error-rate-guidance-report.html#cb75-11" tabindex="-1"></a>  )</span>
<span id="cb75-12"><a href="appendix-c---error-rate-guidance-report.html#cb75-12" tabindex="-1"></a>model_name_best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;model&quot;</span>]</span>
<span id="cb75-13"><a href="appendix-c---error-rate-guidance-report.html#cb75-13" tabindex="-1"></a>method__best_f1_aktiva <span class="ot">&lt;-</span> df_filtered[<span class="dv">1</span>, <span class="st">&quot;method&quot;</span>]</span>
<span id="cb75-14"><a href="appendix-c---error-rate-guidance-report.html#cb75-14" tabindex="-1"></a></span>
<span id="cb75-15"><a href="appendix-c---error-rate-guidance-report.html#cb75-15" tabindex="-1"></a>df_flipped_score <span class="sc">%&gt;%</span> </span>
<span id="cb75-16"><a href="appendix-c---error-rate-guidance-report.html#cb75-16" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb75-17"><a href="appendix-c---error-rate-guidance-report.html#cb75-17" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score)) <span class="sc">+</span></span>
<span id="cb75-18"><a href="appendix-c---error-rate-guidance-report.html#cb75-18" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> predicted_type, <span class="at">y =</span> confidence_score, <span class="at">color =</span> match), <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb75-19"><a href="appendix-c---error-rate-guidance-report.html#cb75-19" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span></span>
<span id="cb75-20"><a href="appendix-c---error-rate-guidance-report.html#cb75-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> model_name_best_f1_aktiva,</span>
<span id="cb75-21"><a href="appendix-c---error-rate-guidance-report.html#cb75-21" tabindex="-1"></a>       <span class="at">subtitle =</span> method__best_f1_aktiva) <span class="sc">+</span></span>
<span id="cb75-22"><a href="appendix-c---error-rate-guidance-report.html#cb75-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:confidence-match-plot-mistral-multi"></span>
<img src="_main_files/figure-html/confidence-match-plot-mistral-multi-1.png" alt="Showing the reported confidence scores for all predictions of Ministral 8B grouped by the true target type. Errors have only been made within the majority class." width="100%" />
<p class="caption">
Figure 10.7: Showing the reported confidence scores for all predictions of Ministral 8B grouped by the true target type. Errors have only been made within the majority class.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="appendix-c---error-rate-guidance-report.html#cb76-1" tabindex="-1"></a>plot_pr_double_curve_multi <span class="ot">&lt;-</span> <span class="cf">function</span>(df, selected_type, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb76-2"><a href="appendix-c---error-rate-guidance-report.html#cb76-2" tabindex="-1"></a>  df_temp2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="appendix-c---error-rate-guidance-report.html#cb76-3" tabindex="-1"></a>    <span class="fu">filter</span>(loop <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="appendix-c---error-rate-guidance-report.html#cb76-4" tabindex="-1"></a>    <span class="fu">select</span>(type, predicted_type, confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="appendix-c---error-rate-guidance-report.html#cb76-5" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb76-6"><a href="appendix-c---error-rate-guidance-report.html#cb76-6" tabindex="-1"></a>      <span class="at">type =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> selected_type, type, <span class="st">&quot;no&quot;</span>),</span>
<span id="cb76-7"><a href="appendix-c---error-rate-guidance-report.html#cb76-7" tabindex="-1"></a>      <span class="at">predicted_type =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> selected_type, predicted_type, <span class="st">&quot;no&quot;</span>)</span>
<span id="cb76-8"><a href="appendix-c---error-rate-guidance-report.html#cb76-8" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb76-9"><a href="appendix-c---error-rate-guidance-report.html#cb76-9" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(selected_type, <span class="st">&quot;no&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb76-10"><a href="appendix-c---error-rate-guidance-report.html#cb76-10" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb76-11"><a href="appendix-c---error-rate-guidance-report.html#cb76-11" tabindex="-1"></a>      <span class="at">confidence_score =</span> <span class="fu">if_else</span>(predicted_type <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">1</span><span class="sc">-</span>confidence_score, confidence_score)</span>
<span id="cb76-12"><a href="appendix-c---error-rate-guidance-report.html#cb76-12" tabindex="-1"></a>    )</span>
<span id="cb76-13"><a href="appendix-c---error-rate-guidance-report.html#cb76-13" tabindex="-1"></a></span>
<span id="cb76-14"><a href="appendix-c---error-rate-guidance-report.html#cb76-14" tabindex="-1"></a>  </span>
<span id="cb76-15"><a href="appendix-c---error-rate-guidance-report.html#cb76-15" tabindex="-1"></a>  <span class="co"># Precision-Recall Curve with ggplot2</span></span>
<span id="cb76-16"><a href="appendix-c---error-rate-guidance-report.html#cb76-16" tabindex="-1"></a>  </span>
<span id="cb76-17"><a href="appendix-c---error-rate-guidance-report.html#cb76-17" tabindex="-1"></a>  pr_df <span class="ot">&lt;-</span> df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_curve</span>(type, confidence_score) <span class="sc">%&gt;%</span></span>
<span id="cb76-18"><a href="appendix-c---error-rate-guidance-report.html#cb76-18" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">threshold =</span> .threshold) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(threshold<span class="sc">&lt;=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-19"><a href="appendix-c---error-rate-guidance-report.html#cb76-19" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">f1 =</span> <span class="dv">2</span> <span class="sc">*</span> precision <span class="sc">*</span> recall <span class="sc">/</span> (precision <span class="sc">+</span> recall))</span>
<span id="cb76-20"><a href="appendix-c---error-rate-guidance-report.html#cb76-20" tabindex="-1"></a>  </span>
<span id="cb76-21"><a href="appendix-c---error-rate-guidance-report.html#cb76-21" tabindex="-1"></a>  pr_auc <span class="ot">&lt;-</span> <span class="fu">round</span>(df_temp2 <span class="sc">%&gt;%</span> <span class="fu">pr_auc</span>(type, confidence_score) <span class="sc">%&gt;%</span> .<span class="sc">$</span>.estimate, <span class="dv">3</span>)</span>
<span id="cb76-22"><a href="appendix-c---error-rate-guidance-report.html#cb76-22" tabindex="-1"></a>  best_F1_row <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb76-23"><a href="appendix-c---error-rate-guidance-report.html#cb76-23" tabindex="-1"></a>  best_F1_row_high_recall <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span> </span>
<span id="cb76-24"><a href="appendix-c---error-rate-guidance-report.html#cb76-24" tabindex="-1"></a>    <span class="fu">filter</span>(recall <span class="sc">&gt;</span> <span class="fl">0.999</span>, precision <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, f1)  </span>
<span id="cb76-25"><a href="appendix-c---error-rate-guidance-report.html#cb76-25" tabindex="-1"></a>  best_F1 <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb76-26"><a href="appendix-c---error-rate-guidance-report.html#cb76-26" tabindex="-1"></a>  best_F1_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall <span class="sc">%&gt;%</span> <span class="fu">pull</span>(f1)</span>
<span id="cb76-27"><a href="appendix-c---error-rate-guidance-report.html#cb76-27" tabindex="-1"></a>  best_threshold <span class="ot">&lt;-</span> best_F1_row  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb76-28"><a href="appendix-c---error-rate-guidance-report.html#cb76-28" tabindex="-1"></a>  best_threshold_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(threshold)</span>
<span id="cb76-29"><a href="appendix-c---error-rate-guidance-report.html#cb76-29" tabindex="-1"></a>  best_precision_high_recall <span class="ot">&lt;-</span> best_F1_row_high_recall  <span class="sc">%&gt;%</span> <span class="fu">pull</span>(precision)</span>
<span id="cb76-30"><a href="appendix-c---error-rate-guidance-report.html#cb76-30" tabindex="-1"></a>  </span>
<span id="cb76-31"><a href="appendix-c---error-rate-guidance-report.html#cb76-31" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb76-32"><a href="appendix-c---error-rate-guidance-report.html#cb76-32" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision)) <span class="sc">+</span></span>
<span id="cb76-33"><a href="appendix-c---error-rate-guidance-report.html#cb76-33" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> threshold), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb76-34"><a href="appendix-c---error-rate-guidance-report.html#cb76-34" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-35"><a href="appendix-c---error-rate-guidance-report.html#cb76-35" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb76-36"><a href="appendix-c---error-rate-guidance-report.html#cb76-36" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Precision-Recall Curve for &quot;</span>, selected_type, <span class="st">&quot; (AUC = &quot;</span>, pr_auc, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb76-37"><a href="appendix-c---error-rate-guidance-report.html#cb76-37" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb76-38"><a href="appendix-c---error-rate-guidance-report.html#cb76-38" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Precision&quot;</span></span>
<span id="cb76-39"><a href="appendix-c---error-rate-guidance-report.html#cb76-39" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb76-40"><a href="appendix-c---error-rate-guidance-report.html#cb76-40" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-41"><a href="appendix-c---error-rate-guidance-report.html#cb76-41" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb76-42"><a href="appendix-c---error-rate-guidance-report.html#cb76-42" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb76-43"><a href="appendix-c---error-rate-guidance-report.html#cb76-43" tabindex="-1"></a>    )</span>
<span id="cb76-44"><a href="appendix-c---error-rate-guidance-report.html#cb76-44" tabindex="-1"></a>  </span>
<span id="cb76-45"><a href="appendix-c---error-rate-guidance-report.html#cb76-45" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> pr_df <span class="sc">%&gt;%</span></span>
<span id="cb76-46"><a href="appendix-c---error-rate-guidance-report.html#cb76-46" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> recall, <span class="at">y =</span> precision, <span class="at">color =</span> f1)) <span class="sc">+</span></span>
<span id="cb76-47"><a href="appendix-c---error-rate-guidance-report.html#cb76-47" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb76-48"><a href="appendix-c---error-rate-guidance-report.html#cb76-48" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb76-49"><a href="appendix-c---error-rate-guidance-report.html#cb76-49" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb76-50"><a href="appendix-c---error-rate-guidance-report.html#cb76-50" tabindex="-1"></a>      <span class="co"># title = &quot;Precision-Recall Curve colored by F1 score&quot;,</span></span>
<span id="cb76-51"><a href="appendix-c---error-rate-guidance-report.html#cb76-51" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Recall&quot;</span>,</span>
<span id="cb76-52"><a href="appendix-c---error-rate-guidance-report.html#cb76-52" tabindex="-1"></a>      <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb76-53"><a href="appendix-c---error-rate-guidance-report.html#cb76-53" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;F1 score&quot;</span></span>
<span id="cb76-54"><a href="appendix-c---error-rate-guidance-report.html#cb76-54" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb76-55"><a href="appendix-c---error-rate-guidance-report.html#cb76-55" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb76-56"><a href="appendix-c---error-rate-guidance-report.html#cb76-56" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb76-57"><a href="appendix-c---error-rate-guidance-report.html#cb76-57" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb76-58"><a href="appendix-c---error-rate-guidance-report.html#cb76-58" tabindex="-1"></a>    ) </span>
<span id="cb76-59"><a href="appendix-c---error-rate-guidance-report.html#cb76-59" tabindex="-1"></a>  </span>
<span id="cb76-60"><a href="appendix-c---error-rate-guidance-report.html#cb76-60" tabindex="-1"></a>  <span class="cf">if</span> (x_stuff <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb76-61"><a href="appendix-c---error-rate-guidance-report.html#cb76-61" tabindex="-1"></a>    g1 <span class="ot">&lt;-</span> g1 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-62"><a href="appendix-c---error-rate-guidance-report.html#cb76-62" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb76-63"><a href="appendix-c---error-rate-guidance-report.html#cb76-63" tabindex="-1"></a>    </span>
<span id="cb76-64"><a href="appendix-c---error-rate-guidance-report.html#cb76-64" tabindex="-1"></a>    g2 <span class="ot">&lt;-</span> g2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb76-65"><a href="appendix-c---error-rate-guidance-report.html#cb76-65" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb76-66"><a href="appendix-c---error-rate-guidance-report.html#cb76-66" tabindex="-1"></a>  }</span>
<span id="cb76-67"><a href="appendix-c---error-rate-guidance-report.html#cb76-67" tabindex="-1"></a>  </span>
<span id="cb76-68"><a href="appendix-c---error-rate-guidance-report.html#cb76-68" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> g1 <span class="sc">+</span> g2</span>
<span id="cb76-69"><a href="appendix-c---error-rate-guidance-report.html#cb76-69" tabindex="-1"></a>  combined_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(</span>
<span id="cb76-70"><a href="appendix-c---error-rate-guidance-report.html#cb76-70" tabindex="-1"></a>    <span class="st">&#39;Best F1 score of &#39;</span>, <span class="fu">round</span>(best_F1,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold,<span class="dv">3</span>), <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>,</span>
<span id="cb76-71"><a href="appendix-c---error-rate-guidance-report.html#cb76-71" tabindex="-1"></a>    <span class="st">&#39;Best F1 score with recall &gt; 0.999 of &#39;</span>, <span class="fu">round</span>(best_F1_high_recall,<span class="dv">3</span>) , <span class="st">&#39; gets reached with threshold of value &#39;</span>, <span class="fu">round</span>(best_threshold_high_recall,<span class="dv">3</span>), <span class="st">&#39; (corresp. precision value: &#39;</span>, <span class="fu">round</span>(best_precision_high_recall,<span class="dv">3</span>) , <span class="st">&#39;)&#39;</span>))</span>
<span id="cb76-72"><a href="appendix-c---error-rate-guidance-report.html#cb76-72" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:micro-pr-curve-llm-multi-ministral">10.8</a> shows the
precision-recall-curve for Ministral-8B-Instruct-2410 with
<em>3_rag_examples</em> twice for each target type. On the left plots the line
color represents the threshold score one could use to decide when to
accept a response as it is. On the right plots the line color is showing
the F1 score that results with a chosen threshold.</p>
<p>The <a href="glossary.html#acronyms_AUC">AUC</a> is highest for <strong>GuV</strong> again. But for the multi-class
classification <strong>Passiva</strong> shows the lowest <a href="glossary.html#acronyms_AUC">AUC</a>, not <strong>Aktiva</strong> as
it was in the binary classification task. The precision-recall-curve for
<strong>Aktiva</strong> and **Passiva*+ show a âstepâ in the area of high recall.
This has a strong effect on the threshold one should choose, if one
wants to guarantee a high recall. The corresponding precision values of
0.2 and 0.13 mean that a human has to check five to eight pages in
average to get a correct classified page of type <strong>Aktiva</strong> and
<strong>Passiva</strong>.</p>
<p>The corresponding plot for the best performing model,
Llama-4-Scout-17B-16E-Instruct, can be found in Figure
<a href="figures.html#fig:micro-pr-curve-llm-multi-llama-scout">14.8</a>. Here the
precision-recall-curve for <strong>Passiva</strong> and <strong>GuV</strong> is almost perfect.
Just the single prediction for <strong>Aktiva</strong> wit a lower confidence shows
an influence on the precision-recall-curve.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="appendix-c---error-rate-guidance-report.html#cb77-1" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span></span>
<span id="cb77-2"><a href="appendix-c---error-rate-guidance-report.html#cb77-2" tabindex="-1"></a>method_name <span class="ot">&lt;-</span> <span class="st">&quot;3_rag_examples&quot;</span></span>
<span id="cb77-3"><a href="appendix-c---error-rate-guidance-report.html#cb77-3" tabindex="-1"></a></span>
<span id="cb77-4"><a href="appendix-c---error-rate-guidance-report.html#cb77-4" tabindex="-1"></a>df_temp_mistral_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="appendix-c---error-rate-guidance-report.html#cb77-5" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb77-6"><a href="appendix-c---error-rate-guidance-report.html#cb77-6" tabindex="-1"></a>    model <span class="sc">==</span> model_name,</span>
<span id="cb77-7"><a href="appendix-c---error-rate-guidance-report.html#cb77-7" tabindex="-1"></a>    method <span class="sc">==</span> method_name</span>
<span id="cb77-8"><a href="appendix-c---error-rate-guidance-report.html#cb77-8" tabindex="-1"></a>  ) <span class="co"># %&gt;% unnest(metrics) # %&gt;% calc_micro_f1(model, method)</span></span>
<span id="cb77-9"><a href="appendix-c---error-rate-guidance-report.html#cb77-9" tabindex="-1"></a>p_aktiva <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-10"><a href="appendix-c---error-rate-guidance-report.html#cb77-10" tabindex="-1"></a>p_passiva <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;Passiva&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-11"><a href="appendix-c---error-rate-guidance-report.html#cb77-11" tabindex="-1"></a>p_guv <span class="ot">&lt;-</span> df_temp_mistral_multi <span class="sc">%&gt;%</span> <span class="fu">plot_pr_double_curve_multi</span>(<span class="st">&quot;GuV&quot;</span>, <span class="at">x_stuff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-12"><a href="appendix-c---error-rate-guidance-report.html#cb77-12" tabindex="-1"></a><span class="co"># p_other &lt;- df_temp_mistral_multi %&gt;% plot_pr_double_curve_multi(&quot;other&quot;, x_stuff = TRUE)</span></span>
<span id="cb77-13"><a href="appendix-c---error-rate-guidance-report.html#cb77-13" tabindex="-1"></a></span>
<span id="cb77-14"><a href="appendix-c---error-rate-guidance-report.html#cb77-14" tabindex="-1"></a><span class="fu">wrap_elements</span>(p_aktiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_passiva) <span class="sc">/</span> <span class="fu">wrap_elements</span>(p_guv) <span class="sc">+</span></span>
<span id="cb77-15"><a href="appendix-c---error-rate-guidance-report.html#cb77-15" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb77-16"><a href="appendix-c---error-rate-guidance-report.html#cb77-16" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="fu">str_c</span>(model_name, <span class="st">&quot; with &quot;</span>, method_name))</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:micro-pr-curve-llm-multi-ministral"></span>
<img src="_main_files/figure-html/micro-pr-curve-llm-multi-ministral-1.png" alt="Showing the precsion-recall-curve for Ministral-8B-Instruct-2410." width="100%" />
<p class="caption">
Figure 10.8: Showing the precsion-recall-curve for Ministral-8B-Instruct-2410.
</p>
</div>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-identification-llm-confidence-multi">10.9</a> summarizes
the relation between reported confidence and correctness of the
classification for all target types and compares it among the best
performing model-strategy combinations for
Llama-4-Scout-17B-16E-Instruct, Ministral-8B-Instruct-2410 and Qwen3-8B.
It seems, as the reported confidence for correct and incorrect
classifications are separable in most cases for Mistral-8B. For Llama 4
Scout this seems not true for the target type <strong>GuV</strong>. For Qwen3-8B
there is almost no separation at all.</p>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-identification-llm-confidence-lm-multi">10.10</a> shows,
that there is almost no area, where the empirical rate of wrong
classifications is zero<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a>. Only for Ministral-8B we find
intervals, where a human donât has to double check the classification
for target types <strong>Aktiva</strong> and <strong>GuV</strong>. These intervals include 90 % of
all predictions. If error rates of 1 % are accepted almost all
predictions by Llama Scout 4 and about 96 % of the predictions by
Ministral-8B are included in the corresponding intervals. For Qwen3-8B
we find no interval without an error rate below 1 %.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="appendix-c---error-rate-guidance-report.html#cb78-1" tabindex="-1"></a>confidence_vs_truth_multi <span class="ot">&lt;-</span> df_multi <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="appendix-c---error-rate-guidance-report.html#cb78-2" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Llama-4-Scout-17B-16E-Instruct&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="appendix-c---error-rate-guidance-report.html#cb78-3" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="appendix-c---error-rate-guidance-report.html#cb78-4" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model, metric_type) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb78-5"><a href="appendix-c---error-rate-guidance-report.html#cb78-5" tabindex="-1"></a>    <span class="at">mean_f1 =</span> <span class="fu">mean</span>(f1_score, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb78-6"><a href="appendix-c---error-rate-guidance-report.html#cb78-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model, metric_type) <span class="sc">%&gt;%</span> </span>
<span id="cb78-7"><a href="appendix-c---error-rate-guidance-report.html#cb78-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_f1)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-8"><a href="appendix-c---error-rate-guidance-report.html#cb78-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_f1, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-9"><a href="appendix-c---error-rate-guidance-report.html#cb78-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>filepath) <span class="sc">%&gt;%</span> </span>
<span id="cb78-10"><a href="appendix-c---error-rate-guidance-report.html#cb78-10" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb78-11"><a href="appendix-c---error-rate-guidance-report.html#cb78-11" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb78-12"><a href="appendix-c---error-rate-guidance-report.html#cb78-12" tabindex="-1"></a>    <span class="co"># truth_NA = factor(truth_NA, levels = c(F, T))</span></span>
<span id="cb78-13"><a href="appendix-c---error-rate-guidance-report.html#cb78-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(metric_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Aktiva&quot;</span>, <span class="st">&quot;Passiva&quot;</span>, <span class="st">&quot;GuV&quot;</span>))</span>
<span id="cb78-14"><a href="appendix-c---error-rate-guidance-report.html#cb78-14" tabindex="-1"></a></span>
<span id="cb78-15"><a href="appendix-c---error-rate-guidance-report.html#cb78-15" tabindex="-1"></a>confidence_vs_truth_multi <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-16"><a href="appendix-c---error-rate-guidance-report.html#cb78-16" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb78-17"><a href="appendix-c---error-rate-guidance-report.html#cb78-17" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence_score, <span class="at">fill =</span> metric_type), </span>
<span id="cb78-18"><a href="appendix-c---error-rate-guidance-report.html#cb78-18" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb78-19"><a href="appendix-c---error-rate-guidance-report.html#cb78-19" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb78-20"><a href="appendix-c---error-rate-guidance-report.html#cb78-20" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb78-21"><a href="appendix-c---error-rate-guidance-report.html#cb78-21" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-identification-llm-confidence-multi"></span>
<img src="_main_files/figure-html/table-identification-llm-confidence-multi-1.png" alt="Comparing the reported confidence scores for the multi-class page identification task for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
Figure 10.9: Comparing the reported confidence scores for the multi-class page identification task for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="appendix-c---error-rate-guidance-report.html#cb79-1" tabindex="-1"></a>confidence_vs_truth_multi <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">confidence =</span> confidence_score) <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="appendix-c---error-rate-guidance-report.html#cb79-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-3"><a href="appendix-c---error-rate-guidance-report.html#cb79-3" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-4"><a href="appendix-c---error-rate-guidance-report.html#cb79-4" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb79-5"><a href="appendix-c---error-rate-guidance-report.html#cb79-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="appendix-c---error-rate-guidance-report.html#cb79-6" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, metric_type, model) <span class="sc">%&gt;%</span></span>
<span id="cb79-7"><a href="appendix-c---error-rate-guidance-report.html#cb79-7" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb79-8"><a href="appendix-c---error-rate-guidance-report.html#cb79-8" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-9"><a href="appendix-c---error-rate-guidance-report.html#cb79-9" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb79-10"><a href="appendix-c---error-rate-guidance-report.html#cb79-10" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb79-11"><a href="appendix-c---error-rate-guidance-report.html#cb79-11" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb79-12"><a href="appendix-c---error-rate-guidance-report.html#cb79-12" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb79-13"><a href="appendix-c---error-rate-guidance-report.html#cb79-13" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb79-14"><a href="appendix-c---error-rate-guidance-report.html#cb79-14" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb79-15"><a href="appendix-c---error-rate-guidance-report.html#cb79-15" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb79-16"><a href="appendix-c---error-rate-guidance-report.html#cb79-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(metric_type, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb79-17"><a href="appendix-c---error-rate-guidance-report.html#cb79-17" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb79-18"><a href="appendix-c---error-rate-guidance-report.html#cb79-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb79-19"><a href="appendix-c---error-rate-guidance-report.html#cb79-19" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb79-20"><a href="appendix-c---error-rate-guidance-report.html#cb79-20" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb79-21"><a href="appendix-c---error-rate-guidance-report.html#cb79-21" tabindex="-1"></a>      chance_false,</span>
<span id="cb79-22"><a href="appendix-c---error-rate-guidance-report.html#cb79-22" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb79-23"><a href="appendix-c---error-rate-guidance-report.html#cb79-23" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb79-24"><a href="appendix-c---error-rate-guidance-report.html#cb79-24" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb79-25"><a href="appendix-c---error-rate-guidance-report.html#cb79-25" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb79-26"><a href="appendix-c---error-rate-guidance-report.html#cb79-26" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb79-27"><a href="appendix-c---error-rate-guidance-report.html#cb79-27" tabindex="-1"></a>    ),</span>
<span id="cb79-28"><a href="appendix-c---error-rate-guidance-report.html#cb79-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb79-29"><a href="appendix-c---error-rate-guidance-report.html#cb79-29" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-30"><a href="appendix-c---error-rate-guidance-report.html#cb79-30" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> conf_center, <span class="at">y =</span> perc, <span class="at">color =</span> chance_low, <span class="at">fill =</span> chance_false_interval), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb79-31"><a href="appendix-c---error-rate-guidance-report.html#cb79-31" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb79-32"><a href="appendix-c---error-rate-guidance-report.html#cb79-32" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb79-33"><a href="appendix-c---error-rate-guidance-report.html#cb79-33" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb79-34"><a href="appendix-c---error-rate-guidance-report.html#cb79-34" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb79-35"><a href="appendix-c---error-rate-guidance-report.html#cb79-35" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb79-36"><a href="appendix-c---error-rate-guidance-report.html#cb79-36" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb79-37"><a href="appendix-c---error-rate-guidance-report.html#cb79-37" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb79-38"><a href="appendix-c---error-rate-guidance-report.html#cb79-38" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb79-39"><a href="appendix-c---error-rate-guidance-report.html#cb79-39" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb79-40"><a href="appendix-c---error-rate-guidance-report.html#cb79-40" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb79-41"><a href="appendix-c---error-rate-guidance-report.html#cb79-41" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-42"><a href="appendix-c---error-rate-guidance-report.html#cb79-42" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb79-43"><a href="appendix-c---error-rate-guidance-report.html#cb79-43" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb79-44"><a href="appendix-c---error-rate-guidance-report.html#cb79-44" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb79-45"><a href="appendix-c---error-rate-guidance-report.html#cb79-45" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb79-46"><a href="appendix-c---error-rate-guidance-report.html#cb79-46" tabindex="-1"></a>  <span class="fu">facet_grid</span>(metric_type <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-identification-llm-confidence-lm-multi"></span>
<img src="_main_files/figure-html/table-identification-llm-confidence-lm-multi-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals for the multi-class classification task." width="100%" />
<p class="caption">
Figure 10.10: Estimating the relative frequency to find a wrong classification over different confidence intervals for the multi-class classification task.
</p>
</div>
</div>
</div>
<div id="extraction-with-llms" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Extraction with LLMs<a href="appendix-c---error-rate-guidance-report.html#extraction-with-llms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="real-tables-1" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Real tables<a href="appendix-c---error-rate-guidance-report.html#real-tables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="appendix-c---error-rate-guidance-report.html#cb80-1" tabindex="-1"></a>confidence_vs_truth_real <span class="ot">&lt;-</span> df_real_table_extraction <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="appendix-c---error-rate-guidance-report.html#cb80-2" tabindex="-1"></a>  <span class="co"># filter(loop == 0) %&gt;% </span></span>
<span id="cb80-3"><a href="appendix-c---error-rate-guidance-report.html#cb80-3" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ministral-8B-Instruct-2410&quot;</span>, <span class="st">&quot;Qwen3-8B&quot;</span>, <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="appendix-c---error-rate-guidance-report.html#cb80-4" tabindex="-1"></a>  <span class="fu">group_by</span>(method, model, loop) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-5"><a href="appendix-c---error-rate-guidance-report.html#cb80-5" tabindex="-1"></a>    <span class="at">mean_percentage_correct_total =</span> <span class="fu">mean</span>(percentage_correct_total, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">.before =</span> <span class="dv">1</span></span>
<span id="cb80-6"><a href="appendix-c---error-rate-guidance-report.html#cb80-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="appendix-c---error-rate-guidance-report.html#cb80-7" tabindex="-1"></a>  <span class="co"># arrange(desc(mean_percentage_correct_total)) %&gt;% </span></span>
<span id="cb80-8"><a href="appendix-c---error-rate-guidance-report.html#cb80-8" tabindex="-1"></a>  <span class="fu">slice_max</span>(mean_percentage_correct_total, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-9"><a href="appendix-c---error-rate-guidance-report.html#cb80-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_processed =</span> <span class="fu">map</span>(predictions, <span class="sc">~</span>{</span>
<span id="cb80-10"><a href="appendix-c---error-rate-guidance-report.html#cb80-10" tabindex="-1"></a>    .x <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="appendix-c---error-rate-guidance-report.html#cb80-11" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">&quot;_merge&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-12"><a href="appendix-c---error-rate-guidance-report.html#cb80-12" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb80-13"><a href="appendix-c---error-rate-guidance-report.html#cb80-13" tabindex="-1"></a>        <span class="at">match =</span> (year_truth <span class="sc">==</span> year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(year_result)),</span>
<span id="cb80-14"><a href="appendix-c---error-rate-guidance-report.html#cb80-14" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_this_year,</span>
<span id="cb80-15"><a href="appendix-c---error-rate-guidance-report.html#cb80-15" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(year_truth),</span>
<span id="cb80-16"><a href="appendix-c---error-rate-guidance-report.html#cb80-16" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(year_result),</span>
<span id="cb80-17"><a href="appendix-c---error-rate-guidance-report.html#cb80-17" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb80-18"><a href="appendix-c---error-rate-guidance-report.html#cb80-18" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb80-19"><a href="appendix-c---error-rate-guidance-report.html#cb80-19" tabindex="-1"></a>        <span class="at">tuple_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb80-20"><a href="appendix-c---error-rate-guidance-report.html#cb80-20" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb80-21"><a href="appendix-c---error-rate-guidance-report.html#cb80-21" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb80-22"><a href="appendix-c---error-rate-guidance-report.html#cb80-22" tabindex="-1"></a>        <span class="at">confidence =</span> confidence_previous_year,</span>
<span id="cb80-23"><a href="appendix-c---error-rate-guidance-report.html#cb80-23" tabindex="-1"></a>        <span class="at">match =</span> (previous_year_truth <span class="sc">==</span> previous_year_result) <span class="sc">|</span> (<span class="fu">is.na</span>(previous_year_truth) <span class="sc">&amp;</span> <span class="fu">is.na</span>(previous_year_result)),</span>
<span id="cb80-24"><a href="appendix-c---error-rate-guidance-report.html#cb80-24" tabindex="-1"></a>        <span class="at">truth_NA =</span> <span class="fu">is.na</span>(previous_year_truth),</span>
<span id="cb80-25"><a href="appendix-c---error-rate-guidance-report.html#cb80-25" tabindex="-1"></a>        <span class="at">predicted_NA =</span> <span class="fu">is.na</span>(previous_year_result),</span>
<span id="cb80-26"><a href="appendix-c---error-rate-guidance-report.html#cb80-26" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">4</span></span>
<span id="cb80-27"><a href="appendix-c---error-rate-guidance-report.html#cb80-27" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">nest</span>(</span>
<span id="cb80-28"><a href="appendix-c---error-rate-guidance-report.html#cb80-28" tabindex="-1"></a>        <span class="at">tuple_previous_year =</span> <span class="fu">c</span>(match, confidence, truth_NA, predicted_NA)</span>
<span id="cb80-29"><a href="appendix-c---error-rate-guidance-report.html#cb80-29" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb80-30"><a href="appendix-c---error-rate-guidance-report.html#cb80-30" tabindex="-1"></a>        <span class="sc">-</span><span class="fu">c</span>(year_truth, previous_year_truth, year_result, previous_year_result,</span>
<span id="cb80-31"><a href="appendix-c---error-rate-guidance-report.html#cb80-31" tabindex="-1"></a>           confidence_this_year, confidence_previous_year)</span>
<span id="cb80-32"><a href="appendix-c---error-rate-guidance-report.html#cb80-32" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb80-33"><a href="appendix-c---error-rate-guidance-report.html#cb80-33" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;E1&quot;</span>, <span class="st">&quot;E2&quot;</span>, <span class="st">&quot;E3&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-34"><a href="appendix-c---error-rate-guidance-report.html#cb80-34" tabindex="-1"></a>      <span class="fu">unnest</span>(<span class="at">cols =</span> value) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-35"><a href="appendix-c---error-rate-guidance-report.html#cb80-35" tabindex="-1"></a>        <span class="at">match =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(match), <span class="cn">FALSE</span>, match)</span>
<span id="cb80-36"><a href="appendix-c---error-rate-guidance-report.html#cb80-36" tabindex="-1"></a>      )</span>
<span id="cb80-37"><a href="appendix-c---error-rate-guidance-report.html#cb80-37" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb80-38"><a href="appendix-c---error-rate-guidance-report.html#cb80-38" tabindex="-1"></a>  <span class="fu">unnest</span>(predictions_processed) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-39"><a href="appendix-c---error-rate-guidance-report.html#cb80-39" tabindex="-1"></a>    <span class="at">match =</span> <span class="fu">factor</span>(match, <span class="at">levels =</span> <span class="fu">c</span>(F, T)),</span>
<span id="cb80-40"><a href="appendix-c---error-rate-guidance-report.html#cb80-40" tabindex="-1"></a>    <span class="at">truth_NA =</span> <span class="fu">factor</span>(truth_NA, <span class="at">levels =</span> <span class="fu">c</span>(F, T))</span>
<span id="cb80-41"><a href="appendix-c---error-rate-guidance-report.html#cb80-41" tabindex="-1"></a>  )</span>
<span id="cb80-42"><a href="appendix-c---error-rate-guidance-report.html#cb80-42" tabindex="-1"></a></span>
<span id="cb80-43"><a href="appendix-c---error-rate-guidance-report.html#cb80-43" tabindex="-1"></a>confidence_intervals_real <span class="ot">&lt;-</span> confidence_vs_truth_real <span class="sc">%&gt;%</span> <span class="co">#rename(confidence = confidence_score) %&gt;% </span></span>
<span id="cb80-44"><a href="appendix-c---error-rate-guidance-report.html#cb80-44" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-45"><a href="appendix-c---error-rate-guidance-report.html#cb80-45" tabindex="-1"></a>    <span class="at">conf_interval =</span> <span class="fu">cut</span>(confidence, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-46"><a href="appendix-c---error-rate-guidance-report.html#cb80-46" tabindex="-1"></a>    <span class="at">conf_center =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">((.+),(.+)</span><span class="sc">\\</span><span class="st">]&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">levels</span>(conf_interval))[conf_interval]) <span class="sc">+</span> <span class="fl">0.025</span></span>
<span id="cb80-47"><a href="appendix-c---error-rate-guidance-report.html#cb80-47" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-48"><a href="appendix-c---error-rate-guidance-report.html#cb80-48" tabindex="-1"></a>  <span class="fu">group_by</span>(conf_center, predicted_NA, model) <span class="sc">%&gt;%</span></span>
<span id="cb80-49"><a href="appendix-c---error-rate-guidance-report.html#cb80-49" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-50"><a href="appendix-c---error-rate-guidance-report.html#cb80-50" tabindex="-1"></a>    <span class="at">n_true =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-51"><a href="appendix-c---error-rate-guidance-report.html#cb80-51" tabindex="-1"></a>    <span class="at">n_false =</span> <span class="fu">sum</span>(match <span class="sc">==</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-52"><a href="appendix-c---error-rate-guidance-report.html#cb80-52" tabindex="-1"></a>    <span class="at">total =</span> n_true <span class="sc">+</span> n_false,</span>
<span id="cb80-53"><a href="appendix-c---error-rate-guidance-report.html#cb80-53" tabindex="-1"></a>    <span class="at">chance_false =</span> <span class="fu">if_else</span>(total <span class="sc">&gt;</span> <span class="dv">0</span>, n_false <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span>, <span class="cn">NA_real_</span>),</span>
<span id="cb80-54"><a href="appendix-c---error-rate-guidance-report.html#cb80-54" tabindex="-1"></a>    <span class="at">chance_zero =</span> chance_false <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb80-55"><a href="appendix-c---error-rate-guidance-report.html#cb80-55" tabindex="-1"></a>    <span class="at">chance_below_1 =</span> chance_false <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb80-56"><a href="appendix-c---error-rate-guidance-report.html#cb80-56" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">if_else</span>(chance_zero, <span class="dv">0</span>, <span class="fu">if_else</span>(chance_below_1, <span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb80-57"><a href="appendix-c---error-rate-guidance-report.html#cb80-57" tabindex="-1"></a>    <span class="at">chance_low =</span> <span class="fu">factor</span>(chance_low, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span>, <span class="st">&quot;below 1 %&quot;</span>, <span class="st">&quot;more&quot;</span>))</span>
<span id="cb80-58"><a href="appendix-c---error-rate-guidance-report.html#cb80-58" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(predicted_NA, model) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb80-59"><a href="appendix-c---error-rate-guidance-report.html#cb80-59" tabindex="-1"></a>    <span class="at">perc =</span> total<span class="sc">/</span><span class="fu">sum</span>(total)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb80-60"><a href="appendix-c---error-rate-guidance-report.html#cb80-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb80-61"><a href="appendix-c---error-rate-guidance-report.html#cb80-61" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-62"><a href="appendix-c---error-rate-guidance-report.html#cb80-62" tabindex="-1"></a>    <span class="at">chance_false_interval =</span> <span class="fu">cut</span>(</span>
<span id="cb80-63"><a href="appendix-c---error-rate-guidance-report.html#cb80-63" tabindex="-1"></a>      chance_false,</span>
<span id="cb80-64"><a href="appendix-c---error-rate-guidance-report.html#cb80-64" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">64</span>, <span class="cn">Inf</span>),</span>
<span id="cb80-65"><a href="appendix-c---error-rate-guidance-report.html#cb80-65" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;[0,1)&quot;</span>, <span class="st">&quot;[1,2)&quot;</span>, <span class="st">&quot;[2,4)&quot;</span>, <span class="st">&quot;[4,8)&quot;</span>, </span>
<span id="cb80-66"><a href="appendix-c---error-rate-guidance-report.html#cb80-66" tabindex="-1"></a>                 <span class="st">&quot;[8,16)&quot;</span>, <span class="st">&quot;[16,32)&quot;</span>, <span class="st">&quot;[32,64)&quot;</span>, <span class="st">&quot;[64,Inf)&quot;</span>),</span>
<span id="cb80-67"><a href="appendix-c---error-rate-guidance-report.html#cb80-67" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb80-68"><a href="appendix-c---error-rate-guidance-report.html#cb80-68" tabindex="-1"></a>      <span class="at">ordered_result =</span> <span class="cn">TRUE</span></span>
<span id="cb80-69"><a href="appendix-c---error-rate-guidance-report.html#cb80-69" tabindex="-1"></a>    ),</span>
<span id="cb80-70"><a href="appendix-c---error-rate-guidance-report.html#cb80-70" tabindex="-1"></a>  )</span>
<span id="cb80-71"><a href="appendix-c---error-rate-guidance-report.html#cb80-71" tabindex="-1"></a></span>
<span id="cb80-72"><a href="appendix-c---error-rate-guidance-report.html#cb80-72" tabindex="-1"></a>conf_scores_top_real <span class="ot">&lt;-</span> confidence_intervals_real <span class="sc">%&gt;%</span> </span>
<span id="cb80-73"><a href="appendix-c---error-rate-guidance-report.html#cb80-73" tabindex="-1"></a>  <span class="fu">filter</span>(conf_center <span class="sc">==</span> <span class="fl">0.975</span>, model <span class="sc">==</span> <span class="st">&quot;Qwen3-235B-A22B-Instruct-2507-FP8&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-74"><a href="appendix-c---error-rate-guidance-report.html#cb80-74" tabindex="-1"></a>  <span class="fu">select</span>(predicted_NA, chance_false) <span class="sc">%&gt;%</span> <span class="fu">deframe</span>()</span></code></pre></div>
</details>
<div id="confidence-1" class="section level5 hasAnchor paragraph-start" number="10.2.1.0.1">
<h5><span class="header-section-number">10.2.1.0.1</span> Confidence<a href="appendix-c---error-rate-guidance-report.html#confidence-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-extraction-llm-confidence">10.11</a> shows, that the
distrubution of the models reported confidence is heterogeneous. Again,
Qwen3-8B reports very high confidence values no matter if the results
are correct or not. Qwen3-235B-A22B-Instruct (and Qwen3-14B) report some
lower confidence scores for predictions, where they are wrong. The
Mistral model again reports a wider range of confidences and for wrong
results the reporetd confidence is lower. But no real separation can be
observed for any of the models.</p>
</div>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-extraction-llm-confidence-lm">10.12</a> helps answering the
question, if the reported confidence score of the responses can be used,
to alert a human that certain predictions might be wrong. In contrast to
the page identification task, we find no confidence intervals where the
mistake rate is equal 0 or less than 1 %. The majority of the
predictions has a very high reported confidence. For the best performing
model Qwen3-235B-A22B-Instruct we find error rates of
3.2631144 % for numeric predictions and
1.32515 % for predicting a missing value.</p>
<p>Thus, we can inform the human about the empirical found error rates but
do not flag some values to be realy trustworthy. In defense for the
model: with manual transcription the error rate is not lower. But we can
inform the human about values that have shown a higher rate of mistakes,
especially for the Ministral model.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="appendix-c---error-rate-guidance-report.html#cb81-1" tabindex="-1"></a>confidence_vs_truth_real <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb81-2"><a href="appendix-c---error-rate-guidance-report.html#cb81-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(</span>
<span id="cb81-3"><a href="appendix-c---error-rate-guidance-report.html#cb81-3" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> match, <span class="at">y =</span> confidence, <span class="at">fill =</span> truth_NA), </span>
<span id="cb81-4"><a href="appendix-c---error-rate-guidance-report.html#cb81-4" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb81-5"><a href="appendix-c---error-rate-guidance-report.html#cb81-5" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="appendix-c---error-rate-guidance-report.html#cb81-6" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="appendix-c---error-rate-guidance-report.html#cb81-7" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-1.png" alt="Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters." width="100%" />
<p class="caption">
Figure 10.11: Comparing the reported confidence scores for the table extraction task on real dataset for the Mistral and Qwen 3 with 8B parameters.
</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="appendix-c---error-rate-guidance-report.html#cb82-1" tabindex="-1"></a>confidence_intervals_real <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="appendix-c---error-rate-guidance-report.html#cb82-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb82-3"><a href="appendix-c---error-rate-guidance-report.html#cb82-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb82-4"><a href="appendix-c---error-rate-guidance-report.html#cb82-4" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb82-5"><a href="appendix-c---error-rate-guidance-report.html#cb82-5" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb82-6"><a href="appendix-c---error-rate-guidance-report.html#cb82-6" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb82-7"><a href="appendix-c---error-rate-guidance-report.html#cb82-7" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="appendix-c---error-rate-guidance-report.html#cb82-8" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb82-9"><a href="appendix-c---error-rate-guidance-report.html#cb82-9" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb82-10"><a href="appendix-c---error-rate-guidance-report.html#cb82-10" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb82-11"><a href="appendix-c---error-rate-guidance-report.html#cb82-11" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb82-12"><a href="appendix-c---error-rate-guidance-report.html#cb82-12" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb82-13"><a href="appendix-c---error-rate-guidance-report.html#cb82-13" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb82-14"><a href="appendix-c---error-rate-guidance-report.html#cb82-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb82-15"><a href="appendix-c---error-rate-guidance-report.html#cb82-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-16"><a href="appendix-c---error-rate-guidance-report.html#cb82-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb82-17"><a href="appendix-c---error-rate-guidance-report.html#cb82-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb82-18"><a href="appendix-c---error-rate-guidance-report.html#cb82-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb82-19"><a href="appendix-c---error-rate-guidance-report.html#cb82-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb82-20"><a href="appendix-c---error-rate-guidance-report.html#cb82-20" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb82-21"><a href="appendix-c---error-rate-guidance-report.html#cb82-21" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb82-22"><a href="appendix-c---error-rate-guidance-report.html#cb82-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-23"><a href="appendix-c---error-rate-guidance-report.html#cb82-23" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence-lm"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-1.png" alt="Estimating the relative frequency to find a wrong classification over different confidence intervals." width="100%" />
<p class="caption">
Figure 10.12: Estimating the relative frequency to find a wrong classification over different confidence intervals.
</p>
</div>
</div>
<div id="synthetic-tables-1" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Synthetic tables<a href="appendix-c---error-rate-guidance-report.html#synthetic-tables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence-2" class="section level5 hasAnchor paragraph-start" number="10.2.2.0.1">
<h5><span class="header-section-number">10.2.2.0.1</span> Confidence<a href="appendix-c---error-rate-guidance-report.html#confidence-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-extraction-llm-confidence-lm-synth">10.13</a> shows, that
we do not find a high confidence interval containing a majority of the
predictions with 0 % error rate. But for Qwen3-235B we find, that the
error rate is below 1 %, except for predicting numeric values, while
ignoring their currency units.</p>
</div>
<p>Figure
<a href="figures.html#fig:table-extraction-llm-confidence-lm-synth-grouped-by-input-format">14.26</a>
groups the responses additonally by the <em>input_format</em> of the documents.
It shows, that with HTML documents Qwen3-235B achieves 0 % error rate
for the prediction of missing values and predicting numeric values, if
currency units get respected.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="appendix-c---error-rate-guidance-report.html#cb83-1" tabindex="-1"></a>confidence_intervals_synth  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_storage/confidence_intervals_synth.rds&quot;</span>)</span>
<span id="cb83-2"><a href="appendix-c---error-rate-guidance-report.html#cb83-2" tabindex="-1"></a></span>
<span id="cb83-3"><a href="appendix-c---error-rate-guidance-report.html#cb83-3" tabindex="-1"></a>confidence_intervals_synth <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="appendix-c---error-rate-guidance-report.html#cb83-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-5"><a href="appendix-c---error-rate-guidance-report.html#cb83-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb83-6"><a href="appendix-c---error-rate-guidance-report.html#cb83-6" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb83-7"><a href="appendix-c---error-rate-guidance-report.html#cb83-7" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb83-8"><a href="appendix-c---error-rate-guidance-report.html#cb83-8" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb83-9"><a href="appendix-c---error-rate-guidance-report.html#cb83-9" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-10"><a href="appendix-c---error-rate-guidance-report.html#cb83-10" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb83-11"><a href="appendix-c---error-rate-guidance-report.html#cb83-11" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb83-12"><a href="appendix-c---error-rate-guidance-report.html#cb83-12" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb83-13"><a href="appendix-c---error-rate-guidance-report.html#cb83-13" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb83-14"><a href="appendix-c---error-rate-guidance-report.html#cb83-14" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb83-15"><a href="appendix-c---error-rate-guidance-report.html#cb83-15" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb83-16"><a href="appendix-c---error-rate-guidance-report.html#cb83-16" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb83-17"><a href="appendix-c---error-rate-guidance-report.html#cb83-17" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-18"><a href="appendix-c---error-rate-guidance-report.html#cb83-18" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb83-19"><a href="appendix-c---error-rate-guidance-report.html#cb83-19" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb83-20"><a href="appendix-c---error-rate-guidance-report.html#cb83-20" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-21"><a href="appendix-c---error-rate-guidance-report.html#cb83-21" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb83-22"><a href="appendix-c---error-rate-guidance-report.html#cb83-22" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb83-23"><a href="appendix-c---error-rate-guidance-report.html#cb83-23" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb83-24"><a href="appendix-c---error-rate-guidance-report.html#cb83-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb83-25"><a href="appendix-c---error-rate-guidance-report.html#cb83-25" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">+</span><span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence-lm-synth"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-synth-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task." width="100%" />
<p class="caption">
Figure 10.13: Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions for the synthetic table extraction task.
</p>
</div>
</div>
<div id="hybrid-aproach" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Hybrid aproach<a href="appendix-c---error-rate-guidance-report.html#hybrid-aproach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="confidence-3" class="section level5 hasAnchor paragraph-start" number="10.2.3.0.1">
<h5><span class="header-section-number">10.2.3.0.1</span> Confidence<a href="appendix-c---error-rate-guidance-report.html#confidence-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Figure <a href="appendix-c---error-rate-guidance-report.html#fig:table-extraction-llm-confidence-lm-synth-context">10.14</a> shows
the rate of wrong predictions for given confidence intervals. Again, the
confidence for predicting a missing value is higher than for predicting
a numeric value. One canât see much difference, but for the best
performing model Qwen3-235B the error rate for numeric values is lower,
when currency units are respected (20 % vs 26 %). But the error rate is
still to high to mark any numeric value as trustful.</p>
</div>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="appendix-c---error-rate-guidance-report.html#cb84-1" tabindex="-1"></a>confidence_intervals_hybrid <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="appendix-c---error-rate-guidance-report.html#cb84-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb84-3"><a href="appendix-c---error-rate-guidance-report.html#cb84-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb84-4"><a href="appendix-c---error-rate-guidance-report.html#cb84-4" tabindex="-1"></a>    <span class="at">x =</span> conf_center, <span class="at">y =</span> perc, </span>
<span id="cb84-5"><a href="appendix-c---error-rate-guidance-report.html#cb84-5" tabindex="-1"></a>    <span class="at">color =</span> chance_low, </span>
<span id="cb84-6"><a href="appendix-c---error-rate-guidance-report.html#cb84-6" tabindex="-1"></a>    <span class="at">fill =</span> chance_false_interval</span>
<span id="cb84-7"><a href="appendix-c---error-rate-guidance-report.html#cb84-7" tabindex="-1"></a>    ), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="appendix-c---error-rate-guidance-report.html#cb84-8" tabindex="-1"></a>  <span class="co"># geom_text(</span></span>
<span id="cb84-9"><a href="appendix-c---error-rate-guidance-report.html#cb84-9" tabindex="-1"></a>  <span class="co">#   aes(x = conf_center, y = perc, label = round(perc, 0)), </span></span>
<span id="cb84-10"><a href="appendix-c---error-rate-guidance-report.html#cb84-10" tabindex="-1"></a>  <span class="co">#   position = position_stack(vjust = 1), vjust = -0.6, </span></span>
<span id="cb84-11"><a href="appendix-c---error-rate-guidance-report.html#cb84-11" tabindex="-1"></a>  <span class="co">#   size = 3, color = &quot;black&quot;</span></span>
<span id="cb84-12"><a href="appendix-c---error-rate-guidance-report.html#cb84-12" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb84-13"><a href="appendix-c---error-rate-guidance-report.html#cb84-13" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;equls 0 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;#00CC00&quot;</span>, <span class="st">&quot;below 1 %&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;more&quot;</span> <span class="ot">=</span> <span class="st">&quot;#555555&quot;</span>)) <span class="sc">+</span></span>
<span id="cb84-14"><a href="appendix-c---error-rate-guidance-report.html#cb84-14" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">&quot;#d53e4f&quot;</span>, <span class="st">&quot;#f46d43&quot;</span>, <span class="st">&quot;#fdae61&quot;</span>, <span class="st">&quot;#fee08b&quot;</span>, <span class="st">&quot;#e6f598&quot;</span>, <span class="st">&quot;#abdda4&quot;</span>, <span class="st">&quot;#66c2a5&quot;</span>, <span class="st">&quot;#3288bd&quot;</span>)), <span class="at">drop=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="appendix-c---error-rate-guidance-report.html#cb84-15" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb84-16"><a href="appendix-c---error-rate-guidance-report.html#cb84-16" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Confidence Interval Center&quot;</span>, </span>
<span id="cb84-17"><a href="appendix-c---error-rate-guidance-report.html#cb84-17" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percentage of predictions&quot;</span>, </span>
<span id="cb84-18"><a href="appendix-c---error-rate-guidance-report.html#cb84-18" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;mistake rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-19"><a href="appendix-c---error-rate-guidance-report.html#cb84-19" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(</span>
<span id="cb84-20"><a href="appendix-c---error-rate-guidance-report.html#cb84-20" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb84-21"><a href="appendix-c---error-rate-guidance-report.html#cb84-21" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb84-22"><a href="appendix-c---error-rate-guidance-report.html#cb84-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb84-23"><a href="appendix-c---error-rate-guidance-report.html#cb84-23" tabindex="-1"></a>  <span class="fu">facet_nested</span>(<span class="fu">paste</span>(<span class="st">&quot;respect units:&quot;</span>, respect_units)<span class="sc">+</span><span class="fu">paste</span>(<span class="st">&quot;predicted NA:&quot;</span>, predicted_NA) <span class="sc">~</span> model)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:table-extraction-llm-confidence-lm-synth-context"></span>
<img src="_main_files/figure-html/table-extraction-llm-confidence-lm-synth-context-1.png" alt="Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning." width="100%" />
<p class="caption">
Figure 10.14: Estimating the relative frequency to find a wrong extraction result over different confidence intervals for predictions based on synthetic examples for in-context learning.
</p>
</div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="32">
<li id="fn32"><p>The model could be forced to return multiple answers,
but it was not. The confidence score is given as log probability.
The exponential function was applied to show the results on the more
common scale of 0 to 1.<a href="appendix-c---error-rate-guidance-report.html#fnref32" class="footnote-back">â©ï¸</a></p></li>
<li id="fn33"><p>There was a single prediction where <a href="glossary.html#acronyms_LLM">LLM</a> predicts
<strong>Aktiva</strong> with high confidence, when the truth is <strong>Passiva</strong>
instead. Because Qwen was showing the same wrong prediction for one
<strong>Passiva</strong> table, I double checked the ground truth. I found, that
the page shows <strong>Aktiva</strong> and <strong>Passiva</strong> simultaneously and was not
correct codified. This was not the only time, where a mistake in the
gold truth was found, by examining potential <a href="glossary.html#acronyms_LLM">LLM</a> mistakes.<a href="appendix-c---error-rate-guidance-report.html#fnref33" class="footnote-back">â©ï¸</a></p></li>
<li id="fn34"><p>Thus, a human has in average to check four pages and
select the correct <strong>Passiva</strong> page among them.<a href="appendix-c---error-rate-guidance-report.html#fnref34" class="footnote-back">â©ï¸</a></p></li>
<li id="fn35"><p>It might be possible to request the n most probable
answers to get confidence scores for all different predictions. But
this was not investigated.<a href="appendix-c---error-rate-guidance-report.html#fnref35" class="footnote-back">â©ï¸</a></p></li>
<li id="fn36"><p>The best performance results with
<em>top_11_rag_examples</em> but the plot was less interesting and its F1
score was not listed in Table
<a href="page-identification-report.html#tab:table-metrics-llm-page-identification-multi-small-models">8.10</a>.<a href="appendix-c---error-rate-guidance-report.html#fnref36" class="footnote-back">â©ï¸</a></p></li>
<li id="fn37"><p>The size of intervals has been narrowed down to 0.1 %
and still there was no range without wrong classification for Llama
4 Scout.<a href="appendix-c---error-rate-guidance-report.html#fnref37" class="footnote-back">â©ï¸</a></p></li>
</ol>
</div>
<script>
// Lightbox functionality for displaying images in a modal view
document.addEventListener("DOMContentLoaded", function () {
  // Create a lightbox container
  const lightbox = document.createElement("div");
  lightbox.id = "lightbox";
  lightbox.style.position = "fixed";
  lightbox.style.top = "0";
  lightbox.style.left = "0";
  lightbox.style.width = "100%";
  lightbox.style.height = "100%";
  lightbox.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
  lightbox.style.display = "none";
  lightbox.style.justifyContent = "center";
  lightbox.style.alignItems = "center";
  lightbox.style.zIndex = "1000";
  document.body.appendChild(lightbox);

  // Add an image element to the lightbox
  const lightboxImage = document.createElement("img");
  lightboxImage.id = "lightbox-image";
  // lightboxImage.style.maxWidth = "90%";
  // lightboxImage.style.maxHeight = "90%";
  lightbox.appendChild(lightboxImage);

  // Close lightbox on click
  lightbox.addEventListener("click", function () {
    lightbox.style.display = "none";
  });

  // Add onclick event to all images except the excluded one
  const images = document.querySelectorAll("img");
  images.forEach((img) => {
    if (img.src.includes("images/BHT_Logo_horizontal_Anthrazit_transparent.svg")) {
      return; // Skip the excluded image
    }
    img.style.cursor = "pointer"; // Change cursor to indicate clickability
    img.addEventListener("click", function () {
      lightboxImage.src = img.src; // Set the lightbox image source
      lightbox.style.display = "flex"; // Show the lightbox
    });
  });
});
</script>

<script>
// Image slider/carousel functionality for divs with class "image-slider"
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-slider').forEach(function (slider) {
    const images = slider.querySelectorAll('img');
    if (images.length < 2) return; // No need for slider if only one image

    // Hide all images except the first
    images.forEach((img, i) => img.style.display = i === 0 ? 'inline' : 'none');
    let current = 0;

    // Create navigation buttons
    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'â¨ Prev';
    prevBtn.style.marginRight = '10px';
    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'Next â©';
    nextBtn.style.marginLeft = '10px';

    // Create a caption container
    const captionContainer = document.createElement('div');
    captionContainer.style.fontStyle = 'italic';
    captionContainer.style.color = '#555';

    // Create a flex container for buttons and caption
    const controlsContainer = document.createElement('div');
    controlsContainer.style.display = 'flex';
    controlsContainer.style.justifyContent = 'space-between';
    controlsContainer.style.alignItems = 'center';
    controlsContainer.style.marginTop = '10px';
    controlsContainer.style.width = '100%';

    // Place buttons and caption in flex container
    controlsContainer.appendChild(prevBtn);
    controlsContainer.appendChild(captionContainer);
    controlsContainer.appendChild(nextBtn);

    // Function to update the caption
    const updateCaption = () => {
      const caption = images[current].nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        captionContainer.textContent = caption.textContent;
      } else {
        captionContainer.textContent = ''; // Clear caption if none exists
      }
    };

    // Function to show the next image
    const showNextImage = () => {
      images[current].style.display = 'none';
      current = (current + 1) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Function to show the previous image
    const showPrevImage = () => {
      images[current].style.display = 'none';
      current = (current - 1 + images.length) % images.length;
      images[current].style.display = 'inline';
      updateCaption();
    };

    // Button click handlers
    prevBtn.onclick = function () {
      stopAutoSlide();
      showPrevImage();
    };
    nextBtn.onclick = function () {
      stopAutoSlide();
      showNextImage();
    };

    // Insert controls container below images
    slider.appendChild(controlsContainer);

    // Automatic sliding
    let autoSlideInterval = setInterval(showNextImage, 2000);

    // Stop automatic sliding on user interaction
    const stopAutoSlide = () => {
      clearInterval(autoSlideInterval);
    };

    // Stop auto-slide when the user interacts with the slider
    prevBtn.addEventListener('click', stopAutoSlide);
    nextBtn.addEventListener('click', stopAutoSlide);
    images.forEach((img) => {
      img.addEventListener('click', stopAutoSlide);
    });

    // Initialize the caption
    updateCaption();
  });
});
</script>

<script>
// Dropdown filter functionality for images with lightbox
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll('.image-selector').forEach(function (selector) {
    const images = selector.querySelectorAll('img');
    if (images.length === 0) return;

    // Create a dropdown filter container
    const filterContainer = document.createElement('div');
    filterContainer.classList.add('filter-container');

    const dropdown = document.createElement('select');
    dropdown.multiple = true;
    dropdown.classList.add('filter-dropdown');

    // Add options to the dropdown
    const uniqueCategories = [];
    images.forEach((img) => {
      const caption = img.nextElementSibling;
      if (caption && caption.classList.contains('image-caption')) {
        const category = caption.textContent.trim();
        if (!uniqueCategories.includes(category)) uniqueCategories.push(category);
      }
    });

    uniqueCategories.forEach((category) => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      // Do NOT set option.selected here!
      dropdown.appendChild(option);
    });

    filterContainer.appendChild(dropdown);
    selector.appendChild(filterContainer);

    // Add a grid container for filtered images
    const gridContainer = document.createElement('div');
    gridContainer.classList.add('image-grid');
    selector.appendChild(gridContainer);

    // Choices.js initialization
    const choices = new Choices(dropdown, {
      removeItemButton: true,
      shouldSort: false,
      searchEnabled: false,
      placeholder: true,
      placeholderValue: 'Filter categories',
    });

    // Clear any existing selection first, then set initial selection
    choices.removeActiveItems(); // This clears existing selections
    choices.setChoiceByValue(uniqueCategories[0]); // This sets only the first category

    // Filtering function
    const filterImages = () => {
      const selectedCategories = Array.from(dropdown.selectedOptions).map(opt => opt.value);
      gridContainer.innerHTML = '';
      let shownWrappers = [];
      images.forEach((img) => {
        const caption = img.nextElementSibling;
        if (caption && caption.classList.contains('image-caption')) {
          const category = caption.textContent.trim();
          if (selectedCategories.includes(category)) {
            const imgWrapper = document.createElement('div');
            imgWrapper.classList.add('image-wrapper');
            const imgClone = img.cloneNode(true);
            imgClone.style.cursor = 'pointer';
            imgClone.addEventListener('click', function () {
              const lightboxImage = document.querySelector("#lightbox img");
              const lightbox = document.querySelector("#lightbox");
              lightboxImage.src = imgClone.src;
              lightbox.style.display = 'flex';
            });
            imgWrapper.appendChild(imgClone);
            const captionClone = caption.cloneNode(true);
            imgWrapper.appendChild(captionClone);
            gridContainer.appendChild(imgWrapper);
            shownWrappers.push(imgWrapper);
          }
        }
      });
      // If only one image is shown, make it span both columns
      if (shownWrappers.length === 1) {
        shownWrappers[0].style.gridColumn = "span 2";
      }
    };

    // Listen for changes from Choices.js
    dropdown.addEventListener('change', filterImages);

    // Initial grid (only first category shown)
    filterImages();
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  var codes = document.querySelectorAll('.hideme');
  var code, i, d, s, p;
  for (i = 0; i < codes.length; i++) {
    code = codes[i];
    p = code.parentNode;
    d = document.createElement('details');
    s = document.createElement('summary');
    s.innerText = 'Details';
    // <details><summary>Details</summary></details>
    d.appendChild(s);
    // move the code into <details>
    p.replaceChild(d, code);
    d.appendChild(code);
  }
});
</script>
            </section>

          </div>
        </div>
      </div>
<a href="appendix-b---information-extraction-report.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-d---feature-effect-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
